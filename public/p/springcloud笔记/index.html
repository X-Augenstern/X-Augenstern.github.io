<!DOCTYPE html>
<html lang="en" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="\n父工程pom 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 &lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt; &lt;project xmlns=&#34;http://maven.apache.org/POM/4.0.0&#34; xmlns:xsi=&#34;http://www.w3.org/2001/XMLSchema-instance&#34; xsi:schemaLocation=&#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&#34;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;com.xz.cloud&lt;/groupId&gt; &lt;artifactId&gt;springcloud&lt;/artifactId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;packaging&gt;pom&lt;/packaging&gt; &lt;modules&gt; &lt;module&gt;mybatis_generator&lt;/module&gt; &lt;module&gt;cloud-provider-payment8001&lt;/module&gt; &lt;module&gt;cloud-consumer-order80&lt;/module&gt; &lt;module&gt;cloud-api-commons&lt;/module&gt; &lt;module&gt;cloud-provider-payment8002&lt;/module&gt; &lt;module&gt;cloud-consumer-feign-order80&lt;/module&gt; &lt;module&gt;cloud-gateway9527&lt;/module&gt; &lt;/modules&gt; &lt;properties&gt; &lt;maven.compiler.source&gt;17&lt;/maven.compiler.source&gt; &lt;maven.compiler.target&gt;17&lt;/maven.compiler.target&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;hutool.version&gt;5.8.22&lt;/hutool.version&gt; &lt;lombok.version&gt;1.18.36&lt;/lombok.version&gt; &lt;druid.version&gt;1.1.23&lt;/druid.version&gt; &lt;mybatis.springboot.version&gt;3.0.4&lt;/mybatis.springboot.version&gt; &lt;mysql.version&gt;8.0.28&lt;/mysql.version&gt; &lt;swagger3.version&gt;2.2.0&lt;/swagger3.version&gt; &lt;mapper.version&gt;4.2.3&lt;/mapper.version&gt; &lt;fastjson2.version&gt;2.0.40&lt;/fastjson2.version&gt; &lt;persistence-api.version&gt;1.0.2&lt;/persistence-api.version&gt; &lt;spring.boot.test.version&gt;3.2.0&lt;/spring.boot.test.version&gt; &lt;spring.boot.version&gt;3.2.0&lt;/spring.boot.version&gt; &lt;spring.cloud.version&gt;2023.0.0&lt;/spring.cloud.version&gt; &lt;spring.cloud.alibaba.version&gt;2023.0.0.0-RC1&lt;/spring.cloud.alibaba.version&gt; &lt;micrometer-tracing.version&gt;1.2.0&lt;/micrometer-tracing.version&gt; &lt;micrometer-observation.version&gt;1.12.0&lt;/micrometer-observation.version&gt; &lt;feign-micrometer.version&gt;12.5&lt;/feign-micrometer.version&gt; &lt;zipkin-reporter-brave.version&gt;2.17.0&lt;/zipkin-reporter-brave.version&gt; &lt;/properties&gt; &lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;!--springboot 3.3.5--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;${spring.boot.version}&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;!--springcloud 2023.0.0--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt; &lt;version&gt;${spring.cloud.version}&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;!--springcloud alibaba 2023.0.0.0-RC1--&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-alibaba-dependencies&lt;/artifactId&gt; &lt;version&gt;${spring.cloud.alibaba.version}&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;!--SpringBoot集成mybatis--&gt; &lt;dependency&gt; &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt; &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;${mybatis.springboot.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!--1、Mysql数据库驱动8 --&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;version&gt;${mysql.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!--2、SpringBoot集成druid连接池--&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;druid-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;${druid.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!--3、通用Mapper4之tk.mybatis--&gt; &lt;dependency&gt; &lt;groupId&gt;tk.mybatis&lt;/groupId&gt; &lt;artifactId&gt;mapper&lt;/artifactId&gt; &lt;version&gt;${mapper.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!--4、persistence--&gt; &lt;dependency&gt; &lt;groupId&gt;javax.persistence&lt;/groupId&gt; &lt;artifactId&gt;persistence-api&lt;/artifactId&gt; &lt;version&gt;${persistence-api.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!-- fastjson2 --&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.fastjson2&lt;/groupId&gt; &lt;artifactId&gt;fastjson2&lt;/artifactId&gt; &lt;version&gt;${fastjson2.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!-- swagger3 调用方式 http://你的主机IP地址:5555/swagger-ui/index.html --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springdoc&lt;/groupId&gt; &lt;artifactId&gt;springdoc-openapi-starter-webmvc-ui&lt;/artifactId&gt; &lt;version&gt;${swagger3.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!--hutool--&gt; &lt;dependency&gt; &lt;groupId&gt;cn.hutool&lt;/groupId&gt; &lt;artifactId&gt;hutool-all&lt;/artifactId&gt; &lt;version&gt;${hutool.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!--lombok--&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;version&gt;${lombok.version}&lt;/version&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;!-- spring-boot-starter-test --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;version&gt;${spring.boot.test.version}&lt;/version&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;!--micrometer-tracing-bom导入链路追踪版本中心 1--&gt; &lt;dependency&gt; &lt;groupId&gt;io.micrometer&lt;/groupId&gt; &lt;artifactId&gt;micrometer-tracing-bom&lt;/artifactId&gt; &lt;version&gt;${micrometer-tracing.version}&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;!--micrometer-tracing指标追踪 2--&gt; &lt;dependency&gt; &lt;groupId&gt;io.micrometer&lt;/groupId&gt; &lt;artifactId&gt;micrometer-tracing&lt;/artifactId&gt; &lt;version&gt;${micrometer-tracing.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!--micrometer-tracing-bridge-brave适配zipkin的桥接包 3--&gt; &lt;dependency&gt; &lt;groupId&gt;io.micrometer&lt;/groupId&gt; &lt;artifactId&gt;micrometer-tracing-bridge-brave&lt;/artifactId&gt; &lt;version&gt;${micrometer-tracing.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!--micrometer-observation 4--&gt; &lt;dependency&gt; &lt;groupId&gt;io.micrometer&lt;/groupId&gt; &lt;artifactId&gt;micrometer-observation&lt;/artifactId&gt; &lt;version&gt;${micrometer-observation.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!--feign-micrometer 5--&gt; &lt;dependency&gt; &lt;groupId&gt;io.github.openfeign&lt;/groupId&gt; &lt;artifactId&gt;feign-micrometer&lt;/artifactId&gt; &lt;version&gt;${feign-micrometer.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!--zipkin-reporter-brave 6--&gt; &lt;dependency&gt; &lt;groupId&gt;io.zipkin.reporter2&lt;/groupId&gt; &lt;artifactId&gt;zipkin-reporter-brave&lt;/artifactId&gt; &lt;version&gt;${zipkin-reporter-brave.version}&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/dependencyManagement&gt; &lt;/project&gt; mybatis_generate（代码生成） pom 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 &lt;!--自己独一份，只是一个普通Maven工程，与boot和cloud无关--&gt; &lt;dependencies&gt; &lt;!--Mybatis 通用mapper tk单独使用，自己独有+自带版本号--&gt; &lt;dependency&gt; &lt;groupId&gt;org.mybatis&lt;/groupId&gt; &lt;artifactId&gt;mybatis&lt;/artifactId&gt; &lt;version&gt;3.5.15&lt;/version&gt; &lt;/dependency&gt; &lt;!-- Mybatis Generator 自己独有+自带版本号--&gt; &lt;dependency&gt; &lt;groupId&gt;org.mybatis.generator&lt;/groupId&gt; &lt;artifactId&gt;mybatis-generator-core&lt;/artifactId&gt; &lt;version&gt;1.4.2&lt;/version&gt; &lt;/dependency&gt; &lt;!--通用Mapper--&gt; &lt;dependency&gt; &lt;groupId&gt;tk.mybatis&lt;/groupId&gt; &lt;artifactId&gt;mapper&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--mysql8.0--&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--persistence--&gt; &lt;dependency&gt; &lt;groupId&gt;javax.persistence&lt;/groupId&gt; &lt;artifactId&gt;persistence-api&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--hutool--&gt; &lt;dependency&gt; &lt;groupId&gt;cn.hutool&lt;/groupId&gt; &lt;artifactId&gt;hutool-all&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--lombok--&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;org.junit.vintage&lt;/groupId&gt; &lt;artifactId&gt;junit-vintage-engine&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;resources&gt; &lt;resource&gt; &lt;directory&gt;${basedir}/src/main/java&lt;/directory&gt; &lt;includes&gt; &lt;include&gt;**/*.xml&lt;/include&gt; &lt;/includes&gt; &lt;/resource&gt; &lt;resource&gt; &lt;directory&gt;${basedir}/src/main/resources&lt;/directory&gt; &lt;/resource&gt; &lt;/resources&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;configuration&gt; &lt;excludes&gt; &lt;exclude&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;/exclude&gt; &lt;/excludes&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;plugin&gt; &lt;groupId&gt;org.mybatis.generator&lt;/groupId&gt; &lt;artifactId&gt;mybatis-generator-maven-plugin&lt;/artifactId&gt; &lt;version&gt;1.4.2&lt;/version&gt; &lt;configuration&gt; &lt;configurationFile&gt;${basedir}/src/main/resources/generatorConfig.xml&lt;/configurationFile&gt; &lt;overwrite&gt;true&lt;/overwrite&gt; &lt;verbose&gt;true&lt;/verbose&gt; &lt;/configuration&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;version&gt;8.0.28&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;tk.mybatis&lt;/groupId&gt; &lt;artifactId&gt;mapper&lt;/artifactId&gt; &lt;version&gt;4.2.3&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; config.properties 1 2 3 4 5 6 7 8 9 10 11 #t_pay??? package.name=com.xz.springcloud # mysql8.0 jdbc.driverClass = com.mysql.cj.jdbc.Driver # jdbc.url= jdbc:mysql://localhost:3306/db2024?characterEncoding=utf8&amp;useSSL=false&amp;serverTimezone=GMT%2B8&amp;rewriteBatchedStatements=true&amp;allowPublicKeyRetrieval=true # jdbc.url= jdbc:mysql://localhost:3306/seata_order?characterEncoding=utf8&amp;useSSL=false&amp;serverTimezone=GMT%2B8&amp;rewriteBatchedStatements=true&amp;allowPublicKeyRetrieval=true # jdbc.url= jdbc:mysql://localhost:3306/seata_storage?characterEncoding=utf8&amp;useSSL=false&amp;serverTimezone=GMT%2B8&amp;rewriteBatchedStatements=true&amp;allowPublicKeyRetrieval=true jdbc.url= jdbc:mysql://localhost:3306/seata_account?characterEncoding=utf8&amp;useSSL=false&amp;serverTimezone=GMT%2B8&amp;rewriteBatchedStatements=true&amp;allowPublicKeyRetrieval=true jdbc.user = root jdbc.password =527644117 generateConfig.xml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 &lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt; &lt;!DOCTYPE generatorConfiguration PUBLIC &#34;-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN&#34; &#34;http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd&#34;&gt; &lt;generatorConfiguration&gt; &lt;properties resource=&#34;config.properties&#34;/&gt; &lt;context id=&#34;Mysql&#34; targetRuntime=&#34;MyBatis3Simple&#34; defaultModelType=&#34;flat&#34;&gt; &lt;property name=&#34;beginningDelimiter&#34; value=&#34;`&#34;/&gt; &lt;property name=&#34;endingDelimiter&#34; value=&#34;`&#34;/&gt; &lt;plugin type=&#34;tk.mybatis.mapper.generator.MapperPlugin&#34;&gt; &lt;property name=&#34;mappers&#34; value=&#34;tk.mybatis.mapper.common.Mapper&#34;/&gt; &lt;property name=&#34;caseSensitive&#34; value=&#34;true&#34;/&gt; &lt;/plugin&gt; &lt;jdbcConnection driverClass=&#34;${jdbc.driverClass}&#34; connectionURL=&#34;${jdbc.url}&#34; userId=&#34;${jdbc.user}&#34; password=&#34;${jdbc.password}&#34;&gt; &lt;/jdbcConnection&gt; &lt;javaModelGenerator targetPackage=&#34;${package.name}.entities&#34; targetProject=&#34;src/main/java&#34;/&gt; &lt;sqlMapGenerator targetPackage=&#34;${package.name}.mapper&#34; targetProject=&#34;src/main/java&#34;/&gt; &lt;javaClientGenerator targetPackage=&#34;${package.name}.mapper&#34; targetProject=&#34;src/main/java&#34; type=&#34;XMLMAPPER&#34;/&gt; &lt;!--&lt;table tableName=&#34;t_pay&#34; domainObjectName=&#34;Pay&#34;&gt; &lt;generatedKey column=&#34;id&#34; sqlStatement=&#34;JDBC&#34;/&gt; &lt;/table&gt;--&gt; &lt;!-- seata_order --&gt; &lt;!--&lt;table tableName=&#34;t_order&#34; domainObjectName=&#34;Order&#34;&gt; &lt;generatedKey column=&#34;id&#34; sqlStatement=&#34;JDBC&#34;/&gt; &lt;/table&gt;--&gt; &lt;!-- seate_storage --&gt; &lt;!--&lt;table tableName=&#34;t_storage&#34; domainObjectName=&#34;Storage&#34;&gt; &lt;generatedKey column=&#34;id&#34; sqlStatement=&#34;JDBC&#34;/&gt; &lt;/table&gt;--&gt; &lt;!-- seate_account --&gt; &lt;table tableName=&#34;t_account&#34; domainObjectName=&#34;Account&#34;&gt; &lt;generatedKey column=&#34;id&#34; sqlStatement=&#34;JDBC&#34;/&gt; &lt;/table&gt; &lt;/context&gt; &lt;/generatorConfiguration&gt; cloud-api-commons（install为jar包供其它微服务使用、OpenFeign、OpenFeign+Sentinel） pom 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 &lt;dependencies&gt; &lt;!--SpringBoot通用依赖模块--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;!--hutool--&gt; &lt;dependency&gt; &lt;groupId&gt;cn.hutool&lt;/groupId&gt; &lt;artifactId&gt;hutool-all&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--openfeign--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/dependencies&gt; apis PayFeignAPi 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 /** * 微服务提供者8001对外暴露接口 */ // @FeignClient(&#34;cloud-payment-service&#34;) // 就是去注册中心的指定微服务上找相同uri然后调用相应的微服务方法 @FeignClient(&#34;cloud-gateway&#34;) /* 此时再关闭网关 { &#34;code&#34;: &#34;500&#34;, &#34;message&#34;: &#34;[503] during [GET] to [http://cloud-gateway/pay/gateway/info] [PayFeignAPi#getGatewayInfo()]: [Load balancer does not contain an instance for the service cloud-gateway]&#34;, &#34;data&#34;: null, &#34;timestamp&#34;: 1733728892254 } 再开启网关 { &#34;code&#34;: &#34;200&#34;, &#34;message&#34;: &#34;success&#34;, &#34;data&#34;: &#34;gateway info test: 5e6f3b3eb1d845f5bc86bbd759bd9084&#34;, &#34;timestamp&#34;: 1733728974072 } 现在三个url都可以访问服务： http://localhost:8001/pay/gateway/info http://localhost:9527/pay/gateway/info http://localhost:80/feign/pay/gateway/info */ public interface PayFeignAPi { /** * 增加一条支付相关流水记录 * * @param payDTO * @return */ @PostMapping(&#34;/pay/add&#34;) ResultData addPay(@RequestBody PayDTO payDTO); /** * 按照主键记录查询支付流水信息 * * @param id * @return */ @GetMapping(&#34;/pay/get/{id}&#34;) ResultData getPayInfo(@PathVariable(&#34;id&#34;) Integer id); /** * openfeign天然支持负载均衡演示 * * @return */ @GetMapping(&#34;/pay/get/info&#34;) String mylb(); @GetMapping(&#34;/pay/circuit/{id}&#34;) String myCircuit(@PathVariable(&#34;id&#34;) Integer id); @GetMapping(&#34;/pay/bulkhead/{id}&#34;) String myBulkhead(@PathVariable(&#34;id&#34;) Integer id); @GetMapping(&#34;/pay/ratelimit/{id}&#34;) String myRatelimit(@PathVariable(&#34;id&#34;) Integer id); @GetMapping(&#34;/pay/micrometer/{id}&#34;) String myMicrometer(@PathVariable(&#34;id&#34;) Integer id); @GetMapping(&#34;/pay/gateway/get/{id}&#34;) ResultData getById(@PathVariable(&#34;id&#34;) Integer id); @GetMapping(&#34;/pay/gateway/info&#34;) ResultData&lt;String&gt; getGatewayInfo(); } PayFeignSentinelAPi：OpenFeign+Sentinel 1 2 3 4 5 6 @FeignClient(value = &#34;nacos-payment-provider&#34;,fallback = PayFeignSentinelApiFallBack.class) // 谁提供服务写谁/转发给谁写谁 public interface PayFeignSentinelApi { @GetMapping(&#34;/pay/nacos/get/{orderNo}&#34;) ResultData getPayByOrderNo(@PathVariable(&#34;orderNo&#34;) String orderNo); } PayFeignSentinelApiFallBack 1 2 3 4 5 6 7 @Component public class PayFeignSentinelApiFallBack implements PayFeignSentinelApi { @Override public ResultData getPayByOrderNo(String orderNo) { return ResultData.fail(ReturnCodeEnum.RC500.getCode(), &#34;对方服务宕机或不可用，FallBack服务降级&#34;); } } StorageFeignApi 1 2 3 4 5 6 7 8 @FeignClient(&#34;seata-storage-service&#34;) public interface StorageFeignApi { /** * 扣减库存 */ @GetMapping(&#34;storage/decrease&#34;) ResultData decrease(@RequestParam(&#34;productId&#34;) Long productId, @RequestParam(&#34;count&#34;) Integer count); } AccountFeignAPi 1 2 3 4 5 6 7 8 @FeignClient(&#34;seata-account-service&#34;) public interface AccountFeignAPi { /** * 扣减余额 */ @GetMapping(&#34;/account/decrease&#34;) ResultData decrease(@RequestParam(&#34;userId&#34;) Long userId, @RequestParam(&#34;money&#34;) Long money); } entities.PayDTO 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 /** * DTO（数据传输对象） * 目的：DTO 主要用于数据传输，尤其是在分布式系统或不同层之间传递数据时。它通常是从数据库或服务中提取的数据对象，经过加工后用于传输。 * 特性： * 主要用于不同系统、模块之间的通信，避免传递过多的细节。 * 可能包含冗余数据或不同领域的数据，目的是为了提高传输效率。 * DTO 通常是无业务逻辑的，仅作为数据的载体。 * 可以是可变的，通常包含 setter 和 getter 方法。 * * dto中的字段实体类中一定存在，vo中的字段实体类中不一定存在 * dto是前端传给后端的，vo是后端传给前端的 * * 一般而言，调用者不应该获悉服务提供者的entity资源并知道表结构关系，所以服务提供方给出的接口文档都应为DTO */ @Data @NoArgsConstructor @AllArgsConstructor public class PayDTO implements Serializable { private Integer id; // 支付流水号 private String payNo; // 订单流水号 private String orderNo; // 用户账号ID private Integer userId; // 交易金额 private BigDecimal amount; } exp.GlobalExceptionHandler 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 /** * 全局异常 * * @ControllerAdvice 是一个用于处理全局异常的类注解，它可以捕获所有控制器中的异常并统一处理。 * 如果希望返回视图而不是直接返回 JSON，可以使用 @ControllerAdvice。 * * @RestControllerAdvice 是 @ControllerAdvice 和 @ResponseBody 的组合，它适用于返回 JSON 或其他对象响应体的情况。通常用于 RESTful 风格的 Web 服务中。 * * @RestControllerAdvice（或 @ControllerAdvice） * 这个注解的作用是将类标记为全局异常处理器，即所有控制器中的异常都会通过这个类来统一处理。它本身并不直接指定处理哪种类型的异常，而是用来指示一个类是用来处理异常的。 * * @ExceptionHandler(RuntimeException.class) * 这个注解是用来处理 特定类型的异常 的。它通常放在一个异常处理方法上，指定该方法捕获 RuntimeException 类型的异常。 * @ExceptionHandler 可以放在任何控制器类或者 @ControllerAdvice 类中，它用来拦截并处理指定类型的异常。 */ @Slf4j @RestControllerAdvice // 该类会对所有的控制器类进行增强处理，并且方法的返回值会直接转换成响应体的内容，标记 GlobalExceptionHandler 类是用来处理异常的 public class GlobalExceptionHandler { @ExceptionHandler(RuntimeException.class) // 标明当发生 RuntimeException 时，exception 方法会被调用，返回统一的错误响应。 @ResponseStatus(HttpStatus.INTERNAL_SERVER_ERROR) // 当这个异常被捕获时，HTTP 响应的状态码会设置为 500（内部服务器错误）。 public ResultData&lt;String&gt; exception(Exception e) { System.out.println(&#34;come in GlobalExceptionHandler&#34;); // 2024-12-04T18:41:14.992+08:00 ERROR 12528 --- [cloud-payment-service] [io-8001-exec-10] c.x.s.exp.GlobalExceptionHandler : 全局异常信息：id不能为负数 log.error(&#34;全局异常信息：{}&#34;, e.getMessage(), e); return ResultData.fail(ReturnCodeEnum.RC500.getCode(), e.getMessage()); /* { &#34;code&#34;: &#34;500&#34;, &#34;message&#34;: &#34;id不能为负数&#34;, &#34;data&#34;: null, &#34;timestamp&#34;: 1733308874996 } */ } } resp ResultData 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 /** * 返回对象 * * 定义返回格式： * 3大标准： * code：由后端统一定义各种返回结果的状态码 * message：本次接口调用的结果描述 * data：本次返回的数据 * timestamp：接口调用的时间 * * @param &lt;T&gt; */ @Data @Accessors(chain = true) // 链式编程 public class ResultData&lt;T&gt; { private String code; private String message; private T data; private long timestamp; public ResultData() { this.timestamp = System.currentTimeMillis(); } /** * 为什么需要显式声明 &lt;T&gt;？ * 静态方法和实例方法的区别： * ResultData&lt;T&gt; 是一个泛型类，而 success(T data) 是静态方法。静态方法与类的实例无关，因此它无法直接访问类的实例化泛型类型。为了解决这个问题，静态方法需要自己声明泛型类型。 * 如果 success 方法是实例方法（即不加 static），那么它可以访问类级别的泛型 T，不需要再显式声明 &lt;T&gt;。但由于 success 是静态方法，它没有类实例，因此无法直接使用类的泛型类型。 */ public static &lt;T&gt; ResultData&lt;T&gt; success(T data) { ResultData&lt;T&gt; resultData = new ResultData&lt;&gt;(); resultData.setCode(ReturnCodeEnum.RC200.getCode()); resultData.setMessage(ReturnCodeEnum.RC200.getMessage()); resultData.setData(data); return resultData; } public static &lt;T&gt; ResultData&lt;T&gt; fail(String code,String message){ ResultData&lt;T&gt; resultData = new ResultData&lt;&gt;(); resultData.setCode(code); resultData.setMessage(message); resultData.setData(null); return resultData; } } ReturnCodeEnum 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 /** * HTTP返回的状态码 */ @Getter public enum ReturnCodeEnum { // 1、举值 /**操作失败**/ RC999(&#34;999&#34;,&#34;操作XXX失败&#34;), /**操作成功**/ RC200(&#34;200&#34;,&#34;success&#34;), /**服务降级**/ RC201(&#34;201&#34;,&#34;服务开启降级保护,请稍后再试!&#34;), /**热点参数限流**/ RC202(&#34;202&#34;,&#34;热点参数限流,请稍后再试!&#34;), /**系统规则不满足**/ RC203(&#34;203&#34;,&#34;系统规则不满足要求,请稍后再试!&#34;), /**授权规则不通过**/ RC204(&#34;204&#34;,&#34;授权规则不通过,请稍后再试!&#34;), RC375(&#34;375&#34;,&#34;数学运算异常，请稍后重试&#34;), /**access_denied**/ RC403(&#34;403&#34;,&#34;无访问权限,请联系管理员授予权限&#34;), /**access_denied**/ RC401(&#34;401&#34;,&#34;匿名用户访问无权限资源时的异常&#34;), RC404(&#34;404&#34;,&#34;404页面找不到的异常&#34;), /**服务异常**/ RC500(&#34;500&#34;,&#34;系统异常，请稍后重试&#34;), INVALID_TOKEN(&#34;2001&#34;,&#34;访问令牌不合法&#34;), ACCESS_DENIED(&#34;2003&#34;,&#34;没有权限访问该资源&#34;), CLIENT_AUTHENTICATION_FAILED(&#34;1001&#34;,&#34;客户端认证失败&#34;), USERNAME_OR_PASSWORD_ERROR(&#34;1002&#34;,&#34;用户名或密码错误&#34;), BUSINESS_ERROR(&#34;1004&#34;,&#34;业务逻辑异常&#34;), UNSUPPORTED_GRANT_TYPE(&#34;1003&#34;, &#34;不支持的认证模式&#34;); // 2、构造 /**自定义状态码**/ private final String code; /**自定义描述**/ private final String message; ReturnCodeEnum(String code, String message){ this.code = code; this.message = message; } // 3、传统遍历 public static ReturnCodeEnum getReturnCodeEnumV1(String code) { for (ReturnCodeEnum element : ReturnCodeEnum.values()) { if(element.getCode().equalsIgnoreCase(code)) { return element; } } return null; } // 3、流式计算遍历 public static ReturnCodeEnum getReturnCodeEnumV2(String code) { return Arrays.stream(ReturnCodeEnum.values()).filter(x -&gt; x.getCode().equalsIgnoreCase(code)).findFirst().orElse(null); } // public static void main(String[] args) // { // System.out.println(getReturnCodeEnumV2(&#34;200&#34;)); // RC200这条枚举记录（RC200(&#34;200&#34;,&#34;success&#34;)） // System.out.println(getReturnCodeEnumV2(&#34;200&#34;).getCode()); // 200 // System.out.println(getReturnCodeEnumV2(&#34;200&#34;).getMessage()); // success // } } …………………………………………………………………… cloud-provider-payment8001（service） pom 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 &lt;dependencies&gt; &lt;!--SpringBoot通用依赖模块--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--SpringBoot集成druid连接池--&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;druid-spring-boot-starter&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- Swagger3 调用方式 http://localhost:8001/swagger-ui/index.html --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springdoc&lt;/groupId&gt; &lt;artifactId&gt;springdoc-openapi-starter-webmvc-ui&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--mybatis和springboot整合--&gt; &lt;dependency&gt; &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt; &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--Mysql数据库驱动8 --&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--persistence--&gt; &lt;dependency&gt; &lt;groupId&gt;javax.persistence&lt;/groupId&gt; &lt;artifactId&gt;persistence-api&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--通用Mapper4--&gt; &lt;dependency&gt; &lt;groupId&gt;tk.mybatis&lt;/groupId&gt; &lt;artifactId&gt;mapper&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--hutool--&gt; &lt;dependency&gt; &lt;groupId&gt;cn.hutool&lt;/groupId&gt; &lt;artifactId&gt;hutool-all&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- fastjson2 --&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.fastjson2&lt;/groupId&gt; &lt;artifactId&gt;fastjson2&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--lombok--&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;scope&gt;provided&lt;/scope&gt; &lt;/dependency&gt; &lt;!--test--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;!--SpringCloud consul discovery --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-consul-discovery&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--SpringCloud consul config--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-consul-config&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-bootstrap&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- 引入cloud-api-commons通用包 --&gt; &lt;dependency&gt; &lt;groupId&gt;com.xz.cloud&lt;/groupId&gt; &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/dependency&gt; &lt;!--micrometer-tracing指标追踪 2--&gt; &lt;dependency&gt; &lt;groupId&gt;io.micrometer&lt;/groupId&gt; &lt;artifactId&gt;micrometer-tracing&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--micrometer-tracing-bridge-brave适配zipkin的桥接包 3--&gt; &lt;dependency&gt; &lt;groupId&gt;io.micrometer&lt;/groupId&gt; &lt;artifactId&gt;micrometer-tracing-bridge-brave&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--micrometer-observation 4--&gt; &lt;dependency&gt; &lt;groupId&gt;io.micrometer&lt;/groupId&gt; &lt;artifactId&gt;micrometer-observation&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--feign-micrometer 5--&gt; &lt;dependency&gt; &lt;groupId&gt;io.github.openfeign&lt;/groupId&gt; &lt;artifactId&gt;feign-micrometer&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--zipkin-reporter-brave 6--&gt; &lt;dependency&gt; &lt;groupId&gt;io.zipkin.reporter2&lt;/groupId&gt; &lt;artifactId&gt;zipkin-reporter-brave&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; yml bootstrap：pom需要引入SpringCloud consul config、bootstrap、Consul、Micrometer+ZipKin 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 # application.yml是用户级的资源配置项 # bootstrap.yml是系统级的，优先级更加高 # Spring Cloud会创建一个“Bootstrap Context”，作为Spring应用的`Application Context`的父上下文。 # 初始化的时候，`Bootstrap Context`负责从外部源加载配置属性并解析配置。这两个上下文共享一个从外部获取的`Environment`。 # Bootstrap`属性有高优先级，默认情况下，它们不会被本地配置覆盖。 # `Bootstrap context`和`Application Context`有着不同的约定，所以新增了一个`bootstrap.yml`文件，保证`Bootstrap Context`和`Application Context`配置的分离。 # application.yml文件改为bootstrap.yml,这是很关键的或者两者共存 # 因为bootstrap.yml是比application.yml先加载的。bootstrap.yml优先级高于application.yml spring: application: name: cloud-payment-service # Spring Cloud Consul for Service Discovery cloud: consul: host: localhost port: 8500 discovery: service-name: ${spring.application.name} # 8001以此名字入驻consul config: profile-separator: &#39;-&#39; # default value is &#34;,&#34;, We update &#34;-&#34; format: yaml management: zipkin: tracing: endpoint: http://localhost:9411/api/v2/spans # 固定写法 tracing: sampling: probability: 1.0 # 采样率默认为0.1，即十次只能有一次被记录下，值越大收集越及时 application 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 server: port: 8001 # ==========applicationName + druid-mysql8 driver=================== spring: datasource: type: com.alibaba.druid.pool.DruidDataSource driver-class-name: com.mysql.cj.jdbc.Driver url: jdbc:mysql://localhost:3306/db2024?characterEncoding=utf8&amp;useSSL=false&amp;serverTimezone=GMT%2B8&amp;rewriteBatchedStatements=true&amp;allowPublicKeyRetrieval=true username: root password: 527644117 profiles: active: dev # 多环境Consul配置加载内容dev/prod，不写就是default配置 # ========================mybatis=================== mybatis: mapper-locations: classpath:mapper/*.xml type-aliases-package: com.xz.springcloud.entities configuration: map-underscore-to-camel-case: true resources.mapper.PayMapper.xml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 &lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt; &lt;!DOCTYPE mapper PUBLIC &#34;-//mybatis.org//DTD Mapper 3.0//EN&#34; &#34;http://mybatis.org/dtd/mybatis-3-mapper.dtd&#34;&gt; &lt;mapper namespace=&#34;com.xz.springcloud.mapper.PayMapper&#34;&gt; &lt;resultMap id=&#34;BaseResultMap&#34; type=&#34;com.xz.springcloud.entities.Pay&#34;&gt; &lt;!-- WARNING - @mbg.generated --&gt; &lt;id column=&#34;id&#34; jdbcType=&#34;INTEGER&#34; property=&#34;id&#34; /&gt; &lt;result column=&#34;pay_no&#34; jdbcType=&#34;VARCHAR&#34; property=&#34;payNo&#34; /&gt; &lt;result column=&#34;order_no&#34; jdbcType=&#34;VARCHAR&#34; property=&#34;orderNo&#34; /&gt; &lt;result column=&#34;user_id&#34; jdbcType=&#34;INTEGER&#34; property=&#34;userId&#34; /&gt; &lt;result column=&#34;amount&#34; jdbcType=&#34;DECIMAL&#34; property=&#34;amount&#34; /&gt; &lt;result column=&#34;deleted&#34; jdbcType=&#34;TINYINT&#34; property=&#34;deleted&#34; /&gt; &lt;result column=&#34;create_time&#34; jdbcType=&#34;TIMESTAMP&#34; property=&#34;createTime&#34; /&gt; &lt;result column=&#34;update_time&#34; jdbcType=&#34;TIMESTAMP&#34; property=&#34;updateTime&#34; /&gt; &lt;/resultMap&gt; &lt;/mapper&gt; Main8001 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 @SpringBootApplication @MapperScan(&#34;com.xz.springcloud.mapper&#34;) public class Main8001 { public static void main(String[] args) { SpringApplication.run(Main8001.class, args); /* 微服务： 1、建module 2、改pom 3、写yml 4、主启动 5、业务类 */ /* 入驻consul（服务注册中心）： 1、pom 2、yml */ } } config.Swagger3Config 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 @Configuration public class Swagger3Config { // 分组API @Bean public GroupedOpenApi PayApi() { return GroupedOpenApi.builder().group(&#34;支付微服务模块&#34;).pathsToMatch(&#34;/pay/**&#34;).build(); // 以pay开头 } @Bean public GroupedOpenApi OtherApi() { return GroupedOpenApi.builder().group(&#34;其它微服务模块&#34;).pathsToMatch(&#34;/other/**&#34;, &#34;/others&#34;).build(); } /* @Bean public GroupedOpenApi CustomerApi() { return GroupedOpenApi.builder().group(&#34;客户微服务模块&#34;).pathsToMatch(&#34;/customer/**&#34;, &#34;/customers&#34;).build(); } */ @Bean public OpenAPI docsOpenApi() { return new OpenAPI() .info(new Info().title(&#34;cloud2024&#34;) .description(&#34;通用设计rest&#34;) .version(&#34;v1.0&#34;)) .externalDocs(new ExternalDocumentation() .description(&#34;www.atguigu.com&#34;) .url(&#34;https://yiyan.baidu.com/&#34;)); } } controller PayController：基础的增删改查、获取Consul中配置的kv、Swagger3注解 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 // Swagger3常用注解： // @Tag 标注位置：controller类：表示controller作用 // @Operation 标注位置：方法：描述方法作用 // @Schema 标注位置：model层的JavaBean：描述模型作用及每个属性 @Tag(name = &#34;支付微服务模块&#34;, description = &#34;支付CRUD&#34;) @RestController // @Controller + @ResponseBody @Slf4j @RequestMapping(&#34;/pay&#34;) public class PayController { @Resource private PayService payService; @PostMapping(&#34;/add&#34;) @Operation(summary = &#34;新增&#34;, description = &#34;新增支付流水方法，json作参数&#34;) public ResultData&lt;String&gt; addPay(@RequestBody Pay pay) { int i = payService.add(pay); return ResultData.success(&#34;成功插入记录了，返回：&#34; + i); } @DeleteMapping(&#34;/del/{id}&#34;) @Operation(summary = &#34;删除&#34;, description = &#34;删除支付流水方法&#34;) public ResultData&lt;String&gt; deletePay(@PathVariable(&#34;id&#34;) Integer id) { return ResultData.success(&#34;成功删除记录：&#34; + payService.delete(id)); } @PutMapping(&#34;/update&#34;) @Operation(summary = &#34;修改&#34;, description = &#34;修改支付流水方法&#34;) public ResultData&lt;String&gt; updatePay(@RequestBody PayDTO payDTO) { // 与前端交互只能用PayDTO，到controller要将其封装为Pay再传给后端 Pay pay = new Pay(); BeanUtils.copyProperties(payDTO, pay); return ResultData.success(&#34;成功修改记录：&#34; + payService.update(pay)); } @GetMapping(&#34;/get/{id}&#34;) @Operation(summary = &#34;按照ID查询流水&#34;, description = &#34;查询支付流水方法&#34;) public ResultData&lt;Pay&gt; getPayById(@PathVariable(&#34;id&#34;) Integer id) { // if (id == -4) throw new RuntimeException(&#34;id不能为负数&#34;); // 暂停62秒钟线程，测试Feign的默认调用超时时间 try { TimeUnit.SECONDS.sleep(62); } catch (InterruptedException e) { e.printStackTrace(); } return ResultData.success(payService.getById(id)); } @GetMapping(&#34;/get&#34;) public ResultData&lt;List&lt;Pay&gt;&gt; getPay() { return ResultData.success(payService.getAll()); } @GetMapping(&#34;/error&#34;) public ResultData&lt;Integer&gt; getPayError() { Integer integer = 200; try { System.out.println(&#34;come in payerror test&#34;); int age = 10 / 0; } catch (Exception e) { e.printStackTrace(); return ResultData.fail(ReturnCodeEnum.RC500.getCode(), e.getMessage()); } return ResultData.success(integer); } /* { &#34;code&#34;: &#34;500&#34;, &#34;message&#34;: &#34;/ by zero&#34;, &#34;data&#34;: null, &#34;timestamp&#34;: 1733309250087 } */ @Value(&#34;${server.port}&#34;) private String port; @GetMapping(&#34;/get/info&#34;) public String getInfoByConsul(@Value(&#34;${xz.info}&#34;) String xzInfo) { // xz.info为写在Consul相应环境中的yaml key return &#34;xzInfo: &#34; + xzInfo + &#34; port: &#34; + port; /* 如果没有在Consul中配置相应的key： -&gt; { &#34;code&#34;: &#34;500&#34;, &#34;message&#34;: &#34;Could not resolve placeholder &#39;xz.info&#39; in value \\&#34;${xz.info}\\&#34;&#34;, &#34;data&#34;: null, &#34;timestamp&#34;: 1733376396579 } */ } } PayCircuitController 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 @RestController @RequestMapping(&#34;/pay&#34;) public class PayCircuitController { /** * Resilience4j CircuitBreaker */ @GetMapping(&#34;/circuit/{id}&#34;) public String myCircuit(@PathVariable(&#34;id&#34;) Integer id) { if (id == -4) throw new RuntimeException(&#34;id 不能为负数&#34;); if (id == 9999) { try { TimeUnit.SECONDS.sleep(5); } catch (InterruptedException e) { e.printStackTrace(); } } return &#34;Hello, circuit! &#34; + &#34;\\t&#34; + IdUtil.simpleUUID(); } /** * Resilience4j Bulkhead */ @GetMapping(&#34;/bulkhead/{id}&#34;) public String myBulkhead(@PathVariable(&#34;id&#34;) Integer id) { if (id == -4) throw new RuntimeException(&#34;bulkhead id 不能为负数&#34;); if (id == 9999) { try { TimeUnit.SECONDS.sleep(5); } catch (InterruptedException e) { e.printStackTrace(); } } return &#34;Hello, bulkhead! &#34; + &#34;\\t&#34; + IdUtil.simpleUUID(); } /** * Resilience4j ratelimit */ @GetMapping(&#34;/ratelimit/{id}&#34;) public String myRatelimit(@PathVariable(&#34;id&#34;) Integer id) { return &#34;Hello, ratelimit! &#34; + &#34;\\t&#34; + IdUtil.simpleUUID(); } } PayMicrometerController 1 2 3 4 5 6 7 8 9 @RestController @RequestMapping(&#34;/pay&#34;) public class PayMicrometerController { @GetMapping(&#34;/micrometer/{id}&#34;) public String myMicrometer(@PathVariable(&#34;id&#34;) Integer id) { return &#34;Hello, welcome to myMicrometer &#34; + id + IdUtil.simpleUUID(); } } GatewayController 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 @RestController @RequestMapping(&#34;/pay&#34;) public class PayGatewayController { @Resource private PayService payService; @GetMapping(&#34;/gateway/get/{id}&#34;) public ResultData&lt;Pay&gt; getById(@PathVariable(&#34;id&#34;) Integer id) { Pay pay = payService.getById(id); return ResultData.success(pay); } @GetMapping(&#34;/gateway/info&#34;) public ResultData&lt;String&gt; getGatewayInfo() { return ResultData.success(&#34;gateway info test: &#34; + IdUtil.simpleUUID()); } @GetMapping(&#34;/gateway/filter&#34;) public ResultData&lt;String&gt; getGatewayFilter(HttpServletRequest request) { String res = &#34;&#34;; Enumeration&lt;String&gt; headers = request.getHeaderNames(); // 获得请求头名字的集合类 while (headers.hasMoreElements()) { String headName = headers.nextElement(); String headValue = request.getHeader(headName); System.out.println(&#34;请求头名：&#34; + headName + &#34;\\t\\t&#34; + &#34;请求头值：&#34; + headValue); /* ... 请求头名：x-request-xz1 请求头值：xzVal1 请求头名：x-request-xz2 请求头值：xzVal2 ... */ if (headName.equalsIgnoreCase(&#34;X-Request-xz1&#34;) || headName.equalsIgnoreCase(&#34;X-Request-xz2&#34;)) { res = res + headName + &#34;\\t&#34; + headValue + &#34; &#34;; } } System.out.println(&#34;==============================================================&#34;); String customerId = request.getParameter(&#34;customerId&#34;); System.out.println(&#34;request Parameter customerId：&#34; + customerId); String customerName = request.getParameter(&#34;customerName&#34;); System.out.println(&#34;request Parameter customerName：&#34; + customerName); System.out.println(&#34;==============================================================&#34;); // request Parameter customerId：9527001 // request Parameter customerName：null return ResultData.success(&#34;getGatewayFilter 过滤器 test：&#34; + res + &#34;\\t&#34; + DateUtil.now()); /* { &#34;code&#34;: &#34;200&#34;, &#34;message&#34;: &#34;success&#34;, &#34;data&#34;: &#34;getGatewayFilter 过滤器 test：x-request-xz1\\txzVal1 x-request-xz2\\txzVal2 \\t2024-12-10 10:51:13&#34;, &#34;timestamp&#34;: 1733799073903 } */ } } service 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 public interface PayService { int add(Pay pay); int delete(Integer id); int update(Pay pay); Pay getById(Integer id); List&lt;Pay&gt; getAll(); } @Service public class PayServiceImpl implements PayService { @Resource private PayMapper payMapper; @Override public int add(Pay pay) { return payMapper.insertSelective(pay); // null的属性不会保存，会使用数据库默认值 } @Override public int delete(Integer id) { return payMapper.deleteByPrimaryKey(id); } @Override public int update(Pay pay) { return payMapper.updateByPrimaryKeySelective(pay); } @Override public Pay getById(Integer id) { return payMapper.selectByPrimaryKey(id); } @Override public List&lt;Pay&gt; getAll() { return payMapper.selectAll(); } } mapper.Paymapper 1 2 public interface PayMapper extends Mapper&lt;Pay&gt; { } entities.Pay 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 /** * 表名：t_pay * 表注释：支付交易表 */ @Table(name = &#34;t_pay&#34;) @Schema(title = &#34;支付交易表Entity&#34;) public class Pay { @Id @GeneratedValue(generator = &#34;JDBC&#34;) @Schema(title = &#34;主键&#34;) private Integer id; /** * 支付流水号 */ @Column(name = &#34;pay_no&#34;) @Schema(title = &#34;支付流水号&#34;) private String payNo; /** * 订单流水号 */ @Column(name = &#34;order_no&#34;) @Schema(title = &#34;订单流水号&#34;) private String orderNo; /** * 用户账号ID */ @Column(name = &#34;user_id&#34;) @Schema(title = &#34;用户账号ID&#34;) private Integer userId; /** * 交易金额 */ @Schema(title = &#34;交易金额&#34;) private BigDecimal amount; /** * 删除标志，默认0不删除，1删除 */ private Byte deleted; /** * 创建时间 */ @Schema(title = &#34;创建时间&#34;) @Column(name = &#34;create_time&#34;) @JsonFormat(pattern = &#34;yyyy-MM-dd HH:mm:ss&#34;, timezone = &#34;GMT+8&#34;) // 完善从数据库中查出并返回的时间格式 private Date createTime; /** * 更新时间 */ @Schema(title = &#34;更新时间&#34;) @Column(name = &#34;update_time&#34;) @JsonFormat(pattern = &#34;yyyy-MM-dd HH:mm:ss&#34;, timezone = &#34;GMT+8&#34;) private Date updateTime; /** * @return id */ public Integer getId() { return id; } /** * @param id */ public void setId(Integer id) { this.id = id; } /** * 获取支付流水号 * * @return payNo - 支付流水号 */ public String getPayNo() { return payNo; } /** * 设置支付流水号 * * @param payNo 支付流水号 */ public void setPayNo(String payNo) { this.payNo = payNo; } /** * 获取订单流水号 * * @return orderNo - 订单流水号 */ public String getOrderNo() { return orderNo; } /** * 设置订单流水号 * * @param orderNo 订单流水号 */ public void setOrderNo(String orderNo) { this.orderNo = orderNo; } /** * 获取用户账号ID * * @return userId - 用户账号ID */ public Integer getUserId() { return userId; } /** * 设置用户账号ID * * @param userId 用户账号ID */ public void setUserId(Integer userId) { this.userId = userId; } /** * 获取交易金额 * * @return amount - 交易金额 */ public BigDecimal getAmount() { return amount; } /** * 设置交易金额 * * @param amount 交易金额 */ public void setAmount(BigDecimal amount) { this.amount = amount; } /** * 获取删除标志，默认0不删除，1删除 * * @return deleted - 删除标志，默认0不删除，1删除 */ public Byte getDeleted() { return deleted; } /** * 设置删除标志，默认0不删除，1删除 * * @param deleted 删除标志，默认0不删除，1删除 */ public void setDeleted(Byte deleted) { this.deleted = deleted; } /** * 获取创建时间 * * @return createTime - 创建时间 */ public Date getCreateTime() { return createTime; } /** * 设置创建时间 * * @param createTime 创建时间 */ public void setCreateTime(Date createTime) { this.createTime = createTime; } /** * 获取更新时间 * * @return updateTime - 更新时间 */ public Date getUpdateTime() { return updateTime; } /** * 设置更新时间 * * @param updateTime 更新时间 */ public void setUpdateTime(Date updateTime) { this.updateTime = updateTime; } } cloud-provider-payment8002（service） 与8001大体上一致 1 2 3 4 5 6 7 8 9 10 11 12 // Main8002 @SpringBootApplication @MapperScan(&#34;com.xz.springcloud.mapper&#34;) public class Main8002 { public static void main(String[] args) { SpringApplication.run(Main8002.class, args); } } // application.yml server: port: 8002 cloud-consumer-order80（deprecated，使用RestTemplate转发给微服务） pom 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 &lt;dependencies&gt; &lt;!--web + actuator--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--lombok--&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;!--hutool-all--&gt; &lt;dependency&gt; &lt;groupId&gt;cn.hutool&lt;/groupId&gt; &lt;artifactId&gt;hutool-all&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--fastjson2--&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.fastjson2&lt;/groupId&gt; &lt;artifactId&gt;fastjson2&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- swagger3 调用方式 http://localhost:8001/swagger-ui/index.html --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springdoc&lt;/groupId&gt; &lt;artifactId&gt;springdoc-openapi-starter-webmvc-ui&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--SpringCloud consul discovery --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-consul-discovery&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--loadbalancer--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-loadbalancer&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- 引入cloud-api-commons通用包 --&gt; &lt;dependency&gt; &lt;groupId&gt;com.xz.cloud&lt;/groupId&gt; &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; application.yml：Consul 1 2 3 4 5 6 7 8 9 10 11 12 13 server: port: 80 spring: application: name: cloud-consumer-order # Spring Cloud Consul for Service Discovery cloud: consul: host: localhost port: 8500 discovery: service-name: ${spring.application.name} # 8001以此名字入驻consul Main80 1 2 3 4 5 6 @SpringBootApplication public class Main80 { public static void main(String[] args) { SpringApplication.run(Main80.class, args); } } config.RestTemplateConfig 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 /** * Spring 框架中提供的一个类，用于简化与 RESTful 服务进行 HTTP 请求和响应的交互。它是一种方便的客户端工具，可以通过简单的方法调用 REST API，并处理请求和响应的数据。 */ @Configuration // @LoadBalancerClient(value = &#34;cloud-payment-service&#34;, configuration = RestTemplateConfig.class) // 区分大小写，要跟consul里名字保持一样 public class RestTemplateConfig { @Bean @LoadBalanced // I/O error on GET request for &#34;http://cloud-payment-service/pay/get/1&#34; -&gt; 一旦通过微服务名字调用，默认后面有多个微服务，需要开启负载均衡 public RestTemplate restTemplate() { return new RestTemplate(); } // 将默认的负载均衡轮询算法修改为随机 // @Bean // ReactiveLoadBalancer&lt;ServiceInstance&gt; randomLoadBalancer(Environment environment, // LoadBalancerClientFactory loadBalancerClientFactory) { // String name = environment.getProperty(LoadBalancerClientFactory.PROPERTY_NAME); // return new RandomLoadBalancer(loadBalancerClientFactory.getLazyProvider(name, ServiceInstanceListSupplier.class), name); // } } controller.OrderController 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 @RestController @RequestMapping(&#34;/consumer&#34;) public class OrderController { // public static final String PaymentServ_URL = &#34;http://localhost:8001&#34;; public static final String PaymentServ_URL = &#34;http://cloud-payment-service&#34;; // consul服务注册中心上的微服务名字 @Resource private RestTemplate restTemplate; @PostMapping(&#34;/pay/add&#34;) public ResultData addOrder(@RequestBody PayDTO payDTO) { // 类似于代理，也可以理解为请求转发，接收来自客户端的请求，然后将其转发给支付微服务，最后返回微服务的响应给客户端。 // 通过这种方式，系统可以轻松实现不同微服务之间的通信，保持松耦合和清晰的模块划分。 // 向目标 URL 发起一个 POST 请求，发送的请求体是 payDTO，并期望返回一个 ResultData 类型的响应。 // 目标微服务的地址，假设 PaymentServ_URL 是微服务的基本 URL（比如 http://payment-service/api），/pay/add 是支付服务处理支付请求的接口路径。 // payDTO 包含了用户请求的支付数据，它会被 RestTemplate 自动序列化成请求体（通常是 JSON 格式）。 return restTemplate.postForObject(PaymentServ_URL + &#34;/pay/add&#34;, payDTO, ResultData.class); // 发送 POST 请求 } @DeleteMapping(&#34;/pay/del/{id}&#34;) public ResultData deleteOrder(@PathVariable(&#34;id&#34;) Integer id) { restTemplate.delete(PaymentServ_URL + &#34;/pay/del/&#34; + id, id); return ResultData.success(null); } @PutMapping(&#34;/pay/update&#34;) public ResultData updateOrder(@RequestBody PayDTO payDTO) { restTemplate.put(PaymentServ_URL + &#34;/pay/update&#34;, payDTO); return ResultData.success(null); } @GetMapping(&#34;/pay/get/{id}&#34;) public ResultData getOrder(@PathVariable(&#34;id&#34;) Integer id) { return restTemplate.getForObject(PaymentServ_URL + &#34;/pay/get/&#34; + id, ResultData.class, id); // 发送 GET 请求 } @GetMapping(&#34;/pay/get/info&#34;) public String getInfoByConsul() { return restTemplate.getForObject(PaymentServ_URL + &#34;/pay/get/info&#34;, String.class); } @Resource private DiscoveryClient discoveryClient; /** * 原理：使用DiscoveryClient动态获取所有上线的服务器列表 * @return */ @GetMapping(&#34;/discovery&#34;) public String discovery() { List&lt;String&gt; services = discoveryClient.getServices(); // 获取consul上全部services for (String ele : services) { System.out.println(ele); // cloud-consumer-order、cloud-payment-service、consul } System.out.println(&#34;====================================&#34;); List&lt;ServiceInstance&gt; instances = discoveryClient.getInstances(&#34;cloud-payment-service&#34;); for (ServiceInstance instance : instances) { System.out.println(instance.getServiceId() + &#34;\\t&#34; + instance.getHost() + &#34;\\t&#34; + instance.getPort() + &#34;\\t&#34; + instance.getUri()); // cloud-payment-service Augenstern 8001 http://Augenstern:8001 // cloud-payment-service Augenstern 8002 http://Augenstern:8002 // 就会在这两个服务器上做负载均衡 } return instances.get(0).getServiceId() + &#34;: &#34; + instances.get(0).getPort(); // cloud-payment-service: 8001 } } cloud-consumer-feign-order80（使用OpenFeign转发给微服务） pom 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 &lt;dependencies&gt; &lt;!--web + actuator--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--lombok--&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;!--hutool-all--&gt; &lt;dependency&gt; &lt;groupId&gt;cn.hutool&lt;/groupId&gt; &lt;artifactId&gt;hutool-all&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--fastjson2--&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.fastjson2&lt;/groupId&gt; &lt;artifactId&gt;fastjson2&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- swagger3 调用方式 http://localhost:8001/swagger-ui/index.html --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springdoc&lt;/groupId&gt; &lt;artifactId&gt;springdoc-openapi-starter-webmvc-ui&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--SpringCloud consul discovery --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-consul-discovery&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--openfeign--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- httpclient5--&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.httpcomponents.client5&lt;/groupId&gt; &lt;artifactId&gt;httpclient5&lt;/artifactId&gt; &lt;version&gt;5.3&lt;/version&gt; &lt;/dependency&gt; &lt;!-- feign-hc5--&gt; &lt;dependency&gt; &lt;groupId&gt;io.github.openfeign&lt;/groupId&gt; &lt;artifactId&gt;feign-hc5&lt;/artifactId&gt; &lt;version&gt;13.1&lt;/version&gt; &lt;/dependency&gt; &lt;!--resilience4j-circuitbreaker--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-circuitbreaker-resilience4j&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- 由于断路保护等需要AOP实现，所以必须导入AOP包 --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-aop&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--resilience4j-bulkhead--&gt; &lt;dependency&gt; &lt;groupId&gt;io.github.resilience4j&lt;/groupId&gt; &lt;artifactId&gt;resilience4j-bulkhead&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--resilience4j-ratelimiter--&gt; &lt;dependency&gt; &lt;groupId&gt;io.github.resilience4j&lt;/groupId&gt; &lt;artifactId&gt;resilience4j-ratelimiter&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--micrometer-tracing指标追踪 2--&gt; &lt;dependency&gt; &lt;groupId&gt;io.micrometer&lt;/groupId&gt; &lt;artifactId&gt;micrometer-tracing&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--micrometer-tracing-bridge-brave适配zipkin的桥接包 3--&gt; &lt;dependency&gt; &lt;groupId&gt;io.micrometer&lt;/groupId&gt; &lt;artifactId&gt;micrometer-tracing-bridge-brave&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--micrometer-observation 4--&gt; &lt;dependency&gt; &lt;groupId&gt;io.micrometer&lt;/groupId&gt; &lt;artifactId&gt;micrometer-observation&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--feign-micrometer 5--&gt; &lt;dependency&gt; &lt;groupId&gt;io.github.openfeign&lt;/groupId&gt; &lt;artifactId&gt;feign-micrometer&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--zipkin-reporter-brave 6--&gt; &lt;dependency&gt; &lt;groupId&gt;io.zipkin.reporter2&lt;/groupId&gt; &lt;artifactId&gt;zipkin-reporter-brave&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- 引入cloud-api-commons通用包 --&gt; &lt;dependency&gt; &lt;groupId&gt;com.xz.cloud&lt;/groupId&gt; &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; application.yml：配置Consul、OpenFeign、Resilience4j、Micrometer+ZipKin 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 server: port: 80 spring: application: name: cloud-consumer-openfeign-order # Spring Cloud Consul for Service Discovery cloud: consul: host: localhost port: 8500 discovery: service-name: ${spring.application.name} # 8001以此名字入驻consul prefer-agent-address: true # 优先使用服务ip进行注册 openfeign: client: config: # default: # （全局） # # 连接超时时间 # connectTimeout: 3000 # # 读取超时时间 # readTimeout: 3000 cloud-payment-service: # 给单个服务指定会覆盖全局的 connectTimeout: 20000 readTimeout: 20000 # 修改默认HttpClient -&gt; Apache HttpClient5开启，提升性能 httpclient: hc5: enabled: true # 替换前为默认的 HttpClient + HttpURLConnection # 替换后为 hc.client5 # 请求/响应压缩：支持对请求和响应进行GZIP压缩，以减少通信过程中的性能损耗 compression: request: enabled: true min-request-size: 2048 # 最小触发压缩的大小 mime-types: text/xml,application/xml,application/json # 触发压缩数据类型 response: enabled: true # 2024-12-05T19:44:14.215+08:00 DEBUG 13360 --- [cloud-consumer-openfeign-order] [p-nio-80-exec-5] com.xz.springcloud.apis.PayFeignAPi : [PayFeignAPi#getPayInfo] Accept-Encoding: gzip # 开启circuitbreaker和分组激活 circuitbreaker: enabled: false group: enabled: false # 默认不开启分组，若开启，默认的分组策略是精确优先，若设置了分组策略则按设置的来 # Feign日志打印功能（logging.level + 含有@FeignClient注解的全接口名 + debug） logging: level: com: xz: springcloud: apis: PayFeignAPi: debug # # 按照次数：COUNT_BASED 的例子 # # 6次访问中当执行方法的失败率达到50%时CircuitBreaker将进入开启OPEN状态(保险丝跳闸断电)拒绝所有请求。 # # 等待5秒后，CircuitBreaker 将自动从开启OPEN状态过渡到半开HALF_OPEN状态，允许一些请求通过以测试服务是否恢复正常。 # # 如还是异常CircuitBreaker 将重新进入开启OPEN状态；如正常将进入关闭CLOSE闭合状态恢复正常处理请求。 # resilience4j: # circuitbreaker: # configs: # default: # failure-rate-threshold: 50 # 调用失败率达到50%时打开断路器，超过失败请求百分⽐时CircuitBreaker变为OPEN状态 # sliding-window-type: COUNT_BASED # 滑动窗口的类型 # sliding-window-size: 6 # 滑动窗⼝的⼤⼩，配置COUNT_BASED表示6个请求，配置TIME_BASED表示6秒 # minimum-number-of-calls: 6 # 断路器计算失败率或慢调用率之前所需的最小样本(每个滑动窗口周期)。如果minimumNumberOfCalls为10，则必须最少记录10个样本，然后才能计算失败率。如果只记录了9次调用，即使所有9次调用都失败，断路器也不会开启 # automatic-transition-from-open-to-half-open-enabled: false # 是否启用自动从开启状态过渡到半开状态，默认值为true。如果启用，CircuitBreaker将自动从开启状态过渡到半开状态，并允许一些请求通过以测试服务是否恢复正常 # wait-duration-in-open-state: 5s # 从OPEN到HALF_OPEN状态需要等待的时间（不管怎么配置，都会在一定时间内恢复到半开） # permitted-number-of-calls-in-half-open-state: 2 # 半开状态允许的最大请求数，默认值为10。在半开状态下，CircuitBreaker将允许最多permittedNumberOfCallsInHalfOpenState个请求通过，如果调用失败率再次达到50%，CircuitBreaker将重新进入开启状态 # record-exceptions: # - java.lang.Exception # instances: # cloud-payment-service: # base-config: default # resilience4j: # timelimiter: # configs: # default: # # 适合高并发场景下接口响应较慢导致拖垮整个服务的其他接口 # timeout-duration: 10s # timelimiter默认限制远程调用1s，超过1s就超时异常，配置了降级，就走降级逻辑（最高优先级） # circuitbreaker: # configs: # default: # failure-rate-threshold: 50 # 调用失败率达到50%时打开断路器，超过失败请求百分⽐时CircuitBreaker变为OPEN状态 # sliding-window-type: TIME_BASED # 滑动窗口的类型 # sliding-window-size: 2 # 滑动窗⼝的⼤⼩，配置TIME_BASED表示2秒 # minimum-number-of-calls: 2 # 断路器计算失败率或慢调用率之前所需的最小样本(每个滑动窗口周期)。 # wait-duration-in-open-state: 5s # 从OPEN到HALF_OPEN状态需要等待的时间（不管怎么配置，都会在一定时间内恢复到半开） # permitted-number-of-calls-in-half-open-state: 2 # 半开状态允许的最大请求数，默认值为10。在半开状态下，CircuitBreaker将允许最多permittedNumberOfCallsInHalfOpenState个请求通过，如果调用失败率再次达到50%，CircuitBreaker将重新进入开启状态 # slow-call-duration-threshold: 2s # 满调用时间阈值，高于阈值视为慢调用并增加慢调用比例 # slow-call-rate-threshold: 30 # 慢调用百分比峰值，断路器把调用时间大于slow-call-duration-threshold视为慢调用，当慢调用比例高于此阈值，断路器打开，并开启服务降级 # record-exceptions: # - java.lang.Exception # instances: # cloud-payment-service: # base-config: default # SEMAPHORE # resilience4j: # bulkhead: # configs: # default: # max-concurrent-calls: 2 # 允许线程并发执行的最大数量 # max-wait-duration: 1s # 当达到并发调用数量时，新的线程的阻塞时间，只愿意等待1s，超时进舱壁兜底fallback # instances: # cloud-payment-service: # base-config: default # timelimiter: # configs: # default: # timeout-duration: 20s # 为了保证测试故意延长 # THREADPOOL 注意，由于THREADPOOL会新启线程池，需要把spring.cloud.openfeign.circuitbreaker.group.enabled设为false，新启线程和原来主线程脱离 # resilience4j: # timelimiter: # configs: # default: # timeout-duration: 10s # thread-pool-bulkhead: # configs: # default: # core-thread-pool-size: 1 # max-thread-pool-size: 1 # queue-capacity: 1 # 线程池内最多容纳1个，等待队列最多容纳1个，故最多容纳2个（核心线程池内存常驻，其余（若有）线程池只是临时的，超过时间不用就会回收） # instances: # cloud-payment-service: # base-config: default resilience4j: ratelimiter: configs: default: limit-for-period: 2 # 在一次刷新周期内，允许执行的最大请求数 limit-refresh-period: 1s # 限流器每隔limitRefreshPeriod刷新一次，将允许处理的最大请求数量重置为limitForPeriod timeout-duration: 1 # 线程等待权限的默认等待时间 instances: cloud-payment-service: base-config: default management: zipkin: tracing: endpoint: http://localhost:9411/api/v2/spans # 固定写法 tracing: sampling: probability: 1.0 # 采样率默认为0.1，即十次只能有一次被记录下，值越大收集越及时 MainOpenFeign80 1 2 3 4 5 6 7 @SpringBootApplication @EnableFeignClients // 启用Feign客户端，定义服务+绑定接口，以声明式的方法优雅而简单地实现服务调用 public class MainOpenFeign80 { public static void main(String[] args) { SpringApplication.run(MainOpenFeign80.class, args); } } config.FeignConfig 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 @Configuration public class FeignConfig { /** * OpenFeign的重试机制 */ @Bean public Retryer myRetryer() { return Retryer.NEVER_RETRY; // Feign默认配置是不走重试策略的 // 最大请求次数为3(1+2)，初始间隔时间为100ms，重试间最大间隔时间为1s // return new Retryer.Default(100, 1, 3); } /** * OpenFeign的日志打印功能 */ @Bean Logger.Level feignLoggerLevel() { return Logger.Level.FULL; } } controller OrderController 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 @RestController @RequestMapping(&#34;/feign&#34;) public class OrderController { @Resource private PayFeignAPi payFeignAPi; @PostMapping(&#34;/pay/add&#34;) public ResultData addOrder(@RequestBody PayDTO payDTO) { // 1、模拟本地addOrder新增订单成功（省略sql操作） // 2、在开启addPay支付微服务远程调用 // 当应用启动时，Feign使用Java动态代理机制生成接口的实现，这个实现由SpringCLoud方法提供支持 // Feign客户端在内部构建了请求的详细信息，并将接口方法调用转换为HTTP调用 return payFeignAPi.addPay(payDTO); } @GetMapping(&#34;/pay/get/{id}&#34;) public ResultData getPayInfo(@PathVariable(&#34;id&#34;) Integer id) { // 1、支付微服务远程调用，按照id查询订单支付流水信息 ResultData resultData = null; try { System.out.println(&#34;调用开始：&#34; + DateUtil.now()); resultData = payFeignAPi.getPayInfo(id); } catch (Exception e) { e.printStackTrace(); System.out.println(&#34;调用结束：&#34; + DateUtil.now()); ResultData.fail(ReturnCodeEnum.RC500.getCode(), e.getMessage()); // 测试超时控制 // 调用开始：2024-12-05 18:52:31 // 调用结束：2024-12-05 18:53:31 // Feign默认超时时间60s } return resultData; } @GetMapping(&#34;/pay/get/info&#34;) public String mylb() { return payFeignAPi.mylb(); } } OrderCircuitController：CircuitBreaker、BulkHead、RateLimit 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 @RestController public class OrderCircuitController { @Resource private PayFeignAPi payFeignAPi; @GetMapping(&#34;/feign/pay/circuit/{id}&#34;) @CircuitBreaker(name = &#34;cloud-payment-service&#34;, fallbackMethod = &#34;myCircuitFallback&#34;) // 与yml的instances名字保持一致 public String myCircuitBreaker(@PathVariable(&#34;id&#34;) Integer id) { return payFeignAPi.myCircuit(id); } /** * 报错就会进入，超过50%才会熔断（断开），后面就算不报错了，仍会返回失败 * 服务降级后的兜底处理方法 */ public String myCircuitFallback(Throwable t) { return &#34;myCircuitFallback 系统繁忙，请稍后再试&#34;; } @GetMapping(&#34;/feign/pay/bulkhead/{id}&#34;) @Bulkhead(name = &#34;cloud-payment-service&#34;, fallbackMethod = &#34;myBulkheadFallback&#34;, type = Bulkhead.Type.SEMAPHORE) public String myBulkhead(@PathVariable(&#34;id&#34;) Integer id) { return payFeignAPi.myBulkhead(id); } public String myBulkheadFallback(Throwable t) { return &#34;myBulkheadFallback 隔板超出最大数量限制，系统繁忙，请稍后再试&#34;; } @GetMapping(&#34;/feign/pay/bulkhead_th/{id}&#34;) @Bulkhead(name = &#34;cloud-payment-service&#34;, fallbackMethod = &#34;myBulkheadFallbackTh&#34;, type = Bulkhead.Type.THREADPOOL) public CompletableFuture&lt;String&gt; myBulkheadTh(@PathVariable(&#34;id&#34;) Integer id) { System.out.println(Thread.currentThread().getName() + &#34;\\t&#34; + &#34;---开始进入---&#34;); try { TimeUnit.SECONDS.sleep(3); } catch (InterruptedException e) { e.printStackTrace(); } System.out.println(Thread.currentThread().getName() + &#34;\\t&#34; + &#34;---准备离开---&#34;); // bulkhead-cloud-payment-service-1 ---开始进入--- // bulkhead-cloud-payment-service-1 ---准备离开--- return CompletableFuture.supplyAsync(() -&gt; payFeignAPi.myBulkhead(id) + &#34;\\t&#34; + &#34;THREADPOOL&#34;); } public CompletableFuture&lt;String&gt; myBulkheadFallbackTh(Integer id, Throwable t) { return CompletableFuture.supplyAsync(() -&gt; &#34;myBulkheadFallbackTh 隔板超出最大数量限制，系统繁忙，请稍后再试&#34;); } @GetMapping(&#34;/feign/pay/ratelimit/{id}&#34;) @RateLimiter(name = &#34;cloud-payment-service&#34;, fallbackMethod = &#34;myRatelimitFallback&#34;) public String myRatelimit(@PathVariable(&#34;id&#34;) Integer id) { return payFeignAPi.myRatelimit(id); } public String myRatelimitFallback(Throwable t) { return &#34;myRatelimitFallback 你被限流了，禁止访问&#34;; } } OrderMicrometerController：Micrometer 1 2 3 4 5 6 7 8 9 10 11 @RestController public class OrderMicrometerController { @Resource private PayFeignAPi payFeignAPi; @GetMapping(&#34;/feign/micrometer/{id}&#34;) public String myMicrometer(@PathVariable(&#34;id&#34;) Integer id) { return payFeignAPi.myMicrometer(id); } } OrderMicrometerController：GateWay 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 @RestController public class OrderGatewayController { @Resource private PayFeignAPi payFeignAPi; @GetMapping(&#34;/feign/pay/gateway/get/{id}&#34;) public ResultData getById(@PathVariable(&#34;id&#34;) Integer id) { return payFeignAPi.getById(id); } @GetMapping(&#34;/feign/pay/gateway/info&#34;) public ResultData&lt;String&gt; getGatewayInfo() { return payFeignAPi.getGatewayInfo(); } } cloud-gateway9527（网关） pom 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 &lt;dependencies&gt; &lt;!--gateway--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-gateway&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--服务注册发现consul discovery,网关也要注册进服务注册中心统一管控--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-consul-discovery&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- 指标监控健康检查的actuator,网关是响应式编程删除掉spring-boot-starter-web dependency--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--lombok--&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;scope&gt;provided&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; application.yml：配置Consul、routes=(id+uri+predicates+filters)*n 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 server: port: 9527 spring: application: name: cloud-gateway # 以微服务注册进consul或nacos服务列表内 cloud: consul: # 配置consul地址 host: localhost port: 8500 discovery: prefer-agent-address: true service-name: ${spring.application.name} gateway: # 所有的请求都会发给网关，由网关进行转发 routes: - id: pay_route1 # 路由的ID（类似于mysql的主键），没有固定规则但要求唯一，建议配合服务名 # uri: http://localhost:8001 # 匹配后提供服务的路由地址 uri: lb://cloud-payment-service # 以微服务名字动态获取uri # lb 代表 负载均衡器（Load Balancer）。这表示请求会通过负载均衡器转发到 cloud-payment-service 服务，而不是直接指定一个固定的 IP 地址或主机名。 # lb://：这个前缀表示使用负载均衡器来解析服务的地址，负载均衡器会根据一定的算法（例如轮询、最小连接数等）将请求转发到 cloud-payment-service 的不同实例。 # 此时将8001改为8007，依然可以通过OpenFeign对服务访问 predicates: # 只有满足了断言下的所有条件才能正常访问到uri - Path=/pay/gateway/get/** # 路径相匹配的进行路由 - After=2024-12-09T16:33:19.186588300+08:00[GMT+08:00] # 在此时间之后才能访问：到点秒杀 # Before Between=XXX,XXX # - Cookie=username,xz # cmd：curl http://localhost:9527/pay/gateway/get/1 --cookie &#34;username=xz&#34; 直接访问9527才生效，当访问80再访问9527则不行，因为这样Cookie只传到了80端口（实际工作中不会有用Feign调网关的情况发生，故直接访问网关没有问题） # - Header=X-Request-Id, \\d+ # cmd：curl http://localhost:9527/pay/gateway/get/1 -H &#34;X-Request-Id:123456&#34; # 一个属性名称，一个正则表达式，属性名与正则匹配才符合条件：请求头要有X-Request-Id属性且值为正数 同样只有直接访问9527才生效 # - Host=**.xz.com # cmd：curl http://localhost:9527/pay/gateway/get/3 -H &#34;Host:a.www.xz.com&#34; 接收一组匹配的域名列表，这个模板是一个ant分隔的模板，用.作为分隔符 # - Query=username, \\d+ # http://localhost:9527/pay/gateway/get/1?username=23 要求有查询参数且符合属性值，一个是属性名、一个是属性值，属性值可以是正则 # - RemoteAddr=10.249.94.1/24 # IPv4地址 10.249.94.181 http://10.249.94.181:9527/pay/gateway/get/1 外部访问IP限制，最大跨度不超过32，目前是1-24，CIDR表示法 # - Method=POST # 限制请求方法只能为POST # Fully Expanded Arguments # - name: My # args: # userType: diamond # http://localhost:9527/pay/gateway/get/1?userType=diamond # Shortcut Configuration # - My=diamond - id: pay_route2 # uri: http://localhost:8001 uri: lb://cloud-payment-service # 动态路由 predicates: - Path=/pay/gateway/info/** - id: pay_route3 uri: lb://cloud-payment-service predicates: - Path=/pay/gateway/filter/** # 默认的正确地址 # - Path=/gateway/filter/** # 拆分为 PrefixPath + Path # - Path=/XYZ/abc/{segment} # {segment}为占位符，最后会被setPath取代 filters: # # 往请求中添加请求头参数 # - AddRequestHeader=X-Request-xz1,xzVal1 # 请求头kv，若含有多个kv则重写一行设置 # - AddRequestHeader=X-Request-xz2,xzVal2 # # 往请求中删除请求头参数 # - RemoveRequestHeader=sec-fetch-site # 删除 请求头名：sec-fetch-site 请求头值：none # # 修改请求头参数 # - SetRequestHeader=sec-fetch-mode,xzxzxzxzxzxz # 请求头名：sec-fetch-mode 请求头值修改为xzxzxzxzxzxz # # 新增请求参数 # - AddRequestParameter=customerId,9527001 # 新增请求参数Parameter，kv（默认值），如果有传过来的请求参数则会将此覆盖 # # 删除请求参数 # - RemoveRequestParameter=customName # 删除url请求参数的value -&gt; null # # 新增响应头参数 # - AddResponseHeader=X-Response-xz,xzzzzzz # x-response-xz: xzzzzzz # # 修改响应头参数 # - SetResponseHeader=Date,2099-11-11 # date: 2099-11-11 # # 删除响应头参数 # - RemoveResponseHeader=Content-Type # 将默认自带Content-Type删除 # - PrefixPath=/pay # http://localhost:9527/pay/gateway/filter 过滤器统一管理前缀 # - SetPath=/pay/gateway/{segment} # 浏览器访问的地址：http://localhost:9527/XYZ/abc/filter 实际访问的地址：http://localhost:9527/pay/gateway/filter # - RedirectTo=302,https://www.baidu.com/ # 访问http://localhost:9527/pay/gateway/filter跳转到https://www.baidu.com/ 302重定向状态码 # 自定义filter就是作用于全部routes的 spring.cloud.gateway.default-filters... - My=xz # xz就是Config里面的status http://localhost:9527/pay/gateway/filter -&gt; 400 http://localhost:9527/pay/gateway/filter?xz=??才能访问（过滤器可以替代断言，但是断言不能替代过滤器） Main9527 1 2 3 4 5 6 7 @SpringBootApplication public class Main9527 { public static void main(String[] args) { SpringApplication.run(Main9527.class, args); // 网关，不写任何业务代码，网关和业务无关 } } mygateway MyRoutePredicateFactory：自定义路由断言 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 /** * 需求说明：自定义配置会员等级userType，按照钻/金/银和yml配置的会员等级，以适配是否可以访问 * * 约定自定义的路由断言工厂必须要以RoutePredicateFactory结尾，前面的部分将会形如[After][Before][Between]...出现 * 因此这个路由断言工厂将会显示为[My] * 2024-12-10T10:17:10.899+08:00 INFO 24408 --- [cloud-gateway] [main] o.s.c.g.r.RouteDefinitionRouteLocator : Loaded RoutePredicateFactory [My] */ @Component public class MyRoutePredicateFactory extends AbstractRoutePredicateFactory&lt;MyRoutePredicateFactory.Config&gt; { public MyRoutePredicateFactory() { super(MyRoutePredicateFactory.Config.class); } // 这个Config类就是路由断言规则！ @Validated public static class Config { @Setter @Getter @NotEmpty private String userType; // 钻/金/银用户等级 } /** * 使支持短格式 */ @Override public List&lt;String&gt; shortcutFieldOrder() { return Collections.singletonList(&#34;userType&#34;); } @Override public Predicate&lt;ServerWebExchange&gt; apply(MyRoutePredicateFactory.Config config) { return new Predicate&lt;ServerWebExchange&gt;() { @Override public boolean test(ServerWebExchange serverWebExchange) { String userType = serverWebExchange.getRequest().getQueryParams().getFirst(&#34;userType&#34;); // 获取名字为userType的查询参数 if (userType == null) return false; // 断言校验失败 if (userType.equalsIgnoreCase(config.getUserType())) { return true; // 与预先定义的userType相同，断言校验成功 } return false; } }; } } MyGlobalFilter：应用场景：统计Controller调用耗时情况，如何落地，谈谈设计思路：自定义全局过滤器（重点，面试设计题） 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 /** * 自定义全局过滤器 */ @Component @Slf4j public class MyGlobalFilter implements GlobalFilter, Ordered { public static final String BEGIN_VISIT_TIME = &#34;begin_visit_time&#34;; @Override public Mono&lt;Void&gt; filter(ServerWebExchange exchange, GatewayFilterChain chain) { // 先记录下访问接口的开始时间 exchange.getAttributes().put(BEGIN_VISIT_TIME, System.currentTimeMillis()); // 返回统计的各个结果给后台 return chain.filter(exchange).then(Mono.fromRunnable(() -&gt; { // 响应式编程 Long beginVisitTime = exchange.getAttribute(BEGIN_VISIT_TIME); if (beginVisitTime != null) { log.info(&#34;访问接口主机：&#34; + exchange.getRequest().getURI().getHost()); log.info(&#34;访问接口端口：&#34; + exchange.getRequest().getURI().getPort()); log.info(&#34;访问接口URL：&#34; + exchange.getRequest().getURI().getPath()); log.info(&#34;访问接口URL后面的参数：&#34; + exchange.getRequest().getURI().getRawQuery()); log.info(&#34;访问接口时长：&#34; + (System.currentTimeMillis() - beginVisitTime) + &#34;毫秒&#34;); log.info(&#34;=====================================&#34;); System.out.println(); /* 2024-12-10T21:53:21.721+08:00 INFO 29628 --- [cloud-gateway] [tor-http-nio-15] c.x.s.mygateway.MyGlobalFilter : 访问接口主机：localhost 2024-12-10T21:53:21.721+08:00 INFO 29628 --- [cloud-gateway] [tor-http-nio-15] c.x.s.mygateway.MyGlobalFilter : 访问接口端口：9527 2024-12-10T21:53:21.721+08:00 INFO 29628 --- [cloud-gateway] [tor-http-nio-15] c.x.s.mygateway.MyGlobalFilter : 访问接口URL：/pay/gateway/info 2024-12-10T21:53:21.721+08:00 INFO 29628 --- [cloud-gateway] [tor-http-nio-15] c.x.s.mygateway.MyGlobalFilter : 访问接口URL后面的参数：null 2024-12-10T21:53:21.721+08:00 INFO 29628 --- [cloud-gateway] [tor-http-nio-15] c.x.s.mygateway.MyGlobalFilter : 访问接口时长：198毫秒 */ } })); } /** * 数字越小，优先级越高，pre最先执行，post最后执行 */ @Override public int getOrder() { return 0; } } MyGatewayFilterFactory：自定义条件过滤器 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 @Component public class MyGatewayFilterFactory extends AbstractGatewayFilterFactory&lt;MyGatewayFilterFactory.Config&gt; { public MyGatewayFilterFactory() { super(MyGatewayFilterFactory.Config.class); } public static class Config { @Getter @Setter private String status; // 设定一个状态值/标志位，等于时才可以访问 } @Override public List&lt;String&gt; shortcutFieldOrder() { return Arrays.asList(&#34;status&#34;); } @Override public GatewayFilter apply(MyGatewayFilterFactory.Config config) { return new GatewayFilter() { @Override public Mono&lt;Void&gt; filter(ServerWebExchange exchange, GatewayFilterChain chain) { ServerHttpRequest request = exchange.getRequest(); System.out.println(&#34;进入了自定义网关过滤器MyGatewayFilterFactory, status：&#34; + config.getStatus()); // 进入了自定义网关过滤器MyGatewayFilterFactory, status：xz（与路由断言工厂类似，来自于yml中的配置） if (request.getQueryParams().containsKey(config.getStatus())) { // 包含配置的key才放行 return chain.filter(exchange); // 放行，传给下一个过滤器 } else { exchange.getResponse().setStatusCode(HttpStatus.BAD_REQUEST); // 非法请求 return exchange.getResponse().setComplete(); } } }; } } Spring Cloud原生 Consul：服务注册与发现 cmd指令 1 2 3 4 5 6 7 8 查看版本 consul --version 运行 consul agent -dev 打开 http://localhost:8500/ pom 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 &lt;!--SpringCloud consul discovery （所有微服务！） --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-consul-discovery&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--SpringCloud consul config （仅service！） --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-consul-config&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-bootstrap&lt;/artifactId&gt; &lt;/dependency&gt; CAP 1 2 3 C：Consistency 强一致性 A：Availability 可用性 P：Partition tolerance 分区容错性 经典CAP图 1 2 3 4 5 6 最多只能同时较好的满足两个。CAP理论的核心是：一个分布式系统不可能同时很好的满足一致性，可用性和分区容错性这三个需求， 因此，根据 CAP 原理将 NoSQL 数据库分成了满足 CA 原则、满足 CP 原则和满足 AP 原则三大类： CA - 单点集群，满足一致性，可用性的系统，通常在可扩展性上不太强大。 CP - 满足一致性，分区容忍性的系统，通常性能不是特别高。 AP - 满足可用性，分区容忍性的系统，通常可能对一致性要求低一些。 ">
<title>SpringCloud笔记</title>

<link rel='canonical' href='https://X-Augenstern.github.io/p/springcloud%E7%AC%94%E8%AE%B0/'>

<link rel="stylesheet" href="/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css"><meta property='og:title' content="SpringCloud笔记">
<meta property='og:description' content="\n父工程pom 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 &lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt; &lt;project xmlns=&#34;http://maven.apache.org/POM/4.0.0&#34; xmlns:xsi=&#34;http://www.w3.org/2001/XMLSchema-instance&#34; xsi:schemaLocation=&#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&#34;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;com.xz.cloud&lt;/groupId&gt; &lt;artifactId&gt;springcloud&lt;/artifactId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;packaging&gt;pom&lt;/packaging&gt; &lt;modules&gt; &lt;module&gt;mybatis_generator&lt;/module&gt; &lt;module&gt;cloud-provider-payment8001&lt;/module&gt; &lt;module&gt;cloud-consumer-order80&lt;/module&gt; &lt;module&gt;cloud-api-commons&lt;/module&gt; &lt;module&gt;cloud-provider-payment8002&lt;/module&gt; &lt;module&gt;cloud-consumer-feign-order80&lt;/module&gt; &lt;module&gt;cloud-gateway9527&lt;/module&gt; &lt;/modules&gt; &lt;properties&gt; &lt;maven.compiler.source&gt;17&lt;/maven.compiler.source&gt; &lt;maven.compiler.target&gt;17&lt;/maven.compiler.target&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;hutool.version&gt;5.8.22&lt;/hutool.version&gt; &lt;lombok.version&gt;1.18.36&lt;/lombok.version&gt; &lt;druid.version&gt;1.1.23&lt;/druid.version&gt; &lt;mybatis.springboot.version&gt;3.0.4&lt;/mybatis.springboot.version&gt; &lt;mysql.version&gt;8.0.28&lt;/mysql.version&gt; &lt;swagger3.version&gt;2.2.0&lt;/swagger3.version&gt; &lt;mapper.version&gt;4.2.3&lt;/mapper.version&gt; &lt;fastjson2.version&gt;2.0.40&lt;/fastjson2.version&gt; &lt;persistence-api.version&gt;1.0.2&lt;/persistence-api.version&gt; &lt;spring.boot.test.version&gt;3.2.0&lt;/spring.boot.test.version&gt; &lt;spring.boot.version&gt;3.2.0&lt;/spring.boot.version&gt; &lt;spring.cloud.version&gt;2023.0.0&lt;/spring.cloud.version&gt; &lt;spring.cloud.alibaba.version&gt;2023.0.0.0-RC1&lt;/spring.cloud.alibaba.version&gt; &lt;micrometer-tracing.version&gt;1.2.0&lt;/micrometer-tracing.version&gt; &lt;micrometer-observation.version&gt;1.12.0&lt;/micrometer-observation.version&gt; &lt;feign-micrometer.version&gt;12.5&lt;/feign-micrometer.version&gt; &lt;zipkin-reporter-brave.version&gt;2.17.0&lt;/zipkin-reporter-brave.version&gt; &lt;/properties&gt; &lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;!--springboot 3.3.5--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;${spring.boot.version}&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;!--springcloud 2023.0.0--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt; &lt;version&gt;${spring.cloud.version}&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;!--springcloud alibaba 2023.0.0.0-RC1--&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-alibaba-dependencies&lt;/artifactId&gt; &lt;version&gt;${spring.cloud.alibaba.version}&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;!--SpringBoot集成mybatis--&gt; &lt;dependency&gt; &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt; &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;${mybatis.springboot.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!--1、Mysql数据库驱动8 --&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;version&gt;${mysql.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!--2、SpringBoot集成druid连接池--&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;druid-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;${druid.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!--3、通用Mapper4之tk.mybatis--&gt; &lt;dependency&gt; &lt;groupId&gt;tk.mybatis&lt;/groupId&gt; &lt;artifactId&gt;mapper&lt;/artifactId&gt; &lt;version&gt;${mapper.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!--4、persistence--&gt; &lt;dependency&gt; &lt;groupId&gt;javax.persistence&lt;/groupId&gt; &lt;artifactId&gt;persistence-api&lt;/artifactId&gt; &lt;version&gt;${persistence-api.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!-- fastjson2 --&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.fastjson2&lt;/groupId&gt; &lt;artifactId&gt;fastjson2&lt;/artifactId&gt; &lt;version&gt;${fastjson2.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!-- swagger3 调用方式 http://你的主机IP地址:5555/swagger-ui/index.html --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springdoc&lt;/groupId&gt; &lt;artifactId&gt;springdoc-openapi-starter-webmvc-ui&lt;/artifactId&gt; &lt;version&gt;${swagger3.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!--hutool--&gt; &lt;dependency&gt; &lt;groupId&gt;cn.hutool&lt;/groupId&gt; &lt;artifactId&gt;hutool-all&lt;/artifactId&gt; &lt;version&gt;${hutool.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!--lombok--&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;version&gt;${lombok.version}&lt;/version&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;!-- spring-boot-starter-test --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;version&gt;${spring.boot.test.version}&lt;/version&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;!--micrometer-tracing-bom导入链路追踪版本中心 1--&gt; &lt;dependency&gt; &lt;groupId&gt;io.micrometer&lt;/groupId&gt; &lt;artifactId&gt;micrometer-tracing-bom&lt;/artifactId&gt; &lt;version&gt;${micrometer-tracing.version}&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;!--micrometer-tracing指标追踪 2--&gt; &lt;dependency&gt; &lt;groupId&gt;io.micrometer&lt;/groupId&gt; &lt;artifactId&gt;micrometer-tracing&lt;/artifactId&gt; &lt;version&gt;${micrometer-tracing.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!--micrometer-tracing-bridge-brave适配zipkin的桥接包 3--&gt; &lt;dependency&gt; &lt;groupId&gt;io.micrometer&lt;/groupId&gt; &lt;artifactId&gt;micrometer-tracing-bridge-brave&lt;/artifactId&gt; &lt;version&gt;${micrometer-tracing.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!--micrometer-observation 4--&gt; &lt;dependency&gt; &lt;groupId&gt;io.micrometer&lt;/groupId&gt; &lt;artifactId&gt;micrometer-observation&lt;/artifactId&gt; &lt;version&gt;${micrometer-observation.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!--feign-micrometer 5--&gt; &lt;dependency&gt; &lt;groupId&gt;io.github.openfeign&lt;/groupId&gt; &lt;artifactId&gt;feign-micrometer&lt;/artifactId&gt; &lt;version&gt;${feign-micrometer.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!--zipkin-reporter-brave 6--&gt; &lt;dependency&gt; &lt;groupId&gt;io.zipkin.reporter2&lt;/groupId&gt; &lt;artifactId&gt;zipkin-reporter-brave&lt;/artifactId&gt; &lt;version&gt;${zipkin-reporter-brave.version}&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/dependencyManagement&gt; &lt;/project&gt; mybatis_generate（代码生成） pom 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 &lt;!--自己独一份，只是一个普通Maven工程，与boot和cloud无关--&gt; &lt;dependencies&gt; &lt;!--Mybatis 通用mapper tk单独使用，自己独有+自带版本号--&gt; &lt;dependency&gt; &lt;groupId&gt;org.mybatis&lt;/groupId&gt; &lt;artifactId&gt;mybatis&lt;/artifactId&gt; &lt;version&gt;3.5.15&lt;/version&gt; &lt;/dependency&gt; &lt;!-- Mybatis Generator 自己独有+自带版本号--&gt; &lt;dependency&gt; &lt;groupId&gt;org.mybatis.generator&lt;/groupId&gt; &lt;artifactId&gt;mybatis-generator-core&lt;/artifactId&gt; &lt;version&gt;1.4.2&lt;/version&gt; &lt;/dependency&gt; &lt;!--通用Mapper--&gt; &lt;dependency&gt; &lt;groupId&gt;tk.mybatis&lt;/groupId&gt; &lt;artifactId&gt;mapper&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--mysql8.0--&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--persistence--&gt; &lt;dependency&gt; &lt;groupId&gt;javax.persistence&lt;/groupId&gt; &lt;artifactId&gt;persistence-api&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--hutool--&gt; &lt;dependency&gt; &lt;groupId&gt;cn.hutool&lt;/groupId&gt; &lt;artifactId&gt;hutool-all&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--lombok--&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;org.junit.vintage&lt;/groupId&gt; &lt;artifactId&gt;junit-vintage-engine&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;resources&gt; &lt;resource&gt; &lt;directory&gt;${basedir}/src/main/java&lt;/directory&gt; &lt;includes&gt; &lt;include&gt;**/*.xml&lt;/include&gt; &lt;/includes&gt; &lt;/resource&gt; &lt;resource&gt; &lt;directory&gt;${basedir}/src/main/resources&lt;/directory&gt; &lt;/resource&gt; &lt;/resources&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;configuration&gt; &lt;excludes&gt; &lt;exclude&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;/exclude&gt; &lt;/excludes&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;plugin&gt; &lt;groupId&gt;org.mybatis.generator&lt;/groupId&gt; &lt;artifactId&gt;mybatis-generator-maven-plugin&lt;/artifactId&gt; &lt;version&gt;1.4.2&lt;/version&gt; &lt;configuration&gt; &lt;configurationFile&gt;${basedir}/src/main/resources/generatorConfig.xml&lt;/configurationFile&gt; &lt;overwrite&gt;true&lt;/overwrite&gt; &lt;verbose&gt;true&lt;/verbose&gt; &lt;/configuration&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;version&gt;8.0.28&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;tk.mybatis&lt;/groupId&gt; &lt;artifactId&gt;mapper&lt;/artifactId&gt; &lt;version&gt;4.2.3&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; config.properties 1 2 3 4 5 6 7 8 9 10 11 #t_pay??? package.name=com.xz.springcloud # mysql8.0 jdbc.driverClass = com.mysql.cj.jdbc.Driver # jdbc.url= jdbc:mysql://localhost:3306/db2024?characterEncoding=utf8&amp;useSSL=false&amp;serverTimezone=GMT%2B8&amp;rewriteBatchedStatements=true&amp;allowPublicKeyRetrieval=true # jdbc.url= jdbc:mysql://localhost:3306/seata_order?characterEncoding=utf8&amp;useSSL=false&amp;serverTimezone=GMT%2B8&amp;rewriteBatchedStatements=true&amp;allowPublicKeyRetrieval=true # jdbc.url= jdbc:mysql://localhost:3306/seata_storage?characterEncoding=utf8&amp;useSSL=false&amp;serverTimezone=GMT%2B8&amp;rewriteBatchedStatements=true&amp;allowPublicKeyRetrieval=true jdbc.url= jdbc:mysql://localhost:3306/seata_account?characterEncoding=utf8&amp;useSSL=false&amp;serverTimezone=GMT%2B8&amp;rewriteBatchedStatements=true&amp;allowPublicKeyRetrieval=true jdbc.user = root jdbc.password =527644117 generateConfig.xml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 &lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt; &lt;!DOCTYPE generatorConfiguration PUBLIC &#34;-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN&#34; &#34;http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd&#34;&gt; &lt;generatorConfiguration&gt; &lt;properties resource=&#34;config.properties&#34;/&gt; &lt;context id=&#34;Mysql&#34; targetRuntime=&#34;MyBatis3Simple&#34; defaultModelType=&#34;flat&#34;&gt; &lt;property name=&#34;beginningDelimiter&#34; value=&#34;`&#34;/&gt; &lt;property name=&#34;endingDelimiter&#34; value=&#34;`&#34;/&gt; &lt;plugin type=&#34;tk.mybatis.mapper.generator.MapperPlugin&#34;&gt; &lt;property name=&#34;mappers&#34; value=&#34;tk.mybatis.mapper.common.Mapper&#34;/&gt; &lt;property name=&#34;caseSensitive&#34; value=&#34;true&#34;/&gt; &lt;/plugin&gt; &lt;jdbcConnection driverClass=&#34;${jdbc.driverClass}&#34; connectionURL=&#34;${jdbc.url}&#34; userId=&#34;${jdbc.user}&#34; password=&#34;${jdbc.password}&#34;&gt; &lt;/jdbcConnection&gt; &lt;javaModelGenerator targetPackage=&#34;${package.name}.entities&#34; targetProject=&#34;src/main/java&#34;/&gt; &lt;sqlMapGenerator targetPackage=&#34;${package.name}.mapper&#34; targetProject=&#34;src/main/java&#34;/&gt; &lt;javaClientGenerator targetPackage=&#34;${package.name}.mapper&#34; targetProject=&#34;src/main/java&#34; type=&#34;XMLMAPPER&#34;/&gt; &lt;!--&lt;table tableName=&#34;t_pay&#34; domainObjectName=&#34;Pay&#34;&gt; &lt;generatedKey column=&#34;id&#34; sqlStatement=&#34;JDBC&#34;/&gt; &lt;/table&gt;--&gt; &lt;!-- seata_order --&gt; &lt;!--&lt;table tableName=&#34;t_order&#34; domainObjectName=&#34;Order&#34;&gt; &lt;generatedKey column=&#34;id&#34; sqlStatement=&#34;JDBC&#34;/&gt; &lt;/table&gt;--&gt; &lt;!-- seate_storage --&gt; &lt;!--&lt;table tableName=&#34;t_storage&#34; domainObjectName=&#34;Storage&#34;&gt; &lt;generatedKey column=&#34;id&#34; sqlStatement=&#34;JDBC&#34;/&gt; &lt;/table&gt;--&gt; &lt;!-- seate_account --&gt; &lt;table tableName=&#34;t_account&#34; domainObjectName=&#34;Account&#34;&gt; &lt;generatedKey column=&#34;id&#34; sqlStatement=&#34;JDBC&#34;/&gt; &lt;/table&gt; &lt;/context&gt; &lt;/generatorConfiguration&gt; cloud-api-commons（install为jar包供其它微服务使用、OpenFeign、OpenFeign+Sentinel） pom 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 &lt;dependencies&gt; &lt;!--SpringBoot通用依赖模块--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;!--hutool--&gt; &lt;dependency&gt; &lt;groupId&gt;cn.hutool&lt;/groupId&gt; &lt;artifactId&gt;hutool-all&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--openfeign--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/dependencies&gt; apis PayFeignAPi 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 /** * 微服务提供者8001对外暴露接口 */ // @FeignClient(&#34;cloud-payment-service&#34;) // 就是去注册中心的指定微服务上找相同uri然后调用相应的微服务方法 @FeignClient(&#34;cloud-gateway&#34;) /* 此时再关闭网关 { &#34;code&#34;: &#34;500&#34;, &#34;message&#34;: &#34;[503] during [GET] to [http://cloud-gateway/pay/gateway/info] [PayFeignAPi#getGatewayInfo()]: [Load balancer does not contain an instance for the service cloud-gateway]&#34;, &#34;data&#34;: null, &#34;timestamp&#34;: 1733728892254 } 再开启网关 { &#34;code&#34;: &#34;200&#34;, &#34;message&#34;: &#34;success&#34;, &#34;data&#34;: &#34;gateway info test: 5e6f3b3eb1d845f5bc86bbd759bd9084&#34;, &#34;timestamp&#34;: 1733728974072 } 现在三个url都可以访问服务： http://localhost:8001/pay/gateway/info http://localhost:9527/pay/gateway/info http://localhost:80/feign/pay/gateway/info */ public interface PayFeignAPi { /** * 增加一条支付相关流水记录 * * @param payDTO * @return */ @PostMapping(&#34;/pay/add&#34;) ResultData addPay(@RequestBody PayDTO payDTO); /** * 按照主键记录查询支付流水信息 * * @param id * @return */ @GetMapping(&#34;/pay/get/{id}&#34;) ResultData getPayInfo(@PathVariable(&#34;id&#34;) Integer id); /** * openfeign天然支持负载均衡演示 * * @return */ @GetMapping(&#34;/pay/get/info&#34;) String mylb(); @GetMapping(&#34;/pay/circuit/{id}&#34;) String myCircuit(@PathVariable(&#34;id&#34;) Integer id); @GetMapping(&#34;/pay/bulkhead/{id}&#34;) String myBulkhead(@PathVariable(&#34;id&#34;) Integer id); @GetMapping(&#34;/pay/ratelimit/{id}&#34;) String myRatelimit(@PathVariable(&#34;id&#34;) Integer id); @GetMapping(&#34;/pay/micrometer/{id}&#34;) String myMicrometer(@PathVariable(&#34;id&#34;) Integer id); @GetMapping(&#34;/pay/gateway/get/{id}&#34;) ResultData getById(@PathVariable(&#34;id&#34;) Integer id); @GetMapping(&#34;/pay/gateway/info&#34;) ResultData&lt;String&gt; getGatewayInfo(); } PayFeignSentinelAPi：OpenFeign+Sentinel 1 2 3 4 5 6 @FeignClient(value = &#34;nacos-payment-provider&#34;,fallback = PayFeignSentinelApiFallBack.class) // 谁提供服务写谁/转发给谁写谁 public interface PayFeignSentinelApi { @GetMapping(&#34;/pay/nacos/get/{orderNo}&#34;) ResultData getPayByOrderNo(@PathVariable(&#34;orderNo&#34;) String orderNo); } PayFeignSentinelApiFallBack 1 2 3 4 5 6 7 @Component public class PayFeignSentinelApiFallBack implements PayFeignSentinelApi { @Override public ResultData getPayByOrderNo(String orderNo) { return ResultData.fail(ReturnCodeEnum.RC500.getCode(), &#34;对方服务宕机或不可用，FallBack服务降级&#34;); } } StorageFeignApi 1 2 3 4 5 6 7 8 @FeignClient(&#34;seata-storage-service&#34;) public interface StorageFeignApi { /** * 扣减库存 */ @GetMapping(&#34;storage/decrease&#34;) ResultData decrease(@RequestParam(&#34;productId&#34;) Long productId, @RequestParam(&#34;count&#34;) Integer count); } AccountFeignAPi 1 2 3 4 5 6 7 8 @FeignClient(&#34;seata-account-service&#34;) public interface AccountFeignAPi { /** * 扣减余额 */ @GetMapping(&#34;/account/decrease&#34;) ResultData decrease(@RequestParam(&#34;userId&#34;) Long userId, @RequestParam(&#34;money&#34;) Long money); } entities.PayDTO 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 /** * DTO（数据传输对象） * 目的：DTO 主要用于数据传输，尤其是在分布式系统或不同层之间传递数据时。它通常是从数据库或服务中提取的数据对象，经过加工后用于传输。 * 特性： * 主要用于不同系统、模块之间的通信，避免传递过多的细节。 * 可能包含冗余数据或不同领域的数据，目的是为了提高传输效率。 * DTO 通常是无业务逻辑的，仅作为数据的载体。 * 可以是可变的，通常包含 setter 和 getter 方法。 * * dto中的字段实体类中一定存在，vo中的字段实体类中不一定存在 * dto是前端传给后端的，vo是后端传给前端的 * * 一般而言，调用者不应该获悉服务提供者的entity资源并知道表结构关系，所以服务提供方给出的接口文档都应为DTO */ @Data @NoArgsConstructor @AllArgsConstructor public class PayDTO implements Serializable { private Integer id; // 支付流水号 private String payNo; // 订单流水号 private String orderNo; // 用户账号ID private Integer userId; // 交易金额 private BigDecimal amount; } exp.GlobalExceptionHandler 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 /** * 全局异常 * * @ControllerAdvice 是一个用于处理全局异常的类注解，它可以捕获所有控制器中的异常并统一处理。 * 如果希望返回视图而不是直接返回 JSON，可以使用 @ControllerAdvice。 * * @RestControllerAdvice 是 @ControllerAdvice 和 @ResponseBody 的组合，它适用于返回 JSON 或其他对象响应体的情况。通常用于 RESTful 风格的 Web 服务中。 * * @RestControllerAdvice（或 @ControllerAdvice） * 这个注解的作用是将类标记为全局异常处理器，即所有控制器中的异常都会通过这个类来统一处理。它本身并不直接指定处理哪种类型的异常，而是用来指示一个类是用来处理异常的。 * * @ExceptionHandler(RuntimeException.class) * 这个注解是用来处理 特定类型的异常 的。它通常放在一个异常处理方法上，指定该方法捕获 RuntimeException 类型的异常。 * @ExceptionHandler 可以放在任何控制器类或者 @ControllerAdvice 类中，它用来拦截并处理指定类型的异常。 */ @Slf4j @RestControllerAdvice // 该类会对所有的控制器类进行增强处理，并且方法的返回值会直接转换成响应体的内容，标记 GlobalExceptionHandler 类是用来处理异常的 public class GlobalExceptionHandler { @ExceptionHandler(RuntimeException.class) // 标明当发生 RuntimeException 时，exception 方法会被调用，返回统一的错误响应。 @ResponseStatus(HttpStatus.INTERNAL_SERVER_ERROR) // 当这个异常被捕获时，HTTP 响应的状态码会设置为 500（内部服务器错误）。 public ResultData&lt;String&gt; exception(Exception e) { System.out.println(&#34;come in GlobalExceptionHandler&#34;); // 2024-12-04T18:41:14.992+08:00 ERROR 12528 --- [cloud-payment-service] [io-8001-exec-10] c.x.s.exp.GlobalExceptionHandler : 全局异常信息：id不能为负数 log.error(&#34;全局异常信息：{}&#34;, e.getMessage(), e); return ResultData.fail(ReturnCodeEnum.RC500.getCode(), e.getMessage()); /* { &#34;code&#34;: &#34;500&#34;, &#34;message&#34;: &#34;id不能为负数&#34;, &#34;data&#34;: null, &#34;timestamp&#34;: 1733308874996 } */ } } resp ResultData 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 /** * 返回对象 * * 定义返回格式： * 3大标准： * code：由后端统一定义各种返回结果的状态码 * message：本次接口调用的结果描述 * data：本次返回的数据 * timestamp：接口调用的时间 * * @param &lt;T&gt; */ @Data @Accessors(chain = true) // 链式编程 public class ResultData&lt;T&gt; { private String code; private String message; private T data; private long timestamp; public ResultData() { this.timestamp = System.currentTimeMillis(); } /** * 为什么需要显式声明 &lt;T&gt;？ * 静态方法和实例方法的区别： * ResultData&lt;T&gt; 是一个泛型类，而 success(T data) 是静态方法。静态方法与类的实例无关，因此它无法直接访问类的实例化泛型类型。为了解决这个问题，静态方法需要自己声明泛型类型。 * 如果 success 方法是实例方法（即不加 static），那么它可以访问类级别的泛型 T，不需要再显式声明 &lt;T&gt;。但由于 success 是静态方法，它没有类实例，因此无法直接使用类的泛型类型。 */ public static &lt;T&gt; ResultData&lt;T&gt; success(T data) { ResultData&lt;T&gt; resultData = new ResultData&lt;&gt;(); resultData.setCode(ReturnCodeEnum.RC200.getCode()); resultData.setMessage(ReturnCodeEnum.RC200.getMessage()); resultData.setData(data); return resultData; } public static &lt;T&gt; ResultData&lt;T&gt; fail(String code,String message){ ResultData&lt;T&gt; resultData = new ResultData&lt;&gt;(); resultData.setCode(code); resultData.setMessage(message); resultData.setData(null); return resultData; } } ReturnCodeEnum 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 /** * HTTP返回的状态码 */ @Getter public enum ReturnCodeEnum { // 1、举值 /**操作失败**/ RC999(&#34;999&#34;,&#34;操作XXX失败&#34;), /**操作成功**/ RC200(&#34;200&#34;,&#34;success&#34;), /**服务降级**/ RC201(&#34;201&#34;,&#34;服务开启降级保护,请稍后再试!&#34;), /**热点参数限流**/ RC202(&#34;202&#34;,&#34;热点参数限流,请稍后再试!&#34;), /**系统规则不满足**/ RC203(&#34;203&#34;,&#34;系统规则不满足要求,请稍后再试!&#34;), /**授权规则不通过**/ RC204(&#34;204&#34;,&#34;授权规则不通过,请稍后再试!&#34;), RC375(&#34;375&#34;,&#34;数学运算异常，请稍后重试&#34;), /**access_denied**/ RC403(&#34;403&#34;,&#34;无访问权限,请联系管理员授予权限&#34;), /**access_denied**/ RC401(&#34;401&#34;,&#34;匿名用户访问无权限资源时的异常&#34;), RC404(&#34;404&#34;,&#34;404页面找不到的异常&#34;), /**服务异常**/ RC500(&#34;500&#34;,&#34;系统异常，请稍后重试&#34;), INVALID_TOKEN(&#34;2001&#34;,&#34;访问令牌不合法&#34;), ACCESS_DENIED(&#34;2003&#34;,&#34;没有权限访问该资源&#34;), CLIENT_AUTHENTICATION_FAILED(&#34;1001&#34;,&#34;客户端认证失败&#34;), USERNAME_OR_PASSWORD_ERROR(&#34;1002&#34;,&#34;用户名或密码错误&#34;), BUSINESS_ERROR(&#34;1004&#34;,&#34;业务逻辑异常&#34;), UNSUPPORTED_GRANT_TYPE(&#34;1003&#34;, &#34;不支持的认证模式&#34;); // 2、构造 /**自定义状态码**/ private final String code; /**自定义描述**/ private final String message; ReturnCodeEnum(String code, String message){ this.code = code; this.message = message; } // 3、传统遍历 public static ReturnCodeEnum getReturnCodeEnumV1(String code) { for (ReturnCodeEnum element : ReturnCodeEnum.values()) { if(element.getCode().equalsIgnoreCase(code)) { return element; } } return null; } // 3、流式计算遍历 public static ReturnCodeEnum getReturnCodeEnumV2(String code) { return Arrays.stream(ReturnCodeEnum.values()).filter(x -&gt; x.getCode().equalsIgnoreCase(code)).findFirst().orElse(null); } // public static void main(String[] args) // { // System.out.println(getReturnCodeEnumV2(&#34;200&#34;)); // RC200这条枚举记录（RC200(&#34;200&#34;,&#34;success&#34;)） // System.out.println(getReturnCodeEnumV2(&#34;200&#34;).getCode()); // 200 // System.out.println(getReturnCodeEnumV2(&#34;200&#34;).getMessage()); // success // } } …………………………………………………………………… cloud-provider-payment8001（service） pom 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 &lt;dependencies&gt; &lt;!--SpringBoot通用依赖模块--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--SpringBoot集成druid连接池--&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;druid-spring-boot-starter&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- Swagger3 调用方式 http://localhost:8001/swagger-ui/index.html --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springdoc&lt;/groupId&gt; &lt;artifactId&gt;springdoc-openapi-starter-webmvc-ui&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--mybatis和springboot整合--&gt; &lt;dependency&gt; &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt; &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--Mysql数据库驱动8 --&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--persistence--&gt; &lt;dependency&gt; &lt;groupId&gt;javax.persistence&lt;/groupId&gt; &lt;artifactId&gt;persistence-api&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--通用Mapper4--&gt; &lt;dependency&gt; &lt;groupId&gt;tk.mybatis&lt;/groupId&gt; &lt;artifactId&gt;mapper&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--hutool--&gt; &lt;dependency&gt; &lt;groupId&gt;cn.hutool&lt;/groupId&gt; &lt;artifactId&gt;hutool-all&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- fastjson2 --&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.fastjson2&lt;/groupId&gt; &lt;artifactId&gt;fastjson2&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--lombok--&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;scope&gt;provided&lt;/scope&gt; &lt;/dependency&gt; &lt;!--test--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;!--SpringCloud consul discovery --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-consul-discovery&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--SpringCloud consul config--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-consul-config&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-bootstrap&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- 引入cloud-api-commons通用包 --&gt; &lt;dependency&gt; &lt;groupId&gt;com.xz.cloud&lt;/groupId&gt; &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/dependency&gt; &lt;!--micrometer-tracing指标追踪 2--&gt; &lt;dependency&gt; &lt;groupId&gt;io.micrometer&lt;/groupId&gt; &lt;artifactId&gt;micrometer-tracing&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--micrometer-tracing-bridge-brave适配zipkin的桥接包 3--&gt; &lt;dependency&gt; &lt;groupId&gt;io.micrometer&lt;/groupId&gt; &lt;artifactId&gt;micrometer-tracing-bridge-brave&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--micrometer-observation 4--&gt; &lt;dependency&gt; &lt;groupId&gt;io.micrometer&lt;/groupId&gt; &lt;artifactId&gt;micrometer-observation&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--feign-micrometer 5--&gt; &lt;dependency&gt; &lt;groupId&gt;io.github.openfeign&lt;/groupId&gt; &lt;artifactId&gt;feign-micrometer&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--zipkin-reporter-brave 6--&gt; &lt;dependency&gt; &lt;groupId&gt;io.zipkin.reporter2&lt;/groupId&gt; &lt;artifactId&gt;zipkin-reporter-brave&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; yml bootstrap：pom需要引入SpringCloud consul config、bootstrap、Consul、Micrometer+ZipKin 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 # application.yml是用户级的资源配置项 # bootstrap.yml是系统级的，优先级更加高 # Spring Cloud会创建一个“Bootstrap Context”，作为Spring应用的`Application Context`的父上下文。 # 初始化的时候，`Bootstrap Context`负责从外部源加载配置属性并解析配置。这两个上下文共享一个从外部获取的`Environment`。 # Bootstrap`属性有高优先级，默认情况下，它们不会被本地配置覆盖。 # `Bootstrap context`和`Application Context`有着不同的约定，所以新增了一个`bootstrap.yml`文件，保证`Bootstrap Context`和`Application Context`配置的分离。 # application.yml文件改为bootstrap.yml,这是很关键的或者两者共存 # 因为bootstrap.yml是比application.yml先加载的。bootstrap.yml优先级高于application.yml spring: application: name: cloud-payment-service # Spring Cloud Consul for Service Discovery cloud: consul: host: localhost port: 8500 discovery: service-name: ${spring.application.name} # 8001以此名字入驻consul config: profile-separator: &#39;-&#39; # default value is &#34;,&#34;, We update &#34;-&#34; format: yaml management: zipkin: tracing: endpoint: http://localhost:9411/api/v2/spans # 固定写法 tracing: sampling: probability: 1.0 # 采样率默认为0.1，即十次只能有一次被记录下，值越大收集越及时 application 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 server: port: 8001 # ==========applicationName + druid-mysql8 driver=================== spring: datasource: type: com.alibaba.druid.pool.DruidDataSource driver-class-name: com.mysql.cj.jdbc.Driver url: jdbc:mysql://localhost:3306/db2024?characterEncoding=utf8&amp;useSSL=false&amp;serverTimezone=GMT%2B8&amp;rewriteBatchedStatements=true&amp;allowPublicKeyRetrieval=true username: root password: 527644117 profiles: active: dev # 多环境Consul配置加载内容dev/prod，不写就是default配置 # ========================mybatis=================== mybatis: mapper-locations: classpath:mapper/*.xml type-aliases-package: com.xz.springcloud.entities configuration: map-underscore-to-camel-case: true resources.mapper.PayMapper.xml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 &lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt; &lt;!DOCTYPE mapper PUBLIC &#34;-//mybatis.org//DTD Mapper 3.0//EN&#34; &#34;http://mybatis.org/dtd/mybatis-3-mapper.dtd&#34;&gt; &lt;mapper namespace=&#34;com.xz.springcloud.mapper.PayMapper&#34;&gt; &lt;resultMap id=&#34;BaseResultMap&#34; type=&#34;com.xz.springcloud.entities.Pay&#34;&gt; &lt;!-- WARNING - @mbg.generated --&gt; &lt;id column=&#34;id&#34; jdbcType=&#34;INTEGER&#34; property=&#34;id&#34; /&gt; &lt;result column=&#34;pay_no&#34; jdbcType=&#34;VARCHAR&#34; property=&#34;payNo&#34; /&gt; &lt;result column=&#34;order_no&#34; jdbcType=&#34;VARCHAR&#34; property=&#34;orderNo&#34; /&gt; &lt;result column=&#34;user_id&#34; jdbcType=&#34;INTEGER&#34; property=&#34;userId&#34; /&gt; &lt;result column=&#34;amount&#34; jdbcType=&#34;DECIMAL&#34; property=&#34;amount&#34; /&gt; &lt;result column=&#34;deleted&#34; jdbcType=&#34;TINYINT&#34; property=&#34;deleted&#34; /&gt; &lt;result column=&#34;create_time&#34; jdbcType=&#34;TIMESTAMP&#34; property=&#34;createTime&#34; /&gt; &lt;result column=&#34;update_time&#34; jdbcType=&#34;TIMESTAMP&#34; property=&#34;updateTime&#34; /&gt; &lt;/resultMap&gt; &lt;/mapper&gt; Main8001 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 @SpringBootApplication @MapperScan(&#34;com.xz.springcloud.mapper&#34;) public class Main8001 { public static void main(String[] args) { SpringApplication.run(Main8001.class, args); /* 微服务： 1、建module 2、改pom 3、写yml 4、主启动 5、业务类 */ /* 入驻consul（服务注册中心）： 1、pom 2、yml */ } } config.Swagger3Config 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 @Configuration public class Swagger3Config { // 分组API @Bean public GroupedOpenApi PayApi() { return GroupedOpenApi.builder().group(&#34;支付微服务模块&#34;).pathsToMatch(&#34;/pay/**&#34;).build(); // 以pay开头 } @Bean public GroupedOpenApi OtherApi() { return GroupedOpenApi.builder().group(&#34;其它微服务模块&#34;).pathsToMatch(&#34;/other/**&#34;, &#34;/others&#34;).build(); } /* @Bean public GroupedOpenApi CustomerApi() { return GroupedOpenApi.builder().group(&#34;客户微服务模块&#34;).pathsToMatch(&#34;/customer/**&#34;, &#34;/customers&#34;).build(); } */ @Bean public OpenAPI docsOpenApi() { return new OpenAPI() .info(new Info().title(&#34;cloud2024&#34;) .description(&#34;通用设计rest&#34;) .version(&#34;v1.0&#34;)) .externalDocs(new ExternalDocumentation() .description(&#34;www.atguigu.com&#34;) .url(&#34;https://yiyan.baidu.com/&#34;)); } } controller PayController：基础的增删改查、获取Consul中配置的kv、Swagger3注解 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 // Swagger3常用注解： // @Tag 标注位置：controller类：表示controller作用 // @Operation 标注位置：方法：描述方法作用 // @Schema 标注位置：model层的JavaBean：描述模型作用及每个属性 @Tag(name = &#34;支付微服务模块&#34;, description = &#34;支付CRUD&#34;) @RestController // @Controller + @ResponseBody @Slf4j @RequestMapping(&#34;/pay&#34;) public class PayController { @Resource private PayService payService; @PostMapping(&#34;/add&#34;) @Operation(summary = &#34;新增&#34;, description = &#34;新增支付流水方法，json作参数&#34;) public ResultData&lt;String&gt; addPay(@RequestBody Pay pay) { int i = payService.add(pay); return ResultData.success(&#34;成功插入记录了，返回：&#34; + i); } @DeleteMapping(&#34;/del/{id}&#34;) @Operation(summary = &#34;删除&#34;, description = &#34;删除支付流水方法&#34;) public ResultData&lt;String&gt; deletePay(@PathVariable(&#34;id&#34;) Integer id) { return ResultData.success(&#34;成功删除记录：&#34; + payService.delete(id)); } @PutMapping(&#34;/update&#34;) @Operation(summary = &#34;修改&#34;, description = &#34;修改支付流水方法&#34;) public ResultData&lt;String&gt; updatePay(@RequestBody PayDTO payDTO) { // 与前端交互只能用PayDTO，到controller要将其封装为Pay再传给后端 Pay pay = new Pay(); BeanUtils.copyProperties(payDTO, pay); return ResultData.success(&#34;成功修改记录：&#34; + payService.update(pay)); } @GetMapping(&#34;/get/{id}&#34;) @Operation(summary = &#34;按照ID查询流水&#34;, description = &#34;查询支付流水方法&#34;) public ResultData&lt;Pay&gt; getPayById(@PathVariable(&#34;id&#34;) Integer id) { // if (id == -4) throw new RuntimeException(&#34;id不能为负数&#34;); // 暂停62秒钟线程，测试Feign的默认调用超时时间 try { TimeUnit.SECONDS.sleep(62); } catch (InterruptedException e) { e.printStackTrace(); } return ResultData.success(payService.getById(id)); } @GetMapping(&#34;/get&#34;) public ResultData&lt;List&lt;Pay&gt;&gt; getPay() { return ResultData.success(payService.getAll()); } @GetMapping(&#34;/error&#34;) public ResultData&lt;Integer&gt; getPayError() { Integer integer = 200; try { System.out.println(&#34;come in payerror test&#34;); int age = 10 / 0; } catch (Exception e) { e.printStackTrace(); return ResultData.fail(ReturnCodeEnum.RC500.getCode(), e.getMessage()); } return ResultData.success(integer); } /* { &#34;code&#34;: &#34;500&#34;, &#34;message&#34;: &#34;/ by zero&#34;, &#34;data&#34;: null, &#34;timestamp&#34;: 1733309250087 } */ @Value(&#34;${server.port}&#34;) private String port; @GetMapping(&#34;/get/info&#34;) public String getInfoByConsul(@Value(&#34;${xz.info}&#34;) String xzInfo) { // xz.info为写在Consul相应环境中的yaml key return &#34;xzInfo: &#34; + xzInfo + &#34; port: &#34; + port; /* 如果没有在Consul中配置相应的key： -&gt; { &#34;code&#34;: &#34;500&#34;, &#34;message&#34;: &#34;Could not resolve placeholder &#39;xz.info&#39; in value \\&#34;${xz.info}\\&#34;&#34;, &#34;data&#34;: null, &#34;timestamp&#34;: 1733376396579 } */ } } PayCircuitController 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 @RestController @RequestMapping(&#34;/pay&#34;) public class PayCircuitController { /** * Resilience4j CircuitBreaker */ @GetMapping(&#34;/circuit/{id}&#34;) public String myCircuit(@PathVariable(&#34;id&#34;) Integer id) { if (id == -4) throw new RuntimeException(&#34;id 不能为负数&#34;); if (id == 9999) { try { TimeUnit.SECONDS.sleep(5); } catch (InterruptedException e) { e.printStackTrace(); } } return &#34;Hello, circuit! &#34; + &#34;\\t&#34; + IdUtil.simpleUUID(); } /** * Resilience4j Bulkhead */ @GetMapping(&#34;/bulkhead/{id}&#34;) public String myBulkhead(@PathVariable(&#34;id&#34;) Integer id) { if (id == -4) throw new RuntimeException(&#34;bulkhead id 不能为负数&#34;); if (id == 9999) { try { TimeUnit.SECONDS.sleep(5); } catch (InterruptedException e) { e.printStackTrace(); } } return &#34;Hello, bulkhead! &#34; + &#34;\\t&#34; + IdUtil.simpleUUID(); } /** * Resilience4j ratelimit */ @GetMapping(&#34;/ratelimit/{id}&#34;) public String myRatelimit(@PathVariable(&#34;id&#34;) Integer id) { return &#34;Hello, ratelimit! &#34; + &#34;\\t&#34; + IdUtil.simpleUUID(); } } PayMicrometerController 1 2 3 4 5 6 7 8 9 @RestController @RequestMapping(&#34;/pay&#34;) public class PayMicrometerController { @GetMapping(&#34;/micrometer/{id}&#34;) public String myMicrometer(@PathVariable(&#34;id&#34;) Integer id) { return &#34;Hello, welcome to myMicrometer &#34; + id + IdUtil.simpleUUID(); } } GatewayController 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 @RestController @RequestMapping(&#34;/pay&#34;) public class PayGatewayController { @Resource private PayService payService; @GetMapping(&#34;/gateway/get/{id}&#34;) public ResultData&lt;Pay&gt; getById(@PathVariable(&#34;id&#34;) Integer id) { Pay pay = payService.getById(id); return ResultData.success(pay); } @GetMapping(&#34;/gateway/info&#34;) public ResultData&lt;String&gt; getGatewayInfo() { return ResultData.success(&#34;gateway info test: &#34; + IdUtil.simpleUUID()); } @GetMapping(&#34;/gateway/filter&#34;) public ResultData&lt;String&gt; getGatewayFilter(HttpServletRequest request) { String res = &#34;&#34;; Enumeration&lt;String&gt; headers = request.getHeaderNames(); // 获得请求头名字的集合类 while (headers.hasMoreElements()) { String headName = headers.nextElement(); String headValue = request.getHeader(headName); System.out.println(&#34;请求头名：&#34; + headName + &#34;\\t\\t&#34; + &#34;请求头值：&#34; + headValue); /* ... 请求头名：x-request-xz1 请求头值：xzVal1 请求头名：x-request-xz2 请求头值：xzVal2 ... */ if (headName.equalsIgnoreCase(&#34;X-Request-xz1&#34;) || headName.equalsIgnoreCase(&#34;X-Request-xz2&#34;)) { res = res + headName + &#34;\\t&#34; + headValue + &#34; &#34;; } } System.out.println(&#34;==============================================================&#34;); String customerId = request.getParameter(&#34;customerId&#34;); System.out.println(&#34;request Parameter customerId：&#34; + customerId); String customerName = request.getParameter(&#34;customerName&#34;); System.out.println(&#34;request Parameter customerName：&#34; + customerName); System.out.println(&#34;==============================================================&#34;); // request Parameter customerId：9527001 // request Parameter customerName：null return ResultData.success(&#34;getGatewayFilter 过滤器 test：&#34; + res + &#34;\\t&#34; + DateUtil.now()); /* { &#34;code&#34;: &#34;200&#34;, &#34;message&#34;: &#34;success&#34;, &#34;data&#34;: &#34;getGatewayFilter 过滤器 test：x-request-xz1\\txzVal1 x-request-xz2\\txzVal2 \\t2024-12-10 10:51:13&#34;, &#34;timestamp&#34;: 1733799073903 } */ } } service 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 public interface PayService { int add(Pay pay); int delete(Integer id); int update(Pay pay); Pay getById(Integer id); List&lt;Pay&gt; getAll(); } @Service public class PayServiceImpl implements PayService { @Resource private PayMapper payMapper; @Override public int add(Pay pay) { return payMapper.insertSelective(pay); // null的属性不会保存，会使用数据库默认值 } @Override public int delete(Integer id) { return payMapper.deleteByPrimaryKey(id); } @Override public int update(Pay pay) { return payMapper.updateByPrimaryKeySelective(pay); } @Override public Pay getById(Integer id) { return payMapper.selectByPrimaryKey(id); } @Override public List&lt;Pay&gt; getAll() { return payMapper.selectAll(); } } mapper.Paymapper 1 2 public interface PayMapper extends Mapper&lt;Pay&gt; { } entities.Pay 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 /** * 表名：t_pay * 表注释：支付交易表 */ @Table(name = &#34;t_pay&#34;) @Schema(title = &#34;支付交易表Entity&#34;) public class Pay { @Id @GeneratedValue(generator = &#34;JDBC&#34;) @Schema(title = &#34;主键&#34;) private Integer id; /** * 支付流水号 */ @Column(name = &#34;pay_no&#34;) @Schema(title = &#34;支付流水号&#34;) private String payNo; /** * 订单流水号 */ @Column(name = &#34;order_no&#34;) @Schema(title = &#34;订单流水号&#34;) private String orderNo; /** * 用户账号ID */ @Column(name = &#34;user_id&#34;) @Schema(title = &#34;用户账号ID&#34;) private Integer userId; /** * 交易金额 */ @Schema(title = &#34;交易金额&#34;) private BigDecimal amount; /** * 删除标志，默认0不删除，1删除 */ private Byte deleted; /** * 创建时间 */ @Schema(title = &#34;创建时间&#34;) @Column(name = &#34;create_time&#34;) @JsonFormat(pattern = &#34;yyyy-MM-dd HH:mm:ss&#34;, timezone = &#34;GMT+8&#34;) // 完善从数据库中查出并返回的时间格式 private Date createTime; /** * 更新时间 */ @Schema(title = &#34;更新时间&#34;) @Column(name = &#34;update_time&#34;) @JsonFormat(pattern = &#34;yyyy-MM-dd HH:mm:ss&#34;, timezone = &#34;GMT+8&#34;) private Date updateTime; /** * @return id */ public Integer getId() { return id; } /** * @param id */ public void setId(Integer id) { this.id = id; } /** * 获取支付流水号 * * @return payNo - 支付流水号 */ public String getPayNo() { return payNo; } /** * 设置支付流水号 * * @param payNo 支付流水号 */ public void setPayNo(String payNo) { this.payNo = payNo; } /** * 获取订单流水号 * * @return orderNo - 订单流水号 */ public String getOrderNo() { return orderNo; } /** * 设置订单流水号 * * @param orderNo 订单流水号 */ public void setOrderNo(String orderNo) { this.orderNo = orderNo; } /** * 获取用户账号ID * * @return userId - 用户账号ID */ public Integer getUserId() { return userId; } /** * 设置用户账号ID * * @param userId 用户账号ID */ public void setUserId(Integer userId) { this.userId = userId; } /** * 获取交易金额 * * @return amount - 交易金额 */ public BigDecimal getAmount() { return amount; } /** * 设置交易金额 * * @param amount 交易金额 */ public void setAmount(BigDecimal amount) { this.amount = amount; } /** * 获取删除标志，默认0不删除，1删除 * * @return deleted - 删除标志，默认0不删除，1删除 */ public Byte getDeleted() { return deleted; } /** * 设置删除标志，默认0不删除，1删除 * * @param deleted 删除标志，默认0不删除，1删除 */ public void setDeleted(Byte deleted) { this.deleted = deleted; } /** * 获取创建时间 * * @return createTime - 创建时间 */ public Date getCreateTime() { return createTime; } /** * 设置创建时间 * * @param createTime 创建时间 */ public void setCreateTime(Date createTime) { this.createTime = createTime; } /** * 获取更新时间 * * @return updateTime - 更新时间 */ public Date getUpdateTime() { return updateTime; } /** * 设置更新时间 * * @param updateTime 更新时间 */ public void setUpdateTime(Date updateTime) { this.updateTime = updateTime; } } cloud-provider-payment8002（service） 与8001大体上一致 1 2 3 4 5 6 7 8 9 10 11 12 // Main8002 @SpringBootApplication @MapperScan(&#34;com.xz.springcloud.mapper&#34;) public class Main8002 { public static void main(String[] args) { SpringApplication.run(Main8002.class, args); } } // application.yml server: port: 8002 cloud-consumer-order80（deprecated，使用RestTemplate转发给微服务） pom 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 &lt;dependencies&gt; &lt;!--web + actuator--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--lombok--&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;!--hutool-all--&gt; &lt;dependency&gt; &lt;groupId&gt;cn.hutool&lt;/groupId&gt; &lt;artifactId&gt;hutool-all&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--fastjson2--&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.fastjson2&lt;/groupId&gt; &lt;artifactId&gt;fastjson2&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- swagger3 调用方式 http://localhost:8001/swagger-ui/index.html --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springdoc&lt;/groupId&gt; &lt;artifactId&gt;springdoc-openapi-starter-webmvc-ui&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--SpringCloud consul discovery --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-consul-discovery&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--loadbalancer--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-loadbalancer&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- 引入cloud-api-commons通用包 --&gt; &lt;dependency&gt; &lt;groupId&gt;com.xz.cloud&lt;/groupId&gt; &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; application.yml：Consul 1 2 3 4 5 6 7 8 9 10 11 12 13 server: port: 80 spring: application: name: cloud-consumer-order # Spring Cloud Consul for Service Discovery cloud: consul: host: localhost port: 8500 discovery: service-name: ${spring.application.name} # 8001以此名字入驻consul Main80 1 2 3 4 5 6 @SpringBootApplication public class Main80 { public static void main(String[] args) { SpringApplication.run(Main80.class, args); } } config.RestTemplateConfig 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 /** * Spring 框架中提供的一个类，用于简化与 RESTful 服务进行 HTTP 请求和响应的交互。它是一种方便的客户端工具，可以通过简单的方法调用 REST API，并处理请求和响应的数据。 */ @Configuration // @LoadBalancerClient(value = &#34;cloud-payment-service&#34;, configuration = RestTemplateConfig.class) // 区分大小写，要跟consul里名字保持一样 public class RestTemplateConfig { @Bean @LoadBalanced // I/O error on GET request for &#34;http://cloud-payment-service/pay/get/1&#34; -&gt; 一旦通过微服务名字调用，默认后面有多个微服务，需要开启负载均衡 public RestTemplate restTemplate() { return new RestTemplate(); } // 将默认的负载均衡轮询算法修改为随机 // @Bean // ReactiveLoadBalancer&lt;ServiceInstance&gt; randomLoadBalancer(Environment environment, // LoadBalancerClientFactory loadBalancerClientFactory) { // String name = environment.getProperty(LoadBalancerClientFactory.PROPERTY_NAME); // return new RandomLoadBalancer(loadBalancerClientFactory.getLazyProvider(name, ServiceInstanceListSupplier.class), name); // } } controller.OrderController 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 @RestController @RequestMapping(&#34;/consumer&#34;) public class OrderController { // public static final String PaymentServ_URL = &#34;http://localhost:8001&#34;; public static final String PaymentServ_URL = &#34;http://cloud-payment-service&#34;; // consul服务注册中心上的微服务名字 @Resource private RestTemplate restTemplate; @PostMapping(&#34;/pay/add&#34;) public ResultData addOrder(@RequestBody PayDTO payDTO) { // 类似于代理，也可以理解为请求转发，接收来自客户端的请求，然后将其转发给支付微服务，最后返回微服务的响应给客户端。 // 通过这种方式，系统可以轻松实现不同微服务之间的通信，保持松耦合和清晰的模块划分。 // 向目标 URL 发起一个 POST 请求，发送的请求体是 payDTO，并期望返回一个 ResultData 类型的响应。 // 目标微服务的地址，假设 PaymentServ_URL 是微服务的基本 URL（比如 http://payment-service/api），/pay/add 是支付服务处理支付请求的接口路径。 // payDTO 包含了用户请求的支付数据，它会被 RestTemplate 自动序列化成请求体（通常是 JSON 格式）。 return restTemplate.postForObject(PaymentServ_URL + &#34;/pay/add&#34;, payDTO, ResultData.class); // 发送 POST 请求 } @DeleteMapping(&#34;/pay/del/{id}&#34;) public ResultData deleteOrder(@PathVariable(&#34;id&#34;) Integer id) { restTemplate.delete(PaymentServ_URL + &#34;/pay/del/&#34; + id, id); return ResultData.success(null); } @PutMapping(&#34;/pay/update&#34;) public ResultData updateOrder(@RequestBody PayDTO payDTO) { restTemplate.put(PaymentServ_URL + &#34;/pay/update&#34;, payDTO); return ResultData.success(null); } @GetMapping(&#34;/pay/get/{id}&#34;) public ResultData getOrder(@PathVariable(&#34;id&#34;) Integer id) { return restTemplate.getForObject(PaymentServ_URL + &#34;/pay/get/&#34; + id, ResultData.class, id); // 发送 GET 请求 } @GetMapping(&#34;/pay/get/info&#34;) public String getInfoByConsul() { return restTemplate.getForObject(PaymentServ_URL + &#34;/pay/get/info&#34;, String.class); } @Resource private DiscoveryClient discoveryClient; /** * 原理：使用DiscoveryClient动态获取所有上线的服务器列表 * @return */ @GetMapping(&#34;/discovery&#34;) public String discovery() { List&lt;String&gt; services = discoveryClient.getServices(); // 获取consul上全部services for (String ele : services) { System.out.println(ele); // cloud-consumer-order、cloud-payment-service、consul } System.out.println(&#34;====================================&#34;); List&lt;ServiceInstance&gt; instances = discoveryClient.getInstances(&#34;cloud-payment-service&#34;); for (ServiceInstance instance : instances) { System.out.println(instance.getServiceId() + &#34;\\t&#34; + instance.getHost() + &#34;\\t&#34; + instance.getPort() + &#34;\\t&#34; + instance.getUri()); // cloud-payment-service Augenstern 8001 http://Augenstern:8001 // cloud-payment-service Augenstern 8002 http://Augenstern:8002 // 就会在这两个服务器上做负载均衡 } return instances.get(0).getServiceId() + &#34;: &#34; + instances.get(0).getPort(); // cloud-payment-service: 8001 } } cloud-consumer-feign-order80（使用OpenFeign转发给微服务） pom 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 &lt;dependencies&gt; &lt;!--web + actuator--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--lombok--&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;!--hutool-all--&gt; &lt;dependency&gt; &lt;groupId&gt;cn.hutool&lt;/groupId&gt; &lt;artifactId&gt;hutool-all&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--fastjson2--&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.fastjson2&lt;/groupId&gt; &lt;artifactId&gt;fastjson2&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- swagger3 调用方式 http://localhost:8001/swagger-ui/index.html --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springdoc&lt;/groupId&gt; &lt;artifactId&gt;springdoc-openapi-starter-webmvc-ui&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--SpringCloud consul discovery --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-consul-discovery&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--openfeign--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- httpclient5--&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.httpcomponents.client5&lt;/groupId&gt; &lt;artifactId&gt;httpclient5&lt;/artifactId&gt; &lt;version&gt;5.3&lt;/version&gt; &lt;/dependency&gt; &lt;!-- feign-hc5--&gt; &lt;dependency&gt; &lt;groupId&gt;io.github.openfeign&lt;/groupId&gt; &lt;artifactId&gt;feign-hc5&lt;/artifactId&gt; &lt;version&gt;13.1&lt;/version&gt; &lt;/dependency&gt; &lt;!--resilience4j-circuitbreaker--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-circuitbreaker-resilience4j&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- 由于断路保护等需要AOP实现，所以必须导入AOP包 --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-aop&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--resilience4j-bulkhead--&gt; &lt;dependency&gt; &lt;groupId&gt;io.github.resilience4j&lt;/groupId&gt; &lt;artifactId&gt;resilience4j-bulkhead&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--resilience4j-ratelimiter--&gt; &lt;dependency&gt; &lt;groupId&gt;io.github.resilience4j&lt;/groupId&gt; &lt;artifactId&gt;resilience4j-ratelimiter&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--micrometer-tracing指标追踪 2--&gt; &lt;dependency&gt; &lt;groupId&gt;io.micrometer&lt;/groupId&gt; &lt;artifactId&gt;micrometer-tracing&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--micrometer-tracing-bridge-brave适配zipkin的桥接包 3--&gt; &lt;dependency&gt; &lt;groupId&gt;io.micrometer&lt;/groupId&gt; &lt;artifactId&gt;micrometer-tracing-bridge-brave&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--micrometer-observation 4--&gt; &lt;dependency&gt; &lt;groupId&gt;io.micrometer&lt;/groupId&gt; &lt;artifactId&gt;micrometer-observation&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--feign-micrometer 5--&gt; &lt;dependency&gt; &lt;groupId&gt;io.github.openfeign&lt;/groupId&gt; &lt;artifactId&gt;feign-micrometer&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--zipkin-reporter-brave 6--&gt; &lt;dependency&gt; &lt;groupId&gt;io.zipkin.reporter2&lt;/groupId&gt; &lt;artifactId&gt;zipkin-reporter-brave&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- 引入cloud-api-commons通用包 --&gt; &lt;dependency&gt; &lt;groupId&gt;com.xz.cloud&lt;/groupId&gt; &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; application.yml：配置Consul、OpenFeign、Resilience4j、Micrometer+ZipKin 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 server: port: 80 spring: application: name: cloud-consumer-openfeign-order # Spring Cloud Consul for Service Discovery cloud: consul: host: localhost port: 8500 discovery: service-name: ${spring.application.name} # 8001以此名字入驻consul prefer-agent-address: true # 优先使用服务ip进行注册 openfeign: client: config: # default: # （全局） # # 连接超时时间 # connectTimeout: 3000 # # 读取超时时间 # readTimeout: 3000 cloud-payment-service: # 给单个服务指定会覆盖全局的 connectTimeout: 20000 readTimeout: 20000 # 修改默认HttpClient -&gt; Apache HttpClient5开启，提升性能 httpclient: hc5: enabled: true # 替换前为默认的 HttpClient + HttpURLConnection # 替换后为 hc.client5 # 请求/响应压缩：支持对请求和响应进行GZIP压缩，以减少通信过程中的性能损耗 compression: request: enabled: true min-request-size: 2048 # 最小触发压缩的大小 mime-types: text/xml,application/xml,application/json # 触发压缩数据类型 response: enabled: true # 2024-12-05T19:44:14.215+08:00 DEBUG 13360 --- [cloud-consumer-openfeign-order] [p-nio-80-exec-5] com.xz.springcloud.apis.PayFeignAPi : [PayFeignAPi#getPayInfo] Accept-Encoding: gzip # 开启circuitbreaker和分组激活 circuitbreaker: enabled: false group: enabled: false # 默认不开启分组，若开启，默认的分组策略是精确优先，若设置了分组策略则按设置的来 # Feign日志打印功能（logging.level + 含有@FeignClient注解的全接口名 + debug） logging: level: com: xz: springcloud: apis: PayFeignAPi: debug # # 按照次数：COUNT_BASED 的例子 # # 6次访问中当执行方法的失败率达到50%时CircuitBreaker将进入开启OPEN状态(保险丝跳闸断电)拒绝所有请求。 # # 等待5秒后，CircuitBreaker 将自动从开启OPEN状态过渡到半开HALF_OPEN状态，允许一些请求通过以测试服务是否恢复正常。 # # 如还是异常CircuitBreaker 将重新进入开启OPEN状态；如正常将进入关闭CLOSE闭合状态恢复正常处理请求。 # resilience4j: # circuitbreaker: # configs: # default: # failure-rate-threshold: 50 # 调用失败率达到50%时打开断路器，超过失败请求百分⽐时CircuitBreaker变为OPEN状态 # sliding-window-type: COUNT_BASED # 滑动窗口的类型 # sliding-window-size: 6 # 滑动窗⼝的⼤⼩，配置COUNT_BASED表示6个请求，配置TIME_BASED表示6秒 # minimum-number-of-calls: 6 # 断路器计算失败率或慢调用率之前所需的最小样本(每个滑动窗口周期)。如果minimumNumberOfCalls为10，则必须最少记录10个样本，然后才能计算失败率。如果只记录了9次调用，即使所有9次调用都失败，断路器也不会开启 # automatic-transition-from-open-to-half-open-enabled: false # 是否启用自动从开启状态过渡到半开状态，默认值为true。如果启用，CircuitBreaker将自动从开启状态过渡到半开状态，并允许一些请求通过以测试服务是否恢复正常 # wait-duration-in-open-state: 5s # 从OPEN到HALF_OPEN状态需要等待的时间（不管怎么配置，都会在一定时间内恢复到半开） # permitted-number-of-calls-in-half-open-state: 2 # 半开状态允许的最大请求数，默认值为10。在半开状态下，CircuitBreaker将允许最多permittedNumberOfCallsInHalfOpenState个请求通过，如果调用失败率再次达到50%，CircuitBreaker将重新进入开启状态 # record-exceptions: # - java.lang.Exception # instances: # cloud-payment-service: # base-config: default # resilience4j: # timelimiter: # configs: # default: # # 适合高并发场景下接口响应较慢导致拖垮整个服务的其他接口 # timeout-duration: 10s # timelimiter默认限制远程调用1s，超过1s就超时异常，配置了降级，就走降级逻辑（最高优先级） # circuitbreaker: # configs: # default: # failure-rate-threshold: 50 # 调用失败率达到50%时打开断路器，超过失败请求百分⽐时CircuitBreaker变为OPEN状态 # sliding-window-type: TIME_BASED # 滑动窗口的类型 # sliding-window-size: 2 # 滑动窗⼝的⼤⼩，配置TIME_BASED表示2秒 # minimum-number-of-calls: 2 # 断路器计算失败率或慢调用率之前所需的最小样本(每个滑动窗口周期)。 # wait-duration-in-open-state: 5s # 从OPEN到HALF_OPEN状态需要等待的时间（不管怎么配置，都会在一定时间内恢复到半开） # permitted-number-of-calls-in-half-open-state: 2 # 半开状态允许的最大请求数，默认值为10。在半开状态下，CircuitBreaker将允许最多permittedNumberOfCallsInHalfOpenState个请求通过，如果调用失败率再次达到50%，CircuitBreaker将重新进入开启状态 # slow-call-duration-threshold: 2s # 满调用时间阈值，高于阈值视为慢调用并增加慢调用比例 # slow-call-rate-threshold: 30 # 慢调用百分比峰值，断路器把调用时间大于slow-call-duration-threshold视为慢调用，当慢调用比例高于此阈值，断路器打开，并开启服务降级 # record-exceptions: # - java.lang.Exception # instances: # cloud-payment-service: # base-config: default # SEMAPHORE # resilience4j: # bulkhead: # configs: # default: # max-concurrent-calls: 2 # 允许线程并发执行的最大数量 # max-wait-duration: 1s # 当达到并发调用数量时，新的线程的阻塞时间，只愿意等待1s，超时进舱壁兜底fallback # instances: # cloud-payment-service: # base-config: default # timelimiter: # configs: # default: # timeout-duration: 20s # 为了保证测试故意延长 # THREADPOOL 注意，由于THREADPOOL会新启线程池，需要把spring.cloud.openfeign.circuitbreaker.group.enabled设为false，新启线程和原来主线程脱离 # resilience4j: # timelimiter: # configs: # default: # timeout-duration: 10s # thread-pool-bulkhead: # configs: # default: # core-thread-pool-size: 1 # max-thread-pool-size: 1 # queue-capacity: 1 # 线程池内最多容纳1个，等待队列最多容纳1个，故最多容纳2个（核心线程池内存常驻，其余（若有）线程池只是临时的，超过时间不用就会回收） # instances: # cloud-payment-service: # base-config: default resilience4j: ratelimiter: configs: default: limit-for-period: 2 # 在一次刷新周期内，允许执行的最大请求数 limit-refresh-period: 1s # 限流器每隔limitRefreshPeriod刷新一次，将允许处理的最大请求数量重置为limitForPeriod timeout-duration: 1 # 线程等待权限的默认等待时间 instances: cloud-payment-service: base-config: default management: zipkin: tracing: endpoint: http://localhost:9411/api/v2/spans # 固定写法 tracing: sampling: probability: 1.0 # 采样率默认为0.1，即十次只能有一次被记录下，值越大收集越及时 MainOpenFeign80 1 2 3 4 5 6 7 @SpringBootApplication @EnableFeignClients // 启用Feign客户端，定义服务+绑定接口，以声明式的方法优雅而简单地实现服务调用 public class MainOpenFeign80 { public static void main(String[] args) { SpringApplication.run(MainOpenFeign80.class, args); } } config.FeignConfig 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 @Configuration public class FeignConfig { /** * OpenFeign的重试机制 */ @Bean public Retryer myRetryer() { return Retryer.NEVER_RETRY; // Feign默认配置是不走重试策略的 // 最大请求次数为3(1+2)，初始间隔时间为100ms，重试间最大间隔时间为1s // return new Retryer.Default(100, 1, 3); } /** * OpenFeign的日志打印功能 */ @Bean Logger.Level feignLoggerLevel() { return Logger.Level.FULL; } } controller OrderController 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 @RestController @RequestMapping(&#34;/feign&#34;) public class OrderController { @Resource private PayFeignAPi payFeignAPi; @PostMapping(&#34;/pay/add&#34;) public ResultData addOrder(@RequestBody PayDTO payDTO) { // 1、模拟本地addOrder新增订单成功（省略sql操作） // 2、在开启addPay支付微服务远程调用 // 当应用启动时，Feign使用Java动态代理机制生成接口的实现，这个实现由SpringCLoud方法提供支持 // Feign客户端在内部构建了请求的详细信息，并将接口方法调用转换为HTTP调用 return payFeignAPi.addPay(payDTO); } @GetMapping(&#34;/pay/get/{id}&#34;) public ResultData getPayInfo(@PathVariable(&#34;id&#34;) Integer id) { // 1、支付微服务远程调用，按照id查询订单支付流水信息 ResultData resultData = null; try { System.out.println(&#34;调用开始：&#34; + DateUtil.now()); resultData = payFeignAPi.getPayInfo(id); } catch (Exception e) { e.printStackTrace(); System.out.println(&#34;调用结束：&#34; + DateUtil.now()); ResultData.fail(ReturnCodeEnum.RC500.getCode(), e.getMessage()); // 测试超时控制 // 调用开始：2024-12-05 18:52:31 // 调用结束：2024-12-05 18:53:31 // Feign默认超时时间60s } return resultData; } @GetMapping(&#34;/pay/get/info&#34;) public String mylb() { return payFeignAPi.mylb(); } } OrderCircuitController：CircuitBreaker、BulkHead、RateLimit 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 @RestController public class OrderCircuitController { @Resource private PayFeignAPi payFeignAPi; @GetMapping(&#34;/feign/pay/circuit/{id}&#34;) @CircuitBreaker(name = &#34;cloud-payment-service&#34;, fallbackMethod = &#34;myCircuitFallback&#34;) // 与yml的instances名字保持一致 public String myCircuitBreaker(@PathVariable(&#34;id&#34;) Integer id) { return payFeignAPi.myCircuit(id); } /** * 报错就会进入，超过50%才会熔断（断开），后面就算不报错了，仍会返回失败 * 服务降级后的兜底处理方法 */ public String myCircuitFallback(Throwable t) { return &#34;myCircuitFallback 系统繁忙，请稍后再试&#34;; } @GetMapping(&#34;/feign/pay/bulkhead/{id}&#34;) @Bulkhead(name = &#34;cloud-payment-service&#34;, fallbackMethod = &#34;myBulkheadFallback&#34;, type = Bulkhead.Type.SEMAPHORE) public String myBulkhead(@PathVariable(&#34;id&#34;) Integer id) { return payFeignAPi.myBulkhead(id); } public String myBulkheadFallback(Throwable t) { return &#34;myBulkheadFallback 隔板超出最大数量限制，系统繁忙，请稍后再试&#34;; } @GetMapping(&#34;/feign/pay/bulkhead_th/{id}&#34;) @Bulkhead(name = &#34;cloud-payment-service&#34;, fallbackMethod = &#34;myBulkheadFallbackTh&#34;, type = Bulkhead.Type.THREADPOOL) public CompletableFuture&lt;String&gt; myBulkheadTh(@PathVariable(&#34;id&#34;) Integer id) { System.out.println(Thread.currentThread().getName() + &#34;\\t&#34; + &#34;---开始进入---&#34;); try { TimeUnit.SECONDS.sleep(3); } catch (InterruptedException e) { e.printStackTrace(); } System.out.println(Thread.currentThread().getName() + &#34;\\t&#34; + &#34;---准备离开---&#34;); // bulkhead-cloud-payment-service-1 ---开始进入--- // bulkhead-cloud-payment-service-1 ---准备离开--- return CompletableFuture.supplyAsync(() -&gt; payFeignAPi.myBulkhead(id) + &#34;\\t&#34; + &#34;THREADPOOL&#34;); } public CompletableFuture&lt;String&gt; myBulkheadFallbackTh(Integer id, Throwable t) { return CompletableFuture.supplyAsync(() -&gt; &#34;myBulkheadFallbackTh 隔板超出最大数量限制，系统繁忙，请稍后再试&#34;); } @GetMapping(&#34;/feign/pay/ratelimit/{id}&#34;) @RateLimiter(name = &#34;cloud-payment-service&#34;, fallbackMethod = &#34;myRatelimitFallback&#34;) public String myRatelimit(@PathVariable(&#34;id&#34;) Integer id) { return payFeignAPi.myRatelimit(id); } public String myRatelimitFallback(Throwable t) { return &#34;myRatelimitFallback 你被限流了，禁止访问&#34;; } } OrderMicrometerController：Micrometer 1 2 3 4 5 6 7 8 9 10 11 @RestController public class OrderMicrometerController { @Resource private PayFeignAPi payFeignAPi; @GetMapping(&#34;/feign/micrometer/{id}&#34;) public String myMicrometer(@PathVariable(&#34;id&#34;) Integer id) { return payFeignAPi.myMicrometer(id); } } OrderMicrometerController：GateWay 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 @RestController public class OrderGatewayController { @Resource private PayFeignAPi payFeignAPi; @GetMapping(&#34;/feign/pay/gateway/get/{id}&#34;) public ResultData getById(@PathVariable(&#34;id&#34;) Integer id) { return payFeignAPi.getById(id); } @GetMapping(&#34;/feign/pay/gateway/info&#34;) public ResultData&lt;String&gt; getGatewayInfo() { return payFeignAPi.getGatewayInfo(); } } cloud-gateway9527（网关） pom 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 &lt;dependencies&gt; &lt;!--gateway--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-gateway&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--服务注册发现consul discovery,网关也要注册进服务注册中心统一管控--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-consul-discovery&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- 指标监控健康检查的actuator,网关是响应式编程删除掉spring-boot-starter-web dependency--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--lombok--&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;scope&gt;provided&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; application.yml：配置Consul、routes=(id+uri+predicates+filters)*n 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 server: port: 9527 spring: application: name: cloud-gateway # 以微服务注册进consul或nacos服务列表内 cloud: consul: # 配置consul地址 host: localhost port: 8500 discovery: prefer-agent-address: true service-name: ${spring.application.name} gateway: # 所有的请求都会发给网关，由网关进行转发 routes: - id: pay_route1 # 路由的ID（类似于mysql的主键），没有固定规则但要求唯一，建议配合服务名 # uri: http://localhost:8001 # 匹配后提供服务的路由地址 uri: lb://cloud-payment-service # 以微服务名字动态获取uri # lb 代表 负载均衡器（Load Balancer）。这表示请求会通过负载均衡器转发到 cloud-payment-service 服务，而不是直接指定一个固定的 IP 地址或主机名。 # lb://：这个前缀表示使用负载均衡器来解析服务的地址，负载均衡器会根据一定的算法（例如轮询、最小连接数等）将请求转发到 cloud-payment-service 的不同实例。 # 此时将8001改为8007，依然可以通过OpenFeign对服务访问 predicates: # 只有满足了断言下的所有条件才能正常访问到uri - Path=/pay/gateway/get/** # 路径相匹配的进行路由 - After=2024-12-09T16:33:19.186588300+08:00[GMT+08:00] # 在此时间之后才能访问：到点秒杀 # Before Between=XXX,XXX # - Cookie=username,xz # cmd：curl http://localhost:9527/pay/gateway/get/1 --cookie &#34;username=xz&#34; 直接访问9527才生效，当访问80再访问9527则不行，因为这样Cookie只传到了80端口（实际工作中不会有用Feign调网关的情况发生，故直接访问网关没有问题） # - Header=X-Request-Id, \\d+ # cmd：curl http://localhost:9527/pay/gateway/get/1 -H &#34;X-Request-Id:123456&#34; # 一个属性名称，一个正则表达式，属性名与正则匹配才符合条件：请求头要有X-Request-Id属性且值为正数 同样只有直接访问9527才生效 # - Host=**.xz.com # cmd：curl http://localhost:9527/pay/gateway/get/3 -H &#34;Host:a.www.xz.com&#34; 接收一组匹配的域名列表，这个模板是一个ant分隔的模板，用.作为分隔符 # - Query=username, \\d+ # http://localhost:9527/pay/gateway/get/1?username=23 要求有查询参数且符合属性值，一个是属性名、一个是属性值，属性值可以是正则 # - RemoteAddr=10.249.94.1/24 # IPv4地址 10.249.94.181 http://10.249.94.181:9527/pay/gateway/get/1 外部访问IP限制，最大跨度不超过32，目前是1-24，CIDR表示法 # - Method=POST # 限制请求方法只能为POST # Fully Expanded Arguments # - name: My # args: # userType: diamond # http://localhost:9527/pay/gateway/get/1?userType=diamond # Shortcut Configuration # - My=diamond - id: pay_route2 # uri: http://localhost:8001 uri: lb://cloud-payment-service # 动态路由 predicates: - Path=/pay/gateway/info/** - id: pay_route3 uri: lb://cloud-payment-service predicates: - Path=/pay/gateway/filter/** # 默认的正确地址 # - Path=/gateway/filter/** # 拆分为 PrefixPath + Path # - Path=/XYZ/abc/{segment} # {segment}为占位符，最后会被setPath取代 filters: # # 往请求中添加请求头参数 # - AddRequestHeader=X-Request-xz1,xzVal1 # 请求头kv，若含有多个kv则重写一行设置 # - AddRequestHeader=X-Request-xz2,xzVal2 # # 往请求中删除请求头参数 # - RemoveRequestHeader=sec-fetch-site # 删除 请求头名：sec-fetch-site 请求头值：none # # 修改请求头参数 # - SetRequestHeader=sec-fetch-mode,xzxzxzxzxzxz # 请求头名：sec-fetch-mode 请求头值修改为xzxzxzxzxzxz # # 新增请求参数 # - AddRequestParameter=customerId,9527001 # 新增请求参数Parameter，kv（默认值），如果有传过来的请求参数则会将此覆盖 # # 删除请求参数 # - RemoveRequestParameter=customName # 删除url请求参数的value -&gt; null # # 新增响应头参数 # - AddResponseHeader=X-Response-xz,xzzzzzz # x-response-xz: xzzzzzz # # 修改响应头参数 # - SetResponseHeader=Date,2099-11-11 # date: 2099-11-11 # # 删除响应头参数 # - RemoveResponseHeader=Content-Type # 将默认自带Content-Type删除 # - PrefixPath=/pay # http://localhost:9527/pay/gateway/filter 过滤器统一管理前缀 # - SetPath=/pay/gateway/{segment} # 浏览器访问的地址：http://localhost:9527/XYZ/abc/filter 实际访问的地址：http://localhost:9527/pay/gateway/filter # - RedirectTo=302,https://www.baidu.com/ # 访问http://localhost:9527/pay/gateway/filter跳转到https://www.baidu.com/ 302重定向状态码 # 自定义filter就是作用于全部routes的 spring.cloud.gateway.default-filters... - My=xz # xz就是Config里面的status http://localhost:9527/pay/gateway/filter -&gt; 400 http://localhost:9527/pay/gateway/filter?xz=??才能访问（过滤器可以替代断言，但是断言不能替代过滤器） Main9527 1 2 3 4 5 6 7 @SpringBootApplication public class Main9527 { public static void main(String[] args) { SpringApplication.run(Main9527.class, args); // 网关，不写任何业务代码，网关和业务无关 } } mygateway MyRoutePredicateFactory：自定义路由断言 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 /** * 需求说明：自定义配置会员等级userType，按照钻/金/银和yml配置的会员等级，以适配是否可以访问 * * 约定自定义的路由断言工厂必须要以RoutePredicateFactory结尾，前面的部分将会形如[After][Before][Between]...出现 * 因此这个路由断言工厂将会显示为[My] * 2024-12-10T10:17:10.899+08:00 INFO 24408 --- [cloud-gateway] [main] o.s.c.g.r.RouteDefinitionRouteLocator : Loaded RoutePredicateFactory [My] */ @Component public class MyRoutePredicateFactory extends AbstractRoutePredicateFactory&lt;MyRoutePredicateFactory.Config&gt; { public MyRoutePredicateFactory() { super(MyRoutePredicateFactory.Config.class); } // 这个Config类就是路由断言规则！ @Validated public static class Config { @Setter @Getter @NotEmpty private String userType; // 钻/金/银用户等级 } /** * 使支持短格式 */ @Override public List&lt;String&gt; shortcutFieldOrder() { return Collections.singletonList(&#34;userType&#34;); } @Override public Predicate&lt;ServerWebExchange&gt; apply(MyRoutePredicateFactory.Config config) { return new Predicate&lt;ServerWebExchange&gt;() { @Override public boolean test(ServerWebExchange serverWebExchange) { String userType = serverWebExchange.getRequest().getQueryParams().getFirst(&#34;userType&#34;); // 获取名字为userType的查询参数 if (userType == null) return false; // 断言校验失败 if (userType.equalsIgnoreCase(config.getUserType())) { return true; // 与预先定义的userType相同，断言校验成功 } return false; } }; } } MyGlobalFilter：应用场景：统计Controller调用耗时情况，如何落地，谈谈设计思路：自定义全局过滤器（重点，面试设计题） 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 /** * 自定义全局过滤器 */ @Component @Slf4j public class MyGlobalFilter implements GlobalFilter, Ordered { public static final String BEGIN_VISIT_TIME = &#34;begin_visit_time&#34;; @Override public Mono&lt;Void&gt; filter(ServerWebExchange exchange, GatewayFilterChain chain) { // 先记录下访问接口的开始时间 exchange.getAttributes().put(BEGIN_VISIT_TIME, System.currentTimeMillis()); // 返回统计的各个结果给后台 return chain.filter(exchange).then(Mono.fromRunnable(() -&gt; { // 响应式编程 Long beginVisitTime = exchange.getAttribute(BEGIN_VISIT_TIME); if (beginVisitTime != null) { log.info(&#34;访问接口主机：&#34; + exchange.getRequest().getURI().getHost()); log.info(&#34;访问接口端口：&#34; + exchange.getRequest().getURI().getPort()); log.info(&#34;访问接口URL：&#34; + exchange.getRequest().getURI().getPath()); log.info(&#34;访问接口URL后面的参数：&#34; + exchange.getRequest().getURI().getRawQuery()); log.info(&#34;访问接口时长：&#34; + (System.currentTimeMillis() - beginVisitTime) + &#34;毫秒&#34;); log.info(&#34;=====================================&#34;); System.out.println(); /* 2024-12-10T21:53:21.721+08:00 INFO 29628 --- [cloud-gateway] [tor-http-nio-15] c.x.s.mygateway.MyGlobalFilter : 访问接口主机：localhost 2024-12-10T21:53:21.721+08:00 INFO 29628 --- [cloud-gateway] [tor-http-nio-15] c.x.s.mygateway.MyGlobalFilter : 访问接口端口：9527 2024-12-10T21:53:21.721+08:00 INFO 29628 --- [cloud-gateway] [tor-http-nio-15] c.x.s.mygateway.MyGlobalFilter : 访问接口URL：/pay/gateway/info 2024-12-10T21:53:21.721+08:00 INFO 29628 --- [cloud-gateway] [tor-http-nio-15] c.x.s.mygateway.MyGlobalFilter : 访问接口URL后面的参数：null 2024-12-10T21:53:21.721+08:00 INFO 29628 --- [cloud-gateway] [tor-http-nio-15] c.x.s.mygateway.MyGlobalFilter : 访问接口时长：198毫秒 */ } })); } /** * 数字越小，优先级越高，pre最先执行，post最后执行 */ @Override public int getOrder() { return 0; } } MyGatewayFilterFactory：自定义条件过滤器 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 @Component public class MyGatewayFilterFactory extends AbstractGatewayFilterFactory&lt;MyGatewayFilterFactory.Config&gt; { public MyGatewayFilterFactory() { super(MyGatewayFilterFactory.Config.class); } public static class Config { @Getter @Setter private String status; // 设定一个状态值/标志位，等于时才可以访问 } @Override public List&lt;String&gt; shortcutFieldOrder() { return Arrays.asList(&#34;status&#34;); } @Override public GatewayFilter apply(MyGatewayFilterFactory.Config config) { return new GatewayFilter() { @Override public Mono&lt;Void&gt; filter(ServerWebExchange exchange, GatewayFilterChain chain) { ServerHttpRequest request = exchange.getRequest(); System.out.println(&#34;进入了自定义网关过滤器MyGatewayFilterFactory, status：&#34; + config.getStatus()); // 进入了自定义网关过滤器MyGatewayFilterFactory, status：xz（与路由断言工厂类似，来自于yml中的配置） if (request.getQueryParams().containsKey(config.getStatus())) { // 包含配置的key才放行 return chain.filter(exchange); // 放行，传给下一个过滤器 } else { exchange.getResponse().setStatusCode(HttpStatus.BAD_REQUEST); // 非法请求 return exchange.getResponse().setComplete(); } } }; } } Spring Cloud原生 Consul：服务注册与发现 cmd指令 1 2 3 4 5 6 7 8 查看版本 consul --version 运行 consul agent -dev 打开 http://localhost:8500/ pom 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 &lt;!--SpringCloud consul discovery （所有微服务！） --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-consul-discovery&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--SpringCloud consul config （仅service！） --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-consul-config&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-bootstrap&lt;/artifactId&gt; &lt;/dependency&gt; CAP 1 2 3 C：Consistency 强一致性 A：Availability 可用性 P：Partition tolerance 分区容错性 经典CAP图 1 2 3 4 5 6 最多只能同时较好的满足两个。CAP理论的核心是：一个分布式系统不可能同时很好的满足一致性，可用性和分区容错性这三个需求， 因此，根据 CAP 原理将 NoSQL 数据库分成了满足 CA 原则、满足 CP 原则和满足 AP 原则三大类： CA - 单点集群，满足一致性，可用性的系统，通常在可扩展性上不太强大。 CP - 满足一致性，分区容忍性的系统，通常性能不是特别高。 AP - 满足可用性，分区容忍性的系统，通常可能对一致性要求低一些。 ">
<meta property='og:url' content='https://X-Augenstern.github.io/p/springcloud%E7%AC%94%E8%AE%B0/'>
<meta property='og:site_name' content='Example Site'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:published_time' content='2025-03-19T21:36:49&#43;08:00'/><meta property='article:modified_time' content='2025-03-19T21:36:49&#43;08:00'/>
<meta name="twitter:title" content="SpringCloud笔记">
<meta name="twitter:description" content="\n父工程pom 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 &lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt; &lt;project xmlns=&#34;http://maven.apache.org/POM/4.0.0&#34; xmlns:xsi=&#34;http://www.w3.org/2001/XMLSchema-instance&#34; xsi:schemaLocation=&#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&#34;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;com.xz.cloud&lt;/groupId&gt; &lt;artifactId&gt;springcloud&lt;/artifactId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;packaging&gt;pom&lt;/packaging&gt; &lt;modules&gt; &lt;module&gt;mybatis_generator&lt;/module&gt; &lt;module&gt;cloud-provider-payment8001&lt;/module&gt; &lt;module&gt;cloud-consumer-order80&lt;/module&gt; &lt;module&gt;cloud-api-commons&lt;/module&gt; &lt;module&gt;cloud-provider-payment8002&lt;/module&gt; &lt;module&gt;cloud-consumer-feign-order80&lt;/module&gt; &lt;module&gt;cloud-gateway9527&lt;/module&gt; &lt;/modules&gt; &lt;properties&gt; &lt;maven.compiler.source&gt;17&lt;/maven.compiler.source&gt; &lt;maven.compiler.target&gt;17&lt;/maven.compiler.target&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;hutool.version&gt;5.8.22&lt;/hutool.version&gt; &lt;lombok.version&gt;1.18.36&lt;/lombok.version&gt; &lt;druid.version&gt;1.1.23&lt;/druid.version&gt; &lt;mybatis.springboot.version&gt;3.0.4&lt;/mybatis.springboot.version&gt; &lt;mysql.version&gt;8.0.28&lt;/mysql.version&gt; &lt;swagger3.version&gt;2.2.0&lt;/swagger3.version&gt; &lt;mapper.version&gt;4.2.3&lt;/mapper.version&gt; &lt;fastjson2.version&gt;2.0.40&lt;/fastjson2.version&gt; &lt;persistence-api.version&gt;1.0.2&lt;/persistence-api.version&gt; &lt;spring.boot.test.version&gt;3.2.0&lt;/spring.boot.test.version&gt; &lt;spring.boot.version&gt;3.2.0&lt;/spring.boot.version&gt; &lt;spring.cloud.version&gt;2023.0.0&lt;/spring.cloud.version&gt; &lt;spring.cloud.alibaba.version&gt;2023.0.0.0-RC1&lt;/spring.cloud.alibaba.version&gt; &lt;micrometer-tracing.version&gt;1.2.0&lt;/micrometer-tracing.version&gt; &lt;micrometer-observation.version&gt;1.12.0&lt;/micrometer-observation.version&gt; &lt;feign-micrometer.version&gt;12.5&lt;/feign-micrometer.version&gt; &lt;zipkin-reporter-brave.version&gt;2.17.0&lt;/zipkin-reporter-brave.version&gt; &lt;/properties&gt; &lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;!--springboot 3.3.5--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;${spring.boot.version}&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;!--springcloud 2023.0.0--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt; &lt;version&gt;${spring.cloud.version}&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;!--springcloud alibaba 2023.0.0.0-RC1--&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-alibaba-dependencies&lt;/artifactId&gt; &lt;version&gt;${spring.cloud.alibaba.version}&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;!--SpringBoot集成mybatis--&gt; &lt;dependency&gt; &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt; &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;${mybatis.springboot.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!--1、Mysql数据库驱动8 --&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;version&gt;${mysql.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!--2、SpringBoot集成druid连接池--&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;druid-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;${druid.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!--3、通用Mapper4之tk.mybatis--&gt; &lt;dependency&gt; &lt;groupId&gt;tk.mybatis&lt;/groupId&gt; &lt;artifactId&gt;mapper&lt;/artifactId&gt; &lt;version&gt;${mapper.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!--4、persistence--&gt; &lt;dependency&gt; &lt;groupId&gt;javax.persistence&lt;/groupId&gt; &lt;artifactId&gt;persistence-api&lt;/artifactId&gt; &lt;version&gt;${persistence-api.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!-- fastjson2 --&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.fastjson2&lt;/groupId&gt; &lt;artifactId&gt;fastjson2&lt;/artifactId&gt; &lt;version&gt;${fastjson2.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!-- swagger3 调用方式 http://你的主机IP地址:5555/swagger-ui/index.html --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springdoc&lt;/groupId&gt; &lt;artifactId&gt;springdoc-openapi-starter-webmvc-ui&lt;/artifactId&gt; &lt;version&gt;${swagger3.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!--hutool--&gt; &lt;dependency&gt; &lt;groupId&gt;cn.hutool&lt;/groupId&gt; &lt;artifactId&gt;hutool-all&lt;/artifactId&gt; &lt;version&gt;${hutool.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!--lombok--&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;version&gt;${lombok.version}&lt;/version&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;!-- spring-boot-starter-test --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;version&gt;${spring.boot.test.version}&lt;/version&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;!--micrometer-tracing-bom导入链路追踪版本中心 1--&gt; &lt;dependency&gt; &lt;groupId&gt;io.micrometer&lt;/groupId&gt; &lt;artifactId&gt;micrometer-tracing-bom&lt;/artifactId&gt; &lt;version&gt;${micrometer-tracing.version}&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;!--micrometer-tracing指标追踪 2--&gt; &lt;dependency&gt; &lt;groupId&gt;io.micrometer&lt;/groupId&gt; &lt;artifactId&gt;micrometer-tracing&lt;/artifactId&gt; &lt;version&gt;${micrometer-tracing.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!--micrometer-tracing-bridge-brave适配zipkin的桥接包 3--&gt; &lt;dependency&gt; &lt;groupId&gt;io.micrometer&lt;/groupId&gt; &lt;artifactId&gt;micrometer-tracing-bridge-brave&lt;/artifactId&gt; &lt;version&gt;${micrometer-tracing.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!--micrometer-observation 4--&gt; &lt;dependency&gt; &lt;groupId&gt;io.micrometer&lt;/groupId&gt; &lt;artifactId&gt;micrometer-observation&lt;/artifactId&gt; &lt;version&gt;${micrometer-observation.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!--feign-micrometer 5--&gt; &lt;dependency&gt; &lt;groupId&gt;io.github.openfeign&lt;/groupId&gt; &lt;artifactId&gt;feign-micrometer&lt;/artifactId&gt; &lt;version&gt;${feign-micrometer.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!--zipkin-reporter-brave 6--&gt; &lt;dependency&gt; &lt;groupId&gt;io.zipkin.reporter2&lt;/groupId&gt; &lt;artifactId&gt;zipkin-reporter-brave&lt;/artifactId&gt; &lt;version&gt;${zipkin-reporter-brave.version}&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/dependencyManagement&gt; &lt;/project&gt; mybatis_generate（代码生成） pom 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 &lt;!--自己独一份，只是一个普通Maven工程，与boot和cloud无关--&gt; &lt;dependencies&gt; &lt;!--Mybatis 通用mapper tk单独使用，自己独有+自带版本号--&gt; &lt;dependency&gt; &lt;groupId&gt;org.mybatis&lt;/groupId&gt; &lt;artifactId&gt;mybatis&lt;/artifactId&gt; &lt;version&gt;3.5.15&lt;/version&gt; &lt;/dependency&gt; &lt;!-- Mybatis Generator 自己独有+自带版本号--&gt; &lt;dependency&gt; &lt;groupId&gt;org.mybatis.generator&lt;/groupId&gt; &lt;artifactId&gt;mybatis-generator-core&lt;/artifactId&gt; &lt;version&gt;1.4.2&lt;/version&gt; &lt;/dependency&gt; &lt;!--通用Mapper--&gt; &lt;dependency&gt; &lt;groupId&gt;tk.mybatis&lt;/groupId&gt; &lt;artifactId&gt;mapper&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--mysql8.0--&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--persistence--&gt; &lt;dependency&gt; &lt;groupId&gt;javax.persistence&lt;/groupId&gt; &lt;artifactId&gt;persistence-api&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--hutool--&gt; &lt;dependency&gt; &lt;groupId&gt;cn.hutool&lt;/groupId&gt; &lt;artifactId&gt;hutool-all&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--lombok--&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;org.junit.vintage&lt;/groupId&gt; &lt;artifactId&gt;junit-vintage-engine&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;resources&gt; &lt;resource&gt; &lt;directory&gt;${basedir}/src/main/java&lt;/directory&gt; &lt;includes&gt; &lt;include&gt;**/*.xml&lt;/include&gt; &lt;/includes&gt; &lt;/resource&gt; &lt;resource&gt; &lt;directory&gt;${basedir}/src/main/resources&lt;/directory&gt; &lt;/resource&gt; &lt;/resources&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;configuration&gt; &lt;excludes&gt; &lt;exclude&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;/exclude&gt; &lt;/excludes&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;plugin&gt; &lt;groupId&gt;org.mybatis.generator&lt;/groupId&gt; &lt;artifactId&gt;mybatis-generator-maven-plugin&lt;/artifactId&gt; &lt;version&gt;1.4.2&lt;/version&gt; &lt;configuration&gt; &lt;configurationFile&gt;${basedir}/src/main/resources/generatorConfig.xml&lt;/configurationFile&gt; &lt;overwrite&gt;true&lt;/overwrite&gt; &lt;verbose&gt;true&lt;/verbose&gt; &lt;/configuration&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;version&gt;8.0.28&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;tk.mybatis&lt;/groupId&gt; &lt;artifactId&gt;mapper&lt;/artifactId&gt; &lt;version&gt;4.2.3&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; config.properties 1 2 3 4 5 6 7 8 9 10 11 #t_pay??? package.name=com.xz.springcloud # mysql8.0 jdbc.driverClass = com.mysql.cj.jdbc.Driver # jdbc.url= jdbc:mysql://localhost:3306/db2024?characterEncoding=utf8&amp;useSSL=false&amp;serverTimezone=GMT%2B8&amp;rewriteBatchedStatements=true&amp;allowPublicKeyRetrieval=true # jdbc.url= jdbc:mysql://localhost:3306/seata_order?characterEncoding=utf8&amp;useSSL=false&amp;serverTimezone=GMT%2B8&amp;rewriteBatchedStatements=true&amp;allowPublicKeyRetrieval=true # jdbc.url= jdbc:mysql://localhost:3306/seata_storage?characterEncoding=utf8&amp;useSSL=false&amp;serverTimezone=GMT%2B8&amp;rewriteBatchedStatements=true&amp;allowPublicKeyRetrieval=true jdbc.url= jdbc:mysql://localhost:3306/seata_account?characterEncoding=utf8&amp;useSSL=false&amp;serverTimezone=GMT%2B8&amp;rewriteBatchedStatements=true&amp;allowPublicKeyRetrieval=true jdbc.user = root jdbc.password =527644117 generateConfig.xml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 &lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt; &lt;!DOCTYPE generatorConfiguration PUBLIC &#34;-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN&#34; &#34;http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd&#34;&gt; &lt;generatorConfiguration&gt; &lt;properties resource=&#34;config.properties&#34;/&gt; &lt;context id=&#34;Mysql&#34; targetRuntime=&#34;MyBatis3Simple&#34; defaultModelType=&#34;flat&#34;&gt; &lt;property name=&#34;beginningDelimiter&#34; value=&#34;`&#34;/&gt; &lt;property name=&#34;endingDelimiter&#34; value=&#34;`&#34;/&gt; &lt;plugin type=&#34;tk.mybatis.mapper.generator.MapperPlugin&#34;&gt; &lt;property name=&#34;mappers&#34; value=&#34;tk.mybatis.mapper.common.Mapper&#34;/&gt; &lt;property name=&#34;caseSensitive&#34; value=&#34;true&#34;/&gt; &lt;/plugin&gt; &lt;jdbcConnection driverClass=&#34;${jdbc.driverClass}&#34; connectionURL=&#34;${jdbc.url}&#34; userId=&#34;${jdbc.user}&#34; password=&#34;${jdbc.password}&#34;&gt; &lt;/jdbcConnection&gt; &lt;javaModelGenerator targetPackage=&#34;${package.name}.entities&#34; targetProject=&#34;src/main/java&#34;/&gt; &lt;sqlMapGenerator targetPackage=&#34;${package.name}.mapper&#34; targetProject=&#34;src/main/java&#34;/&gt; &lt;javaClientGenerator targetPackage=&#34;${package.name}.mapper&#34; targetProject=&#34;src/main/java&#34; type=&#34;XMLMAPPER&#34;/&gt; &lt;!--&lt;table tableName=&#34;t_pay&#34; domainObjectName=&#34;Pay&#34;&gt; &lt;generatedKey column=&#34;id&#34; sqlStatement=&#34;JDBC&#34;/&gt; &lt;/table&gt;--&gt; &lt;!-- seata_order --&gt; &lt;!--&lt;table tableName=&#34;t_order&#34; domainObjectName=&#34;Order&#34;&gt; &lt;generatedKey column=&#34;id&#34; sqlStatement=&#34;JDBC&#34;/&gt; &lt;/table&gt;--&gt; &lt;!-- seate_storage --&gt; &lt;!--&lt;table tableName=&#34;t_storage&#34; domainObjectName=&#34;Storage&#34;&gt; &lt;generatedKey column=&#34;id&#34; sqlStatement=&#34;JDBC&#34;/&gt; &lt;/table&gt;--&gt; &lt;!-- seate_account --&gt; &lt;table tableName=&#34;t_account&#34; domainObjectName=&#34;Account&#34;&gt; &lt;generatedKey column=&#34;id&#34; sqlStatement=&#34;JDBC&#34;/&gt; &lt;/table&gt; &lt;/context&gt; &lt;/generatorConfiguration&gt; cloud-api-commons（install为jar包供其它微服务使用、OpenFeign、OpenFeign+Sentinel） pom 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 &lt;dependencies&gt; &lt;!--SpringBoot通用依赖模块--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;!--hutool--&gt; &lt;dependency&gt; &lt;groupId&gt;cn.hutool&lt;/groupId&gt; &lt;artifactId&gt;hutool-all&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--openfeign--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/dependencies&gt; apis PayFeignAPi 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 /** * 微服务提供者8001对外暴露接口 */ // @FeignClient(&#34;cloud-payment-service&#34;) // 就是去注册中心的指定微服务上找相同uri然后调用相应的微服务方法 @FeignClient(&#34;cloud-gateway&#34;) /* 此时再关闭网关 { &#34;code&#34;: &#34;500&#34;, &#34;message&#34;: &#34;[503] during [GET] to [http://cloud-gateway/pay/gateway/info] [PayFeignAPi#getGatewayInfo()]: [Load balancer does not contain an instance for the service cloud-gateway]&#34;, &#34;data&#34;: null, &#34;timestamp&#34;: 1733728892254 } 再开启网关 { &#34;code&#34;: &#34;200&#34;, &#34;message&#34;: &#34;success&#34;, &#34;data&#34;: &#34;gateway info test: 5e6f3b3eb1d845f5bc86bbd759bd9084&#34;, &#34;timestamp&#34;: 1733728974072 } 现在三个url都可以访问服务： http://localhost:8001/pay/gateway/info http://localhost:9527/pay/gateway/info http://localhost:80/feign/pay/gateway/info */ public interface PayFeignAPi { /** * 增加一条支付相关流水记录 * * @param payDTO * @return */ @PostMapping(&#34;/pay/add&#34;) ResultData addPay(@RequestBody PayDTO payDTO); /** * 按照主键记录查询支付流水信息 * * @param id * @return */ @GetMapping(&#34;/pay/get/{id}&#34;) ResultData getPayInfo(@PathVariable(&#34;id&#34;) Integer id); /** * openfeign天然支持负载均衡演示 * * @return */ @GetMapping(&#34;/pay/get/info&#34;) String mylb(); @GetMapping(&#34;/pay/circuit/{id}&#34;) String myCircuit(@PathVariable(&#34;id&#34;) Integer id); @GetMapping(&#34;/pay/bulkhead/{id}&#34;) String myBulkhead(@PathVariable(&#34;id&#34;) Integer id); @GetMapping(&#34;/pay/ratelimit/{id}&#34;) String myRatelimit(@PathVariable(&#34;id&#34;) Integer id); @GetMapping(&#34;/pay/micrometer/{id}&#34;) String myMicrometer(@PathVariable(&#34;id&#34;) Integer id); @GetMapping(&#34;/pay/gateway/get/{id}&#34;) ResultData getById(@PathVariable(&#34;id&#34;) Integer id); @GetMapping(&#34;/pay/gateway/info&#34;) ResultData&lt;String&gt; getGatewayInfo(); } PayFeignSentinelAPi：OpenFeign+Sentinel 1 2 3 4 5 6 @FeignClient(value = &#34;nacos-payment-provider&#34;,fallback = PayFeignSentinelApiFallBack.class) // 谁提供服务写谁/转发给谁写谁 public interface PayFeignSentinelApi { @GetMapping(&#34;/pay/nacos/get/{orderNo}&#34;) ResultData getPayByOrderNo(@PathVariable(&#34;orderNo&#34;) String orderNo); } PayFeignSentinelApiFallBack 1 2 3 4 5 6 7 @Component public class PayFeignSentinelApiFallBack implements PayFeignSentinelApi { @Override public ResultData getPayByOrderNo(String orderNo) { return ResultData.fail(ReturnCodeEnum.RC500.getCode(), &#34;对方服务宕机或不可用，FallBack服务降级&#34;); } } StorageFeignApi 1 2 3 4 5 6 7 8 @FeignClient(&#34;seata-storage-service&#34;) public interface StorageFeignApi { /** * 扣减库存 */ @GetMapping(&#34;storage/decrease&#34;) ResultData decrease(@RequestParam(&#34;productId&#34;) Long productId, @RequestParam(&#34;count&#34;) Integer count); } AccountFeignAPi 1 2 3 4 5 6 7 8 @FeignClient(&#34;seata-account-service&#34;) public interface AccountFeignAPi { /** * 扣减余额 */ @GetMapping(&#34;/account/decrease&#34;) ResultData decrease(@RequestParam(&#34;userId&#34;) Long userId, @RequestParam(&#34;money&#34;) Long money); } entities.PayDTO 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 /** * DTO（数据传输对象） * 目的：DTO 主要用于数据传输，尤其是在分布式系统或不同层之间传递数据时。它通常是从数据库或服务中提取的数据对象，经过加工后用于传输。 * 特性： * 主要用于不同系统、模块之间的通信，避免传递过多的细节。 * 可能包含冗余数据或不同领域的数据，目的是为了提高传输效率。 * DTO 通常是无业务逻辑的，仅作为数据的载体。 * 可以是可变的，通常包含 setter 和 getter 方法。 * * dto中的字段实体类中一定存在，vo中的字段实体类中不一定存在 * dto是前端传给后端的，vo是后端传给前端的 * * 一般而言，调用者不应该获悉服务提供者的entity资源并知道表结构关系，所以服务提供方给出的接口文档都应为DTO */ @Data @NoArgsConstructor @AllArgsConstructor public class PayDTO implements Serializable { private Integer id; // 支付流水号 private String payNo; // 订单流水号 private String orderNo; // 用户账号ID private Integer userId; // 交易金额 private BigDecimal amount; } exp.GlobalExceptionHandler 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 /** * 全局异常 * * @ControllerAdvice 是一个用于处理全局异常的类注解，它可以捕获所有控制器中的异常并统一处理。 * 如果希望返回视图而不是直接返回 JSON，可以使用 @ControllerAdvice。 * * @RestControllerAdvice 是 @ControllerAdvice 和 @ResponseBody 的组合，它适用于返回 JSON 或其他对象响应体的情况。通常用于 RESTful 风格的 Web 服务中。 * * @RestControllerAdvice（或 @ControllerAdvice） * 这个注解的作用是将类标记为全局异常处理器，即所有控制器中的异常都会通过这个类来统一处理。它本身并不直接指定处理哪种类型的异常，而是用来指示一个类是用来处理异常的。 * * @ExceptionHandler(RuntimeException.class) * 这个注解是用来处理 特定类型的异常 的。它通常放在一个异常处理方法上，指定该方法捕获 RuntimeException 类型的异常。 * @ExceptionHandler 可以放在任何控制器类或者 @ControllerAdvice 类中，它用来拦截并处理指定类型的异常。 */ @Slf4j @RestControllerAdvice // 该类会对所有的控制器类进行增强处理，并且方法的返回值会直接转换成响应体的内容，标记 GlobalExceptionHandler 类是用来处理异常的 public class GlobalExceptionHandler { @ExceptionHandler(RuntimeException.class) // 标明当发生 RuntimeException 时，exception 方法会被调用，返回统一的错误响应。 @ResponseStatus(HttpStatus.INTERNAL_SERVER_ERROR) // 当这个异常被捕获时，HTTP 响应的状态码会设置为 500（内部服务器错误）。 public ResultData&lt;String&gt; exception(Exception e) { System.out.println(&#34;come in GlobalExceptionHandler&#34;); // 2024-12-04T18:41:14.992+08:00 ERROR 12528 --- [cloud-payment-service] [io-8001-exec-10] c.x.s.exp.GlobalExceptionHandler : 全局异常信息：id不能为负数 log.error(&#34;全局异常信息：{}&#34;, e.getMessage(), e); return ResultData.fail(ReturnCodeEnum.RC500.getCode(), e.getMessage()); /* { &#34;code&#34;: &#34;500&#34;, &#34;message&#34;: &#34;id不能为负数&#34;, &#34;data&#34;: null, &#34;timestamp&#34;: 1733308874996 } */ } } resp ResultData 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 /** * 返回对象 * * 定义返回格式： * 3大标准： * code：由后端统一定义各种返回结果的状态码 * message：本次接口调用的结果描述 * data：本次返回的数据 * timestamp：接口调用的时间 * * @param &lt;T&gt; */ @Data @Accessors(chain = true) // 链式编程 public class ResultData&lt;T&gt; { private String code; private String message; private T data; private long timestamp; public ResultData() { this.timestamp = System.currentTimeMillis(); } /** * 为什么需要显式声明 &lt;T&gt;？ * 静态方法和实例方法的区别： * ResultData&lt;T&gt; 是一个泛型类，而 success(T data) 是静态方法。静态方法与类的实例无关，因此它无法直接访问类的实例化泛型类型。为了解决这个问题，静态方法需要自己声明泛型类型。 * 如果 success 方法是实例方法（即不加 static），那么它可以访问类级别的泛型 T，不需要再显式声明 &lt;T&gt;。但由于 success 是静态方法，它没有类实例，因此无法直接使用类的泛型类型。 */ public static &lt;T&gt; ResultData&lt;T&gt; success(T data) { ResultData&lt;T&gt; resultData = new ResultData&lt;&gt;(); resultData.setCode(ReturnCodeEnum.RC200.getCode()); resultData.setMessage(ReturnCodeEnum.RC200.getMessage()); resultData.setData(data); return resultData; } public static &lt;T&gt; ResultData&lt;T&gt; fail(String code,String message){ ResultData&lt;T&gt; resultData = new ResultData&lt;&gt;(); resultData.setCode(code); resultData.setMessage(message); resultData.setData(null); return resultData; } } ReturnCodeEnum 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 /** * HTTP返回的状态码 */ @Getter public enum ReturnCodeEnum { // 1、举值 /**操作失败**/ RC999(&#34;999&#34;,&#34;操作XXX失败&#34;), /**操作成功**/ RC200(&#34;200&#34;,&#34;success&#34;), /**服务降级**/ RC201(&#34;201&#34;,&#34;服务开启降级保护,请稍后再试!&#34;), /**热点参数限流**/ RC202(&#34;202&#34;,&#34;热点参数限流,请稍后再试!&#34;), /**系统规则不满足**/ RC203(&#34;203&#34;,&#34;系统规则不满足要求,请稍后再试!&#34;), /**授权规则不通过**/ RC204(&#34;204&#34;,&#34;授权规则不通过,请稍后再试!&#34;), RC375(&#34;375&#34;,&#34;数学运算异常，请稍后重试&#34;), /**access_denied**/ RC403(&#34;403&#34;,&#34;无访问权限,请联系管理员授予权限&#34;), /**access_denied**/ RC401(&#34;401&#34;,&#34;匿名用户访问无权限资源时的异常&#34;), RC404(&#34;404&#34;,&#34;404页面找不到的异常&#34;), /**服务异常**/ RC500(&#34;500&#34;,&#34;系统异常，请稍后重试&#34;), INVALID_TOKEN(&#34;2001&#34;,&#34;访问令牌不合法&#34;), ACCESS_DENIED(&#34;2003&#34;,&#34;没有权限访问该资源&#34;), CLIENT_AUTHENTICATION_FAILED(&#34;1001&#34;,&#34;客户端认证失败&#34;), USERNAME_OR_PASSWORD_ERROR(&#34;1002&#34;,&#34;用户名或密码错误&#34;), BUSINESS_ERROR(&#34;1004&#34;,&#34;业务逻辑异常&#34;), UNSUPPORTED_GRANT_TYPE(&#34;1003&#34;, &#34;不支持的认证模式&#34;); // 2、构造 /**自定义状态码**/ private final String code; /**自定义描述**/ private final String message; ReturnCodeEnum(String code, String message){ this.code = code; this.message = message; } // 3、传统遍历 public static ReturnCodeEnum getReturnCodeEnumV1(String code) { for (ReturnCodeEnum element : ReturnCodeEnum.values()) { if(element.getCode().equalsIgnoreCase(code)) { return element; } } return null; } // 3、流式计算遍历 public static ReturnCodeEnum getReturnCodeEnumV2(String code) { return Arrays.stream(ReturnCodeEnum.values()).filter(x -&gt; x.getCode().equalsIgnoreCase(code)).findFirst().orElse(null); } // public static void main(String[] args) // { // System.out.println(getReturnCodeEnumV2(&#34;200&#34;)); // RC200这条枚举记录（RC200(&#34;200&#34;,&#34;success&#34;)） // System.out.println(getReturnCodeEnumV2(&#34;200&#34;).getCode()); // 200 // System.out.println(getReturnCodeEnumV2(&#34;200&#34;).getMessage()); // success // } } …………………………………………………………………… cloud-provider-payment8001（service） pom 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 &lt;dependencies&gt; &lt;!--SpringBoot通用依赖模块--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--SpringBoot集成druid连接池--&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;druid-spring-boot-starter&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- Swagger3 调用方式 http://localhost:8001/swagger-ui/index.html --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springdoc&lt;/groupId&gt; &lt;artifactId&gt;springdoc-openapi-starter-webmvc-ui&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--mybatis和springboot整合--&gt; &lt;dependency&gt; &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt; &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--Mysql数据库驱动8 --&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--persistence--&gt; &lt;dependency&gt; &lt;groupId&gt;javax.persistence&lt;/groupId&gt; &lt;artifactId&gt;persistence-api&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--通用Mapper4--&gt; &lt;dependency&gt; &lt;groupId&gt;tk.mybatis&lt;/groupId&gt; &lt;artifactId&gt;mapper&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--hutool--&gt; &lt;dependency&gt; &lt;groupId&gt;cn.hutool&lt;/groupId&gt; &lt;artifactId&gt;hutool-all&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- fastjson2 --&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.fastjson2&lt;/groupId&gt; &lt;artifactId&gt;fastjson2&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--lombok--&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;scope&gt;provided&lt;/scope&gt; &lt;/dependency&gt; &lt;!--test--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;!--SpringCloud consul discovery --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-consul-discovery&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--SpringCloud consul config--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-consul-config&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-bootstrap&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- 引入cloud-api-commons通用包 --&gt; &lt;dependency&gt; &lt;groupId&gt;com.xz.cloud&lt;/groupId&gt; &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/dependency&gt; &lt;!--micrometer-tracing指标追踪 2--&gt; &lt;dependency&gt; &lt;groupId&gt;io.micrometer&lt;/groupId&gt; &lt;artifactId&gt;micrometer-tracing&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--micrometer-tracing-bridge-brave适配zipkin的桥接包 3--&gt; &lt;dependency&gt; &lt;groupId&gt;io.micrometer&lt;/groupId&gt; &lt;artifactId&gt;micrometer-tracing-bridge-brave&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--micrometer-observation 4--&gt; &lt;dependency&gt; &lt;groupId&gt;io.micrometer&lt;/groupId&gt; &lt;artifactId&gt;micrometer-observation&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--feign-micrometer 5--&gt; &lt;dependency&gt; &lt;groupId&gt;io.github.openfeign&lt;/groupId&gt; &lt;artifactId&gt;feign-micrometer&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--zipkin-reporter-brave 6--&gt; &lt;dependency&gt; &lt;groupId&gt;io.zipkin.reporter2&lt;/groupId&gt; &lt;artifactId&gt;zipkin-reporter-brave&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; yml bootstrap：pom需要引入SpringCloud consul config、bootstrap、Consul、Micrometer+ZipKin 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 # application.yml是用户级的资源配置项 # bootstrap.yml是系统级的，优先级更加高 # Spring Cloud会创建一个“Bootstrap Context”，作为Spring应用的`Application Context`的父上下文。 # 初始化的时候，`Bootstrap Context`负责从外部源加载配置属性并解析配置。这两个上下文共享一个从外部获取的`Environment`。 # Bootstrap`属性有高优先级，默认情况下，它们不会被本地配置覆盖。 # `Bootstrap context`和`Application Context`有着不同的约定，所以新增了一个`bootstrap.yml`文件，保证`Bootstrap Context`和`Application Context`配置的分离。 # application.yml文件改为bootstrap.yml,这是很关键的或者两者共存 # 因为bootstrap.yml是比application.yml先加载的。bootstrap.yml优先级高于application.yml spring: application: name: cloud-payment-service # Spring Cloud Consul for Service Discovery cloud: consul: host: localhost port: 8500 discovery: service-name: ${spring.application.name} # 8001以此名字入驻consul config: profile-separator: &#39;-&#39; # default value is &#34;,&#34;, We update &#34;-&#34; format: yaml management: zipkin: tracing: endpoint: http://localhost:9411/api/v2/spans # 固定写法 tracing: sampling: probability: 1.0 # 采样率默认为0.1，即十次只能有一次被记录下，值越大收集越及时 application 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 server: port: 8001 # ==========applicationName + druid-mysql8 driver=================== spring: datasource: type: com.alibaba.druid.pool.DruidDataSource driver-class-name: com.mysql.cj.jdbc.Driver url: jdbc:mysql://localhost:3306/db2024?characterEncoding=utf8&amp;useSSL=false&amp;serverTimezone=GMT%2B8&amp;rewriteBatchedStatements=true&amp;allowPublicKeyRetrieval=true username: root password: 527644117 profiles: active: dev # 多环境Consul配置加载内容dev/prod，不写就是default配置 # ========================mybatis=================== mybatis: mapper-locations: classpath:mapper/*.xml type-aliases-package: com.xz.springcloud.entities configuration: map-underscore-to-camel-case: true resources.mapper.PayMapper.xml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 &lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt; &lt;!DOCTYPE mapper PUBLIC &#34;-//mybatis.org//DTD Mapper 3.0//EN&#34; &#34;http://mybatis.org/dtd/mybatis-3-mapper.dtd&#34;&gt; &lt;mapper namespace=&#34;com.xz.springcloud.mapper.PayMapper&#34;&gt; &lt;resultMap id=&#34;BaseResultMap&#34; type=&#34;com.xz.springcloud.entities.Pay&#34;&gt; &lt;!-- WARNING - @mbg.generated --&gt; &lt;id column=&#34;id&#34; jdbcType=&#34;INTEGER&#34; property=&#34;id&#34; /&gt; &lt;result column=&#34;pay_no&#34; jdbcType=&#34;VARCHAR&#34; property=&#34;payNo&#34; /&gt; &lt;result column=&#34;order_no&#34; jdbcType=&#34;VARCHAR&#34; property=&#34;orderNo&#34; /&gt; &lt;result column=&#34;user_id&#34; jdbcType=&#34;INTEGER&#34; property=&#34;userId&#34; /&gt; &lt;result column=&#34;amount&#34; jdbcType=&#34;DECIMAL&#34; property=&#34;amount&#34; /&gt; &lt;result column=&#34;deleted&#34; jdbcType=&#34;TINYINT&#34; property=&#34;deleted&#34; /&gt; &lt;result column=&#34;create_time&#34; jdbcType=&#34;TIMESTAMP&#34; property=&#34;createTime&#34; /&gt; &lt;result column=&#34;update_time&#34; jdbcType=&#34;TIMESTAMP&#34; property=&#34;updateTime&#34; /&gt; &lt;/resultMap&gt; &lt;/mapper&gt; Main8001 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 @SpringBootApplication @MapperScan(&#34;com.xz.springcloud.mapper&#34;) public class Main8001 { public static void main(String[] args) { SpringApplication.run(Main8001.class, args); /* 微服务： 1、建module 2、改pom 3、写yml 4、主启动 5、业务类 */ /* 入驻consul（服务注册中心）： 1、pom 2、yml */ } } config.Swagger3Config 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 @Configuration public class Swagger3Config { // 分组API @Bean public GroupedOpenApi PayApi() { return GroupedOpenApi.builder().group(&#34;支付微服务模块&#34;).pathsToMatch(&#34;/pay/**&#34;).build(); // 以pay开头 } @Bean public GroupedOpenApi OtherApi() { return GroupedOpenApi.builder().group(&#34;其它微服务模块&#34;).pathsToMatch(&#34;/other/**&#34;, &#34;/others&#34;).build(); } /* @Bean public GroupedOpenApi CustomerApi() { return GroupedOpenApi.builder().group(&#34;客户微服务模块&#34;).pathsToMatch(&#34;/customer/**&#34;, &#34;/customers&#34;).build(); } */ @Bean public OpenAPI docsOpenApi() { return new OpenAPI() .info(new Info().title(&#34;cloud2024&#34;) .description(&#34;通用设计rest&#34;) .version(&#34;v1.0&#34;)) .externalDocs(new ExternalDocumentation() .description(&#34;www.atguigu.com&#34;) .url(&#34;https://yiyan.baidu.com/&#34;)); } } controller PayController：基础的增删改查、获取Consul中配置的kv、Swagger3注解 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 // Swagger3常用注解： // @Tag 标注位置：controller类：表示controller作用 // @Operation 标注位置：方法：描述方法作用 // @Schema 标注位置：model层的JavaBean：描述模型作用及每个属性 @Tag(name = &#34;支付微服务模块&#34;, description = &#34;支付CRUD&#34;) @RestController // @Controller + @ResponseBody @Slf4j @RequestMapping(&#34;/pay&#34;) public class PayController { @Resource private PayService payService; @PostMapping(&#34;/add&#34;) @Operation(summary = &#34;新增&#34;, description = &#34;新增支付流水方法，json作参数&#34;) public ResultData&lt;String&gt; addPay(@RequestBody Pay pay) { int i = payService.add(pay); return ResultData.success(&#34;成功插入记录了，返回：&#34; + i); } @DeleteMapping(&#34;/del/{id}&#34;) @Operation(summary = &#34;删除&#34;, description = &#34;删除支付流水方法&#34;) public ResultData&lt;String&gt; deletePay(@PathVariable(&#34;id&#34;) Integer id) { return ResultData.success(&#34;成功删除记录：&#34; + payService.delete(id)); } @PutMapping(&#34;/update&#34;) @Operation(summary = &#34;修改&#34;, description = &#34;修改支付流水方法&#34;) public ResultData&lt;String&gt; updatePay(@RequestBody PayDTO payDTO) { // 与前端交互只能用PayDTO，到controller要将其封装为Pay再传给后端 Pay pay = new Pay(); BeanUtils.copyProperties(payDTO, pay); return ResultData.success(&#34;成功修改记录：&#34; + payService.update(pay)); } @GetMapping(&#34;/get/{id}&#34;) @Operation(summary = &#34;按照ID查询流水&#34;, description = &#34;查询支付流水方法&#34;) public ResultData&lt;Pay&gt; getPayById(@PathVariable(&#34;id&#34;) Integer id) { // if (id == -4) throw new RuntimeException(&#34;id不能为负数&#34;); // 暂停62秒钟线程，测试Feign的默认调用超时时间 try { TimeUnit.SECONDS.sleep(62); } catch (InterruptedException e) { e.printStackTrace(); } return ResultData.success(payService.getById(id)); } @GetMapping(&#34;/get&#34;) public ResultData&lt;List&lt;Pay&gt;&gt; getPay() { return ResultData.success(payService.getAll()); } @GetMapping(&#34;/error&#34;) public ResultData&lt;Integer&gt; getPayError() { Integer integer = 200; try { System.out.println(&#34;come in payerror test&#34;); int age = 10 / 0; } catch (Exception e) { e.printStackTrace(); return ResultData.fail(ReturnCodeEnum.RC500.getCode(), e.getMessage()); } return ResultData.success(integer); } /* { &#34;code&#34;: &#34;500&#34;, &#34;message&#34;: &#34;/ by zero&#34;, &#34;data&#34;: null, &#34;timestamp&#34;: 1733309250087 } */ @Value(&#34;${server.port}&#34;) private String port; @GetMapping(&#34;/get/info&#34;) public String getInfoByConsul(@Value(&#34;${xz.info}&#34;) String xzInfo) { // xz.info为写在Consul相应环境中的yaml key return &#34;xzInfo: &#34; + xzInfo + &#34; port: &#34; + port; /* 如果没有在Consul中配置相应的key： -&gt; { &#34;code&#34;: &#34;500&#34;, &#34;message&#34;: &#34;Could not resolve placeholder &#39;xz.info&#39; in value \\&#34;${xz.info}\\&#34;&#34;, &#34;data&#34;: null, &#34;timestamp&#34;: 1733376396579 } */ } } PayCircuitController 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 @RestController @RequestMapping(&#34;/pay&#34;) public class PayCircuitController { /** * Resilience4j CircuitBreaker */ @GetMapping(&#34;/circuit/{id}&#34;) public String myCircuit(@PathVariable(&#34;id&#34;) Integer id) { if (id == -4) throw new RuntimeException(&#34;id 不能为负数&#34;); if (id == 9999) { try { TimeUnit.SECONDS.sleep(5); } catch (InterruptedException e) { e.printStackTrace(); } } return &#34;Hello, circuit! &#34; + &#34;\\t&#34; + IdUtil.simpleUUID(); } /** * Resilience4j Bulkhead */ @GetMapping(&#34;/bulkhead/{id}&#34;) public String myBulkhead(@PathVariable(&#34;id&#34;) Integer id) { if (id == -4) throw new RuntimeException(&#34;bulkhead id 不能为负数&#34;); if (id == 9999) { try { TimeUnit.SECONDS.sleep(5); } catch (InterruptedException e) { e.printStackTrace(); } } return &#34;Hello, bulkhead! &#34; + &#34;\\t&#34; + IdUtil.simpleUUID(); } /** * Resilience4j ratelimit */ @GetMapping(&#34;/ratelimit/{id}&#34;) public String myRatelimit(@PathVariable(&#34;id&#34;) Integer id) { return &#34;Hello, ratelimit! &#34; + &#34;\\t&#34; + IdUtil.simpleUUID(); } } PayMicrometerController 1 2 3 4 5 6 7 8 9 @RestController @RequestMapping(&#34;/pay&#34;) public class PayMicrometerController { @GetMapping(&#34;/micrometer/{id}&#34;) public String myMicrometer(@PathVariable(&#34;id&#34;) Integer id) { return &#34;Hello, welcome to myMicrometer &#34; + id + IdUtil.simpleUUID(); } } GatewayController 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 @RestController @RequestMapping(&#34;/pay&#34;) public class PayGatewayController { @Resource private PayService payService; @GetMapping(&#34;/gateway/get/{id}&#34;) public ResultData&lt;Pay&gt; getById(@PathVariable(&#34;id&#34;) Integer id) { Pay pay = payService.getById(id); return ResultData.success(pay); } @GetMapping(&#34;/gateway/info&#34;) public ResultData&lt;String&gt; getGatewayInfo() { return ResultData.success(&#34;gateway info test: &#34; + IdUtil.simpleUUID()); } @GetMapping(&#34;/gateway/filter&#34;) public ResultData&lt;String&gt; getGatewayFilter(HttpServletRequest request) { String res = &#34;&#34;; Enumeration&lt;String&gt; headers = request.getHeaderNames(); // 获得请求头名字的集合类 while (headers.hasMoreElements()) { String headName = headers.nextElement(); String headValue = request.getHeader(headName); System.out.println(&#34;请求头名：&#34; + headName + &#34;\\t\\t&#34; + &#34;请求头值：&#34; + headValue); /* ... 请求头名：x-request-xz1 请求头值：xzVal1 请求头名：x-request-xz2 请求头值：xzVal2 ... */ if (headName.equalsIgnoreCase(&#34;X-Request-xz1&#34;) || headName.equalsIgnoreCase(&#34;X-Request-xz2&#34;)) { res = res + headName + &#34;\\t&#34; + headValue + &#34; &#34;; } } System.out.println(&#34;==============================================================&#34;); String customerId = request.getParameter(&#34;customerId&#34;); System.out.println(&#34;request Parameter customerId：&#34; + customerId); String customerName = request.getParameter(&#34;customerName&#34;); System.out.println(&#34;request Parameter customerName：&#34; + customerName); System.out.println(&#34;==============================================================&#34;); // request Parameter customerId：9527001 // request Parameter customerName：null return ResultData.success(&#34;getGatewayFilter 过滤器 test：&#34; + res + &#34;\\t&#34; + DateUtil.now()); /* { &#34;code&#34;: &#34;200&#34;, &#34;message&#34;: &#34;success&#34;, &#34;data&#34;: &#34;getGatewayFilter 过滤器 test：x-request-xz1\\txzVal1 x-request-xz2\\txzVal2 \\t2024-12-10 10:51:13&#34;, &#34;timestamp&#34;: 1733799073903 } */ } } service 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 public interface PayService { int add(Pay pay); int delete(Integer id); int update(Pay pay); Pay getById(Integer id); List&lt;Pay&gt; getAll(); } @Service public class PayServiceImpl implements PayService { @Resource private PayMapper payMapper; @Override public int add(Pay pay) { return payMapper.insertSelective(pay); // null的属性不会保存，会使用数据库默认值 } @Override public int delete(Integer id) { return payMapper.deleteByPrimaryKey(id); } @Override public int update(Pay pay) { return payMapper.updateByPrimaryKeySelective(pay); } @Override public Pay getById(Integer id) { return payMapper.selectByPrimaryKey(id); } @Override public List&lt;Pay&gt; getAll() { return payMapper.selectAll(); } } mapper.Paymapper 1 2 public interface PayMapper extends Mapper&lt;Pay&gt; { } entities.Pay 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 /** * 表名：t_pay * 表注释：支付交易表 */ @Table(name = &#34;t_pay&#34;) @Schema(title = &#34;支付交易表Entity&#34;) public class Pay { @Id @GeneratedValue(generator = &#34;JDBC&#34;) @Schema(title = &#34;主键&#34;) private Integer id; /** * 支付流水号 */ @Column(name = &#34;pay_no&#34;) @Schema(title = &#34;支付流水号&#34;) private String payNo; /** * 订单流水号 */ @Column(name = &#34;order_no&#34;) @Schema(title = &#34;订单流水号&#34;) private String orderNo; /** * 用户账号ID */ @Column(name = &#34;user_id&#34;) @Schema(title = &#34;用户账号ID&#34;) private Integer userId; /** * 交易金额 */ @Schema(title = &#34;交易金额&#34;) private BigDecimal amount; /** * 删除标志，默认0不删除，1删除 */ private Byte deleted; /** * 创建时间 */ @Schema(title = &#34;创建时间&#34;) @Column(name = &#34;create_time&#34;) @JsonFormat(pattern = &#34;yyyy-MM-dd HH:mm:ss&#34;, timezone = &#34;GMT+8&#34;) // 完善从数据库中查出并返回的时间格式 private Date createTime; /** * 更新时间 */ @Schema(title = &#34;更新时间&#34;) @Column(name = &#34;update_time&#34;) @JsonFormat(pattern = &#34;yyyy-MM-dd HH:mm:ss&#34;, timezone = &#34;GMT+8&#34;) private Date updateTime; /** * @return id */ public Integer getId() { return id; } /** * @param id */ public void setId(Integer id) { this.id = id; } /** * 获取支付流水号 * * @return payNo - 支付流水号 */ public String getPayNo() { return payNo; } /** * 设置支付流水号 * * @param payNo 支付流水号 */ public void setPayNo(String payNo) { this.payNo = payNo; } /** * 获取订单流水号 * * @return orderNo - 订单流水号 */ public String getOrderNo() { return orderNo; } /** * 设置订单流水号 * * @param orderNo 订单流水号 */ public void setOrderNo(String orderNo) { this.orderNo = orderNo; } /** * 获取用户账号ID * * @return userId - 用户账号ID */ public Integer getUserId() { return userId; } /** * 设置用户账号ID * * @param userId 用户账号ID */ public void setUserId(Integer userId) { this.userId = userId; } /** * 获取交易金额 * * @return amount - 交易金额 */ public BigDecimal getAmount() { return amount; } /** * 设置交易金额 * * @param amount 交易金额 */ public void setAmount(BigDecimal amount) { this.amount = amount; } /** * 获取删除标志，默认0不删除，1删除 * * @return deleted - 删除标志，默认0不删除，1删除 */ public Byte getDeleted() { return deleted; } /** * 设置删除标志，默认0不删除，1删除 * * @param deleted 删除标志，默认0不删除，1删除 */ public void setDeleted(Byte deleted) { this.deleted = deleted; } /** * 获取创建时间 * * @return createTime - 创建时间 */ public Date getCreateTime() { return createTime; } /** * 设置创建时间 * * @param createTime 创建时间 */ public void setCreateTime(Date createTime) { this.createTime = createTime; } /** * 获取更新时间 * * @return updateTime - 更新时间 */ public Date getUpdateTime() { return updateTime; } /** * 设置更新时间 * * @param updateTime 更新时间 */ public void setUpdateTime(Date updateTime) { this.updateTime = updateTime; } } cloud-provider-payment8002（service） 与8001大体上一致 1 2 3 4 5 6 7 8 9 10 11 12 // Main8002 @SpringBootApplication @MapperScan(&#34;com.xz.springcloud.mapper&#34;) public class Main8002 { public static void main(String[] args) { SpringApplication.run(Main8002.class, args); } } // application.yml server: port: 8002 cloud-consumer-order80（deprecated，使用RestTemplate转发给微服务） pom 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 &lt;dependencies&gt; &lt;!--web + actuator--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--lombok--&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;!--hutool-all--&gt; &lt;dependency&gt; &lt;groupId&gt;cn.hutool&lt;/groupId&gt; &lt;artifactId&gt;hutool-all&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--fastjson2--&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.fastjson2&lt;/groupId&gt; &lt;artifactId&gt;fastjson2&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- swagger3 调用方式 http://localhost:8001/swagger-ui/index.html --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springdoc&lt;/groupId&gt; &lt;artifactId&gt;springdoc-openapi-starter-webmvc-ui&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--SpringCloud consul discovery --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-consul-discovery&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--loadbalancer--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-loadbalancer&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- 引入cloud-api-commons通用包 --&gt; &lt;dependency&gt; &lt;groupId&gt;com.xz.cloud&lt;/groupId&gt; &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; application.yml：Consul 1 2 3 4 5 6 7 8 9 10 11 12 13 server: port: 80 spring: application: name: cloud-consumer-order # Spring Cloud Consul for Service Discovery cloud: consul: host: localhost port: 8500 discovery: service-name: ${spring.application.name} # 8001以此名字入驻consul Main80 1 2 3 4 5 6 @SpringBootApplication public class Main80 { public static void main(String[] args) { SpringApplication.run(Main80.class, args); } } config.RestTemplateConfig 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 /** * Spring 框架中提供的一个类，用于简化与 RESTful 服务进行 HTTP 请求和响应的交互。它是一种方便的客户端工具，可以通过简单的方法调用 REST API，并处理请求和响应的数据。 */ @Configuration // @LoadBalancerClient(value = &#34;cloud-payment-service&#34;, configuration = RestTemplateConfig.class) // 区分大小写，要跟consul里名字保持一样 public class RestTemplateConfig { @Bean @LoadBalanced // I/O error on GET request for &#34;http://cloud-payment-service/pay/get/1&#34; -&gt; 一旦通过微服务名字调用，默认后面有多个微服务，需要开启负载均衡 public RestTemplate restTemplate() { return new RestTemplate(); } // 将默认的负载均衡轮询算法修改为随机 // @Bean // ReactiveLoadBalancer&lt;ServiceInstance&gt; randomLoadBalancer(Environment environment, // LoadBalancerClientFactory loadBalancerClientFactory) { // String name = environment.getProperty(LoadBalancerClientFactory.PROPERTY_NAME); // return new RandomLoadBalancer(loadBalancerClientFactory.getLazyProvider(name, ServiceInstanceListSupplier.class), name); // } } controller.OrderController 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 @RestController @RequestMapping(&#34;/consumer&#34;) public class OrderController { // public static final String PaymentServ_URL = &#34;http://localhost:8001&#34;; public static final String PaymentServ_URL = &#34;http://cloud-payment-service&#34;; // consul服务注册中心上的微服务名字 @Resource private RestTemplate restTemplate; @PostMapping(&#34;/pay/add&#34;) public ResultData addOrder(@RequestBody PayDTO payDTO) { // 类似于代理，也可以理解为请求转发，接收来自客户端的请求，然后将其转发给支付微服务，最后返回微服务的响应给客户端。 // 通过这种方式，系统可以轻松实现不同微服务之间的通信，保持松耦合和清晰的模块划分。 // 向目标 URL 发起一个 POST 请求，发送的请求体是 payDTO，并期望返回一个 ResultData 类型的响应。 // 目标微服务的地址，假设 PaymentServ_URL 是微服务的基本 URL（比如 http://payment-service/api），/pay/add 是支付服务处理支付请求的接口路径。 // payDTO 包含了用户请求的支付数据，它会被 RestTemplate 自动序列化成请求体（通常是 JSON 格式）。 return restTemplate.postForObject(PaymentServ_URL + &#34;/pay/add&#34;, payDTO, ResultData.class); // 发送 POST 请求 } @DeleteMapping(&#34;/pay/del/{id}&#34;) public ResultData deleteOrder(@PathVariable(&#34;id&#34;) Integer id) { restTemplate.delete(PaymentServ_URL + &#34;/pay/del/&#34; + id, id); return ResultData.success(null); } @PutMapping(&#34;/pay/update&#34;) public ResultData updateOrder(@RequestBody PayDTO payDTO) { restTemplate.put(PaymentServ_URL + &#34;/pay/update&#34;, payDTO); return ResultData.success(null); } @GetMapping(&#34;/pay/get/{id}&#34;) public ResultData getOrder(@PathVariable(&#34;id&#34;) Integer id) { return restTemplate.getForObject(PaymentServ_URL + &#34;/pay/get/&#34; + id, ResultData.class, id); // 发送 GET 请求 } @GetMapping(&#34;/pay/get/info&#34;) public String getInfoByConsul() { return restTemplate.getForObject(PaymentServ_URL + &#34;/pay/get/info&#34;, String.class); } @Resource private DiscoveryClient discoveryClient; /** * 原理：使用DiscoveryClient动态获取所有上线的服务器列表 * @return */ @GetMapping(&#34;/discovery&#34;) public String discovery() { List&lt;String&gt; services = discoveryClient.getServices(); // 获取consul上全部services for (String ele : services) { System.out.println(ele); // cloud-consumer-order、cloud-payment-service、consul } System.out.println(&#34;====================================&#34;); List&lt;ServiceInstance&gt; instances = discoveryClient.getInstances(&#34;cloud-payment-service&#34;); for (ServiceInstance instance : instances) { System.out.println(instance.getServiceId() + &#34;\\t&#34; + instance.getHost() + &#34;\\t&#34; + instance.getPort() + &#34;\\t&#34; + instance.getUri()); // cloud-payment-service Augenstern 8001 http://Augenstern:8001 // cloud-payment-service Augenstern 8002 http://Augenstern:8002 // 就会在这两个服务器上做负载均衡 } return instances.get(0).getServiceId() + &#34;: &#34; + instances.get(0).getPort(); // cloud-payment-service: 8001 } } cloud-consumer-feign-order80（使用OpenFeign转发给微服务） pom 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 &lt;dependencies&gt; &lt;!--web + actuator--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--lombok--&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;!--hutool-all--&gt; &lt;dependency&gt; &lt;groupId&gt;cn.hutool&lt;/groupId&gt; &lt;artifactId&gt;hutool-all&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--fastjson2--&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.fastjson2&lt;/groupId&gt; &lt;artifactId&gt;fastjson2&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- swagger3 调用方式 http://localhost:8001/swagger-ui/index.html --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springdoc&lt;/groupId&gt; &lt;artifactId&gt;springdoc-openapi-starter-webmvc-ui&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--SpringCloud consul discovery --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-consul-discovery&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--openfeign--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- httpclient5--&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.httpcomponents.client5&lt;/groupId&gt; &lt;artifactId&gt;httpclient5&lt;/artifactId&gt; &lt;version&gt;5.3&lt;/version&gt; &lt;/dependency&gt; &lt;!-- feign-hc5--&gt; &lt;dependency&gt; &lt;groupId&gt;io.github.openfeign&lt;/groupId&gt; &lt;artifactId&gt;feign-hc5&lt;/artifactId&gt; &lt;version&gt;13.1&lt;/version&gt; &lt;/dependency&gt; &lt;!--resilience4j-circuitbreaker--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-circuitbreaker-resilience4j&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- 由于断路保护等需要AOP实现，所以必须导入AOP包 --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-aop&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--resilience4j-bulkhead--&gt; &lt;dependency&gt; &lt;groupId&gt;io.github.resilience4j&lt;/groupId&gt; &lt;artifactId&gt;resilience4j-bulkhead&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--resilience4j-ratelimiter--&gt; &lt;dependency&gt; &lt;groupId&gt;io.github.resilience4j&lt;/groupId&gt; &lt;artifactId&gt;resilience4j-ratelimiter&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--micrometer-tracing指标追踪 2--&gt; &lt;dependency&gt; &lt;groupId&gt;io.micrometer&lt;/groupId&gt; &lt;artifactId&gt;micrometer-tracing&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--micrometer-tracing-bridge-brave适配zipkin的桥接包 3--&gt; &lt;dependency&gt; &lt;groupId&gt;io.micrometer&lt;/groupId&gt; &lt;artifactId&gt;micrometer-tracing-bridge-brave&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--micrometer-observation 4--&gt; &lt;dependency&gt; &lt;groupId&gt;io.micrometer&lt;/groupId&gt; &lt;artifactId&gt;micrometer-observation&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--feign-micrometer 5--&gt; &lt;dependency&gt; &lt;groupId&gt;io.github.openfeign&lt;/groupId&gt; &lt;artifactId&gt;feign-micrometer&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--zipkin-reporter-brave 6--&gt; &lt;dependency&gt; &lt;groupId&gt;io.zipkin.reporter2&lt;/groupId&gt; &lt;artifactId&gt;zipkin-reporter-brave&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- 引入cloud-api-commons通用包 --&gt; &lt;dependency&gt; &lt;groupId&gt;com.xz.cloud&lt;/groupId&gt; &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; application.yml：配置Consul、OpenFeign、Resilience4j、Micrometer+ZipKin 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 server: port: 80 spring: application: name: cloud-consumer-openfeign-order # Spring Cloud Consul for Service Discovery cloud: consul: host: localhost port: 8500 discovery: service-name: ${spring.application.name} # 8001以此名字入驻consul prefer-agent-address: true # 优先使用服务ip进行注册 openfeign: client: config: # default: # （全局） # # 连接超时时间 # connectTimeout: 3000 # # 读取超时时间 # readTimeout: 3000 cloud-payment-service: # 给单个服务指定会覆盖全局的 connectTimeout: 20000 readTimeout: 20000 # 修改默认HttpClient -&gt; Apache HttpClient5开启，提升性能 httpclient: hc5: enabled: true # 替换前为默认的 HttpClient + HttpURLConnection # 替换后为 hc.client5 # 请求/响应压缩：支持对请求和响应进行GZIP压缩，以减少通信过程中的性能损耗 compression: request: enabled: true min-request-size: 2048 # 最小触发压缩的大小 mime-types: text/xml,application/xml,application/json # 触发压缩数据类型 response: enabled: true # 2024-12-05T19:44:14.215+08:00 DEBUG 13360 --- [cloud-consumer-openfeign-order] [p-nio-80-exec-5] com.xz.springcloud.apis.PayFeignAPi : [PayFeignAPi#getPayInfo] Accept-Encoding: gzip # 开启circuitbreaker和分组激活 circuitbreaker: enabled: false group: enabled: false # 默认不开启分组，若开启，默认的分组策略是精确优先，若设置了分组策略则按设置的来 # Feign日志打印功能（logging.level + 含有@FeignClient注解的全接口名 + debug） logging: level: com: xz: springcloud: apis: PayFeignAPi: debug # # 按照次数：COUNT_BASED 的例子 # # 6次访问中当执行方法的失败率达到50%时CircuitBreaker将进入开启OPEN状态(保险丝跳闸断电)拒绝所有请求。 # # 等待5秒后，CircuitBreaker 将自动从开启OPEN状态过渡到半开HALF_OPEN状态，允许一些请求通过以测试服务是否恢复正常。 # # 如还是异常CircuitBreaker 将重新进入开启OPEN状态；如正常将进入关闭CLOSE闭合状态恢复正常处理请求。 # resilience4j: # circuitbreaker: # configs: # default: # failure-rate-threshold: 50 # 调用失败率达到50%时打开断路器，超过失败请求百分⽐时CircuitBreaker变为OPEN状态 # sliding-window-type: COUNT_BASED # 滑动窗口的类型 # sliding-window-size: 6 # 滑动窗⼝的⼤⼩，配置COUNT_BASED表示6个请求，配置TIME_BASED表示6秒 # minimum-number-of-calls: 6 # 断路器计算失败率或慢调用率之前所需的最小样本(每个滑动窗口周期)。如果minimumNumberOfCalls为10，则必须最少记录10个样本，然后才能计算失败率。如果只记录了9次调用，即使所有9次调用都失败，断路器也不会开启 # automatic-transition-from-open-to-half-open-enabled: false # 是否启用自动从开启状态过渡到半开状态，默认值为true。如果启用，CircuitBreaker将自动从开启状态过渡到半开状态，并允许一些请求通过以测试服务是否恢复正常 # wait-duration-in-open-state: 5s # 从OPEN到HALF_OPEN状态需要等待的时间（不管怎么配置，都会在一定时间内恢复到半开） # permitted-number-of-calls-in-half-open-state: 2 # 半开状态允许的最大请求数，默认值为10。在半开状态下，CircuitBreaker将允许最多permittedNumberOfCallsInHalfOpenState个请求通过，如果调用失败率再次达到50%，CircuitBreaker将重新进入开启状态 # record-exceptions: # - java.lang.Exception # instances: # cloud-payment-service: # base-config: default # resilience4j: # timelimiter: # configs: # default: # # 适合高并发场景下接口响应较慢导致拖垮整个服务的其他接口 # timeout-duration: 10s # timelimiter默认限制远程调用1s，超过1s就超时异常，配置了降级，就走降级逻辑（最高优先级） # circuitbreaker: # configs: # default: # failure-rate-threshold: 50 # 调用失败率达到50%时打开断路器，超过失败请求百分⽐时CircuitBreaker变为OPEN状态 # sliding-window-type: TIME_BASED # 滑动窗口的类型 # sliding-window-size: 2 # 滑动窗⼝的⼤⼩，配置TIME_BASED表示2秒 # minimum-number-of-calls: 2 # 断路器计算失败率或慢调用率之前所需的最小样本(每个滑动窗口周期)。 # wait-duration-in-open-state: 5s # 从OPEN到HALF_OPEN状态需要等待的时间（不管怎么配置，都会在一定时间内恢复到半开） # permitted-number-of-calls-in-half-open-state: 2 # 半开状态允许的最大请求数，默认值为10。在半开状态下，CircuitBreaker将允许最多permittedNumberOfCallsInHalfOpenState个请求通过，如果调用失败率再次达到50%，CircuitBreaker将重新进入开启状态 # slow-call-duration-threshold: 2s # 满调用时间阈值，高于阈值视为慢调用并增加慢调用比例 # slow-call-rate-threshold: 30 # 慢调用百分比峰值，断路器把调用时间大于slow-call-duration-threshold视为慢调用，当慢调用比例高于此阈值，断路器打开，并开启服务降级 # record-exceptions: # - java.lang.Exception # instances: # cloud-payment-service: # base-config: default # SEMAPHORE # resilience4j: # bulkhead: # configs: # default: # max-concurrent-calls: 2 # 允许线程并发执行的最大数量 # max-wait-duration: 1s # 当达到并发调用数量时，新的线程的阻塞时间，只愿意等待1s，超时进舱壁兜底fallback # instances: # cloud-payment-service: # base-config: default # timelimiter: # configs: # default: # timeout-duration: 20s # 为了保证测试故意延长 # THREADPOOL 注意，由于THREADPOOL会新启线程池，需要把spring.cloud.openfeign.circuitbreaker.group.enabled设为false，新启线程和原来主线程脱离 # resilience4j: # timelimiter: # configs: # default: # timeout-duration: 10s # thread-pool-bulkhead: # configs: # default: # core-thread-pool-size: 1 # max-thread-pool-size: 1 # queue-capacity: 1 # 线程池内最多容纳1个，等待队列最多容纳1个，故最多容纳2个（核心线程池内存常驻，其余（若有）线程池只是临时的，超过时间不用就会回收） # instances: # cloud-payment-service: # base-config: default resilience4j: ratelimiter: configs: default: limit-for-period: 2 # 在一次刷新周期内，允许执行的最大请求数 limit-refresh-period: 1s # 限流器每隔limitRefreshPeriod刷新一次，将允许处理的最大请求数量重置为limitForPeriod timeout-duration: 1 # 线程等待权限的默认等待时间 instances: cloud-payment-service: base-config: default management: zipkin: tracing: endpoint: http://localhost:9411/api/v2/spans # 固定写法 tracing: sampling: probability: 1.0 # 采样率默认为0.1，即十次只能有一次被记录下，值越大收集越及时 MainOpenFeign80 1 2 3 4 5 6 7 @SpringBootApplication @EnableFeignClients // 启用Feign客户端，定义服务+绑定接口，以声明式的方法优雅而简单地实现服务调用 public class MainOpenFeign80 { public static void main(String[] args) { SpringApplication.run(MainOpenFeign80.class, args); } } config.FeignConfig 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 @Configuration public class FeignConfig { /** * OpenFeign的重试机制 */ @Bean public Retryer myRetryer() { return Retryer.NEVER_RETRY; // Feign默认配置是不走重试策略的 // 最大请求次数为3(1+2)，初始间隔时间为100ms，重试间最大间隔时间为1s // return new Retryer.Default(100, 1, 3); } /** * OpenFeign的日志打印功能 */ @Bean Logger.Level feignLoggerLevel() { return Logger.Level.FULL; } } controller OrderController 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 @RestController @RequestMapping(&#34;/feign&#34;) public class OrderController { @Resource private PayFeignAPi payFeignAPi; @PostMapping(&#34;/pay/add&#34;) public ResultData addOrder(@RequestBody PayDTO payDTO) { // 1、模拟本地addOrder新增订单成功（省略sql操作） // 2、在开启addPay支付微服务远程调用 // 当应用启动时，Feign使用Java动态代理机制生成接口的实现，这个实现由SpringCLoud方法提供支持 // Feign客户端在内部构建了请求的详细信息，并将接口方法调用转换为HTTP调用 return payFeignAPi.addPay(payDTO); } @GetMapping(&#34;/pay/get/{id}&#34;) public ResultData getPayInfo(@PathVariable(&#34;id&#34;) Integer id) { // 1、支付微服务远程调用，按照id查询订单支付流水信息 ResultData resultData = null; try { System.out.println(&#34;调用开始：&#34; + DateUtil.now()); resultData = payFeignAPi.getPayInfo(id); } catch (Exception e) { e.printStackTrace(); System.out.println(&#34;调用结束：&#34; + DateUtil.now()); ResultData.fail(ReturnCodeEnum.RC500.getCode(), e.getMessage()); // 测试超时控制 // 调用开始：2024-12-05 18:52:31 // 调用结束：2024-12-05 18:53:31 // Feign默认超时时间60s } return resultData; } @GetMapping(&#34;/pay/get/info&#34;) public String mylb() { return payFeignAPi.mylb(); } } OrderCircuitController：CircuitBreaker、BulkHead、RateLimit 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 @RestController public class OrderCircuitController { @Resource private PayFeignAPi payFeignAPi; @GetMapping(&#34;/feign/pay/circuit/{id}&#34;) @CircuitBreaker(name = &#34;cloud-payment-service&#34;, fallbackMethod = &#34;myCircuitFallback&#34;) // 与yml的instances名字保持一致 public String myCircuitBreaker(@PathVariable(&#34;id&#34;) Integer id) { return payFeignAPi.myCircuit(id); } /** * 报错就会进入，超过50%才会熔断（断开），后面就算不报错了，仍会返回失败 * 服务降级后的兜底处理方法 */ public String myCircuitFallback(Throwable t) { return &#34;myCircuitFallback 系统繁忙，请稍后再试&#34;; } @GetMapping(&#34;/feign/pay/bulkhead/{id}&#34;) @Bulkhead(name = &#34;cloud-payment-service&#34;, fallbackMethod = &#34;myBulkheadFallback&#34;, type = Bulkhead.Type.SEMAPHORE) public String myBulkhead(@PathVariable(&#34;id&#34;) Integer id) { return payFeignAPi.myBulkhead(id); } public String myBulkheadFallback(Throwable t) { return &#34;myBulkheadFallback 隔板超出最大数量限制，系统繁忙，请稍后再试&#34;; } @GetMapping(&#34;/feign/pay/bulkhead_th/{id}&#34;) @Bulkhead(name = &#34;cloud-payment-service&#34;, fallbackMethod = &#34;myBulkheadFallbackTh&#34;, type = Bulkhead.Type.THREADPOOL) public CompletableFuture&lt;String&gt; myBulkheadTh(@PathVariable(&#34;id&#34;) Integer id) { System.out.println(Thread.currentThread().getName() + &#34;\\t&#34; + &#34;---开始进入---&#34;); try { TimeUnit.SECONDS.sleep(3); } catch (InterruptedException e) { e.printStackTrace(); } System.out.println(Thread.currentThread().getName() + &#34;\\t&#34; + &#34;---准备离开---&#34;); // bulkhead-cloud-payment-service-1 ---开始进入--- // bulkhead-cloud-payment-service-1 ---准备离开--- return CompletableFuture.supplyAsync(() -&gt; payFeignAPi.myBulkhead(id) + &#34;\\t&#34; + &#34;THREADPOOL&#34;); } public CompletableFuture&lt;String&gt; myBulkheadFallbackTh(Integer id, Throwable t) { return CompletableFuture.supplyAsync(() -&gt; &#34;myBulkheadFallbackTh 隔板超出最大数量限制，系统繁忙，请稍后再试&#34;); } @GetMapping(&#34;/feign/pay/ratelimit/{id}&#34;) @RateLimiter(name = &#34;cloud-payment-service&#34;, fallbackMethod = &#34;myRatelimitFallback&#34;) public String myRatelimit(@PathVariable(&#34;id&#34;) Integer id) { return payFeignAPi.myRatelimit(id); } public String myRatelimitFallback(Throwable t) { return &#34;myRatelimitFallback 你被限流了，禁止访问&#34;; } } OrderMicrometerController：Micrometer 1 2 3 4 5 6 7 8 9 10 11 @RestController public class OrderMicrometerController { @Resource private PayFeignAPi payFeignAPi; @GetMapping(&#34;/feign/micrometer/{id}&#34;) public String myMicrometer(@PathVariable(&#34;id&#34;) Integer id) { return payFeignAPi.myMicrometer(id); } } OrderMicrometerController：GateWay 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 @RestController public class OrderGatewayController { @Resource private PayFeignAPi payFeignAPi; @GetMapping(&#34;/feign/pay/gateway/get/{id}&#34;) public ResultData getById(@PathVariable(&#34;id&#34;) Integer id) { return payFeignAPi.getById(id); } @GetMapping(&#34;/feign/pay/gateway/info&#34;) public ResultData&lt;String&gt; getGatewayInfo() { return payFeignAPi.getGatewayInfo(); } } cloud-gateway9527（网关） pom 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 &lt;dependencies&gt; &lt;!--gateway--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-gateway&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--服务注册发现consul discovery,网关也要注册进服务注册中心统一管控--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-consul-discovery&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- 指标监控健康检查的actuator,网关是响应式编程删除掉spring-boot-starter-web dependency--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--lombok--&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;scope&gt;provided&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; application.yml：配置Consul、routes=(id+uri+predicates+filters)*n 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 server: port: 9527 spring: application: name: cloud-gateway # 以微服务注册进consul或nacos服务列表内 cloud: consul: # 配置consul地址 host: localhost port: 8500 discovery: prefer-agent-address: true service-name: ${spring.application.name} gateway: # 所有的请求都会发给网关，由网关进行转发 routes: - id: pay_route1 # 路由的ID（类似于mysql的主键），没有固定规则但要求唯一，建议配合服务名 # uri: http://localhost:8001 # 匹配后提供服务的路由地址 uri: lb://cloud-payment-service # 以微服务名字动态获取uri # lb 代表 负载均衡器（Load Balancer）。这表示请求会通过负载均衡器转发到 cloud-payment-service 服务，而不是直接指定一个固定的 IP 地址或主机名。 # lb://：这个前缀表示使用负载均衡器来解析服务的地址，负载均衡器会根据一定的算法（例如轮询、最小连接数等）将请求转发到 cloud-payment-service 的不同实例。 # 此时将8001改为8007，依然可以通过OpenFeign对服务访问 predicates: # 只有满足了断言下的所有条件才能正常访问到uri - Path=/pay/gateway/get/** # 路径相匹配的进行路由 - After=2024-12-09T16:33:19.186588300+08:00[GMT+08:00] # 在此时间之后才能访问：到点秒杀 # Before Between=XXX,XXX # - Cookie=username,xz # cmd：curl http://localhost:9527/pay/gateway/get/1 --cookie &#34;username=xz&#34; 直接访问9527才生效，当访问80再访问9527则不行，因为这样Cookie只传到了80端口（实际工作中不会有用Feign调网关的情况发生，故直接访问网关没有问题） # - Header=X-Request-Id, \\d+ # cmd：curl http://localhost:9527/pay/gateway/get/1 -H &#34;X-Request-Id:123456&#34; # 一个属性名称，一个正则表达式，属性名与正则匹配才符合条件：请求头要有X-Request-Id属性且值为正数 同样只有直接访问9527才生效 # - Host=**.xz.com # cmd：curl http://localhost:9527/pay/gateway/get/3 -H &#34;Host:a.www.xz.com&#34; 接收一组匹配的域名列表，这个模板是一个ant分隔的模板，用.作为分隔符 # - Query=username, \\d+ # http://localhost:9527/pay/gateway/get/1?username=23 要求有查询参数且符合属性值，一个是属性名、一个是属性值，属性值可以是正则 # - RemoteAddr=10.249.94.1/24 # IPv4地址 10.249.94.181 http://10.249.94.181:9527/pay/gateway/get/1 外部访问IP限制，最大跨度不超过32，目前是1-24，CIDR表示法 # - Method=POST # 限制请求方法只能为POST # Fully Expanded Arguments # - name: My # args: # userType: diamond # http://localhost:9527/pay/gateway/get/1?userType=diamond # Shortcut Configuration # - My=diamond - id: pay_route2 # uri: http://localhost:8001 uri: lb://cloud-payment-service # 动态路由 predicates: - Path=/pay/gateway/info/** - id: pay_route3 uri: lb://cloud-payment-service predicates: - Path=/pay/gateway/filter/** # 默认的正确地址 # - Path=/gateway/filter/** # 拆分为 PrefixPath + Path # - Path=/XYZ/abc/{segment} # {segment}为占位符，最后会被setPath取代 filters: # # 往请求中添加请求头参数 # - AddRequestHeader=X-Request-xz1,xzVal1 # 请求头kv，若含有多个kv则重写一行设置 # - AddRequestHeader=X-Request-xz2,xzVal2 # # 往请求中删除请求头参数 # - RemoveRequestHeader=sec-fetch-site # 删除 请求头名：sec-fetch-site 请求头值：none # # 修改请求头参数 # - SetRequestHeader=sec-fetch-mode,xzxzxzxzxzxz # 请求头名：sec-fetch-mode 请求头值修改为xzxzxzxzxzxz # # 新增请求参数 # - AddRequestParameter=customerId,9527001 # 新增请求参数Parameter，kv（默认值），如果有传过来的请求参数则会将此覆盖 # # 删除请求参数 # - RemoveRequestParameter=customName # 删除url请求参数的value -&gt; null # # 新增响应头参数 # - AddResponseHeader=X-Response-xz,xzzzzzz # x-response-xz: xzzzzzz # # 修改响应头参数 # - SetResponseHeader=Date,2099-11-11 # date: 2099-11-11 # # 删除响应头参数 # - RemoveResponseHeader=Content-Type # 将默认自带Content-Type删除 # - PrefixPath=/pay # http://localhost:9527/pay/gateway/filter 过滤器统一管理前缀 # - SetPath=/pay/gateway/{segment} # 浏览器访问的地址：http://localhost:9527/XYZ/abc/filter 实际访问的地址：http://localhost:9527/pay/gateway/filter # - RedirectTo=302,https://www.baidu.com/ # 访问http://localhost:9527/pay/gateway/filter跳转到https://www.baidu.com/ 302重定向状态码 # 自定义filter就是作用于全部routes的 spring.cloud.gateway.default-filters... - My=xz # xz就是Config里面的status http://localhost:9527/pay/gateway/filter -&gt; 400 http://localhost:9527/pay/gateway/filter?xz=??才能访问（过滤器可以替代断言，但是断言不能替代过滤器） Main9527 1 2 3 4 5 6 7 @SpringBootApplication public class Main9527 { public static void main(String[] args) { SpringApplication.run(Main9527.class, args); // 网关，不写任何业务代码，网关和业务无关 } } mygateway MyRoutePredicateFactory：自定义路由断言 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 /** * 需求说明：自定义配置会员等级userType，按照钻/金/银和yml配置的会员等级，以适配是否可以访问 * * 约定自定义的路由断言工厂必须要以RoutePredicateFactory结尾，前面的部分将会形如[After][Before][Between]...出现 * 因此这个路由断言工厂将会显示为[My] * 2024-12-10T10:17:10.899+08:00 INFO 24408 --- [cloud-gateway] [main] o.s.c.g.r.RouteDefinitionRouteLocator : Loaded RoutePredicateFactory [My] */ @Component public class MyRoutePredicateFactory extends AbstractRoutePredicateFactory&lt;MyRoutePredicateFactory.Config&gt; { public MyRoutePredicateFactory() { super(MyRoutePredicateFactory.Config.class); } // 这个Config类就是路由断言规则！ @Validated public static class Config { @Setter @Getter @NotEmpty private String userType; // 钻/金/银用户等级 } /** * 使支持短格式 */ @Override public List&lt;String&gt; shortcutFieldOrder() { return Collections.singletonList(&#34;userType&#34;); } @Override public Predicate&lt;ServerWebExchange&gt; apply(MyRoutePredicateFactory.Config config) { return new Predicate&lt;ServerWebExchange&gt;() { @Override public boolean test(ServerWebExchange serverWebExchange) { String userType = serverWebExchange.getRequest().getQueryParams().getFirst(&#34;userType&#34;); // 获取名字为userType的查询参数 if (userType == null) return false; // 断言校验失败 if (userType.equalsIgnoreCase(config.getUserType())) { return true; // 与预先定义的userType相同，断言校验成功 } return false; } }; } } MyGlobalFilter：应用场景：统计Controller调用耗时情况，如何落地，谈谈设计思路：自定义全局过滤器（重点，面试设计题） 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 /** * 自定义全局过滤器 */ @Component @Slf4j public class MyGlobalFilter implements GlobalFilter, Ordered { public static final String BEGIN_VISIT_TIME = &#34;begin_visit_time&#34;; @Override public Mono&lt;Void&gt; filter(ServerWebExchange exchange, GatewayFilterChain chain) { // 先记录下访问接口的开始时间 exchange.getAttributes().put(BEGIN_VISIT_TIME, System.currentTimeMillis()); // 返回统计的各个结果给后台 return chain.filter(exchange).then(Mono.fromRunnable(() -&gt; { // 响应式编程 Long beginVisitTime = exchange.getAttribute(BEGIN_VISIT_TIME); if (beginVisitTime != null) { log.info(&#34;访问接口主机：&#34; + exchange.getRequest().getURI().getHost()); log.info(&#34;访问接口端口：&#34; + exchange.getRequest().getURI().getPort()); log.info(&#34;访问接口URL：&#34; + exchange.getRequest().getURI().getPath()); log.info(&#34;访问接口URL后面的参数：&#34; + exchange.getRequest().getURI().getRawQuery()); log.info(&#34;访问接口时长：&#34; + (System.currentTimeMillis() - beginVisitTime) + &#34;毫秒&#34;); log.info(&#34;=====================================&#34;); System.out.println(); /* 2024-12-10T21:53:21.721+08:00 INFO 29628 --- [cloud-gateway] [tor-http-nio-15] c.x.s.mygateway.MyGlobalFilter : 访问接口主机：localhost 2024-12-10T21:53:21.721+08:00 INFO 29628 --- [cloud-gateway] [tor-http-nio-15] c.x.s.mygateway.MyGlobalFilter : 访问接口端口：9527 2024-12-10T21:53:21.721+08:00 INFO 29628 --- [cloud-gateway] [tor-http-nio-15] c.x.s.mygateway.MyGlobalFilter : 访问接口URL：/pay/gateway/info 2024-12-10T21:53:21.721+08:00 INFO 29628 --- [cloud-gateway] [tor-http-nio-15] c.x.s.mygateway.MyGlobalFilter : 访问接口URL后面的参数：null 2024-12-10T21:53:21.721+08:00 INFO 29628 --- [cloud-gateway] [tor-http-nio-15] c.x.s.mygateway.MyGlobalFilter : 访问接口时长：198毫秒 */ } })); } /** * 数字越小，优先级越高，pre最先执行，post最后执行 */ @Override public int getOrder() { return 0; } } MyGatewayFilterFactory：自定义条件过滤器 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 @Component public class MyGatewayFilterFactory extends AbstractGatewayFilterFactory&lt;MyGatewayFilterFactory.Config&gt; { public MyGatewayFilterFactory() { super(MyGatewayFilterFactory.Config.class); } public static class Config { @Getter @Setter private String status; // 设定一个状态值/标志位，等于时才可以访问 } @Override public List&lt;String&gt; shortcutFieldOrder() { return Arrays.asList(&#34;status&#34;); } @Override public GatewayFilter apply(MyGatewayFilterFactory.Config config) { return new GatewayFilter() { @Override public Mono&lt;Void&gt; filter(ServerWebExchange exchange, GatewayFilterChain chain) { ServerHttpRequest request = exchange.getRequest(); System.out.println(&#34;进入了自定义网关过滤器MyGatewayFilterFactory, status：&#34; + config.getStatus()); // 进入了自定义网关过滤器MyGatewayFilterFactory, status：xz（与路由断言工厂类似，来自于yml中的配置） if (request.getQueryParams().containsKey(config.getStatus())) { // 包含配置的key才放行 return chain.filter(exchange); // 放行，传给下一个过滤器 } else { exchange.getResponse().setStatusCode(HttpStatus.BAD_REQUEST); // 非法请求 return exchange.getResponse().setComplete(); } } }; } } Spring Cloud原生 Consul：服务注册与发现 cmd指令 1 2 3 4 5 6 7 8 查看版本 consul --version 运行 consul agent -dev 打开 http://localhost:8500/ pom 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 &lt;!--SpringCloud consul discovery （所有微服务！） --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-consul-discovery&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--SpringCloud consul config （仅service！） --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-consul-config&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-bootstrap&lt;/artifactId&gt; &lt;/dependency&gt; CAP 1 2 3 C：Consistency 强一致性 A：Availability 可用性 P：Partition tolerance 分区容错性 经典CAP图 1 2 3 4 5 6 最多只能同时较好的满足两个。CAP理论的核心是：一个分布式系统不可能同时很好的满足一致性，可用性和分区容错性这三个需求， 因此，根据 CAP 原理将 NoSQL 数据库分成了满足 CA 原则、满足 CP 原则和满足 AP 原则三大类： CA - 单点集群，满足一致性，可用性的系统，通常在可扩展性上不太强大。 CP - 满足一致性，分区容忍性的系统，通常性能不是特别高。 AP - 满足可用性，分区容忍性的系统，通常可能对一致性要求低一些。 ">
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu_f509edb42ecc0ebd.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">🍥</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">Example Site</a></h1>
            <h2 class="site-description">Example description</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://github.com/CaiJimmy/hugo-theme-stack'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://twitter.com'
                        target="_blank"
                        title="Twitter"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>Home</span>
            </a>
        </li>
        
        
        <li >
            <a href='/about/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>About</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        
        <li >
            <a href='/links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Links</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">
                    
                        <li id="i18n-switch">  
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 5h7" />
  <path d="M9 3v2c0 4.418 -2.239 8 -5 8" />
  <path d="M5 9c-.003 2.144 2.952 3.908 6.7 4" />
  <path d="M12 20l4 -9l4 9" />
  <path d="M19.1 18h-6.2" />
</svg>



                            <select name="language" title="language" onchange="window.location.href = this.selectedOptions[0].value">
                                
                                    <option value="https://X-Augenstern.github.io/" selected>English</option>
                                
                                    <option value="https://X-Augenstern.github.io/zh-cn/" >中文</option>
                                
                                    <option value="https://X-Augenstern.github.io/ar/" >عربي</option>
                                
                            </select>
                        </li>
                    
                

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>Dark Mode</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">Table of contents</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#父工程pom">父工程pom</a></li>
    <li><a href="#mybatis_generate代码生成">mybatis_generate（代码生成）</a>
      <ol>
        <li><a href="#pom">pom</a></li>
        <li><a href="#configproperties">config.properties</a></li>
        <li><a href="#generateconfigxml">generateConfig.xml</a></li>
      </ol>
    </li>
    <li><a href="#cloud-api-commonsinstall为jar包供其它微服务使用openfeignopenfeignsentinel">cloud-api-commons（install为jar包供其它微服务使用、OpenFeign、OpenFeign+Sentinel）</a>
      <ol>
        <li><a href="#pom-1">pom</a></li>
        <li><a href="#apis">apis</a>
          <ol>
            <li><a href="#payfeignapi">PayFeignAPi</a></li>
            <li><a href="#payfeignsentinelapiopenfeignsentinel">PayFeignSentinelAPi：OpenFeign+Sentinel</a></li>
            <li><a href="#payfeignsentinelapifallback">PayFeignSentinelApiFallBack</a></li>
            <li><a href="#storagefeignapi">StorageFeignApi</a></li>
            <li><a href="#accountfeignapi">AccountFeignAPi</a></li>
          </ol>
        </li>
        <li><a href="#entitiespaydto">entities.PayDTO</a></li>
        <li><a href="#expglobalexceptionhandler">exp.GlobalExceptionHandler</a></li>
        <li><a href="#resp">resp</a>
          <ol>
            <li><a href="#resultdata">ResultData</a></li>
            <li><a href="#returncodeenum">ReturnCodeEnum</a></li>
          </ol>
        </li>
      </ol>
    </li>
  </ol>

  <ol>
    <li><a href="#cloud-provider-payment8001service">cloud-provider-payment8001（service）</a>
      <ol>
        <li><a href="#pom-2">pom</a></li>
        <li><a href="#yml">yml</a>
          <ol>
            <li><a href="#bootstrappom需要引入springcloud-consul-configbootstrapconsulmicrometerzipkin">bootstrap：pom需要引入SpringCloud consul config、bootstrap、Consul、Micrometer+ZipKin</a></li>
            <li><a href="#application">application</a></li>
          </ol>
        </li>
        <li><a href="#resourcesmapperpaymapperxml">resources.mapper.PayMapper.xml</a></li>
        <li><a href="#main8001">Main8001</a></li>
        <li><a href="#configswagger3config">config.Swagger3Config</a></li>
        <li><a href="#controller">controller</a>
          <ol>
            <li><a href="#paycontroller基础的增删改查获取consul中配置的kvswagger3注解">PayController：基础的增删改查、获取Consul中配置的kv、Swagger3注解</a></li>
            <li><a href="#paycircuitcontroller">PayCircuitController</a></li>
            <li><a href="#paymicrometercontroller">PayMicrometerController</a></li>
            <li><a href="#gatewaycontroller">GatewayController</a></li>
          </ol>
        </li>
        <li><a href="#service">service</a></li>
        <li><a href="#mapperpaymapper">mapper.Paymapper</a></li>
        <li><a href="#entitiespay">entities.Pay</a></li>
      </ol>
    </li>
    <li><a href="#cloud-provider-payment8002service">cloud-provider-payment8002（service）</a>
      <ol>
        <li><a href="#与8001大体上一致">与8001大体上一致</a></li>
      </ol>
    </li>
    <li><a href="#cloud-consumer-order80deprecated使用resttemplate转发给微服务">cloud-consumer-order80（<em>deprecated</em>，使用RestTemplate转发给微服务）</a>
      <ol>
        <li><a href="#pom-3">pom</a></li>
        <li><a href="#applicationymlconsul">application.yml：Consul</a></li>
        <li><a href="#main80">Main80</a></li>
        <li><a href="#configresttemplateconfig">config.RestTemplateConfig</a></li>
        <li><a href="#controllerordercontroller">controller.OrderController</a></li>
      </ol>
    </li>
    <li><a href="#cloud-consumer-feign-order80使用openfeign转发给微服务">cloud-consumer-feign-order80（使用OpenFeign转发给微服务）</a>
      <ol>
        <li><a href="#pom-4">pom</a></li>
        <li><a href="#applicationyml配置consulopenfeignresilience4jmicrometerzipkin">application.yml：配置Consul、OpenFeign、Resilience4j、Micrometer+ZipKin</a></li>
        <li><a href="#mainopenfeign80">MainOpenFeign80</a></li>
        <li><a href="#configfeignconfig">config.FeignConfig</a></li>
        <li><a href="#controller-1">controller</a>
          <ol>
            <li><a href="#ordercontroller">OrderController</a></li>
            <li><a href="#ordercircuitcontrollercircuitbreakerbulkheadratelimit">OrderCircuitController：CircuitBreaker、BulkHead、RateLimit</a></li>
            <li><a href="#ordermicrometercontrollermicrometer">OrderMicrometerController：Micrometer</a></li>
            <li><a href="#ordermicrometercontrollergateway">OrderMicrometerController：GateWay</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#cloud-gateway9527网关">cloud-gateway9527（网关）</a>
      <ol>
        <li><a href="#pom-5">pom</a></li>
        <li><a href="#applicationyml配置consulroutesiduripredicatesfiltersn">application.yml：配置Consul、routes=(id+uri+predicates+filters)*n</a></li>
        <li><a href="#main9527">Main9527</a></li>
        <li><a href="#mygateway">mygateway</a>
          <ol>
            <li><a href="#myroutepredicatefactory自定义路由断言">MyRoutePredicateFactory：自定义路由断言</a></li>
            <li><a href="#myglobalfilter应用场景统计controller调用耗时情况如何落地谈谈设计思路自定义全局过滤器重点面试设计题">MyGlobalFilter：应用场景：统计Controller调用耗时情况，如何落地，谈谈设计思路：自定义全局过滤器（重点，面试设计题）</a></li>
            <li><a href="#mygatewayfilterfactory自定义条件过滤器">MyGatewayFilterFactory：自定义条件过滤器</a></li>
          </ol>
        </li>
      </ol>
    </li>
  </ol>

  <ol>
    <li><a href="#consul服务注册与发现">Consul：服务注册与发现</a>
      <ol>
        <li><a href="#cmd指令">cmd指令</a></li>
        <li><a href="#pom-6">pom</a></li>
        <li><a href="#cap">CAP</a>
          <ol>
            <li><a href="#经典cap图">经典CAP图</a></li>
            <li><a href="#ap架构eurekanacos">AP架构：Eureka/Nacos</a></li>
            <li><a href="#cp架构zookeeperconsul">CP架构：Zookeeper/Consul</a></li>
            <li><a href="#三个注册中心异同点consul除了能够实现服务注册与发现更能做到服务的动态配置与管理">三个注册中心异同点：Consul除了能够实现服务注册与发现，更能做到服务的动态配置与管理</a></li>
          </ol>
        </li>
        <li><a href="#持久化配置并注册为windows服务">持久化配置并注册为windows服务</a></li>
      </ol>
    </li>
    <li><a href="#loadbalancer负载均衡">LoadBalancer：负载均衡</a>
      <ol>
        <li><a href="#本地客户端负载均衡loadbalancer与服务器端负载均衡nginx的区别面试">本地客户端负载均衡：LoadBalancer与服务器端负载均衡：Nginx的区别（面试）</a></li>
        <li><a href="#pomconsumer">pom（consumer）</a></li>
        <li><a href="#负载均衡默认使用轮询算法">负载均衡默认使用轮询算法</a></li>
      </ol>
    </li>
    <li><a href="#openfeign服务接口调用和负载均衡默认集成了loadbalancer">OpenFeign：服务接口调用和负载均衡（默认集成了LoadBalancer）</a>
      <ol>
        <li><a href="#工作原理特点">工作原理+特点</a></li>
        <li><a href="#openfeign与resttemplate区别">OpenFeign与RestTemplate区别</a></li>
        <li><a href="#pomconsumer-1">pom（consumer）</a></li>
      </ol>
    </li>
    <li><a href="#resilience4j是spring-cloud-circuit-breaker接口规范的实现类circuitbreakerbulkheadratelimiter">Resilience4j是Spring Cloud Circuit Breaker接口规范的实现类：CircuitBreaker+BulkHead+RateLimiter</a>
      <ol>
        <li><a href="#circuitbreaker断路器服务熔断和服务降级面试必考题">CircuitBreaker：断路器，服务熔断和服务降级（面试必考题）</a>
          <ol>
            <li><a href="#配置参数">配置参数</a></li>
            <li><a href="#pomconsumer-2">pom（consumer）</a></li>
            <li><a href="#断路器开启或关闭的条件">断路器开启或关闭的条件</a></li>
          </ol>
        </li>
        <li><a href="#bulkhead舱壁隔离依赖隔离负载保护">BulkHead：舱壁隔离，依赖隔离，负载保护</a>
          <ol>
            <li><a href="#关注点舱壁种类">关注点+舱壁种类</a></li>
          </ol>
        </li>
        <li><a href="#ratelimiter限流侧重于一段时间内的最多请求次数">RateLimiter：限流，侧重于一段时间内的最多请求次数</a>
          <ol>
            <li><a href="#说说常见限流算法面试">说说常见限流算法（面试）</a></li>
          </ol>
        </li>
        <li><a href="#熔断与隔离的理解与使用">熔断与隔离的理解与使用</a></li>
      </ol>
    </li>
    <li><a href="#micrometer-tracing数据采样前身sleuthzipkin链路展现分布式链路追踪distributed-tracing">Micrometer Tracing：数据采样，前身Sleuth+ZipKin：链路展现=分布式链路追踪（Distributed Tracing）</a>
      <ol>
        <li><a href="#zipkin">Zipkin</a>
          <ol>
            <li><a href="#cmd指令-1">cmd指令</a></li>
          </ol>
        </li>
        <li><a href="#pomserviceconsumer">pom（service、consumer）</a></li>
        <li><a href="#yml-1">yml</a></li>
      </ol>
    </li>
    <li><a href="#gateway服务网关">GateWay：服务网关</a>
      <ol>
        <li><a href="#gateway与nginx区别">GateWay与Nginx区别</a></li>
        <li><a href="#gateway与openfeign区别">GateWay与OpenFeign区别</a></li>
        <li><a href="#三大概念routepredicatefilter">三大概念：Route、Predicate、Filter</a></li>
        <li><a href="#filter请求鉴权异常处理记录接口调用时长统计">Filter：请求鉴权、异常处理、记录接口调用时长统计&hellip;</a>
          <ol>
            <li><a href="#filter与predicate区别">Filter与Predicate区别</a></li>
          </ol>
        </li>
        <li><a href="#pom-7">pom</a></li>
        <li><a href="#yml-2">yml</a></li>
      </ol>
    </li>
  </ol>

  <ol>
    <li><a href="#cloudalibaba-provider-payment9001servicesentinelopenfeign">cloudalibaba-provider-payment9001（service）(Sentinel+OpenFeign)</a>
      <ol>
        <li><a href="#pom-8">pom</a></li>
        <li><a href="#applicationyml">application.yml</a></li>
        <li><a href="#main9001">Main9001</a></li>
        <li><a href="#controllerpayalibabacontroller">controller.PayAlibabaController</a></li>
      </ol>
    </li>
    <li><a href="#cloudalibaba-consumer-order83resttemplateopenfeign">cloudalibaba-consumer-order83（RestTemplate、OpenFeign）</a>
      <ol>
        <li><a href="#pom-9">pom</a></li>
        <li><a href="#applicationyml-1">application.yml</a></li>
        <li><a href="#main83">Main83</a></li>
        <li><a href="#configresttemplate">config.RestTemplate</a></li>
        <li><a href="#controllerorderalibabacontroller">controller.OrderAlibabaController</a></li>
      </ol>
    </li>
    <li><a href="#cloudalibaba-config-nacos-client3377加载nacos服务中心配置">cloudalibaba-config-nacos-client3377（加载Nacos服务中心配置）</a>
      <ol>
        <li><a href="#pom-10">pom</a></li>
        <li><a href="#yml-3">yml</a>
          <ol>
            <li><a href="#bootstrappom需要引入nacos-configbootstrap">bootstrap：pom需要引入nacos-config、bootstrap</a></li>
            <li><a href="#application-1">application</a></li>
          </ol>
        </li>
        <li><a href="#main3377">Main3377</a></li>
        <li><a href="#controllernacosconfigclientcontroller">controller.NacosConfigClientController</a></li>
      </ol>
    </li>
    <li><a href="#cloudalibaba-sentinel-service8401">cloudalibaba-sentinel-service8401</a>
      <ol>
        <li><a href="#pom-11">pom</a></li>
        <li><a href="#applicationyml-2">application.yml</a></li>
        <li><a href="#main8401">Main8401</a></li>
        <li><a href="#handlermyrequestoriginparser">handler.MyRequestOriginParser</a></li>
        <li><a href="#serviceflowlimitservice">service.FlowLimitService</a></li>
        <li><a href="#controller-2">controller</a>
          <ol>
            <li><a href="#flowlimitcontroller">FlowLimitController</a></li>
            <li><a href="#ratelimitcontroller">RateLimitController</a></li>
            <li><a href="#empowercontroller">EmpowerController</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#cloudalibaba-sentinel-gateway9528sentinelgateway">cloudalibaba-sentinel-gateway9528（Sentinel+Gateway）</a>
      <ol>
        <li><a href="#pom-12">pom</a></li>
        <li><a href="#applicationyml-3">application.yml</a></li>
        <li><a href="#main">Main</a></li>
        <li><a href="#configgatewayconfiguration">config.GatewayConfiguration</a></li>
      </ol>
    </li>
    <li><a href="#seata-order-service2001">seata-order-service2001</a>
      <ol>
        <li><a href="#pom-13">pom</a></li>
        <li><a href="#applicationyml-4">application.yml</a></li>
        <li><a href="#seataordermainapp2001">SeataOrderMainApp2001</a></li>
        <li><a href="#entitiesorder">entities.Order</a></li>
        <li><a href="#mapper">mapper</a></li>
        <li><a href="#service-1">service</a></li>
        <li><a href="#controllerordercontroller-1">controller.OrderController</a></li>
      </ol>
    </li>
    <li><a href="#seata-storage-service2002">seata-storage-service2002</a>
      <ol>
        <li><a href="#pom同2001">pom（同2001）</a></li>
        <li><a href="#applicationyml修改serverportspringapplicationnamespringdatasourceurl">application.yml（修改server.port、spring.application.name、spring.datasource.url）</a></li>
        <li><a href="#seatastoragemainapp2002">SeataStorageMainApp2002</a></li>
        <li><a href="#entitiesstorage">entities.Storage</a></li>
        <li><a href="#mapper-1">mapper</a></li>
        <li><a href="#service-2">service</a></li>
        <li><a href="#controllerstoragecontroller">controller.StorageController</a></li>
      </ol>
    </li>
    <li><a href="#seata-account-service2003">seata-account-service2003</a>
      <ol>
        <li><a href="#pom同2001-1">pom（同2001）</a></li>
        <li><a href="#applicationyml修改serverportspringapplicationnamespringdatasourceurl-1">application.yml（修改server.port、spring.application.name、spring.datasource.url）</a></li>
        <li><a href="#seatastoragemainapp2003">SeataStorageMainApp2003</a></li>
        <li><a href="#entitiesstorage-1">entities.Storage</a></li>
        <li><a href="#mapper-2">mapper</a></li>
        <li><a href="#service-3">service</a></li>
        <li><a href="#controlleraccountcontroller">controller.AccountController</a></li>
      </ol>
    </li>
  </ol>

  <ol>
    <li><a href="#nacos服务注册与发现--spring-cloud-consul">Nacos：服务注册与发现 = Spring Cloud Consul</a>
      <ol>
        <li><a href="#四个注册中心异同点">四个注册中心异同点</a></li>
        <li><a href="#cmd指令-2">cmd指令</a></li>
        <li><a href="#pom-14">pom</a></li>
        <li><a href="#在9001的基础上直接拷贝配置运行9002nacos同样支持负载均衡">在9001的基础上直接拷贝配置运行9002（Nacos同样支持负载均衡）</a></li>
        <li><a href="#服务配置中心">服务配置中心</a></li>
        <li><a href="#实际问题">实际问题</a></li>
        <li><a href="#三种方案加载不同环境下的服务中心yaml配置信息">三种方案加载不同环境下的服务中心yaml配置信息</a>
          <ol>
            <li><a href="#data-id">Data ID</a></li>
            <li><a href="#group">Group</a></li>
            <li><a href="#namespace">Namespace</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#sentinel从流量路由流量控制流量整形熔断降级系统自适应过载保护热点流量防护等多个维度帮助开发者保障微服务的稳定性">Sentinel：从流量路由、流量控制、流量整形、熔断降级、系统自适应过载保护、热点流量防护等多个维度帮助开发者保障微服务的稳定性</a>
      <ol>
        <li><a href="#流控降级和容错标准">流控降级和容错标准</a></li>
        <li><a href="#讲讲什么是缓存穿透击穿雪崩如何解决见redis7">讲讲什么是缓存穿透？击穿？雪崩？如何解决？（见redis7）</a></li>
        <li><a href="#服务雪崩降级熔断限流隔离超时">服务雪崩/降级/熔断/限流/隔离/超时</a></li>
        <li><a href="#cmd指令-3">cmd指令</a></li>
        <li><a href="#pom-15">pom</a></li>
        <li><a href="#流控规则阈值类型qps">流控规则—阈值类型—QPS</a>
          <ol>
            <li><a href="#流控模式">流控模式</a></li>
            <li><a href="#流控效果">流控效果</a></li>
          </ol>
        </li>
        <li><a href="#流控规则阈值类型并发线程数">流控规则—阈值类型—并发线程数</a>
          <ol>
            <li><a href="#使用jmeter压力测试1s100个请求循环">使用JMeter压力测试：1s100个请求、循环</a></li>
          </ol>
        </li>
        <li><a href="#熔断规则">熔断规则</a>
          <ol>
            <li><a href="#慢调用比例1s内至少收集5个请求在这些请求中超过200ms的比例超过01就熔断5s">慢调用比例：1s内，至少收集5个请求，在这些请求中，超过200ms的比例超过0.1，就熔断5s</a></li>
            <li><a href="#异常比例1s内至少收集5个请求在这些请求中出现异常的比例超过02就熔断5s">异常比例：1s内，至少收集5个请求，在这些请求中，出现异常的比例超过0.2，就熔断5s</a></li>
            <li><a href="#异常数1s内至少收集5个请求在这些请求中出现异常数量超过1就熔断5s">异常数：1s内，至少收集5个请求，在这些请求中，出现异常数量超过1，就熔断5s</a></li>
          </ol>
        </li>
        <li><a href="#sentinelresource一个流量防卫防护组件注解用于指定需要被防护的资源对配置的资源进行流量控制熔断降级等功能">@SentinelResource：一个流量防卫防护组件注解，用于指定需要被防护的资源，对配置的资源进行流量控制、熔断降级等功能</a>
          <ol>
            <li><a href="#不使用此注解按照rest地址限流默认限流返回">不使用此注解，按照REST地址限流+默认限流返回</a></li>
            <li><a href="#使用此注解按资源名称限流自定义限流返回">使用此注解按资源名称限流，自定义限流返回</a></li>
            <li><a href="#使用此注解按资源名称限流自定义限流返回服务降级处理blockhandler针对sentinel配置出现违规情况fallback针对jvm抛出的异常启动服务降级即使有全局异常依然生效全局异常先捕获再抛出">使用此注解按资源名称限流，自定义限流返回，服务降级处理：blockHandler针对Sentinel配置出现违规情况；fallback针对JVM抛出的异常启动服务降级（即使有全局异常依然生效∵全局异常先捕获再抛出）</a></li>
          </ol>
        </li>
        <li><a href="#热点规则">热点规则</a>
          <ol>
            <li><a href="#只支持qps模式第参数索引个参数在统计窗口时长内如果访问次数超过单机阈值就限流调用限流方法dealhandler_testhotkey">只支持QPS模式，第“参数索引”个参数在统计窗口时长内如果访问次数超过单机阈值就限流，调用限流方法dealHandler_testHotKey</a></li>
            <li><a href="#当此参数等于5时允许单机阈值达到200热点参数必须是基本类型或者string">当此参数等于5时允许单机阈值达到200（热点参数必须是基本类型或者String）</a></li>
          </ol>
        </li>
        <li><a href="#授权规则">授权规则</a>
          <ol>
            <li><a href="#当请求中包含配置的查询参数名servername若其值为testtest2限流反之通过">当请求中包含配置的查询参数名serverName，若其值为test/test2，限流，反之通过</a></li>
          </ol>
        </li>
        <li><a href="#规则持久化目前8401sentinel-service一重启配置的规则就会丢失将规则持久化进nacos保存只要nacos里面的配置不删除规则持续有效">规则持久化：目前8401Sentinel Service一重启，配置的规则就会丢失；将规则持久化进Nacos保存，只要Nacos里面的配置不删除，规则持续有效</a>
          <ol>
            <li><a href="#pom-16">pom</a></li>
            <li><a href="#nacos新建json配置">Nacos新建JSON配置</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#sentinel整合openfeignopenfeign在consumer调用端sentinel在provider被调用端">Sentinel整合OpenFeign：OpenFeign在Consumer调用端，Sentinel在Provider被调用端</a></li>
    <li><a href="#sentinel整合gatewayopenfeign在consumer调用端sentinel在provider被调用端">Sentinel整合Gateway：OpenFeign在Consumer调用端，Sentinel在Provider被调用端</a>
      <ol>
        <li><a href="#pom-17">pom</a></li>
      </ol>
    </li>
    <li><a href="#seata分布式事务框架解决微服务架构下的分布式事务问题">Seata：分布式事务框架，解决微服务架构下的分布式事务问题</a>
      <ol>
        <li><a href="#面试">面试</a>
          <ol>
            <li><a href="#简历上写用了微服务bootcloud做过项目不可能只有一个数据库吧请谈谈多个数据库之间如何处理分布式事务">简历上写用了微服务boot/cloud做过项目，不可能只有一个数据库吧？请谈谈多个数据库之间如何处理分布式事务？</a></li>
            <li><a href="#阿里的seata-at模式如何做到对业务的无侵入">阿里的Seata-AT模式如何做到对业务的无侵入？</a></li>
            <li><a href="#对于分布式事务问题你知道的解决方案有哪些请你谈谈">对于分布式事务问题，你知道的解决方案有哪些？请你谈谈？</a></li>
            <li><a href="#上述面试问题都指向一个重要问题">上述面试问题都指向一个重要问题</a></li>
          </ol>
        </li>
        <li><a href="#seata的工作流程">Seata的工作流程</a>
          <ol>
            <li><a href="#xidtctmrm">XID、TC+TM+RM</a></li>
          </ol>
        </li>
        <li><a href="#cmd指令-4">cmd指令</a></li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/springcloud%E7%AC%94%E8%AE%B0/">SpringCloud笔记</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Mar 19, 2025</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    59 minute read
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <p><img src="C:%5cUsers%5chp%5cDesktop%5c%e5%bc%80%e5%8f%91%e6%96%87%e6%a1%a3%5cSpringCloud%5cFigure%5cimage-20241204161538321.png"
	
	
	
	loading="lazy"
	
		alt="image-20241204161538321"
	
	
></p>
<p><img src="C:%5cUsers%5chp%5cDesktop%5c%e5%bc%80%e5%8f%91%e6%96%87%e6%a1%a3%5cSpringCloud%5cFigure%5cimage-20241211153816483.png"
	
	
	
	loading="lazy"
	
		alt="image-20241211153816483"
	
	
></p>
<h2 id="父工程pom">父工程pom
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">&#34;http://maven.apache.org/POM/4.0.0&#34;</span>
</span></span><span class="line"><span class="cl">         <span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span class="line"><span class="cl">         <span class="na">xsi:schemaLocation=</span><span class="s">&#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>com.xz.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>springcloud<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;packaging&gt;</span>pom<span class="nt">&lt;/packaging&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;modules&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;module&gt;</span>mybatis_generator<span class="nt">&lt;/module&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;module&gt;</span>cloud-provider-payment8001<span class="nt">&lt;/module&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;module&gt;</span>cloud-consumer-order80<span class="nt">&lt;/module&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;module&gt;</span>cloud-api-commons<span class="nt">&lt;/module&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;module&gt;</span>cloud-provider-payment8002<span class="nt">&lt;/module&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;module&gt;</span>cloud-consumer-feign-order80<span class="nt">&lt;/module&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;module&gt;</span>cloud-gateway9527<span class="nt">&lt;/module&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/modules&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;properties&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;maven.compiler.source&gt;</span>17<span class="nt">&lt;/maven.compiler.source&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;maven.compiler.target&gt;</span>17<span class="nt">&lt;/maven.compiler.target&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;project.build.sourceEncoding&gt;</span>UTF-8<span class="nt">&lt;/project.build.sourceEncoding&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;hutool.version&gt;</span>5.8.22<span class="nt">&lt;/hutool.version&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;lombok.version&gt;</span>1.18.36<span class="nt">&lt;/lombok.version&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;druid.version&gt;</span>1.1.23<span class="nt">&lt;/druid.version&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;mybatis.springboot.version&gt;</span>3.0.4<span class="nt">&lt;/mybatis.springboot.version&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;mysql.version&gt;</span>8.0.28<span class="nt">&lt;/mysql.version&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;swagger3.version&gt;</span>2.2.0<span class="nt">&lt;/swagger3.version&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;mapper.version&gt;</span>4.2.3<span class="nt">&lt;/mapper.version&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;fastjson2.version&gt;</span>2.0.40<span class="nt">&lt;/fastjson2.version&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;persistence-api.version&gt;</span>1.0.2<span class="nt">&lt;/persistence-api.version&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;spring.boot.test.version&gt;</span>3.2.0<span class="nt">&lt;/spring.boot.test.version&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;spring.boot.version&gt;</span>3.2.0<span class="nt">&lt;/spring.boot.version&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;spring.cloud.version&gt;</span>2023.0.0<span class="nt">&lt;/spring.cloud.version&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;spring.cloud.alibaba.version&gt;</span>2023.0.0.0-RC1<span class="nt">&lt;/spring.cloud.alibaba.version&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;micrometer-tracing.version&gt;</span>1.2.0<span class="nt">&lt;/micrometer-tracing.version&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;micrometer-observation.version&gt;</span>1.12.0<span class="nt">&lt;/micrometer-observation.version&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;feign-micrometer.version&gt;</span>12.5<span class="nt">&lt;/feign-micrometer.version&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;zipkin-reporter-brave.version&gt;</span>2.17.0<span class="nt">&lt;/zipkin-reporter-brave.version&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/properties&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependencyManagement&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;dependencies&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="c">&lt;!--springboot 3.3.5--&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-parent<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;version&gt;</span>${spring.boot.version}<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;type&gt;</span>pom<span class="nt">&lt;/type&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;scope&gt;</span>import<span class="nt">&lt;/scope&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="c">&lt;!--springcloud 2023.0.0--&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;artifactId&gt;</span>spring-cloud-dependencies<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;version&gt;</span>${spring.cloud.version}<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;type&gt;</span>pom<span class="nt">&lt;/type&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;scope&gt;</span>import<span class="nt">&lt;/scope&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="c">&lt;!--springcloud alibaba 2023.0.0.0-RC1--&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;groupId&gt;</span>com.alibaba.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;artifactId&gt;</span>spring-cloud-alibaba-dependencies<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;version&gt;</span>${spring.cloud.alibaba.version}<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;type&gt;</span>pom<span class="nt">&lt;/type&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;scope&gt;</span>import<span class="nt">&lt;/scope&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="c">&lt;!--SpringBoot集成mybatis--&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;groupId&gt;</span>org.mybatis.spring.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;artifactId&gt;</span>mybatis-spring-boot-starter<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;version&gt;</span>${mybatis.springboot.version}<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="c">&lt;!--1、Mysql数据库驱动8 --&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;groupId&gt;</span>mysql<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;artifactId&gt;</span>mysql-connector-java<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;version&gt;</span>${mysql.version}<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="c">&lt;!--2、SpringBoot集成druid连接池--&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;groupId&gt;</span>com.alibaba<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;artifactId&gt;</span>druid-spring-boot-starter<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;version&gt;</span>${druid.version}<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="c">&lt;!--3、通用Mapper4之tk.mybatis--&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;groupId&gt;</span>tk.mybatis<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;artifactId&gt;</span>mapper<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;version&gt;</span>${mapper.version}<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="c">&lt;!--4、persistence--&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;groupId&gt;</span>javax.persistence<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;artifactId&gt;</span>persistence-api<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;version&gt;</span>${persistence-api.version}<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="c">&lt;!-- fastjson2 --&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;groupId&gt;</span>com.alibaba.fastjson2<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;artifactId&gt;</span>fastjson2<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;version&gt;</span>${fastjson2.version}<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="c">&lt;!-- swagger3 调用方式 http://你的主机IP地址:5555/swagger-ui/index.html --&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;groupId&gt;</span>org.springdoc<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;artifactId&gt;</span>springdoc-openapi-starter-webmvc-ui<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;version&gt;</span>${swagger3.version}<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="c">&lt;!--hutool--&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;groupId&gt;</span>cn.hutool<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;artifactId&gt;</span>hutool-all<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;version&gt;</span>${hutool.version}<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="c">&lt;!--lombok--&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;groupId&gt;</span>org.projectlombok<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;artifactId&gt;</span>lombok<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;version&gt;</span>${lombok.version}<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="c">&lt;!-- spring-boot-starter-test --&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-test<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;version&gt;</span>${spring.boot.test.version}<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c">&lt;!--micrometer-tracing-bom导入链路追踪版本中心  1--&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;groupId&gt;</span>io.micrometer<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;artifactId&gt;</span>micrometer-tracing-bom<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;version&gt;</span>${micrometer-tracing.version}<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;type&gt;</span>pom<span class="nt">&lt;/type&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;scope&gt;</span>import<span class="nt">&lt;/scope&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="c">&lt;!--micrometer-tracing指标追踪  2--&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;groupId&gt;</span>io.micrometer<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;artifactId&gt;</span>micrometer-tracing<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;version&gt;</span>${micrometer-tracing.version}<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="c">&lt;!--micrometer-tracing-bridge-brave适配zipkin的桥接包 3--&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;groupId&gt;</span>io.micrometer<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;artifactId&gt;</span>micrometer-tracing-bridge-brave<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;version&gt;</span>${micrometer-tracing.version}<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="c">&lt;!--micrometer-observation 4--&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;groupId&gt;</span>io.micrometer<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;artifactId&gt;</span>micrometer-observation<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;version&gt;</span>${micrometer-observation.version}<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="c">&lt;!--feign-micrometer 5--&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;groupId&gt;</span>io.github.openfeign<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;artifactId&gt;</span>feign-micrometer<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;version&gt;</span>${feign-micrometer.version}<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="c">&lt;!--zipkin-reporter-brave 6--&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;groupId&gt;</span>io.zipkin.reporter2<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;artifactId&gt;</span>zipkin-reporter-brave<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;version&gt;</span>${zipkin-reporter-brave.version}<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/dependencies&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependencyManagement&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/project&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="mybatis_generate代码生成">mybatis_generate（代码生成）
</h2><h3 id="pom">pom
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="c">&lt;!--自己独一份，只是一个普通Maven工程，与boot和cloud无关--&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependencies&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--Mybatis 通用mapper tk单独使用，自己独有+自带版本号--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.mybatis<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>mybatis<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;version&gt;</span>3.5.15<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- Mybatis Generator 自己独有+自带版本号--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.mybatis.generator<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>mybatis-generator-core<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;version&gt;</span>1.4.2<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--通用Mapper--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>tk.mybatis<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>mapper<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--mysql8.0--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>mysql<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>mysql-connector-java<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--persistence--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>javax.persistence<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>persistence-api<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--hutool--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>cn.hutool<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>hutool-all<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--lombok--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.projectlombok<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>lombok<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-test<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;exclusions&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;exclusion&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;groupId&gt;</span>org.junit.vintage<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;artifactId&gt;</span>junit-vintage-engine<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/exclusion&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/exclusions&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependencies&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">&lt;build&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;resources&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;resource&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;directory&gt;</span>${basedir}/src/main/java<span class="nt">&lt;/directory&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;includes&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;include&gt;</span>**/*.xml<span class="nt">&lt;/include&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/includes&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/resource&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;resource&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;directory&gt;</span>${basedir}/src/main/resources<span class="nt">&lt;/directory&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/resource&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/resources&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;plugins&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;plugin&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;artifactId&gt;</span>spring-boot-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;configuration&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;excludes&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;exclude&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;groupId&gt;</span>org.projectlombok<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;artifactId&gt;</span>lombok<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;/exclude&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;/excludes&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/configuration&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/plugin&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;plugin&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;groupId&gt;</span>org.mybatis.generator<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;artifactId&gt;</span>mybatis-generator-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;version&gt;</span>1.4.2<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;configuration&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;configurationFile&gt;</span>${basedir}/src/main/resources/generatorConfig.xml<span class="nt">&lt;/configurationFile&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;overwrite&gt;</span>true<span class="nt">&lt;/overwrite&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;verbose&gt;</span>true<span class="nt">&lt;/verbose&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/configuration&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;dependencies&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;groupId&gt;</span>mysql<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;artifactId&gt;</span>mysql-connector-java<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;version&gt;</span>8.0.28<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;groupId&gt;</span>tk.mybatis<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;artifactId&gt;</span>mapper<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;version&gt;</span>4.2.3<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/dependencies&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/plugin&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/plugins&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/build&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="configproperties">config.properties
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-properties" data-lang="properties"><span class="line"><span class="cl"><span class="c1">#t_pay???</span>
</span></span><span class="line"><span class="cl"><span class="na">package.name</span><span class="o">=</span><span class="s">com.xz.springcloud</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># mysql8.0</span>
</span></span><span class="line"><span class="cl"><span class="na">jdbc.driverClass</span> <span class="o">=</span> <span class="s">com.mysql.cj.jdbc.Driver</span>
</span></span><span class="line"><span class="cl"><span class="c1"># jdbc.url= jdbc:mysql://localhost:3306/db2024?characterEncoding=utf8&amp;useSSL=false&amp;serverTimezone=GMT%2B8&amp;rewriteBatchedStatements=true&amp;allowPublicKeyRetrieval=true</span>
</span></span><span class="line"><span class="cl"><span class="c1"># jdbc.url= jdbc:mysql://localhost:3306/seata_order?characterEncoding=utf8&amp;useSSL=false&amp;serverTimezone=GMT%2B8&amp;rewriteBatchedStatements=true&amp;allowPublicKeyRetrieval=true</span>
</span></span><span class="line"><span class="cl"><span class="c1"># jdbc.url= jdbc:mysql://localhost:3306/seata_storage?characterEncoding=utf8&amp;useSSL=false&amp;serverTimezone=GMT%2B8&amp;rewriteBatchedStatements=true&amp;allowPublicKeyRetrieval=true</span>
</span></span><span class="line"><span class="cl"><span class="na">jdbc.url</span><span class="o">=</span> <span class="s">jdbc:mysql://localhost:3306/seata_account?characterEncoding=utf8&amp;useSSL=false&amp;serverTimezone=GMT%2B8&amp;rewriteBatchedStatements=true&amp;allowPublicKeyRetrieval=true</span>
</span></span><span class="line"><span class="cl"><span class="na">jdbc.user</span> <span class="o">=</span> <span class="s">root</span>
</span></span><span class="line"><span class="cl"><span class="na">jdbc.password</span> <span class="o">=</span><span class="s">527644117</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="generateconfigxml">generateConfig.xml
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span class="line"><span class="cl"><span class="cp">&lt;!DOCTYPE generatorConfiguration
</span></span></span><span class="line"><span class="cl"><span class="cp">        PUBLIC &#34;-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN&#34;
</span></span></span><span class="line"><span class="cl"><span class="cp">        &#34;http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd&#34;&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">&lt;generatorConfiguration&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;properties</span> <span class="na">resource=</span><span class="s">&#34;config.properties&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;context</span> <span class="na">id=</span><span class="s">&#34;Mysql&#34;</span> <span class="na">targetRuntime=</span><span class="s">&#34;MyBatis3Simple&#34;</span> <span class="na">defaultModelType=</span><span class="s">&#34;flat&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;beginningDelimiter&#34;</span> <span class="na">value=</span><span class="s">&#34;`&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;endingDelimiter&#34;</span> <span class="na">value=</span><span class="s">&#34;`&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;plugin</span> <span class="na">type=</span><span class="s">&#34;tk.mybatis.mapper.generator.MapperPlugin&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;mappers&#34;</span> <span class="na">value=</span><span class="s">&#34;tk.mybatis.mapper.common.Mapper&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;caseSensitive&#34;</span> <span class="na">value=</span><span class="s">&#34;true&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/plugin&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;jdbcConnection</span> <span class="na">driverClass=</span><span class="s">&#34;${jdbc.driverClass}&#34;</span>
</span></span><span class="line"><span class="cl">                        <span class="na">connectionURL=</span><span class="s">&#34;${jdbc.url}&#34;</span>
</span></span><span class="line"><span class="cl">                        <span class="na">userId=</span><span class="s">&#34;${jdbc.user}&#34;</span>
</span></span><span class="line"><span class="cl">                        <span class="na">password=</span><span class="s">&#34;${jdbc.password}&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/jdbcConnection&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;javaModelGenerator</span> <span class="na">targetPackage=</span><span class="s">&#34;${package.name}.entities&#34;</span> <span class="na">targetProject=</span><span class="s">&#34;src/main/java&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;sqlMapGenerator</span> <span class="na">targetPackage=</span><span class="s">&#34;${package.name}.mapper&#34;</span> <span class="na">targetProject=</span><span class="s">&#34;src/main/java&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;javaClientGenerator</span> <span class="na">targetPackage=</span><span class="s">&#34;${package.name}.mapper&#34;</span> <span class="na">targetProject=</span><span class="s">&#34;src/main/java&#34;</span> <span class="na">type=</span><span class="s">&#34;XMLMAPPER&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c">&lt;!--&lt;table tableName=&#34;t_pay&#34; domainObjectName=&#34;Pay&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="c">            &lt;generatedKey column=&#34;id&#34; sqlStatement=&#34;JDBC&#34;/&gt;
</span></span></span><span class="line"><span class="cl"><span class="c">        &lt;/table&gt;--&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c">&lt;!-- seata_order --&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="c">&lt;!--&lt;table tableName=&#34;t_order&#34; domainObjectName=&#34;Order&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="c">            &lt;generatedKey column=&#34;id&#34; sqlStatement=&#34;JDBC&#34;/&gt;
</span></span></span><span class="line"><span class="cl"><span class="c">        &lt;/table&gt;--&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c">&lt;!-- seate_storage --&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="c">&lt;!--&lt;table tableName=&#34;t_storage&#34; domainObjectName=&#34;Storage&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="c">            &lt;generatedKey column=&#34;id&#34; sqlStatement=&#34;JDBC&#34;/&gt;
</span></span></span><span class="line"><span class="cl"><span class="c">        &lt;/table&gt;--&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c">&lt;!-- seate_account --&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;table</span> <span class="na">tableName=</span><span class="s">&#34;t_account&#34;</span> <span class="na">domainObjectName=</span><span class="s">&#34;Account&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;generatedKey</span> <span class="na">column=</span><span class="s">&#34;id&#34;</span> <span class="na">sqlStatement=</span><span class="s">&#34;JDBC&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/table&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/context&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/generatorConfiguration&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="cloud-api-commonsinstall为jar包供其它微服务使用openfeignopenfeignsentinel">cloud-api-commons（install为jar包供其它微服务使用、OpenFeign、OpenFeign+Sentinel）
</h2><h3 id="pom-1">pom
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependencies&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--SpringBoot通用依赖模块--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-actuator<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.projectlombok<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>lombok<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--hutool--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>cn.hutool<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>hutool-all<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--openfeign--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-openfeign<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependencies&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="apis">apis
</h3><h4 id="payfeignapi">PayFeignAPi
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 微服务提供者8001对外暴露接口
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// @FeignClient(&#34;cloud-payment-service&#34;)  // 就是去注册中心的指定微服务上找相同uri然后调用相应的微服务方法</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@FeignClient</span><span class="p">(</span><span class="s">&#34;cloud-gateway&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">  此时再关闭网关
</span></span></span><span class="line"><span class="cl"><span class="cm">  {
</span></span></span><span class="line"><span class="cl"><span class="cm">      &#34;code&#34;: &#34;500&#34;,
</span></span></span><span class="line"><span class="cl"><span class="cm">      &#34;message&#34;: &#34;[503] during [GET] to [http://cloud-gateway/pay/gateway/info] [PayFeignAPi#getGatewayInfo()]: [Load balancer does not contain an instance for the service cloud-gateway]&#34;,
</span></span></span><span class="line"><span class="cl"><span class="cm">      &#34;data&#34;: null,
</span></span></span><span class="line"><span class="cl"><span class="cm">      &#34;timestamp&#34;: 1733728892254
</span></span></span><span class="line"><span class="cl"><span class="cm">  }
</span></span></span><span class="line"><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="cl"><span class="cm">  再开启网关
</span></span></span><span class="line"><span class="cl"><span class="cm">  {
</span></span></span><span class="line"><span class="cl"><span class="cm">    &#34;code&#34;: &#34;200&#34;,
</span></span></span><span class="line"><span class="cl"><span class="cm">    &#34;message&#34;: &#34;success&#34;,
</span></span></span><span class="line"><span class="cl"><span class="cm">    &#34;data&#34;: &#34;gateway info test: 5e6f3b3eb1d845f5bc86bbd759bd9084&#34;,
</span></span></span><span class="line"><span class="cl"><span class="cm">    &#34;timestamp&#34;: 1733728974072
</span></span></span><span class="line"><span class="cl"><span class="cm">  }
</span></span></span><span class="line"><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="cl"><span class="cm">  现在三个url都可以访问服务：
</span></span></span><span class="line"><span class="cl"><span class="cm">  http://localhost:8001/pay/gateway/info
</span></span></span><span class="line"><span class="cl"><span class="cm">  http://localhost:9527/pay/gateway/info
</span></span></span><span class="line"><span class="cl"><span class="cm">  http://localhost:80/feign/pay/gateway/info
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">PayFeignAPi</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 增加一条支付相关流水记录
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param payDTO
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&#34;/pay/add&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ResultData</span><span class="w"> </span><span class="nf">addPay</span><span class="p">(</span><span class="nd">@RequestBody</span><span class="w"> </span><span class="n">PayDTO</span><span class="w"> </span><span class="n">payDTO</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 按照主键记录查询支付流水信息
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param id
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/pay/get/{id}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ResultData</span><span class="w"> </span><span class="nf">getPayInfo</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&#34;id&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * openfeign天然支持负载均衡演示
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/pay/get/info&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="nf">mylb</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/pay/circuit/{id}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="nf">myCircuit</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&#34;id&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/pay/bulkhead/{id}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="nf">myBulkhead</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&#34;id&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/pay/ratelimit/{id}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="nf">myRatelimit</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&#34;id&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/pay/micrometer/{id}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="nf">myMicrometer</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&#34;id&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/pay/gateway/get/{id}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ResultData</span><span class="w"> </span><span class="nf">getById</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&#34;id&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/pay/gateway/info&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ResultData</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getGatewayInfo</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="payfeignsentinelapiopenfeignsentinel">PayFeignSentinelAPi：OpenFeign+Sentinel
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@FeignClient</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;nacos-payment-provider&#34;</span><span class="p">,</span><span class="n">fallback</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PayFeignSentinelApiFallBack</span><span class="p">.</span><span class="na">class</span><span class="p">)</span><span class="w">  </span><span class="c1">// 谁提供服务写谁/转发给谁写谁</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">PayFeignSentinelApi</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/pay/nacos/get/{orderNo}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ResultData</span><span class="w"> </span><span class="nf">getPayByOrderNo</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&#34;orderNo&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">orderNo</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="payfeignsentinelapifallback">PayFeignSentinelApiFallBack
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Component</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">PayFeignSentinelApiFallBack</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">PayFeignSentinelApi</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ResultData</span><span class="w"> </span><span class="nf">getPayByOrderNo</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">orderNo</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ResultData</span><span class="p">.</span><span class="na">fail</span><span class="p">(</span><span class="n">ReturnCodeEnum</span><span class="p">.</span><span class="na">RC500</span><span class="p">.</span><span class="na">getCode</span><span class="p">(),</span><span class="w"> </span><span class="s">&#34;对方服务宕机或不可用，FallBack服务降级&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="storagefeignapi">StorageFeignApi
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@FeignClient</span><span class="p">(</span><span class="s">&#34;seata-storage-service&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">StorageFeignApi</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 扣减库存
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;storage/decrease&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ResultData</span><span class="w"> </span><span class="nf">decrease</span><span class="p">(</span><span class="nd">@RequestParam</span><span class="p">(</span><span class="s">&#34;productId&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">productId</span><span class="p">,</span><span class="w"> </span><span class="nd">@RequestParam</span><span class="p">(</span><span class="s">&#34;count&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">count</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="accountfeignapi">AccountFeignAPi
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@FeignClient</span><span class="p">(</span><span class="s">&#34;seata-account-service&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">AccountFeignAPi</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 扣减余额
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/account/decrease&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ResultData</span><span class="w"> </span><span class="nf">decrease</span><span class="p">(</span><span class="nd">@RequestParam</span><span class="p">(</span><span class="s">&#34;userId&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">userId</span><span class="p">,</span><span class="w"> </span><span class="nd">@RequestParam</span><span class="p">(</span><span class="s">&#34;money&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">money</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="entitiespaydto">entities.PayDTO
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * DTO（数据传输对象）
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 目的：DTO 主要用于数据传输，尤其是在分布式系统或不同层之间传递数据时。它通常是从数据库或服务中提取的数据对象，经过加工后用于传输。
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 特性：
</span></span></span><span class="line"><span class="cl"><span class="cm"> *      主要用于不同系统、模块之间的通信，避免传递过多的细节。
</span></span></span><span class="line"><span class="cl"><span class="cm"> *      可能包含冗余数据或不同领域的数据，目的是为了提高传输效率。
</span></span></span><span class="line"><span class="cl"><span class="cm"> *      DTO 通常是无业务逻辑的，仅作为数据的载体。
</span></span></span><span class="line"><span class="cl"><span class="cm"> *      可以是可变的，通常包含 setter 和 getter 方法。
</span></span></span><span class="line"><span class="cl"><span class="cm"> *
</span></span></span><span class="line"><span class="cl"><span class="cm"> * dto中的字段实体类中一定存在，vo中的字段实体类中不一定存在
</span></span></span><span class="line"><span class="cl"><span class="cm"> * dto是前端传给后端的，vo是后端传给前端的
</span></span></span><span class="line"><span class="cl"><span class="cm"> *
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 一般而言，调用者不应该获悉服务提供者的entity资源并知道表结构关系，所以服务提供方给出的接口文档都应为DTO
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Data</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@NoArgsConstructor</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@AllArgsConstructor</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">PayDTO</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Serializable</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 支付流水号</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">payNo</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 订单流水号</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">orderNo</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 用户账号ID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">userId</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 交易金额</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">amount</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="expglobalexceptionhandler">exp.GlobalExceptionHandler
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 全局异常
</span></span></span><span class="line"><span class="cl"><span class="cm"> *
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @ControllerAdvice 是一个用于处理全局异常的类注解，它可以捕获所有控制器中的异常并统一处理。
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 如果希望返回视图而不是直接返回 JSON，可以使用 @ControllerAdvice。
</span></span></span><span class="line"><span class="cl"><span class="cm"> *
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @RestControllerAdvice 是 @ControllerAdvice 和 @ResponseBody 的组合，它适用于返回 JSON 或其他对象响应体的情况。通常用于 RESTful 风格的 Web 服务中。
</span></span></span><span class="line"><span class="cl"><span class="cm"> *
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @RestControllerAdvice（或 @ControllerAdvice）
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 这个注解的作用是将类标记为全局异常处理器，即所有控制器中的异常都会通过这个类来统一处理。它本身并不直接指定处理哪种类型的异常，而是用来指示一个类是用来处理异常的。
</span></span></span><span class="line"><span class="cl"><span class="cm"> *
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @ExceptionHandler(RuntimeException.class)
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 这个注解是用来处理 特定类型的异常 的。它通常放在一个异常处理方法上，指定该方法捕获 RuntimeException 类型的异常。
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @ExceptionHandler 可以放在任何控制器类或者 @ControllerAdvice 类中，它用来拦截并处理指定类型的异常。
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Slf4j</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@RestControllerAdvice</span><span class="w">  </span><span class="c1">// 该类会对所有的控制器类进行增强处理，并且方法的返回值会直接转换成响应体的内容，标记 GlobalExceptionHandler 类是用来处理异常的</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">GlobalExceptionHandler</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@ExceptionHandler</span><span class="p">(</span><span class="n">RuntimeException</span><span class="p">.</span><span class="na">class</span><span class="p">)</span><span class="w">  </span><span class="c1">// 标明当发生 RuntimeException 时，exception 方法会被调用，返回统一的错误响应。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@ResponseStatus</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">INTERNAL_SERVER_ERROR</span><span class="p">)</span><span class="w">  </span><span class="c1">// 当这个异常被捕获时，HTTP 响应的状态码会设置为 500（内部服务器错误）。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ResultData</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">exception</span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;come in GlobalExceptionHandler&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 2024-12-04T18:41:14.992+08:00 ERROR 12528 --- [cloud-payment-service] [io-8001-exec-10] c.x.s.exp.GlobalExceptionHandler         : 全局异常信息：id不能为负数</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&#34;全局异常信息：{}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">(),</span><span class="w"> </span><span class="n">e</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ResultData</span><span class="p">.</span><span class="na">fail</span><span class="p">(</span><span class="n">ReturnCodeEnum</span><span class="p">.</span><span class="na">RC500</span><span class="p">.</span><span class="na">getCode</span><span class="p">(),</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">        {
</span></span></span><span class="line"><span class="cl"><span class="cm">            &#34;code&#34;: &#34;500&#34;,
</span></span></span><span class="line"><span class="cl"><span class="cm">            &#34;message&#34;: &#34;id不能为负数&#34;,
</span></span></span><span class="line"><span class="cl"><span class="cm">            &#34;data&#34;: null,
</span></span></span><span class="line"><span class="cl"><span class="cm">            &#34;timestamp&#34;: 1733308874996
</span></span></span><span class="line"><span class="cl"><span class="cm">        }
</span></span></span><span class="line"><span class="cl"><span class="cm">         */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="resp">resp
</h3><h4 id="resultdata">ResultData
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 返回对象
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 定义返回格式：
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 3大标准：
</span></span></span><span class="line"><span class="cl"><span class="cm"> * code：由后端统一定义各种返回结果的状态码
</span></span></span><span class="line"><span class="cl"><span class="cm"> * message：本次接口调用的结果描述
</span></span></span><span class="line"><span class="cl"><span class="cm"> * data：本次返回的数据
</span></span></span><span class="line"><span class="cl"><span class="cm"> * timestamp：接口调用的时间
</span></span></span><span class="line"><span class="cl"><span class="cm"> *
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @param &lt;T&gt;
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Data</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Accessors</span><span class="p">(</span><span class="n">chain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span><span class="w">  </span><span class="c1">// 链式编程</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ResultData</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">code</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">message</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="n">data</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">timestamp</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">ResultData</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 为什么需要显式声明 &lt;T&gt;？
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 静态方法和实例方法的区别：
</span></span></span><span class="line"><span class="cl"><span class="cm">     *      ResultData&lt;T&gt; 是一个泛型类，而 success(T data) 是静态方法。静态方法与类的实例无关，因此它无法直接访问类的实例化泛型类型。为了解决这个问题，静态方法需要自己声明泛型类型。
</span></span></span><span class="line"><span class="cl"><span class="cm">     *      如果 success 方法是实例方法（即不加 static），那么它可以访问类级别的泛型 T，不需要再显式声明 &lt;T&gt;。但由于 success 是静态方法，它没有类实例，因此无法直接使用类的泛型类型。
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ResultData</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">success</span><span class="p">(</span><span class="n">T</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ResultData</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">resultData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ResultData</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">resultData</span><span class="p">.</span><span class="na">setCode</span><span class="p">(</span><span class="n">ReturnCodeEnum</span><span class="p">.</span><span class="na">RC200</span><span class="p">.</span><span class="na">getCode</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">resultData</span><span class="p">.</span><span class="na">setMessage</span><span class="p">(</span><span class="n">ReturnCodeEnum</span><span class="p">.</span><span class="na">RC200</span><span class="p">.</span><span class="na">getMessage</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">resultData</span><span class="p">.</span><span class="na">setData</span><span class="p">(</span><span class="n">data</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">resultData</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ResultData</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">fail</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">code</span><span class="p">,</span><span class="n">String</span><span class="w"> </span><span class="n">message</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ResultData</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">resultData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ResultData</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">resultData</span><span class="p">.</span><span class="na">setCode</span><span class="p">(</span><span class="n">code</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">resultData</span><span class="p">.</span><span class="na">setMessage</span><span class="p">(</span><span class="n">message</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">resultData</span><span class="p">.</span><span class="na">setData</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">resultData</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="returncodeenum">ReturnCodeEnum
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * HTTP返回的状态码
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Getter</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">enum</span><span class="w"> </span><span class="n">ReturnCodeEnum</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 1、举值</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**操作失败**/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">RC999</span><span class="p">(</span><span class="s">&#34;999&#34;</span><span class="p">,</span><span class="s">&#34;操作XXX失败&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**操作成功**/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">RC200</span><span class="p">(</span><span class="s">&#34;200&#34;</span><span class="p">,</span><span class="s">&#34;success&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**服务降级**/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">RC201</span><span class="p">(</span><span class="s">&#34;201&#34;</span><span class="p">,</span><span class="s">&#34;服务开启降级保护,请稍后再试!&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**热点参数限流**/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">RC202</span><span class="p">(</span><span class="s">&#34;202&#34;</span><span class="p">,</span><span class="s">&#34;热点参数限流,请稍后再试!&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**系统规则不满足**/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">RC203</span><span class="p">(</span><span class="s">&#34;203&#34;</span><span class="p">,</span><span class="s">&#34;系统规则不满足要求,请稍后再试!&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**授权规则不通过**/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">RC204</span><span class="p">(</span><span class="s">&#34;204&#34;</span><span class="p">,</span><span class="s">&#34;授权规则不通过,请稍后再试!&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">RC375</span><span class="p">(</span><span class="s">&#34;375&#34;</span><span class="p">,</span><span class="s">&#34;数学运算异常，请稍后重试&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**access_denied**/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">RC403</span><span class="p">(</span><span class="s">&#34;403&#34;</span><span class="p">,</span><span class="s">&#34;无访问权限,请联系管理员授予权限&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**access_denied**/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">RC401</span><span class="p">(</span><span class="s">&#34;401&#34;</span><span class="p">,</span><span class="s">&#34;匿名用户访问无权限资源时的异常&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">RC404</span><span class="p">(</span><span class="s">&#34;404&#34;</span><span class="p">,</span><span class="s">&#34;404页面找不到的异常&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**服务异常**/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">RC500</span><span class="p">(</span><span class="s">&#34;500&#34;</span><span class="p">,</span><span class="s">&#34;系统异常，请稍后重试&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">INVALID_TOKEN</span><span class="p">(</span><span class="s">&#34;2001&#34;</span><span class="p">,</span><span class="s">&#34;访问令牌不合法&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ACCESS_DENIED</span><span class="p">(</span><span class="s">&#34;2003&#34;</span><span class="p">,</span><span class="s">&#34;没有权限访问该资源&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">CLIENT_AUTHENTICATION_FAILED</span><span class="p">(</span><span class="s">&#34;1001&#34;</span><span class="p">,</span><span class="s">&#34;客户端认证失败&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">USERNAME_OR_PASSWORD_ERROR</span><span class="p">(</span><span class="s">&#34;1002&#34;</span><span class="p">,</span><span class="s">&#34;用户名或密码错误&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">BUSINESS_ERROR</span><span class="p">(</span><span class="s">&#34;1004&#34;</span><span class="p">,</span><span class="s">&#34;业务逻辑异常&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">UNSUPPORTED_GRANT_TYPE</span><span class="p">(</span><span class="s">&#34;1003&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;不支持的认证模式&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 2、构造</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**自定义状态码**/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">code</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**自定义描述**/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">message</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ReturnCodeEnum</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">code</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">message</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">code</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">message</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 3、传统遍历</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">ReturnCodeEnum</span><span class="w"> </span><span class="nf">getReturnCodeEnumV1</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">code</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">ReturnCodeEnum</span><span class="w"> </span><span class="n">element</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">ReturnCodeEnum</span><span class="p">.</span><span class="na">values</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">element</span><span class="p">.</span><span class="na">getCode</span><span class="p">().</span><span class="na">equalsIgnoreCase</span><span class="p">(</span><span class="n">code</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">element</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 3、流式计算遍历</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">ReturnCodeEnum</span><span class="w"> </span><span class="nf">getReturnCodeEnumV2</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">code</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Arrays</span><span class="p">.</span><span class="na">stream</span><span class="p">(</span><span class="n">ReturnCodeEnum</span><span class="p">.</span><span class="na">values</span><span class="p">()).</span><span class="na">filter</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="na">getCode</span><span class="p">().</span><span class="na">equalsIgnoreCase</span><span class="p">(</span><span class="n">code</span><span class="p">)).</span><span class="na">findFirst</span><span class="p">().</span><span class="na">orElse</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// public static void main(String[] args)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// {</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//     System.out.println(getReturnCodeEnumV2(&#34;200&#34;));  // RC200这条枚举记录（RC200(&#34;200&#34;,&#34;success&#34;)）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//     System.out.println(getReturnCodeEnumV2(&#34;200&#34;).getCode());  // 200</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//     System.out.println(getReturnCodeEnumV2(&#34;200&#34;).getMessage());  // success</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// }</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h1 id="heading">……………………………………………………………………
</h1><h2 id="cloud-provider-payment8001service">cloud-provider-payment8001（service）
</h2><h3 id="pom-2">pom
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependencies&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--SpringBoot通用依赖模块--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-actuator<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--SpringBoot集成druid连接池--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>com.alibaba<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>druid-spring-boot-starter<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- Swagger3 调用方式 http://localhost:8001/swagger-ui/index.html --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.springdoc<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>springdoc-openapi-starter-webmvc-ui<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--mybatis和springboot整合--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.mybatis.spring.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>mybatis-spring-boot-starter<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--Mysql数据库驱动8 --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>mysql<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>mysql-connector-java<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--persistence--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>javax.persistence<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>persistence-api<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--通用Mapper4--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>tk.mybatis<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>mapper<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--hutool--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>cn.hutool<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>hutool-all<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- fastjson2 --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>com.alibaba.fastjson2<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>fastjson2<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--lombok--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.projectlombok<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>lombok<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;scope&gt;</span>provided<span class="nt">&lt;/scope&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--test--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-test<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--SpringCloud consul discovery --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-consul-discovery<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--SpringCloud consul config--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-consul-config<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-bootstrap<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- 引入cloud-api-commons通用包 --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>com.xz.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>cloud-api-commons<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--micrometer-tracing指标追踪  2--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>io.micrometer<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>micrometer-tracing<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--micrometer-tracing-bridge-brave适配zipkin的桥接包 3--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>io.micrometer<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>micrometer-tracing-bridge-brave<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--micrometer-observation 4--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>io.micrometer<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>micrometer-observation<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--feign-micrometer 5--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>io.github.openfeign<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>feign-micrometer<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--zipkin-reporter-brave 6--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>io.zipkin.reporter2<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>zipkin-reporter-brave<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependencies&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">&lt;build&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;plugins&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;plugin&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;artifactId&gt;</span>spring-boot-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/plugin&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/plugins&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/build&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="yml">yml
</h3><h4 id="bootstrappom需要引入springcloud-consul-configbootstrapconsulmicrometerzipkin">bootstrap：pom需要引入SpringCloud consul config、bootstrap、Consul、Micrometer+ZipKin
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yml" data-lang="yml"><span class="line"><span class="cl"><span class="c"># application.yml是用户级的资源配置项</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># bootstrap.yml是系统级的，优先级更加高</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># Spring Cloud会创建一个“Bootstrap Context”，作为Spring应用的`Application Context`的父上下文。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># 初始化的时候，`Bootstrap Context`负责从外部源加载配置属性并解析配置。这两个上下文共享一个从外部获取的`Environment`。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># Bootstrap`属性有高优先级，默认情况下，它们不会被本地配置覆盖。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># `Bootstrap context`和`Application Context`有着不同的约定，所以新增了一个`bootstrap.yml`文件，保证`Bootstrap Context`和`Application Context`配置的分离。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># application.yml文件改为bootstrap.yml,这是很关键的或者两者共存</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># 因为bootstrap.yml是比application.yml先加载的。bootstrap.yml优先级高于application.yml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spring</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">application</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">cloud-payment-service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c"># Spring Cloud Consul for Service Discovery</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">cloud</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">consul</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l">localhost</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">8500</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">discovery</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">service-name</span><span class="p">:</span><span class="w"> </span><span class="l">${spring.application.name} </span><span class="w"> </span><span class="c"># 8001以此名字入驻consul</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">config</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">profile-separator</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;-&#39;</span><span class="w">  </span><span class="c"># default value is &#34;,&#34;, We update &#34;-&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="l">yaml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">management</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">zipkin</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">tracing</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">endpoint</span><span class="p">:</span><span class="w"> </span><span class="l">http://localhost:9411/api/v2/spans </span><span class="w"> </span><span class="c"># 固定写法</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">tracing</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">sampling</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">probability</span><span class="p">:</span><span class="w"> </span><span class="m">1.0</span><span class="w">  </span><span class="c"># 采样率默认为0.1，即十次只能有一次被记录下，值越大收集越及时</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="application">application
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yml" data-lang="yml"><span class="line"><span class="cl"><span class="nt">server</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">8001</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># ==========applicationName + druid-mysql8 driver===================</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spring</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">datasource</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">com.alibaba.druid.pool.DruidDataSource</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">driver-class-name</span><span class="p">:</span><span class="w"> </span><span class="l">com.mysql.cj.jdbc.Driver</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">jdbc:mysql://localhost:3306/db2024?characterEncoding=utf8&amp;useSSL=false&amp;serverTimezone=GMT%2B8&amp;rewriteBatchedStatements=true&amp;allowPublicKeyRetrieval=true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l">root</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="m">527644117</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">profiles</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">active</span><span class="p">:</span><span class="w"> </span><span class="l">dev </span><span class="w"> </span><span class="c"># 多环境Consul配置加载内容dev/prod，不写就是default配置</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># ========================mybatis===================</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">mybatis</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">mapper-locations</span><span class="p">:</span><span class="w"> </span><span class="l">classpath:mapper/*.xml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">type-aliases-package</span><span class="p">:</span><span class="w"> </span><span class="l">com.xz.springcloud.entities</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">configuration</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">map-underscore-to-camel-case</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="resourcesmapperpaymapperxml">resources.mapper.PayMapper.xml
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span class="line"><span class="cl"><span class="cp">&lt;!DOCTYPE mapper PUBLIC &#34;-//mybatis.org//DTD Mapper 3.0//EN&#34; &#34;http://mybatis.org/dtd/mybatis-3-mapper.dtd&#34;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;mapper</span> <span class="na">namespace=</span><span class="s">&#34;com.xz.springcloud.mapper.PayMapper&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">&#34;BaseResultMap&#34;</span> <span class="na">type=</span><span class="s">&#34;com.xz.springcloud.entities.Pay&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--
</span></span></span><span class="line"><span class="cl"><span class="c">      WARNING - @mbg.generated
</span></span></span><span class="line"><span class="cl"><span class="c">    --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;id</span> <span class="na">column=</span><span class="s">&#34;id&#34;</span> <span class="na">jdbcType=</span><span class="s">&#34;INTEGER&#34;</span> <span class="na">property=</span><span class="s">&#34;id&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;result</span> <span class="na">column=</span><span class="s">&#34;pay_no&#34;</span> <span class="na">jdbcType=</span><span class="s">&#34;VARCHAR&#34;</span> <span class="na">property=</span><span class="s">&#34;payNo&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;result</span> <span class="na">column=</span><span class="s">&#34;order_no&#34;</span> <span class="na">jdbcType=</span><span class="s">&#34;VARCHAR&#34;</span> <span class="na">property=</span><span class="s">&#34;orderNo&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;result</span> <span class="na">column=</span><span class="s">&#34;user_id&#34;</span> <span class="na">jdbcType=</span><span class="s">&#34;INTEGER&#34;</span> <span class="na">property=</span><span class="s">&#34;userId&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;result</span> <span class="na">column=</span><span class="s">&#34;amount&#34;</span> <span class="na">jdbcType=</span><span class="s">&#34;DECIMAL&#34;</span> <span class="na">property=</span><span class="s">&#34;amount&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;result</span> <span class="na">column=</span><span class="s">&#34;deleted&#34;</span> <span class="na">jdbcType=</span><span class="s">&#34;TINYINT&#34;</span> <span class="na">property=</span><span class="s">&#34;deleted&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;result</span> <span class="na">column=</span><span class="s">&#34;create_time&#34;</span> <span class="na">jdbcType=</span><span class="s">&#34;TIMESTAMP&#34;</span> <span class="na">property=</span><span class="s">&#34;createTime&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;result</span> <span class="na">column=</span><span class="s">&#34;update_time&#34;</span> <span class="na">jdbcType=</span><span class="s">&#34;TIMESTAMP&#34;</span> <span class="na">property=</span><span class="s">&#34;updateTime&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/resultMap&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/mapper&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="main8001">Main8001
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@SpringBootApplication</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@MapperScan</span><span class="p">(</span><span class="s">&#34;com.xz.springcloud.mapper&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Main8001</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">SpringApplication</span><span class="p">.</span><span class="na">run</span><span class="p">(</span><span class="n">Main8001</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">          微服务：
</span></span></span><span class="line"><span class="cl"><span class="cm">           1、建module
</span></span></span><span class="line"><span class="cl"><span class="cm">           2、改pom
</span></span></span><span class="line"><span class="cl"><span class="cm">           3、写yml
</span></span></span><span class="line"><span class="cl"><span class="cm">           4、主启动
</span></span></span><span class="line"><span class="cl"><span class="cm">           5、业务类
</span></span></span><span class="line"><span class="cl"><span class="cm">         */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">           入驻consul（服务注册中心）：
</span></span></span><span class="line"><span class="cl"><span class="cm">            1、pom
</span></span></span><span class="line"><span class="cl"><span class="cm">            2、yml
</span></span></span><span class="line"><span class="cl"><span class="cm">         */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="configswagger3config">config.Swagger3Config
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Configuration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Swagger3Config</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 分组API</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Bean</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">GroupedOpenApi</span><span class="w"> </span><span class="nf">PayApi</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">GroupedOpenApi</span><span class="p">.</span><span class="na">builder</span><span class="p">().</span><span class="na">group</span><span class="p">(</span><span class="s">&#34;支付微服务模块&#34;</span><span class="p">).</span><span class="na">pathsToMatch</span><span class="p">(</span><span class="s">&#34;/pay/**&#34;</span><span class="p">).</span><span class="na">build</span><span class="p">();</span><span class="w">  </span><span class="c1">// 以pay开头</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Bean</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">GroupedOpenApi</span><span class="w"> </span><span class="nf">OtherApi</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">GroupedOpenApi</span><span class="p">.</span><span class="na">builder</span><span class="p">().</span><span class="na">group</span><span class="p">(</span><span class="s">&#34;其它微服务模块&#34;</span><span class="p">).</span><span class="na">pathsToMatch</span><span class="p">(</span><span class="s">&#34;/other/**&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;/others&#34;</span><span class="p">).</span><span class="na">build</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">    @Bean
</span></span></span><span class="line"><span class="cl"><span class="cm">    public GroupedOpenApi CustomerApi()
</span></span></span><span class="line"><span class="cl"><span class="cm">    {
</span></span></span><span class="line"><span class="cl"><span class="cm">        return GroupedOpenApi.builder().group(&#34;客户微服务模块&#34;).pathsToMatch(&#34;/customer/**&#34;, &#34;/customers&#34;).build();
</span></span></span><span class="line"><span class="cl"><span class="cm">    }
</span></span></span><span class="line"><span class="cl"><span class="cm">    */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Bean</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">OpenAPI</span><span class="w"> </span><span class="nf">docsOpenApi</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">OpenAPI</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Info</span><span class="p">().</span><span class="na">title</span><span class="p">(</span><span class="s">&#34;cloud2024&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="p">.</span><span class="na">description</span><span class="p">(</span><span class="s">&#34;通用设计rest&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="p">.</span><span class="na">version</span><span class="p">(</span><span class="s">&#34;v1.0&#34;</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">externalDocs</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">ExternalDocumentation</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="p">.</span><span class="na">description</span><span class="p">(</span><span class="s">&#34;www.atguigu.com&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="p">.</span><span class="na">url</span><span class="p">(</span><span class="s">&#34;https://yiyan.baidu.com/&#34;</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="controller">controller
</h3><h4 id="paycontroller基础的增删改查获取consul中配置的kvswagger3注解">PayController：基础的增删改查、获取Consul中配置的kv、Swagger3注解
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span><span class="lnt">94
</span><span class="lnt">95
</span><span class="lnt">96
</span><span class="lnt">97
</span><span class="lnt">98
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Swagger3常用注解：</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// @Tag 标注位置：controller类：表示controller作用</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// @Operation 标注位置：方法：描述方法作用</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// @Schema 标注位置：model层的JavaBean：描述模型作用及每个属性</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Tag</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;支付微服务模块&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;支付CRUD&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@RestController</span><span class="w">  </span><span class="c1">// @Controller + @ResponseBody</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Slf4j</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&#34;/pay&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">PayController</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Resource</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">PayService</span><span class="w"> </span><span class="n">payService</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&#34;/add&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Operation</span><span class="p">(</span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;新增&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;新增支付流水方法，json作参数&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ResultData</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">addPay</span><span class="p">(</span><span class="nd">@RequestBody</span><span class="w"> </span><span class="n">Pay</span><span class="w"> </span><span class="n">pay</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">payService</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">pay</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ResultData</span><span class="p">.</span><span class="na">success</span><span class="p">(</span><span class="s">&#34;成功插入记录了，返回：&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@DeleteMapping</span><span class="p">(</span><span class="s">&#34;/del/{id}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Operation</span><span class="p">(</span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;删除&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;删除支付流水方法&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ResultData</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">deletePay</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&#34;id&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ResultData</span><span class="p">.</span><span class="na">success</span><span class="p">(</span><span class="s">&#34;成功删除记录：&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">payService</span><span class="p">.</span><span class="na">delete</span><span class="p">(</span><span class="n">id</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@PutMapping</span><span class="p">(</span><span class="s">&#34;/update&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Operation</span><span class="p">(</span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;修改&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;修改支付流水方法&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ResultData</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">updatePay</span><span class="p">(</span><span class="nd">@RequestBody</span><span class="w"> </span><span class="n">PayDTO</span><span class="w"> </span><span class="n">payDTO</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 与前端交互只能用PayDTO，到controller要将其封装为Pay再传给后端</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Pay</span><span class="w"> </span><span class="n">pay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Pay</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">BeanUtils</span><span class="p">.</span><span class="na">copyProperties</span><span class="p">(</span><span class="n">payDTO</span><span class="p">,</span><span class="w"> </span><span class="n">pay</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ResultData</span><span class="p">.</span><span class="na">success</span><span class="p">(</span><span class="s">&#34;成功修改记录：&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">payService</span><span class="p">.</span><span class="na">update</span><span class="p">(</span><span class="n">pay</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/get/{id}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Operation</span><span class="p">(</span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;按照ID查询流水&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;查询支付流水方法&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ResultData</span><span class="o">&lt;</span><span class="n">Pay</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getPayById</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&#34;id&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// if (id == -4) throw new RuntimeException(&#34;id不能为负数&#34;);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 暂停62秒钟线程，测试Feign的默认调用超时时间</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">TimeUnit</span><span class="p">.</span><span class="na">SECONDS</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="n">62</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">InterruptedException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ResultData</span><span class="p">.</span><span class="na">success</span><span class="p">(</span><span class="n">payService</span><span class="p">.</span><span class="na">getById</span><span class="p">(</span><span class="n">id</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/get&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ResultData</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Pay</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="nf">getPay</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ResultData</span><span class="p">.</span><span class="na">success</span><span class="p">(</span><span class="n">payService</span><span class="p">.</span><span class="na">getAll</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/error&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ResultData</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getPayError</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Integer</span><span class="w"> </span><span class="n">integer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">200</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;come in payerror test&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">10</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">0</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">ResultData</span><span class="p">.</span><span class="na">fail</span><span class="p">(</span><span class="n">ReturnCodeEnum</span><span class="p">.</span><span class="na">RC500</span><span class="p">.</span><span class="na">getCode</span><span class="p">(),</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ResultData</span><span class="p">.</span><span class="na">success</span><span class="p">(</span><span class="n">integer</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">    {
</span></span></span><span class="line"><span class="cl"><span class="cm">        &#34;code&#34;: &#34;500&#34;,
</span></span></span><span class="line"><span class="cl"><span class="cm">        &#34;message&#34;: &#34;/ by zero&#34;,
</span></span></span><span class="line"><span class="cl"><span class="cm">        &#34;data&#34;: null,
</span></span></span><span class="line"><span class="cl"><span class="cm">        &#34;timestamp&#34;: 1733309250087
</span></span></span><span class="line"><span class="cl"><span class="cm">    }
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Value</span><span class="p">(</span><span class="s">&#34;${server.port}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">port</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/get/info&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getInfoByConsul</span><span class="p">(</span><span class="nd">@Value</span><span class="p">(</span><span class="s">&#34;${xz.info}&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">xzInfo</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="c1">// xz.info为写在Consul相应环境中的yaml key</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;xzInfo: &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xzInfo</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34; port: &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">port</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">            如果没有在Consul中配置相应的key：
</span></span></span><span class="line"><span class="cl"><span class="cm">            -&gt; {
</span></span></span><span class="line"><span class="cl"><span class="cm">                    &#34;code&#34;: &#34;500&#34;,
</span></span></span><span class="line"><span class="cl"><span class="cm">                    &#34;message&#34;: &#34;Could not resolve placeholder &#39;xz.info&#39; in value \&#34;${xz.info}\&#34;&#34;,
</span></span></span><span class="line"><span class="cl"><span class="cm">                    &#34;data&#34;: null,
</span></span></span><span class="line"><span class="cl"><span class="cm">                    &#34;timestamp&#34;: 1733376396579
</span></span></span><span class="line"><span class="cl"><span class="cm">                }
</span></span></span><span class="line"><span class="cl"><span class="cm">         */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="paycircuitcontroller">PayCircuitController
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RestController</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&#34;/pay&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">PayCircuitController</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * Resilience4j CircuitBreaker
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/circuit/{id}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">myCircuit</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&#34;id&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">-</span><span class="n">4</span><span class="p">)</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="s">&#34;id 不能为负数&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">9999</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">TimeUnit</span><span class="p">.</span><span class="na">SECONDS</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="n">5</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">InterruptedException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;Hello, circuit! &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;\t&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">IdUtil</span><span class="p">.</span><span class="na">simpleUUID</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * Resilience4j Bulkhead
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/bulkhead/{id}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">myBulkhead</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&#34;id&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">-</span><span class="n">4</span><span class="p">)</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="s">&#34;bulkhead id 不能为负数&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">9999</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">TimeUnit</span><span class="p">.</span><span class="na">SECONDS</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="n">5</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">InterruptedException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;Hello, bulkhead! &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;\t&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">IdUtil</span><span class="p">.</span><span class="na">simpleUUID</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * Resilience4j ratelimit
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/ratelimit/{id}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">myRatelimit</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&#34;id&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;Hello, ratelimit! &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;\t&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">IdUtil</span><span class="p">.</span><span class="na">simpleUUID</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="paymicrometercontroller">PayMicrometerController
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RestController</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&#34;/pay&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">PayMicrometerController</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/micrometer/{id}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">myMicrometer</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&#34;id&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;Hello, welcome to myMicrometer &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">IdUtil</span><span class="p">.</span><span class="na">simpleUUID</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="gatewaycontroller">GatewayController
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RestController</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&#34;/pay&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">PayGatewayController</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Resource</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">PayService</span><span class="w"> </span><span class="n">payService</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/gateway/get/{id}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ResultData</span><span class="o">&lt;</span><span class="n">Pay</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getById</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&#34;id&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Pay</span><span class="w"> </span><span class="n">pay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">payService</span><span class="p">.</span><span class="na">getById</span><span class="p">(</span><span class="n">id</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ResultData</span><span class="p">.</span><span class="na">success</span><span class="p">(</span><span class="n">pay</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/gateway/info&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ResultData</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getGatewayInfo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ResultData</span><span class="p">.</span><span class="na">success</span><span class="p">(</span><span class="s">&#34;gateway info test: &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">IdUtil</span><span class="p">.</span><span class="na">simpleUUID</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/gateway/filter&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ResultData</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getGatewayFilter</span><span class="p">(</span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Enumeration</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">headers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">getHeaderNames</span><span class="p">();</span><span class="w">  </span><span class="c1">// 获得请求头名字的集合类</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">headers</span><span class="p">.</span><span class="na">hasMoreElements</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">headName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">headers</span><span class="p">.</span><span class="na">nextElement</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">headValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">getHeader</span><span class="p">(</span><span class="n">headName</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;请求头名：&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">headName</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;\t\t&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;请求头值：&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">headValue</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">              ...
</span></span></span><span class="line"><span class="cl"><span class="cm">              请求头名：x-request-xz1       请求头值：xzVal1
</span></span></span><span class="line"><span class="cl"><span class="cm">              请求头名：x-request-xz2       请求头值：xzVal2
</span></span></span><span class="line"><span class="cl"><span class="cm">              ...
</span></span></span><span class="line"><span class="cl"><span class="cm">             */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">headName</span><span class="p">.</span><span class="na">equalsIgnoreCase</span><span class="p">(</span><span class="s">&#34;X-Request-xz1&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="o">||</span><span class="w"> </span><span class="n">headName</span><span class="p">.</span><span class="na">equalsIgnoreCase</span><span class="p">(</span><span class="s">&#34;X-Request-xz2&#34;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">headName</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;\t&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">headValue</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34; &#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;==============================================================&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">customerId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">getParameter</span><span class="p">(</span><span class="s">&#34;customerId&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;request Parameter customerId：&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">customerId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">customerName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">getParameter</span><span class="p">(</span><span class="s">&#34;customerName&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;request Parameter customerName：&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">customerName</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;==============================================================&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// request Parameter customerId：9527001</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// request Parameter customerName：null</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ResultData</span><span class="p">.</span><span class="na">success</span><span class="p">(</span><span class="s">&#34;getGatewayFilter 过滤器 test：&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;\t&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">DateUtil</span><span class="p">.</span><span class="na">now</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">        {
</span></span></span><span class="line"><span class="cl"><span class="cm">            &#34;code&#34;: &#34;200&#34;,
</span></span></span><span class="line"><span class="cl"><span class="cm">            &#34;message&#34;: &#34;success&#34;,
</span></span></span><span class="line"><span class="cl"><span class="cm">            &#34;data&#34;: &#34;getGatewayFilter 过滤器 test：x-request-xz1\txzVal1 x-request-xz2\txzVal2 \t2024-12-10 10:51:13&#34;,
</span></span></span><span class="line"><span class="cl"><span class="cm">            &#34;timestamp&#34;: 1733799073903
</span></span></span><span class="line"><span class="cl"><span class="cm">        }
</span></span></span><span class="line"><span class="cl"><span class="cm">         */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="service">service
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">PayService</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="n">Pay</span><span class="w"> </span><span class="n">pay</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="n">Pay</span><span class="w"> </span><span class="n">pay</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Pay</span><span class="w"> </span><span class="nf">getById</span><span class="p">(</span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Pay</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getAll</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">PayServiceImpl</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">PayService</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Resource</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">PayMapper</span><span class="w"> </span><span class="n">payMapper</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="n">Pay</span><span class="w"> </span><span class="n">pay</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">payMapper</span><span class="p">.</span><span class="na">insertSelective</span><span class="p">(</span><span class="n">pay</span><span class="p">);</span><span class="w">  </span><span class="c1">// null的属性不会保存，会使用数据库默认值</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">payMapper</span><span class="p">.</span><span class="na">deleteByPrimaryKey</span><span class="p">(</span><span class="n">id</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="n">Pay</span><span class="w"> </span><span class="n">pay</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">payMapper</span><span class="p">.</span><span class="na">updateByPrimaryKeySelective</span><span class="p">(</span><span class="n">pay</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Pay</span><span class="w"> </span><span class="nf">getById</span><span class="p">(</span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">payMapper</span><span class="p">.</span><span class="na">selectByPrimaryKey</span><span class="p">(</span><span class="n">id</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Pay</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getAll</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">payMapper</span><span class="p">.</span><span class="na">selectAll</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="mapperpaymapper">mapper.Paymapper
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">PayMapper</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Mapper</span><span class="o">&lt;</span><span class="n">Pay</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="entitiespay">entities.Pay
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 表名：t_pay
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 表注释：支付交易表
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Table</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;t_pay&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Schema</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;支付交易表Entity&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Pay</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GeneratedValue</span><span class="p">(</span><span class="n">generator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;JDBC&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Schema</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;主键&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 支付流水号
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;pay_no&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Schema</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;支付流水号&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">payNo</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 订单流水号
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;order_no&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Schema</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;订单流水号&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">orderNo</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 用户账号ID
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;user_id&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Schema</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;用户账号ID&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">userId</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 交易金额
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Schema</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;交易金额&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">amount</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 删除标志，默认0不删除，1删除
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Byte</span><span class="w"> </span><span class="n">deleted</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 创建时间
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Schema</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;创建时间&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;create_time&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@JsonFormat</span><span class="p">(</span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;yyyy-MM-dd HH:mm:ss&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">timezone</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;GMT+8&#34;</span><span class="p">)</span><span class="w">  </span><span class="c1">// 完善从数据库中查出并返回的时间格式</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Date</span><span class="w"> </span><span class="n">createTime</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 更新时间
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Schema</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;更新时间&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;update_time&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@JsonFormat</span><span class="p">(</span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;yyyy-MM-dd HH:mm:ss&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">timezone</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;GMT+8&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Date</span><span class="w"> </span><span class="n">updateTime</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return id
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="nf">getId</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">id</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param id
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setId</span><span class="p">(</span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">id</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 获取支付流水号
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return payNo - 支付流水号
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getPayNo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">payNo</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 设置支付流水号
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param payNo 支付流水号
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setPayNo</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">payNo</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">payNo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">payNo</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 获取订单流水号
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return orderNo - 订单流水号
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getOrderNo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">orderNo</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 设置订单流水号
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param orderNo 订单流水号
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setOrderNo</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">orderNo</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">orderNo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orderNo</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 获取用户账号ID
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return userId - 用户账号ID
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="nf">getUserId</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">userId</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 设置用户账号ID
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param userId 用户账号ID
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setUserId</span><span class="p">(</span><span class="n">Integer</span><span class="w"> </span><span class="n">userId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">userId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">userId</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 获取交易金额
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return amount - 交易金额
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="nf">getAmount</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">amount</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 设置交易金额
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param amount 交易金额
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setAmount</span><span class="p">(</span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">amount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">amount</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 获取删除标志，默认0不删除，1删除
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return deleted - 删除标志，默认0不删除，1删除
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Byte</span><span class="w"> </span><span class="nf">getDeleted</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">deleted</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 设置删除标志，默认0不删除，1删除
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param deleted 删除标志，默认0不删除，1删除
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setDeleted</span><span class="p">(</span><span class="n">Byte</span><span class="w"> </span><span class="n">deleted</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">deleted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">deleted</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 获取创建时间
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return createTime - 创建时间
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Date</span><span class="w"> </span><span class="nf">getCreateTime</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">createTime</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 设置创建时间
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param createTime 创建时间
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setCreateTime</span><span class="p">(</span><span class="n">Date</span><span class="w"> </span><span class="n">createTime</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">createTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createTime</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 获取更新时间
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return updateTime - 更新时间
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Date</span><span class="w"> </span><span class="nf">getUpdateTime</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">updateTime</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 设置更新时间
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param updateTime 更新时间
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setUpdateTime</span><span class="p">(</span><span class="n">Date</span><span class="w"> </span><span class="n">updateTime</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">updateTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">updateTime</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="cloud-provider-payment8002service">cloud-provider-payment8002（service）
</h2><h3 id="与8001大体上一致">与8001大体上一致
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Main8002</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@SpringBootApplication</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@MapperScan</span><span class="p">(</span><span class="s">&#34;com.xz.springcloud.mapper&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Main8002</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">SpringApplication</span><span class="p">.</span><span class="na">run</span><span class="p">(</span><span class="n">Main8002</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// application.yml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nl">server</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">port</span><span class="p">:</span><span class="w"> </span><span class="n">8002</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="cloud-consumer-order80deprecated使用resttemplate转发给微服务">cloud-consumer-order80（<em>deprecated</em>，使用RestTemplate转发给微服务）
</h2><h3 id="pom-3">pom
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependencies&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--web + actuator--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-actuator<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--lombok--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.projectlombok<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>lombok<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--hutool-all--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>cn.hutool<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>hutool-all<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--fastjson2--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>com.alibaba.fastjson2<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>fastjson2<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- swagger3 调用方式 http://localhost:8001/swagger-ui/index.html --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.springdoc<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>springdoc-openapi-starter-webmvc-ui<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--SpringCloud consul discovery --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-consul-discovery<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--loadbalancer--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-loadbalancer<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- 引入cloud-api-commons通用包 --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>com.xz.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>cloud-api-commons<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependencies&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">&lt;build&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;plugins&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;plugin&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;artifactId&gt;</span>spring-boot-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/plugin&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/plugins&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/build&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="applicationymlconsul">application.yml：Consul
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yml" data-lang="yml"><span class="line"><span class="cl"><span class="nt">server</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spring</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">application</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">cloud-consumer-order</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c"># Spring Cloud Consul for Service Discovery</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">cloud</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">consul</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l">localhost</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">8500</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">discovery</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">service-name</span><span class="p">:</span><span class="w"> </span><span class="l">${spring.application.name} </span><span class="w"> </span><span class="c"># 8001以此名字入驻consul</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="main80">Main80
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@SpringBootApplication</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Main80</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">SpringApplication</span><span class="p">.</span><span class="na">run</span><span class="p">(</span><span class="n">Main80</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="configresttemplateconfig">config.RestTemplateConfig
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * Spring 框架中提供的一个类，用于简化与 RESTful 服务进行 HTTP 请求和响应的交互。它是一种方便的客户端工具，可以通过简单的方法调用 REST API，并处理请求和响应的数据。
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Configuration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// @LoadBalancerClient(value = &#34;cloud-payment-service&#34;, configuration = RestTemplateConfig.class)  // 区分大小写，要跟consul里名字保持一样</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">RestTemplateConfig</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Bean</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@LoadBalanced</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// I/O error on GET request for &#34;http://cloud-payment-service/pay/get/1&#34; -&gt; 一旦通过微服务名字调用，默认后面有多个微服务，需要开启负载均衡</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">RestTemplate</span><span class="w"> </span><span class="nf">restTemplate</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RestTemplate</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 将默认的负载均衡轮询算法修改为随机</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// @Bean</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// ReactiveLoadBalancer&lt;ServiceInstance&gt; randomLoadBalancer(Environment environment,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//                                                          LoadBalancerClientFactory loadBalancerClientFactory) {</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//     String name = environment.getProperty(LoadBalancerClientFactory.PROPERTY_NAME);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//     return new RandomLoadBalancer(loadBalancerClientFactory.getLazyProvider(name, ServiceInstanceListSupplier.class), name);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// }</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="controllerordercontroller">controller.OrderController
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RestController</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&#34;/consumer&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">OrderController</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// public static final String PaymentServ_URL = &#34;http://localhost:8001&#34;;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">PaymentServ_URL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;http://cloud-payment-service&#34;</span><span class="p">;</span><span class="w">  </span><span class="c1">// consul服务注册中心上的微服务名字</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Resource</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">RestTemplate</span><span class="w"> </span><span class="n">restTemplate</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&#34;/pay/add&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ResultData</span><span class="w"> </span><span class="nf">addOrder</span><span class="p">(</span><span class="nd">@RequestBody</span><span class="w"> </span><span class="n">PayDTO</span><span class="w"> </span><span class="n">payDTO</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 类似于代理，也可以理解为请求转发，接收来自客户端的请求，然后将其转发给支付微服务，最后返回微服务的响应给客户端。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 通过这种方式，系统可以轻松实现不同微服务之间的通信，保持松耦合和清晰的模块划分。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 向目标 URL 发起一个 POST 请求，发送的请求体是 payDTO，并期望返回一个 ResultData 类型的响应。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 目标微服务的地址，假设 PaymentServ_URL 是微服务的基本 URL（比如 http://payment-service/api），/pay/add 是支付服务处理支付请求的接口路径。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// payDTO 包含了用户请求的支付数据，它会被 RestTemplate 自动序列化成请求体（通常是 JSON 格式）。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">restTemplate</span><span class="p">.</span><span class="na">postForObject</span><span class="p">(</span><span class="n">PaymentServ_URL</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;/pay/add&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">payDTO</span><span class="p">,</span><span class="w"> </span><span class="n">ResultData</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w">  </span><span class="c1">// 发送 POST 请求</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@DeleteMapping</span><span class="p">(</span><span class="s">&#34;/pay/del/{id}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ResultData</span><span class="w"> </span><span class="nf">deleteOrder</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&#34;id&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">restTemplate</span><span class="p">.</span><span class="na">delete</span><span class="p">(</span><span class="n">PaymentServ_URL</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;/pay/del/&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ResultData</span><span class="p">.</span><span class="na">success</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@PutMapping</span><span class="p">(</span><span class="s">&#34;/pay/update&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ResultData</span><span class="w"> </span><span class="nf">updateOrder</span><span class="p">(</span><span class="nd">@RequestBody</span><span class="w"> </span><span class="n">PayDTO</span><span class="w"> </span><span class="n">payDTO</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">restTemplate</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">PaymentServ_URL</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;/pay/update&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">payDTO</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ResultData</span><span class="p">.</span><span class="na">success</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/pay/get/{id}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ResultData</span><span class="w"> </span><span class="nf">getOrder</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&#34;id&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">restTemplate</span><span class="p">.</span><span class="na">getForObject</span><span class="p">(</span><span class="n">PaymentServ_URL</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;/pay/get/&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">ResultData</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">);</span><span class="w">  </span><span class="c1">// 发送 GET 请求</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/pay/get/info&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getInfoByConsul</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">restTemplate</span><span class="p">.</span><span class="na">getForObject</span><span class="p">(</span><span class="n">PaymentServ_URL</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;/pay/get/info&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Resource</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">DiscoveryClient</span><span class="w"> </span><span class="n">discoveryClient</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 原理：使用DiscoveryClient动态获取所有上线的服务器列表
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/discovery&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">discovery</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">services</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">discoveryClient</span><span class="p">.</span><span class="na">getServices</span><span class="p">();</span><span class="w">  </span><span class="c1">// 获取consul上全部services</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">ele</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">services</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">ele</span><span class="p">);</span><span class="w">  </span><span class="c1">// cloud-consumer-order、cloud-payment-service、consul</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;====================================&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">ServiceInstance</span><span class="o">&gt;</span><span class="w"> </span><span class="n">instances</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">discoveryClient</span><span class="p">.</span><span class="na">getInstances</span><span class="p">(</span><span class="s">&#34;cloud-payment-service&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">ServiceInstance</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">instances</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">instance</span><span class="p">.</span><span class="na">getServiceId</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;\t&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">instance</span><span class="p">.</span><span class="na">getHost</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;\t&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">instance</span><span class="p">.</span><span class="na">getPort</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;\t&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">instance</span><span class="p">.</span><span class="na">getUri</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// cloud-payment-service    Augenstern 8001   http://Augenstern:8001</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// cloud-payment-service    Augenstern 8002   http://Augenstern:8002</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// 就会在这两个服务器上做负载均衡</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">instances</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">0</span><span class="p">).</span><span class="na">getServiceId</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;: &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">instances</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">0</span><span class="p">).</span><span class="na">getPort</span><span class="p">();</span><span class="w">  </span><span class="c1">// cloud-payment-service: 8001</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="cloud-consumer-feign-order80使用openfeign转发给微服务">cloud-consumer-feign-order80（使用OpenFeign转发给微服务）
</h2><h3 id="pom-4">pom
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependencies&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--web + actuator--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-actuator<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--lombok--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.projectlombok<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>lombok<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--hutool-all--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>cn.hutool<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>hutool-all<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--fastjson2--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>com.alibaba.fastjson2<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>fastjson2<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- swagger3 调用方式 http://localhost:8001/swagger-ui/index.html --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.springdoc<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>springdoc-openapi-starter-webmvc-ui<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--SpringCloud consul discovery --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-consul-discovery<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--openfeign--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-openfeign<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- httpclient5--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.apache.httpcomponents.client5<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>httpclient5<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;version&gt;</span>5.3<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- feign-hc5--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>io.github.openfeign<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>feign-hc5<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;version&gt;</span>13.1<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--resilience4j-circuitbreaker--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-circuitbreaker-resilience4j<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- 由于断路保护等需要AOP实现，所以必须导入AOP包 --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-aop<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--resilience4j-bulkhead--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>io.github.resilience4j<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>resilience4j-bulkhead<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--resilience4j-ratelimiter--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>io.github.resilience4j<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>resilience4j-ratelimiter<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--micrometer-tracing指标追踪  2--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>io.micrometer<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>micrometer-tracing<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--micrometer-tracing-bridge-brave适配zipkin的桥接包 3--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>io.micrometer<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>micrometer-tracing-bridge-brave<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--micrometer-observation 4--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>io.micrometer<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>micrometer-observation<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--feign-micrometer 5--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>io.github.openfeign<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>feign-micrometer<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--zipkin-reporter-brave 6--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>io.zipkin.reporter2<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>zipkin-reporter-brave<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- 引入cloud-api-commons通用包 --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>com.xz.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>cloud-api-commons<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependencies&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="applicationyml配置consulopenfeignresilience4jmicrometerzipkin">application.yml：配置Consul、OpenFeign、Resilience4j、Micrometer+ZipKin
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yml" data-lang="yml"><span class="line"><span class="cl"><span class="nt">server</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spring</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">application</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">cloud-consumer-openfeign-order</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c"># Spring Cloud Consul for Service Discovery</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">cloud</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">consul</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l">localhost</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">8500</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">discovery</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">service-name</span><span class="p">:</span><span class="w"> </span><span class="l">${spring.application.name} </span><span class="w"> </span><span class="c"># 8001以此名字入驻consul</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">prefer-agent-address</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">  </span><span class="c"># 优先使用服务ip进行注册</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">openfeign</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">client</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">config</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="c"># default:  # （全局）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="c">#   # 连接超时时间</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="c">#   connectTimeout: 3000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="c">#   # 读取超时时间</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="c">#   readTimeout: 3000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">cloud-payment-service</span><span class="p">:</span><span class="w"> </span><span class="c"># 给单个服务指定会覆盖全局的</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">connectTimeout</span><span class="p">:</span><span class="w"> </span><span class="m">20000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">readTimeout</span><span class="p">:</span><span class="w"> </span><span class="m">20000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># 修改默认HttpClient -&gt; Apache HttpClient5开启，提升性能</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">httpclient</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">hc5</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="c"># 替换前为默认的 HttpClient + HttpURLConnection</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="c"># 替换后为 hc.client5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># 请求/响应压缩：支持对请求和响应进行GZIP压缩，以减少通信过程中的性能损耗</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">compression</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">request</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">min-request-size</span><span class="p">:</span><span class="w"> </span><span class="m">2048</span><span class="w">  </span><span class="c"># 最小触发压缩的大小</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">mime-types</span><span class="p">:</span><span class="w"> </span><span class="l">text/xml,application/xml,application/json </span><span class="w"> </span><span class="c"># 触发压缩数据类型</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">response</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="c"># 2024-12-05T19:44:14.215+08:00 DEBUG 13360 --- [cloud-consumer-openfeign-order] [p-nio-80-exec-5] com.xz.springcloud.apis.PayFeignAPi      : [PayFeignAPi#getPayInfo] Accept-Encoding: gzip</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># 开启circuitbreaker和分组激活</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">circuitbreaker</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">group</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">  </span><span class="c"># 默认不开启分组，若开启，默认的分组策略是精确优先，若设置了分组策略则按设置的来</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># Feign日志打印功能（logging.level + 含有@FeignClient注解的全接口名 + debug）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">logging</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">level</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">com</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">xz</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">springcloud</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">apis</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">PayFeignAPi</span><span class="p">:</span><span class="w"> </span><span class="l">debug</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># # 按照次数：COUNT_BASED 的例子</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># # 6次访问中当执行方法的失败率达到50%时CircuitBreaker将进入开启OPEN状态(保险丝跳闸断电)拒绝所有请求。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># # 等待5秒后，CircuitBreaker 将自动从开启OPEN状态过渡到半开HALF_OPEN状态，允许一些请求通过以测试服务是否恢复正常。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># # 如还是异常CircuitBreaker 将重新进入开启OPEN状态；如正常将进入关闭CLOSE闭合状态恢复正常处理请求。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># resilience4j:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#   circuitbreaker:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#     configs:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#       default:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#         failure-rate-threshold: 50  # 调用失败率达到50%时打开断路器，超过失败请求百分⽐时CircuitBreaker变为OPEN状态</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#         sliding-window-type: COUNT_BASED  # 滑动窗口的类型</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#         sliding-window-size: 6  # 滑动窗⼝的⼤⼩，配置COUNT_BASED表示6个请求，配置TIME_BASED表示6秒</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#         minimum-number-of-calls: 6  # 断路器计算失败率或慢调用率之前所需的最小样本(每个滑动窗口周期)。如果minimumNumberOfCalls为10，则必须最少记录10个样本，然后才能计算失败率。如果只记录了9次调用，即使所有9次调用都失败，断路器也不会开启</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#         automatic-transition-from-open-to-half-open-enabled: false  # 是否启用自动从开启状态过渡到半开状态，默认值为true。如果启用，CircuitBreaker将自动从开启状态过渡到半开状态，并允许一些请求通过以测试服务是否恢复正常</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#         wait-duration-in-open-state: 5s  # 从OPEN到HALF_OPEN状态需要等待的时间（不管怎么配置，都会在一定时间内恢复到半开）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#         permitted-number-of-calls-in-half-open-state: 2  # 半开状态允许的最大请求数，默认值为10。在半开状态下，CircuitBreaker将允许最多permittedNumberOfCallsInHalfOpenState个请求通过，如果调用失败率再次达到50%，CircuitBreaker将重新进入开启状态</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#         record-exceptions:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#           - java.lang.Exception</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#     instances:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#       cloud-payment-service:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#         base-config: default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># resilience4j:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#   timelimiter:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#     configs:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#       default:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#         # 适合高并发场景下接口响应较慢导致拖垮整个服务的其他接口</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#         timeout-duration: 10s  # timelimiter默认限制远程调用1s，超过1s就超时异常，配置了降级，就走降级逻辑（最高优先级）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#   circuitbreaker:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#     configs:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#       default:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#         failure-rate-threshold: 50  # 调用失败率达到50%时打开断路器，超过失败请求百分⽐时CircuitBreaker变为OPEN状态</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#         sliding-window-type: TIME_BASED  # 滑动窗口的类型</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#         sliding-window-size: 2  # 滑动窗⼝的⼤⼩，配置TIME_BASED表示2秒</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#         minimum-number-of-calls: 2  # 断路器计算失败率或慢调用率之前所需的最小样本(每个滑动窗口周期)。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#         wait-duration-in-open-state: 5s  # 从OPEN到HALF_OPEN状态需要等待的时间（不管怎么配置，都会在一定时间内恢复到半开）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#         permitted-number-of-calls-in-half-open-state: 2  # 半开状态允许的最大请求数，默认值为10。在半开状态下，CircuitBreaker将允许最多permittedNumberOfCallsInHalfOpenState个请求通过，如果调用失败率再次达到50%，CircuitBreaker将重新进入开启状态</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#         slow-call-duration-threshold: 2s  # 满调用时间阈值，高于阈值视为慢调用并增加慢调用比例</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#         slow-call-rate-threshold: 30  # 慢调用百分比峰值，断路器把调用时间大于slow-call-duration-threshold视为慢调用，当慢调用比例高于此阈值，断路器打开，并开启服务降级</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#         record-exceptions:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#           - java.lang.Exception</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#     instances:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#       cloud-payment-service:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#         base-config: default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># SEMAPHORE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># resilience4j:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#   bulkhead:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#     configs:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#       default:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#         max-concurrent-calls: 2  # 允许线程并发执行的最大数量</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#         max-wait-duration: 1s  # 当达到并发调用数量时，新的线程的阻塞时间，只愿意等待1s，超时进舱壁兜底fallback</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#     instances:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#       cloud-payment-service:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#         base-config: default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#   timelimiter:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#     configs:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#       default:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#         timeout-duration: 20s  # 为了保证测试故意延长</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># THREADPOOL  注意，由于THREADPOOL会新启线程池，需要把spring.cloud.openfeign.circuitbreaker.group.enabled设为false，新启线程和原来主线程脱离</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># resilience4j:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#   timelimiter:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#     configs:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#       default:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#          timeout-duration: 10s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#   thread-pool-bulkhead:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#     configs:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#       default:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#         core-thread-pool-size: 1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#         max-thread-pool-size: 1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#         queue-capacity: 1  # 线程池内最多容纳1个，等待队列最多容纳1个，故最多容纳2个（核心线程池内存常驻，其余（若有）线程池只是临时的，超过时间不用就会回收）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#     instances:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#       cloud-payment-service:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#         base-config: default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">resilience4j</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">ratelimiter</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">configs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">default</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">limit-for-period</span><span class="p">:</span><span class="w"> </span><span class="m">2</span><span class="w">  </span><span class="c"># 在一次刷新周期内，允许执行的最大请求数</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">limit-refresh-period</span><span class="p">:</span><span class="w"> </span><span class="l">1s </span><span class="w"> </span><span class="c"># 限流器每隔limitRefreshPeriod刷新一次，将允许处理的最大请求数量重置为limitForPeriod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">timeout-duration</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">  </span><span class="c"># 线程等待权限的默认等待时间</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">instances</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">cloud-payment-service</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">base-config</span><span class="p">:</span><span class="w"> </span><span class="l">default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">management</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">zipkin</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">tracing</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">endpoint</span><span class="p">:</span><span class="w"> </span><span class="l">http://localhost:9411/api/v2/spans </span><span class="w"> </span><span class="c"># 固定写法</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">tracing</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">sampling</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">probability</span><span class="p">:</span><span class="w"> </span><span class="m">1.0</span><span class="w">  </span><span class="c"># 采样率默认为0.1，即十次只能有一次被记录下，值越大收集越及时</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="mainopenfeign80">MainOpenFeign80
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@SpringBootApplication</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@EnableFeignClients</span><span class="w">  </span><span class="c1">// 启用Feign客户端，定义服务+绑定接口，以声明式的方法优雅而简单地实现服务调用</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MainOpenFeign80</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">SpringApplication</span><span class="p">.</span><span class="na">run</span><span class="p">(</span><span class="n">MainOpenFeign80</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="configfeignconfig">config.FeignConfig
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Configuration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">FeignConfig</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * OpenFeign的重试机制
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Bean</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Retryer</span><span class="w"> </span><span class="nf">myRetryer</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Retryer</span><span class="p">.</span><span class="na">NEVER_RETRY</span><span class="p">;</span><span class="w">  </span><span class="c1">// Feign默认配置是不走重试策略的</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 最大请求次数为3(1+2)，初始间隔时间为100ms，重试间最大间隔时间为1s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// return new Retryer.Default(100, 1, 3);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * OpenFeign的日志打印功能
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Bean</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Logger</span><span class="p">.</span><span class="na">Level</span><span class="w"> </span><span class="nf">feignLoggerLevel</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Logger</span><span class="p">.</span><span class="na">Level</span><span class="p">.</span><span class="na">FULL</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="controller-1">controller
</h3><h4 id="ordercontroller">OrderController
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RestController</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&#34;/feign&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">OrderController</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Resource</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">PayFeignAPi</span><span class="w"> </span><span class="n">payFeignAPi</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&#34;/pay/add&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ResultData</span><span class="w"> </span><span class="nf">addOrder</span><span class="p">(</span><span class="nd">@RequestBody</span><span class="w"> </span><span class="n">PayDTO</span><span class="w"> </span><span class="n">payDTO</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 1、模拟本地addOrder新增订单成功（省略sql操作）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 2、在开启addPay支付微服务远程调用</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 当应用启动时，Feign使用Java动态代理机制生成接口的实现，这个实现由SpringCLoud方法提供支持</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// Feign客户端在内部构建了请求的详细信息，并将接口方法调用转换为HTTP调用</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">payFeignAPi</span><span class="p">.</span><span class="na">addPay</span><span class="p">(</span><span class="n">payDTO</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/pay/get/{id}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ResultData</span><span class="w"> </span><span class="nf">getPayInfo</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&#34;id&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 1、支付微服务远程调用，按照id查询订单支付流水信息</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ResultData</span><span class="w"> </span><span class="n">resultData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;调用开始：&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">DateUtil</span><span class="p">.</span><span class="na">now</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">resultData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">payFeignAPi</span><span class="p">.</span><span class="na">getPayInfo</span><span class="p">(</span><span class="n">id</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;调用结束：&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">DateUtil</span><span class="p">.</span><span class="na">now</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">ResultData</span><span class="p">.</span><span class="na">fail</span><span class="p">(</span><span class="n">ReturnCodeEnum</span><span class="p">.</span><span class="na">RC500</span><span class="p">.</span><span class="na">getCode</span><span class="p">(),</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// 测试超时控制</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// 调用开始：2024-12-05 18:52:31</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// 调用结束：2024-12-05 18:53:31</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// Feign默认超时时间60s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">resultData</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/pay/get/info&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">mylb</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">payFeignAPi</span><span class="p">.</span><span class="na">mylb</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="ordercircuitcontrollercircuitbreakerbulkheadratelimit">OrderCircuitController：CircuitBreaker、BulkHead、RateLimit
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RestController</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">OrderCircuitController</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Resource</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">PayFeignAPi</span><span class="w"> </span><span class="n">payFeignAPi</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/feign/pay/circuit/{id}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@CircuitBreaker</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;cloud-payment-service&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">fallbackMethod</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;myCircuitFallback&#34;</span><span class="p">)</span><span class="w">  </span><span class="c1">// 与yml的instances名字保持一致</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">myCircuitBreaker</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&#34;id&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">payFeignAPi</span><span class="p">.</span><span class="na">myCircuit</span><span class="p">(</span><span class="n">id</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 报错就会进入，超过50%才会熔断（断开），后面就算不报错了，仍会返回失败
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 服务降级后的兜底处理方法
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">myCircuitFallback</span><span class="p">(</span><span class="n">Throwable</span><span class="w"> </span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;myCircuitFallback 系统繁忙，请稍后再试&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/feign/pay/bulkhead/{id}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Bulkhead</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;cloud-payment-service&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">fallbackMethod</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;myBulkheadFallback&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Bulkhead</span><span class="p">.</span><span class="na">Type</span><span class="p">.</span><span class="na">SEMAPHORE</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">myBulkhead</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&#34;id&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">payFeignAPi</span><span class="p">.</span><span class="na">myBulkhead</span><span class="p">(</span><span class="n">id</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">myBulkheadFallback</span><span class="p">(</span><span class="n">Throwable</span><span class="w"> </span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;myBulkheadFallback 隔板超出最大数量限制，系统繁忙，请稍后再试&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/feign/pay/bulkhead_th/{id}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Bulkhead</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;cloud-payment-service&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">fallbackMethod</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;myBulkheadFallbackTh&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Bulkhead</span><span class="p">.</span><span class="na">Type</span><span class="p">.</span><span class="na">THREADPOOL</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">myBulkheadTh</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&#34;id&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getName</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;\t&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;---开始进入---&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">TimeUnit</span><span class="p">.</span><span class="na">SECONDS</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="n">3</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">InterruptedException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getName</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;\t&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;---准备离开---&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// bulkhead-cloud-payment-service-1 ---开始进入---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// bulkhead-cloud-payment-service-1 ---准备离开---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="p">.</span><span class="na">supplyAsync</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">payFeignAPi</span><span class="p">.</span><span class="na">myBulkhead</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;\t&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;THREADPOOL&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">myBulkheadFallbackTh</span><span class="p">(</span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">Throwable</span><span class="w"> </span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="p">.</span><span class="na">supplyAsync</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s">&#34;myBulkheadFallbackTh 隔板超出最大数量限制，系统繁忙，请稍后再试&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/feign/pay/ratelimit/{id}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@RateLimiter</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;cloud-payment-service&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">fallbackMethod</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;myRatelimitFallback&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">myRatelimit</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&#34;id&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">payFeignAPi</span><span class="p">.</span><span class="na">myRatelimit</span><span class="p">(</span><span class="n">id</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">myRatelimitFallback</span><span class="p">(</span><span class="n">Throwable</span><span class="w"> </span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;myRatelimitFallback 你被限流了，禁止访问&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="ordermicrometercontrollermicrometer">OrderMicrometerController：Micrometer
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RestController</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">OrderMicrometerController</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Resource</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">PayFeignAPi</span><span class="w"> </span><span class="n">payFeignAPi</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/feign/micrometer/{id}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">myMicrometer</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&#34;id&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">payFeignAPi</span><span class="p">.</span><span class="na">myMicrometer</span><span class="p">(</span><span class="n">id</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="ordermicrometercontrollergateway">OrderMicrometerController：GateWay
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RestController</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">OrderGatewayController</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Resource</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">PayFeignAPi</span><span class="w"> </span><span class="n">payFeignAPi</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/feign/pay/gateway/get/{id}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ResultData</span><span class="w"> </span><span class="nf">getById</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&#34;id&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">payFeignAPi</span><span class="p">.</span><span class="na">getById</span><span class="p">(</span><span class="n">id</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/feign/pay/gateway/info&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ResultData</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getGatewayInfo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">payFeignAPi</span><span class="p">.</span><span class="na">getGatewayInfo</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="cloud-gateway9527网关">cloud-gateway9527（网关）
</h2><h3 id="pom-5">pom
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependencies&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--gateway--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-gateway<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--服务注册发现consul discovery,网关也要注册进服务注册中心统一管控--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-consul-discovery<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- 指标监控健康检查的actuator,网关是响应式编程删除掉spring-boot-starter-web dependency--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-actuator<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--lombok--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.projectlombok<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>lombok<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;scope&gt;</span>provided<span class="nt">&lt;/scope&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependencies&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">&lt;build&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;plugins&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;plugin&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;artifactId&gt;</span>spring-boot-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/plugin&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/plugins&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/build&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="applicationyml配置consulroutesiduripredicatesfiltersn">application.yml：配置Consul、routes=(id+uri+predicates+filters)*n
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yml" data-lang="yml"><span class="line"><span class="cl"><span class="nt">server</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">9527</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spring</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">application</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">cloud-gateway </span><span class="w"> </span><span class="c"># 以微服务注册进consul或nacos服务列表内</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">cloud</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">consul</span><span class="p">:</span><span class="w">  </span><span class="c"># 配置consul地址</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l">localhost</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">8500</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">discovery</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">prefer-agent-address</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">service-name</span><span class="p">:</span><span class="w"> </span><span class="l">${spring.application.name}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">gateway</span><span class="p">:</span><span class="w">  </span><span class="c"># 所有的请求都会发给网关，由网关进行转发</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">routes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l">pay_route1 </span><span class="w"> </span><span class="c"># 路由的ID（类似于mysql的主键），没有固定规则但要求唯一，建议配合服务名</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="c"># uri: http://localhost:8001  # 匹配后提供服务的路由地址</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">uri</span><span class="p">:</span><span class="w"> </span><span class="l">lb://cloud-payment-service </span><span class="w"> </span><span class="c"># 以微服务名字动态获取uri</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="c"># lb 代表 负载均衡器（Load Balancer）。这表示请求会通过负载均衡器转发到 cloud-payment-service 服务，而不是直接指定一个固定的 IP 地址或主机名。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="c"># lb://：这个前缀表示使用负载均衡器来解析服务的地址，负载均衡器会根据一定的算法（例如轮询、最小连接数等）将请求转发到 cloud-payment-service 的不同实例。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="c"># 此时将8001改为8007，依然可以通过OpenFeign对服务访问</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">predicates</span><span class="p">:</span><span class="w">  </span><span class="c"># 只有满足了断言下的所有条件才能正常访问到uri</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="l">Path=/pay/gateway/get/** </span><span class="w"> </span><span class="c"># 路径相匹配的进行路由</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="l">After=2024-12-09T16:33:19.186588300+08:00[GMT+08:00] </span><span class="w"> </span><span class="c"># 在此时间之后才能访问：到点秒杀</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c"># Before  Between=XXX,XXX</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c"># - Cookie=username,xz  # cmd：curl http://localhost:9527/pay/gateway/get/1 --cookie &#34;username=xz&#34;  直接访问9527才生效，当访问80再访问9527则不行，因为这样Cookie只传到了80端口（实际工作中不会有用Feign调网关的情况发生，故直接访问网关没有问题）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c"># - Header=X-Request-Id, \d+  # cmd：curl http://localhost:9527/pay/gateway/get/1 -H &#34;X-Request-Id:123456&#34;  # 一个属性名称，一个正则表达式，属性名与正则匹配才符合条件：请求头要有X-Request-Id属性且值为正数  同样只有直接访问9527才生效</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c"># - Host=**.xz.com  # cmd：curl http://localhost:9527/pay/gateway/get/3 -H &#34;Host:a.www.xz.com&#34;  接收一组匹配的域名列表，这个模板是一个ant分隔的模板，用.作为分隔符</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c"># - Query=username, \d+  # http://localhost:9527/pay/gateway/get/1?username=23 要求有查询参数且符合属性值，一个是属性名、一个是属性值，属性值可以是正则</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c"># - RemoteAddr=10.249.94.1/24  # IPv4地址 10.249.94.181  http://10.249.94.181:9527/pay/gateway/get/1  外部访问IP限制，最大跨度不超过32，目前是1-24，CIDR表示法</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c"># - Method=POST  # 限制请求方法只能为POST</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c"># Fully Expanded Arguments</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c"># - name: My</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c">#   args:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c">#     userType: diamond  # http://localhost:9527/pay/gateway/get/1?userType=diamond</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c"># Shortcut Configuration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c"># - My=diamond</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l">pay_route2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="c"># uri: http://localhost:8001</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">uri</span><span class="p">:</span><span class="w"> </span><span class="l">lb://cloud-payment-service </span><span class="w"> </span><span class="c"># 动态路由</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">predicates</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="l">Path=/pay/gateway/info/**</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l">pay_route3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">uri</span><span class="p">:</span><span class="w"> </span><span class="l">lb://cloud-payment-service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">predicates</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="l">Path=/pay/gateway/filter/** </span><span class="w"> </span><span class="c"># 默认的正确地址</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c"># - Path=/gateway/filter/**  # 拆分为 PrefixPath + Path</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c"># - Path=/XYZ/abc/{segment}  # {segment}为占位符，最后会被setPath取代</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">filters</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c"># # 往请求中添加请求头参数</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c"># - AddRequestHeader=X-Request-xz1,xzVal1  # 请求头kv，若含有多个kv则重写一行设置</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c"># - AddRequestHeader=X-Request-xz2,xzVal2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c"># # 往请求中删除请求头参数</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c"># - RemoveRequestHeader=sec-fetch-site  # 删除 请求头名：sec-fetch-site 请求头值：none</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c"># # 修改请求头参数</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c"># - SetRequestHeader=sec-fetch-mode,xzxzxzxzxzxz  # 请求头名：sec-fetch-mode 请求头值修改为xzxzxzxzxzxz</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c"># # 新增请求参数</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c"># - AddRequestParameter=customerId,9527001  # 新增请求参数Parameter，kv（默认值），如果有传过来的请求参数则会将此覆盖</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c"># # 删除请求参数</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c"># - RemoveRequestParameter=customName  # 删除url请求参数的value -&gt; null</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c"># # 新增响应头参数</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c"># - AddResponseHeader=X-Response-xz,xzzzzzz  # x-response-xz: xzzzzzz</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c"># # 修改响应头参数</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c"># - SetResponseHeader=Date,2099-11-11  # date: 2099-11-11</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c"># # 删除响应头参数</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c"># - RemoveResponseHeader=Content-Type  # 将默认自带Content-Type删除</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c"># - PrefixPath=/pay  # http://localhost:9527/pay/gateway/filter  过滤器统一管理前缀</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c"># - SetPath=/pay/gateway/{segment}  # 浏览器访问的地址：http://localhost:9527/XYZ/abc/filter  实际访问的地址：http://localhost:9527/pay/gateway/filter</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c"># - RedirectTo=302,https://www.baidu.com/  # 访问http://localhost:9527/pay/gateway/filter跳转到https://www.baidu.com/  302重定向状态码</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c"># 自定义filter就是作用于全部routes的 spring.cloud.gateway.default-filters...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="l">My=xz </span><span class="w"> </span><span class="c"># xz就是Config里面的status  http://localhost:9527/pay/gateway/filter -&gt; 400  http://localhost:9527/pay/gateway/filter?xz=??才能访问（过滤器可以替代断言，但是断言不能替代过滤器）</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="main9527">Main9527
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@SpringBootApplication</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Main9527</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">SpringApplication</span><span class="p">.</span><span class="na">run</span><span class="p">(</span><span class="n">Main9527</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 网关，不写任何业务代码，网关和业务无关</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="mygateway">mygateway
</h3><h4 id="myroutepredicatefactory自定义路由断言">MyRoutePredicateFactory：自定义路由断言
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 需求说明：自定义配置会员等级userType，按照钻/金/银和yml配置的会员等级，以适配是否可以访问
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 约定自定义的路由断言工厂必须要以RoutePredicateFactory结尾，前面的部分将会形如[After][Before][Between]...出现
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 因此这个路由断言工厂将会显示为[My]
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 2024-12-10T10:17:10.899+08:00  INFO 24408 --- [cloud-gateway] [main] o.s.c.g.r.RouteDefinitionRouteLocator : Loaded RoutePredicateFactory [My]
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Component</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MyRoutePredicateFactory</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">AbstractRoutePredicateFactory</span><span class="o">&lt;</span><span class="n">MyRoutePredicateFactory</span><span class="p">.</span><span class="na">Config</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">MyRoutePredicateFactory</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">super</span><span class="p">(</span><span class="n">MyRoutePredicateFactory</span><span class="p">.</span><span class="na">Config</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 这个Config类就是路由断言规则！</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Validated</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Config</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nd">@Setter</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nd">@Getter</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nd">@NotEmpty</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">userType</span><span class="p">;</span><span class="w">  </span><span class="c1">// 钻/金/银用户等级</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 使支持短格式
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">shortcutFieldOrder</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Collections</span><span class="p">.</span><span class="na">singletonList</span><span class="p">(</span><span class="s">&#34;userType&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Predicate</span><span class="o">&lt;</span><span class="n">ServerWebExchange</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="n">MyRoutePredicateFactory</span><span class="p">.</span><span class="na">Config</span><span class="w"> </span><span class="n">config</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Predicate</span><span class="o">&lt;</span><span class="n">ServerWebExchange</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">test</span><span class="p">(</span><span class="n">ServerWebExchange</span><span class="w"> </span><span class="n">serverWebExchange</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">String</span><span class="w"> </span><span class="n">userType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">serverWebExchange</span><span class="p">.</span><span class="na">getRequest</span><span class="p">().</span><span class="na">getQueryParams</span><span class="p">().</span><span class="na">getFirst</span><span class="p">(</span><span class="s">&#34;userType&#34;</span><span class="p">);</span><span class="w">  </span><span class="c1">// 获取名字为userType的查询参数</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">userType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w">  </span><span class="c1">// 断言校验失败</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">userType</span><span class="p">.</span><span class="na">equalsIgnoreCase</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="na">getUserType</span><span class="p">()))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w">  </span><span class="c1">// 与预先定义的userType相同，断言校验成功</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="myglobalfilter应用场景统计controller调用耗时情况如何落地谈谈设计思路自定义全局过滤器重点面试设计题">MyGlobalFilter：应用场景：统计Controller调用耗时情况，如何落地，谈谈设计思路：自定义全局过滤器（重点，面试设计题）
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 自定义全局过滤器
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Component</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Slf4j</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MyGlobalFilter</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">GlobalFilter</span><span class="p">,</span><span class="w"> </span><span class="n">Ordered</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">BEGIN_VISIT_TIME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;begin_visit_time&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Mono</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">filter</span><span class="p">(</span><span class="n">ServerWebExchange</span><span class="w"> </span><span class="n">exchange</span><span class="p">,</span><span class="w"> </span><span class="n">GatewayFilterChain</span><span class="w"> </span><span class="n">chain</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 先记录下访问接口的开始时间</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">exchange</span><span class="p">.</span><span class="na">getAttributes</span><span class="p">().</span><span class="na">put</span><span class="p">(</span><span class="n">BEGIN_VISIT_TIME</span><span class="p">,</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 返回统计的各个结果给后台</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chain</span><span class="p">.</span><span class="na">filter</span><span class="p">(</span><span class="n">exchange</span><span class="p">).</span><span class="na">then</span><span class="p">(</span><span class="n">Mono</span><span class="p">.</span><span class="na">fromRunnable</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="c1">// 响应式编程</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Long</span><span class="w"> </span><span class="n">beginVisitTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">exchange</span><span class="p">.</span><span class="na">getAttribute</span><span class="p">(</span><span class="n">BEGIN_VISIT_TIME</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">beginVisitTime</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&#34;访问接口主机：&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">exchange</span><span class="p">.</span><span class="na">getRequest</span><span class="p">().</span><span class="na">getURI</span><span class="p">().</span><span class="na">getHost</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&#34;访问接口端口：&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">exchange</span><span class="p">.</span><span class="na">getRequest</span><span class="p">().</span><span class="na">getURI</span><span class="p">().</span><span class="na">getPort</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&#34;访问接口URL：&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">exchange</span><span class="p">.</span><span class="na">getRequest</span><span class="p">().</span><span class="na">getURI</span><span class="p">().</span><span class="na">getPath</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&#34;访问接口URL后面的参数：&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">exchange</span><span class="p">.</span><span class="na">getRequest</span><span class="p">().</span><span class="na">getURI</span><span class="p">().</span><span class="na">getRawQuery</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&#34;访问接口时长：&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">beginVisitTime</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;毫秒&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&#34;=====================================&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">                2024-12-10T21:53:21.721+08:00  INFO 29628 --- [cloud-gateway] [tor-http-nio-15] c.x.s.mygateway.MyGlobalFilter           : 访问接口主机：localhost
</span></span></span><span class="line"><span class="cl"><span class="cm">                2024-12-10T21:53:21.721+08:00  INFO 29628 --- [cloud-gateway] [tor-http-nio-15] c.x.s.mygateway.MyGlobalFilter           : 访问接口端口：9527
</span></span></span><span class="line"><span class="cl"><span class="cm">                2024-12-10T21:53:21.721+08:00  INFO 29628 --- [cloud-gateway] [tor-http-nio-15] c.x.s.mygateway.MyGlobalFilter           : 访问接口URL：/pay/gateway/info
</span></span></span><span class="line"><span class="cl"><span class="cm">                2024-12-10T21:53:21.721+08:00  INFO 29628 --- [cloud-gateway] [tor-http-nio-15] c.x.s.mygateway.MyGlobalFilter           : 访问接口URL后面的参数：null
</span></span></span><span class="line"><span class="cl"><span class="cm">                2024-12-10T21:53:21.721+08:00  INFO 29628 --- [cloud-gateway] [tor-http-nio-15] c.x.s.mygateway.MyGlobalFilter           : 访问接口时长：198毫秒
</span></span></span><span class="line"><span class="cl"><span class="cm">                 */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 数字越小，优先级越高，pre最先执行，post最后执行
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">getOrder</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">0</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="mygatewayfilterfactory自定义条件过滤器">MyGatewayFilterFactory：自定义条件过滤器
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Component</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MyGatewayFilterFactory</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">AbstractGatewayFilterFactory</span><span class="o">&lt;</span><span class="n">MyGatewayFilterFactory</span><span class="p">.</span><span class="na">Config</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">MyGatewayFilterFactory</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">super</span><span class="p">(</span><span class="n">MyGatewayFilterFactory</span><span class="p">.</span><span class="na">Config</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Config</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nd">@Getter</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nd">@Setter</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">status</span><span class="p">;</span><span class="w">  </span><span class="c1">// 设定一个状态值/标志位，等于时才可以访问</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">shortcutFieldOrder</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="s">&#34;status&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">GatewayFilter</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="n">MyGatewayFilterFactory</span><span class="p">.</span><span class="na">Config</span><span class="w"> </span><span class="n">config</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">GatewayFilter</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kd">public</span><span class="w"> </span><span class="n">Mono</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">filter</span><span class="p">(</span><span class="n">ServerWebExchange</span><span class="w"> </span><span class="n">exchange</span><span class="p">,</span><span class="w"> </span><span class="n">GatewayFilterChain</span><span class="w"> </span><span class="n">chain</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">ServerHttpRequest</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">exchange</span><span class="p">.</span><span class="na">getRequest</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;进入了自定义网关过滤器MyGatewayFilterFactory, status：&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">config</span><span class="p">.</span><span class="na">getStatus</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c1">// 进入了自定义网关过滤器MyGatewayFilterFactory, status：xz（与路由断言工厂类似，来自于yml中的配置）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getQueryParams</span><span class="p">().</span><span class="na">containsKey</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="na">getStatus</span><span class="p">()))</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="c1">// 包含配置的key才放行</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">return</span><span class="w"> </span><span class="n">chain</span><span class="p">.</span><span class="na">filter</span><span class="p">(</span><span class="n">exchange</span><span class="p">);</span><span class="w">  </span><span class="c1">// 放行，传给下一个过滤器</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">exchange</span><span class="p">.</span><span class="na">getResponse</span><span class="p">().</span><span class="na">setStatusCode</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">BAD_REQUEST</span><span class="p">);</span><span class="w">  </span><span class="c1">// 非法请求</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">return</span><span class="w"> </span><span class="n">exchange</span><span class="p">.</span><span class="na">getResponse</span><span class="p">().</span><span class="na">setComplete</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h1 id="spring-cloud原生">Spring Cloud原生
</h1><h2 id="consul服务注册与发现">Consul：服务注册与发现
</h2><h3 id="cmd指令">cmd指令
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cmd" data-lang="cmd"><span class="line"><span class="cl">查看版本
</span></span><span class="line"><span class="cl">consul --version
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">运行
</span></span><span class="line"><span class="cl">consul agent -dev
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">打开
</span></span><span class="line"><span class="cl">http://localhost:8500/
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="pom-6">pom
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="c">&lt;!--SpringCloud consul discovery  （所有微服务！） --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-consul-discovery<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">&lt;!--SpringCloud consul config  （仅service！） --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-consul-config<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-bootstrap<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="cap">CAP
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">C：Consistency 强一致性
</span></span><span class="line"><span class="cl">A：Availability 可用性
</span></span><span class="line"><span class="cl">P：Partition tolerance 分区容错性
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="经典cap图">经典CAP图
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">最多只能同时较好的满足两个。CAP理论的核心是：一个分布式系统不可能同时很好的满足一致性，可用性和分区容错性这三个需求，
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">因此，根据 CAP 原理将 NoSQL 数据库分成了满足 CA 原则、满足 CP 原则和满足 AP 原则三大类：
</span></span><span class="line"><span class="cl">CA - 单点集群，满足一致性，可用性的系统，通常在可扩展性上不太强大。
</span></span><span class="line"><span class="cl">CP - 满足一致性，分区容忍性的系统，通常性能不是特别高。
</span></span><span class="line"><span class="cl">AP - 满足可用性，分区容忍性的系统，通常可能对一致性要求低一些。
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="data:application/octet-stream;base64,iVBORw0KGgoAAAANSUhEUgAAAp8AAAJICAIAAACosRjIAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAIvbSURBVHhe7b2Hf9zGmf//&#43;1tOyyKKVK8kl&#43;Ryd9nVRXJJir2oklRlkWzLRcXdcpObLMk9LnKV3OR8kzjlLvGl55zknMulOLFTHCduKZfYvw/wUOPRYLlckluw2M&#43;83uJrMRgMsCsA73kGA&#43;D/&#43;4yJiYmJiYnJW4l2Z2JiYmJi8lqi3ZmYmJiYmLyWaHcmJiYmJiavpf9vzqoIIYQQQjwD7U4IIYR4DdqdEEII8Rq0OyGEEOI1aHdCCCHEa9DuhBBCiNeg3QkhhBCvQbsTQgghXoN2J4QQQrwG7U4IIYR4DdqdEEII8Rq0OyGEEOI1aHdCCCHEa9DuhBBCiNeg3QkhhBCvQbsTQgghXoN2J4QQQrwG7U4IIYR4DdqdEEII8Rq0OyGEEOI1aHdCCCHEa9DuhBBCiNeg3QkhhBCvQbsTQgghXoN2J4QQQrwG7U4IIYR4DdqdEEII8Rq0OyGEEOI1aHdCCCHEa9DuhBBCiNeg3QkhhBCvQbsTQgghXoN2J4QQQrwG7U4IIYR4DdqdEEII8Rq0OyGEEOI1aHdCCCHEa9DuhHiQho7R1h1XC4vCPcZcQojnod2JS4GWTj/&#43;4je/8&#43;abb/0CuykSPoOz579y&#43;PgD5RsGjfJTAslhcSxr5McA23DryacmY&#43;vojTPYDCeoxKh5Zugbg28qPxoSvoXKJ4RkCTj2aXfiLmDNt9/5g5gpRoLApiVXeB1LoWYjPwZQpqwrRvrgw4/R4JiNQbHsRF2zS/o20O6EZDk49ml34iJgSnFSPGladlcthvhtF4/dVZpua0NBuxNCEg6OfdqduIJF4R7VCR9PgsCMGmKgGxQNCGPuZEzL7kiI4xs6Ro1KpoR2J4QkHBz7tDtxBc6oHYoaOXyXCoihf4jq8PEHRF2YpZadEr1yONiYOxm63RH6Y3Lr6I3YBqwany&#43;8/sbEPC2h2HRHseELorbJ0C9S4Isbc3X0ngPanZAsB8c&#43;7U7Sj1wU11Ps4W/TMhZ0O1HpxRRnywDKnFhgkq4C1KyXkYQco9hs0D0df820OyFZDo592p2kGTgS8bSoSNK04vIpcTYdEHYbZaIypd0FbO1EITu9&#43;dYvjAKzgXYnhMwAHPu0O0kzRp98YmNfoHduqxTPCLg47Q50myIZc2cD7U4ImQE49ml3kk6MwH0G161jA7dNVH1pit3zL8RvdyN8T6BQE2V3/Kr4yhdefwOzhNOPvzitMYCoAV8TTTFVg1SydfRGo2RsUF6eZKBAnah5yv93fH2FysSC&#43;pdCVTHabTPbfvyAslJ9CAh&#43;zCnrMVaH7USOUYaQJIFjn3Yn6QTnO5GQpHikOy1wep2o2u7wn/gU343vOKFPlJ7K7kYbwm12x4LGtQ&#43;VoCVj2ajg/2WyGpAwK57/OPgvaj&#43;KpCkrmShnJ0yiaeKsDZVEbSXgvz729sf4bdVugH0Jk/g9J6sK2yMNphjfVJUhJKlgZ6PdSTrR7Ys0ZQA3LVDbRL0Xda6fc6c8ycZvd5zNJ8rZKZ5u/ziZvd2nvM9QpDUZ&#43;A2j3h3gTFhpjP8&#43;NCMmysVMMTZmooSd8H8XVbHOxbFJxj42WZps&#43;/XdQP8cNUlDYWJikoQyFDxJNtjTaHeSTnTdxjboDEAsOFH1RTXqjoltNaCfpmNvm6EuY&#43;5s0D0tXyEe9KX0hF8bs/TfXFKMHmNnVWguIDNqPZMNV3QKD5XgR0O&#43;s/7J/l8mZttJNVlgSn1LnO0qZ9MkxvYj01gcODdektQzWRwvSTZPba1KUVdESALBbka7k3QiJztJ8dsrTvTTt5z3ETNNTNtnXr2wE/20HuN0jIBPP8XjVG4UmA1Y70S9s7M7ltXNZ/RU44dSs3SMVgtMaeizdcfVhrqcDQX9N0fCuowrF6jTqCTqpY2JeVpCO0BF21iLs2PfEHM82z9lJUjGj4lFnI5HtfqVeGyesSKG7ySpYB&#43;j3UnaMM77sS&#43;7ThecuCfqvdS4uvKdI6F09NN6DLsbHb9YyigwG2Zvd4gnqiz1jg0kp2wgsIl5dpps7fCr7i1nQ8HYGMOvAirR/1/0/y/FxLyLacquF2P7Y5TXt9C5/fpugBR1LzV&#43;TGy/s5M/qXs7IQbYx2h3kjZ0ASNFldCM0aWrn0n1eHSynmRhSrujcWAEZEhR7TVjZm/3GC0YXahO2eg/YOwfyvCo/v9oKC3GJQBj7IKztTExw05oJTj1aaBvf9T/PkWM7Qf6bjDZ74CNmShhJ&#43;fGCzP73yRkBmAfo91J2kie3Y2zrW5cY6UxJKGf1qETnJoBnCEfJmZcmhJ&#43;yp6ZD/SlYvyquv&#43;clU/MsNNkulJAexNFL63K&#43;A1VflRQYKLoVNuDJpox14le25S71mTbD/Sv4NwqxUQJOxmzFHpV&#43;D8y5hKSQLCP0e4kbSTP7npPqTPe0s/7MTpI9XNxPAmyNGqYPUm1ewxv6f81U1oZTFaVviVT/j66Yp3/axMz7DTlrjKb7TeaDjF&#43;JZ2JEnYyZin0qmh3klSwj9HuJG3op2CkKU/Z8aP3OTt7g/WYNeolXkE/F8dO8EeSLqOmy&#43;7xf3dn0qvS/yOm3H59pU75Tcyw05SXP2az/UbDQq8qxleYKGEnY5Yi9hckJIFgH6PdSdow&#43;s9jnDqnhdFocPa9T3mJV4jHEDhHo/UQo3t/lmS63Sey7BR7DCPQV&#43;psdU3MsJMxy0mitt&#43;oypilM1HCTsYshV4V7U6SCvYx2p2kEznTSUpUz7Yemjs7eAW9c36yi7jGuRia1Ens6LnJyES7650lE1l2irElgrFSY&#43;5Erp2MWU5ms/1GN0yMX0lnooSdjFkKvSranSQV7GO0O0knuoecNyPNAKM/YLJB2noLYLLrsm44F7vB7rP57hNV2Cldsfss/&#43;9i/Eo6EyXsZMxSJHCrCIkN9jHanaQT43kpU4Z3U6KPp4s/RRWPG87FuqdjqMVAX2r2do8xNGFKknTd3ZjlJFHbD/SqYnyFiRJ2MmYpYn9BQhII9jHanaQT437o2Z/ydJ3En6JeFHDDuVj3dAy1GOhLzczuI5e&#43;3UefNS30LZnyNja9cOwx88YsJ8b2z2ZgRIxfSWeihJ2MWQq9qnTtUSRLwD5Gu5M0Y/h4yv7bGMBkE7VMPzkF4IZzsS68GGox0Jeamd2NB7xMdoFjSvS&#43;mdgxtHFJxXkPwsQMOxmznCRq&#43;0GMX0lnooSdjFkKvSranSQV7GO0O0kzRpj1QRxv0EKBqOdZ/Wo6Gg0QWwyMkfNOAbjhXJwuuwPIeGLeLIZEGH0zcW4MknPQ4sQMOxmzomJs/4zD99i/kmKihJ2MWQq9KtqdJBXsY7Q7ST/6iRgJgo&#43;hAVhZRrwbUb4R/E3ZDwz09TojSzeci9Nod6PVFfuOBvxfTKZPvW9msp8RLtfvYohabGKenYxZUZnW9uNXmuwmiNi/kmKihJ2MWQq9qnTtUSRLwD5Gu5P0gwhPP7lLwulY9zfkgUndW1hEN4oxnm7KDgBgjOkzzu9uOBfr3zeGWgz0pWZsd2C0ulCt81fFjyZdJpPpE/9rsrikC6&#43;/YbQDUKexoqjbPDHPTsasydB/ByRMOmuecvun/JWEiRJ2MmYp9KqwMcZcQhII9jHanbgCI9KKM&#43;lXZ/UYMc6eZKPf2Aj33XAu1v0UQy0G&#43;lKzsbsRUkuCiSFClIen47EyEH2qhDqxLGqQSiZyL6bJOl0mZtvJmDUZaEbMfvtRcmI27U4yB&#43;xjtDtxCwjynOfiGElXuxEgxjgLG8RoE7jhXJxeuwM0gPSfKHaarBJYVt&#43;kGGmyABpMlLCTMSsGzo6BGCnq9sfzK4GJEnYyZin0qmh3klSwj9HuxEWobtLYCWdGo4vYCAGNPvYYGJ3z&#43;rUAN5yLdSnGUIuBvtQs7Q7g5in/U9ACcA5LNMAqYrTeMMs5Tl5nopydjFmxwfYb/8vOFGP74/yVJkrYyZil0Kui3UlSwT5GuxPXATfjPIjTny4DnH&#43;RAwFENTfKK2JLwkDWpdBdiM8qf0p1JQmsV21DDE8b6EvFaOjoX3DKylEPflj8F6hQHp8BljVaWjGAaFEJmmJYUFWCSWwwZhmFDdSmAmNWPKjtV6F8nNsf56&#43;kygBjlkKvKl17FMkSsIfT7oQQQoinoN0JIYQQr0G7E0IIIV6DdieEEEK8Bu1OCCGEeA3anRBCCPEatDshhBDiNWh3QgghxGvQ7oQQQojXoN0JIYQQr0G7E0IIIV6DdieEEEK8Bu1OCCGEeA3anRBCCPEatDshhBDiNWh3QgghxGvQ7oQQQojXoN0JIYQQr0G7E0IIIV6DdieEEEK8Bu1OCCGEeA3anRBCCPEatDshhBDiNWh3QgghxGvQ7oQQQojXoN0JIYQQr0G7E0IIIV6DdieEEEK8Bu1OCCGEeA3anRBCCPEatDshhBDiNWh3QgghxGvQ7oQQQojXoN0JIYQQr0G7E0IIIV6DdieEEEK8Bu1OCCGEeA3anZCMpTgypzTiK4/kBCM5Nc25a5rzGpvz25vn9jYVbGuaN9RUuLepcLSp6GDj/Csa51/VOP/qxvmHba6xPyPnikbMRRmURPmCrU1YNn&#43;zVU/u6mbUiZpRP9ZirctYOyHExdDuhGQU0HllJLe&#43;OW9T89zOZvh43rClcHh6wRGbozbHHFwbDaMMkMWP2I2AKxoLR6z6C7Y0zW231phb14y1W7I3tooQ4jJod0LcjhWdVzfnbbR0Pm9nE4xbdLkVfJsuN8w9ewzfX92I9Vq&#43;39GELcnb0JxT1ewrM7eWEOIGaHdCXElpJKcqYgXoPU3zdtm960rnyRB5/IjvIfurGosOWP352EK0PHLCkTkljm9BCEkTtDshLsLnj&#43;TWNee3NiM&#43;tvrbr7R6yNNv9MmwTW/14R&#43;yYvqC7U3Y8tzaZnbdE5J2aHdC0k3xRalvbkYoPBGmu9bokyGmv9oO6HdS84SkGdqdkPRRbI11tyL1nU1Fl9lSzyyjTwY0f5U1Gn/ejqb8SHNOdTOH3BOSYmh3QlIOgvUK65p6wdamovEmiNAjUndia75w1Bp1n7ex2bq5zvgpCCHJgXYnJIWURHKqmvPbmgt3N80/ZHe/Gzr0KtD8FY3zhq0e&#43;5wq3j1PSNKh3QlJCaWR3AbrOTOFI01WD7whv6zBCuX3W8Psc&#43;t4VZ6QJEK7E5JcrBFza5oLBqzhclkUrMfmSGPReFNBf1Pu6mb8PsYvRgiZPbQ7IUkD8fpq2&#43;uX0evROGqNvLMcX9/Me&#43;UJSSy0OyFJoDiSW9tc0NdUdKCJXp8COH7c6qvPqeXQekISBu1OSILJCUfyNzcXjtDr0&#43;GIdT0&#43;v816b43xexJCZgDtTkjCsO5za2ou3NNkPTLWsBeJhyON83Y15W1qxi9p/LaEkGlBuxOSCEqt97YVbMvq8fCJYv5VjQVb7UH1vBhPyEyh3QmZHcWRnFBkbmezdYndqw&#43;lST3HrIvx&#43;ZubfUHeHE/ITKDdCZkpxRFfWSRvffO8XfR6cjjaOG&#43;oKXcd75ojZNrQ7oTMiIsh&#43;/wrvPscWTeAIP7yxrntDOIJmR60OyHTxnpAzVrrabL0eoo4ZgfxDXy8HSHxQrsTMj18AeuGNwSUpoFIkik62JjfyuH0hMQF7U5I3BRHcqqtF7sxZE8bRxoLBpr4HhpCpoR2JyQ&#43;SqzHyhbubTJ9Q1LOvF32/XIUPCGTQ7sTMjU&#43;fySvsdl6XLzDNCQtFB2wXhjPy/CETAbtTsgU&#43;MrtsfF8TI3LmH9Vo3VDPG&#43;WIyQatDshsfBVRgq28InxbuVIY0FfE8fZEeKEdidkUnJCkXmDvNDubo41ztvRxHfPEGJAuxMSnZwq&#43;yF0hkuIC7Hvhs8Jm/&#43;DhGQztDshUcits1/1ZliEuBYIfrgpp6bZ&#43;H8kJGuh3Qkxse58G6HaM41jjYV77TvlHP&#43;hhGQhtDshl5C7prlwlGrPVAr32w&#43;sdfy3EpJt0O6EfA6jdg9QuI8RPCG0OyEXQcxnqZ1Pmc10jlmCz6ml4ElWQ7sTYmENo9tHtXuFo42Fu5tyqil4kr3Q7oRY74axHiBPtXuJo9bj6HmbHMlaaHeS7fgqI9Z97XwanfeA4If4JDuSpdDuJKvxlUesN7pS7V7lSGNBfxOfRU&#43;yENqdZC846Rf0NUEAphKIh5h/TePcruY5Jeb/PiHehnYn2UpxJL&#43;tef5hUwbEe8y/ujG/me&#43;DJ9kF7U6ykpJI3vrm&#43;Yesu6cMExAPcqyx6LLG3LUUPMkiaHeSfRTbg&#43;T5QLoso3C/PYSegifZAe1Osg5rkPwQ1Z6NzNvBIfQkW6DdSXbh80fmdjUbJ32SPeRvbp5Tau4VhHgP2p1kE3K5/WrzjE&#43;yh/lXNuau4QV44n1od5JF5NTwJTHEelFsThUfUks8Du1OsgVfIFKwnWonFgVbeAGeeBzanWQHpZH81mbe/0YmOGrfAc9H3BDvQruTrCC3obnoMscpnmQxReN8SyzxMrQ78T6&#43;SvbJkygUDLB/nngW2p14neJIfqSZD5MnTuZf3ZjXyPHzxJvQ7sTjcJw8iYE9ft7cZwjxALQ78TLWs2u6qXYSi7mdfL4N8SC0O/Eyues4mI5MQdGBJuv5No6dh5CMhnYnnsVXESnYxsCdTI01vK7M3H8IyWhod&#43;JZ8jY1z7/SPI8T4qTo8sbcdQzfiaeg3Yk38QUi83YwcCfxUrCV4TvxFLQ78SZ5jc3zrzLP4IRMxvwrGvPWM3wn3oF2Jx6Eb3AnM4BvfydegnYnHiS/mYE7mTbzD9kPt3HsToRkIrQ78RpW4D7MwJ3MhHlDDN&#43;JR6Ddiddg4E5mDMN34hlod&#43;IpEHjxijuZDdbVd7&#43;5XxGScdDuxFPkbWyef4V5viYkfooua8xdy/CdZDy0e2IYOXzX2fNf&#43;eZ33hQuvP7G4eMPlG8Y1Mtg8taTT2GWlEF5ZxkBxVRV4PTjL24dvdEoA1p3XI0ajEyAjcEsIxM5&#43;haizkXhHqNMxlMamcc3vZJZcsx6dB1fHEcyHdo9McCX&#43;CmdCaJVZeDXidxLk1O0EzMuTXCzXgZgQeQ72wfIRBtCz8Fm2HVckqK2DDKa3DXNRQdodzJbisaacmrdG75Pq1nvErBhCFoAzmM4O&#43;EDttYZYEgxnNkkCIkRApEpwUmedk8AYnf8VXvwBx9&#43;bDv0c/squ0sZ8OZbv5AcfFBVAcnEbo1FAGqTHL2tAGSlxnGOKB&#43;ZWLvKwSEkG4O1yPGPVb/9zh&#43;8d8zM7Wmaf9g8UxMyXeZf3Zjf7l67x9&#43;sdw8452DzjITzknFOi1oMyShG4gG/G&#43;2eAES02DVVjtpNlX2V3VUZgLmSqS8rOSivcqQdYITvUsxoGaimgLNVoVfoPXyBSOE&#43;Bu4kMRTubvKVm/uYS4jRrEerXc90D3I&#43;xObhA9DjH93c6rSJkxXALDn1obAHryQmGfxutHsCcNpdRcwqU1lWlRHQ3EamflhKMV3GUgZtdpUDeUsxJL0Vj3okU12qn2y9HsN6Z8wh8xydenadvf7hN87/56/&#43;C9z1tScuP39n6S1dRpmk0vvolde/dibFK/Uebn4wrRzOkzXrU2PB6fb8ibZxnlQ52E4xN5KqTdldLyY5&#43;vmQxAN&#43;NNo9ATjtDux9cmrLSqMbqaFjVHJkUu3NyJeGgn5EqaWQVCseJSeyonUGGJvnMayXvR4zz9GppPau7T/93cTZSk/P//DLRsnkAanLStGqMGZNBloD2HIjkyw42liwpcnYx9zAlM16pwURASM8wDkK4Fyh6x814LSARZCprnbjg7OJoCrBXwmp8UEvhkr0GozNEG1jlp6JxeXMpuIWKYakygDJUadHEif40Wj3BIC9Fj&#43;l0if2WmlKY99VZbC7Wzupw&#43;4oLPnqeJBJHD9yqOAzDl3VShDkMJBjQ7XiJVOOc/1AktBfMo2jzhvkVEWKxtPZLQ&#43;t/vYvv5cfGTpH1A4QxH/4t4&#43;bTu03CicVtDCwUjjbyI&#43;KbHOchbONwtGmnKC5p6WdaTXrcW5R8bFKOGkoU8pJCWcMOZOohKV0czsrQcLJRJWB7ydytYRMVYOcmvSTkiDnSeMMhqQKyLVLVYDED3432j0BiINlL1RHAg4Yff&#43;ezO5A8g27GwmHgX68yRpxMMhhKa14WbUcIchXhY2DHMt6rCGc35rm59PB6PLbxh80uwHZZto9KvOvbMxvdl3nvDq68Vc5TzKdzXrVXY8POEWgZSDnAbWgOinJyQqTahF17lLGlYgcf2VStS1UJdgALIUVqUrUOU0qcdpdVW5MIiDBimRrvXe&#43;Sg346Wj3BCCu1ROOFr3fDKhjQM8EUK/kqyNBnzSOSSV4OZJRRg4kHGkoiQ8idXxAMjYAB57UI8noDMhgSiLzdqazW772ru3ykyJeN2Y5QZR//Wtn0Br40n9/C&#43;WNXnE0DqQSGBcf5OK9YV/UgGKqBtU3IIsIerV6VbvOXi&#43;ZKIBJ2WzV2WBsDGqWBR9&#43;47xzAAFmyYbJxoDJrvdjpSgsW6s2QL6p8dVi5KeBo40F213XOS/9cEqxckKQ41rUqJr1ckJA0mMMFeWLL9VJSdenrAInFpmUkxsyVQElXZmU8oa5pYyqZDK7q64ImVR21xPOdaolQeIHPx3tngDkAMCuic9qB1W2FtSBpGfq&#43;aq8MQlwfEqmHKiqQSDuxwccYFJGDifZnqj&#43;RqY0/HHMGLMylNy65qKDjlNzCoHV8HsiRXWbDtz24d8u6QJFgs9UAagUObCpzFJJSRFAkxO5F5MIHlKcmNbCcVQ&#43;kXUxoRjyUWBiWku6U2HridyLybjKgJzf/uX3xlADTOo/Aso7xyJgKTQj5EfDZ1UYYFkp4wq7y43vVeb&#43;ll6MZj2O&#43;sma9eqkoZYVVFMAn6OelAwT6yc3QdoWqoC1/KVtCCCVYF36pFpEIflIxiQ2DGc5/FU5WKlaisQDfjTaPQEYB4BM4jhUoTaIeiAB1QxXOTKJ8ioHiJJlFVKVaqTLLFmpGF2OfLU9Bqq97I3&#43;rvzNzfOvNs/LqUR0CzEb&#43;QZQmqgdfyU8VZ5WMhO7I2EWxCxX7jGpLIhKpIDE0yiPAjILlSjBqwrlyjqKoTCEjcIyCx7FBykM0eIzUGJWzQt9QUziryojBZBQGI0P9V1QmxRASVE7lpJV4C8qREmZK&#43;VlewRpixjKTyNu65yfVrNevOgUqn6yinpSMhaU8srTQFoYKpq3lnecr4yaJ9sYOfupSEOKIakCQPoGkPTTKZkS/GK0ewLQDxig&#43;sT09mbUAwn7q7hZHSpAihlHixxRsgoZaaIOFXE5kvK9UcBAbZ6xioyk2H5tzFHzvJxKRMkirRhINAx1KUECY1lnVRAncpBkUvlb9aLrtQGZK8pUBtWNKx8Emav7FagGhET5RqaqSib1ZeULqo1HSSmjR/w6Uh5/VQ6WRQ6aCyonzRxpLNjmos55OYfE2ayfTKj6ySrqSclYUPUBoHJ8VmcbWSOQSeNkokIImZxsY4yGghRDUgWAqsoL56sUgl&#43;Mdk8A&#43;gEjqN1UxcfOAwmWlV4yJH3HdeaoA0y6v&#43;QAU00HtfcjX3JkXeosID11Cue2ZS7WaPl0P31WlKy7MCoSRhvFJFpV8XfUqpCDJB6FKWXS6ANXyFwlXVmpCtkNjMKCsjIaFpilkEBcyVjKqKWAtDzwFWRSvosubwNpuKj&#43;ANUWUQ0XN1A42uSrNPe6dDGtZr2cNNQshR4nOE9KQM4PuonVilRSpxogOUr2glQSu2denbjktAbUqUmVAWoj9VMimRL8YrR7AnDaHchRpPZvtY&#43;ioYqSqrsJSe3cgmTi&#43;EE&#43;SqpDC1VJ35S0CfSlpBWvH2D2EhNX4LAlAFXh4FfrVRuW0VgvhUv329xFY8pqkyE/u6FSTEq&#43;TE5pd6C6zZGcYa7kq8JoDUCfkonKDXFKvrFJIunJUvx2lwJovqgCTqTxIWWkoYM2hF4g7cw/1Ji7xi2d83IqiLNZH7WLTp2FjFF1qgAQxTrtjhw5d&#43;kVAjmlqG0AOE3J2U9lOutEJXLWQkmVKcWQVA5Qpyz2zE8L/GK0ewKIand15MCp&#43;qSesGcbbV4wMe/ShFWoEFxy9GMMR5HRSJejC5XjMJbyesJcb1x0L&#43;hL/7PlRbcq/p4M&#43;eVnb3eAz1ISCTrUnS2ZemHMlT5wJGykPkBPMo1NEknDu/jgRBWWZdVSAHORY9jdqNxAX0S65VXPv0uYf03j3C632H3KZj38h0kkOVeIF1EGBZAjkkZSllUnJZkUDBNLfwBWjXyAOgEylWtVIwNzsRZsnmwVkjplSZ3Il0rki0iOfiKSYkioH9uGSTm1IulXOUk84Eej3ROABNm6bgXso8gXu2NHx2cFMifzq17MWRIHleSrHCBHgp6jbxL&#43;4tjAcQJwZGKWN1rBPn9k3q40P6IOqEvjseNUiaGNMhKwIslknHYXkCN16kacrDAcL13renActbAYd8oYWpbVcwy7R70SYYCtsquxrs3LB6N3If0cbZy3s2lOibnvpQX5ifTzTIxmPT7jMFceVQk5SrqoSjJlUsB5AznK7kreRtKDdZxeJnK1pLdCpE4jYRXGOTBqMSSqfQbgd6PdSaaSE44UXeY4HacDdXnbkBOkpdwpsamSnyA6VyPRpmV3IN0Gep0xCiNT5qocaRwYq1OijVqJQsroOYbdpcMAv0zU8QEK&#43;Vmk5aF&#43;B1dRNO6KS&#43;8zaNarHLTppXGPUEFv2auQQ&#43;UAqVN3s&#43;QAmB6fMQv/WUiqlSBl4HtZC2Ssz5K5UoOAGowCglEMYIOjliRTgv8g2p1kKtabY9J6L5xChe/wJSJpeBGIepXelFwl1MakuBxJ9ZZPaXdUhVUg4scHFY7HiN1RISwrbQ7Rrd4UUFuIDUAZfSnkY0VYBLJHDgqgmN52sVYT0&#43;4oLGWwkVIzNhv&#43;1jdAMqUYktGx4RLmX&#43;XeN8qkBsOvaB9IDwFkrOcTV4H/INqdZCqueqG7bik9wW0qeFXXv/WETFWJaDWG3SFymVQJDtaDY8mUwsqvelItCaDCdEnwt&#43;SjQmk3GEkfxCc5ahIYdgeT/SbSYlBIpvFF3IN16b0ze&#43;3eYA/cQUSuAne5nI8coyRxFfg/ot1JpmJddE/rne4GkBZULV6EKRGnOoNRyFXiV4APumsB9Il8YykpLEaE/yB4yQFYnQq4nYUBqlKrA87tQQsAlchcvZ1hrAgbZmyq5Os5qFxK6pl6/cC5wQD5&#43;MX0tbuLo43zBt34vrjUcNgeVedMDNxdDv6PaHeSkfgq3HLRncwGNCMQteNMZLQeXMQx&#43;9J7mbkHZg/l9uV5dfHeeVmduBDanUyPnJKWJdV9uSWtRn7qyW1wy0V3MjPgdelawGnopy67zd1g/pWNubVZfemdZBy0O5kel19/8u13/rD3qjvTLvj8SPOCI&#43;ZZmGQQcp0eybVX3BXzr2nMa6TdSSZBu5NpAKN/6RvfxU7z0cefPPH8/0vvTfMFfe666E6my/WvnUHgjr/6UHyXcqRxbnf2XnonmQjtTqaBr7jFv27nXQ8&#43;i/3mn//61/ff/Fnz1kNGmRRRGpk3nP7n2JBsQQbWFTv2Q0LcCu1Ops3CcE/f3ut&#43;9ZvfYe9553fv3Xj3F1LfS&#43;8LRgpHaXeSKo41Fu5r8lWY&#43;yEhroV2JzOkvn3k/Gv/jh3ok0/&#43;du7CN6pb9xkFkkpuXbM1YJ52J6nhWGPRgaac6oy59N7QMSrj2418IA&#43;lVo&#43;iUyUVZ&#43;33V6nyJEOh3cnMKV2348qbTr//lw&#43;xG/3kZ7/afeh2o0DyyNuQ/lfDkazCelnc2hTZfV5FR2TbVd27jxn58dMa7QHyAvyN/FsvPn1WlTSS/hh5kongP5F2JzMnz9/WOXz0je/9BHvS7/74/l0PPLusdsAokwzy25rd85Q6kg3Mv6YxvzkVdp8f7D712PkPPvz4hQtfLwx0GnPjZAZ2xwdBHkWHZLzihWQW&#43;B&#43;k3clsqdu8H&#43;ejTz/9FPsTTg3wvVEg4RT0c8A8SS1HGuf2JH3Y/LruAz/48f/83//9E4fSTfc8nlvaZhSIkxnYXRUA8hh5VYZkIvgfpN1JAlgQ6r78&#43;pM/&#43;9&#43;3sUv97Be/OXDs3vyyzUaZBDJvkEPqSGo52liwLbl2P3TjqXd//x6OoD/&#43;6S&#43;Dlx2fzR2ns7S7vDdWXiMrlG8YlAv2H3z4Mf6ePf8V43F1mEQmFpQCxsvoAHJkcZRBDID16nNJwsH/IO1OEsbmndd82b4h/p///Oe9Dz9fk7ShdoV7aHeSWo41zhtOlt0Dm4afffmrf/nQeiLvF7/27Yb20Tz/DKN2YTZ2lxe8InxXOfC0lNETPK133Uu1elJzsbjzNfNIHLuXVPAL0&#43;4kkZSs3X7PQ8&#43;/9/5fsG994z9/1L//eqNAQigao91JajnWWLg/KXbfMnLj99/8GY4XtIlvufeJio1DRoEZoJwN6RrAysh32l3mSp88PhihOeJyIAE3YnqpRI28U5VA2FgQYTp0LrOAXMjHIlgp5qIM6pfyxlpIAsHPS7uTxIMDWE5YOKSvuvn0qtXbjAKzpOhy3g5HUsuxxqKDjcZ&#43;OEuWVPfdfursb9/9I44UHC&#43;9e64tquwyyswMpdvJktPuRoK5Y1waMOJ7mUTSO/MFRPAyC2X0fKORQRIOfl7anSSFqsieV7/yxt//8Q/sZE&#43;/&#43;JUNvQeNArOB748hqeaY9S4ZYz&#43;cDU1bDp278A3Le5999sTz/29t97hRYDYoZ&#43;ODgXSSx&#43;iZh6FVBK8yAeJsufQu6EuhHSC2xl/D4liRlMQHnairIAkEPy/tTpJFbmkbDuNfvv0u9rNf/&#43;Z3OGvEiAamBd8fQ1LP/MOJsXtOScveq&#43;780U9&#43;bh0Xv/390dseWl6X4PtInc5WiJhxYMpk1JKYK5nq2rmKzo2kFkFJETwSGhBqQVVV1ITmgqqBJBb8vLQ7SS7NWw9977&#43;sXnqkE2eeCTbtMgrMAHbLkzRwLAF2D2waxlHwySd/w&#43;HwtW/9oHfPtUaBhDBLuyNMl0wJxNEul8mz578ife9Rl0LbHdUqx6MMMsXu8D0mnfC6e/LAz067k6QzP9j95LkvyVPtvv7GD5u2HJpb1m6UmRbmaZeQlGDsh9Ola9fR117/TxwFUODDZ19NyAC6qECcWAuSkQ/isTs8LZnichkWp4&#43;ij1E/lpXOfxlzd/j4A/iM76uXISkAPzvtTlLE2JG7f22/ewaBy76rTyycRS&#43;9cc4lJDUY&#43;2H8rKjfcvn1J3//x/ex/7/537&#43;44ob7fcUtRpkEMku7Q8ySKbG12F0tAiQiR1I5ehQuc&#43;WauuoGgOZVAcnXJ0nCwW9Ou5PUUbZ&#43;J2L3f/zj/7DnIZoPbBqe2dO4jHMuIanB2A/jpKF99JGnL9iOs3rjEzuALiozsDtyBIm8kYwb3hB/I5QfOXyXDIiTJF33onDUjAJAOufV8LrTj79ol7Wif9SP2pCDMvggBUgywA9Ou5NUc9eDz8qDO976&#43;a87h4/M4AWyxjmXkNRg7IdTUlTZ1bPn2p/87FfY29/9/XsPPPHyjB8dPy1mYHcjGePdZCmV0AKQRoAE6M4xd0ZXvOoMUAkFjGieJBb8yLQ7SQNtO6756f9Yp7x//evTm&#43;95fLqnPOOcS0hqMPbD2CCivfHuL9gu&#43;&#43;y/fvq/SRpAFxWsWgJxIx/AxBJAy6QqKcC4mBX13hbkSxkJylEGhVWA3tAxqlfirEEvgPiePfPJBnsd7U7SAOL1pbX9cr/v//3fP7/0je9O67G1xjmXkNRg7IeTMbesfW33uDyVGUHqK1/&#43;1uKqXqMMIUmFdifppLCyc/zYPe//2RpL/&#43;vf/n7syN1GgckwzrmEpAZjP4xKYaBzz5V3yF79zu/eu/rmM0YBQlIA7U7STEF5&#43;8a&#43;y&#43;WqHqKcR56&#43;sCDUbZRxYpxzCUkNxn5o4CtuWdmw9cEnX8bO/K9/ffr9N3/W0M5XpJP0QLsTV&#43;Bft/Oeh56Xc&#43;I3/vNHbTuuMQoYGOdcQlKDsR8aYL/94Y&#43;tJ9B9/MlfT33hxVm&#43;542Q2UC7E7ewKNwzfPltP//lb7FT/uo3v7vx7i8YBXSMcy4hqSDms&#43;quv/NRuRMEe&#43;/28Ztn&#43;bwmQmYJ7U5cRE5Jy4beg8&#43;98jXsl5/89W/PvPT6ZI&#43;tXXDUceYlJNkciW738o1D51/797/&#43;7e/Yb1/9yhuBTcP5ZZuNMoSkGNqduI7iNduvu/ORjz/5K/bO//z&#43;T/Zfc8IoAPiOOJJ65l8Vxe5Dl98q74OB3W848diK&#43;i1GAULSAu1O3EhuaduOA7d8/Y0fYgf9w3t/vvP000uq&#43;/QC86/g&#43;91JajnWWHTZJXYvKG8/9dj5997/C/bS7/zwvzfvvCZRb2cnZPbQ7sS9VLfue/jsq9hHkS68/kbn8BE1q2i8iXYnKeVYY&#43;Fok9oDm7Yc&#43;uLXvv2vf32KnfPBJ18ON&#43;9RszxPq/16NyOTuA3smbQ7cS&#43;Fgc5rbnngf375G&#43;ypP/vft6&#43;6&#43;bQ81a5wH&#43;1OUgvsvnvC7kdve0iew/rbd/942XX3LatN8NvZZ09Dx&#43;g3v/PmBxdfxoqEDT79&#43;IsJeUKcVKjnoOa33/mDeqc7cQP4P6Ldidvp2nUUcZKcUxDNV0X2zBui3b3Dwms3LTq2ccnRDcuPrC05XB84FK46GKg5UNEwWrppz7LI0KLNO&#43;Z3bZnX3T&#43;3ty&#43;/tyevrzt3oDN3S2fOlg7flnaf9bfDN9CZM9CV29ed19eb39s/t3ugoHNbYdvggqZdS9btX1U7XlZ9MBC6PFh2dc3KI6uXHlm3&#43;OjGhcc2GVsSi2ON83Y0wY7YA2UA3YXX3&#43;jefczYV10CYms5XowE38/ewVKVM&#43;fWaA&#43;&#43;JekC/yO0O8kAltb23/Xgs3KN86vf/MHwPTctvnbq&#43;&#43;IWXde46IbI4htbl97SsuK2tlUnulfdtWXVPduL7xssPbXLf3qv//R&#43;/&#43;kR/5lR/5lx/5kDpQ8IBx0cwFy7zJhV3lpqb&#43;mp3SUnh1bdu2PV3VtXnehbeXv7suOtS25qXXRDy6LrmxY6NobowOjLjq5bdc1q/9W1VZcH1o4Ub9q9vGXn4s4thT19c3t782Hrre2&#43;rZuFORN/2/HB&#43;mtJ3YE112abFJtYyloQc/u781Bzd3/B5h0LmoaXrN&#43;zsu5AWeWhcMnV9SuOrFl8bIOxhSZHG/ffd9s3/vNH2AM/&#43;eRvJ8484&#43;YnpSu7Sy86UC9qk/e&#43;zAapR88ZOXzX2fNf4aPjXQX&#43;j2h3kjGMHbn72z/4KfbaDz7&#43;&#43;ObXHgzdMWCegmH06xuX3hRZdrx9xR2dJXf3ldy7o&#43;Tk7pJT&#43;0vPjJaeGSs9M27b&#43;rJL0UUeD5cujmaBVfNYyZnRkvv3ltw3VHLPAFoSy27tWHZz25Ibm4wtzGaWHltfek0dYuj6A/7GPcvadizo6itAwN3flTPQaZl42&#43;Y5YMLNk1h8BljWt&#43;ucqByy78qF79GM6NhaGBlevG5kFRoZFVdWrzyyBi0PY7PLb&#43;2588uP//EvVuPyez96a9/VJ3JKkvh29tmj7K5nqve86ZkzICGVkGSD/yPanWQSVZE9z7781b/&#43;3eoaPfej11sfGFt0HQLlpqU3Na28bfOqE/0l924vvX&#43;49DR0bkThM7D4LLCUP2rH94Or7upfeUfn8uMRxPSGNrKBxcc2QpmVV4ZXjxY37Vrasa2otzevvzN3wO5XVwG3LuPUcHG9c&#43;yO/dy&#43;nrzugbktgws37FtRc7ACrZClR9fD9N0PX/H8D79sG&#43;2zZ156fUPfZcY&#43;6UKi2n3r6I1G5qJwz60nn1Lva3/zrV84e9dRRl7HLmXUu1xlLqJ2NBoE1eePRVBMFsHfC6&#43;/gVXLLJIy8OPT7iTzOP7w42//6XfYff/3T7&#43;5/NUT1Wf2lZ7aW3p65GJo7jImTL&#43;/9ORwyd19K25rW3JTy6LrTQt6jCXHNhRfUx86FNywd8Xm7fO7&#43;&#43;fC6IZf3clARw5M37GlsHt/6e3P3PC/v/8l9rRf/vG3N5x6JFMeUxPV7tI5D9fKJBwsYwONBDGrRfQy&#43;hg9JCmA1sDEtH0VwJkpiZfkUw9&#43;dtqdZBK5/siC6vblbduGnrjl27/9708/s29J&#43;sGXNzx1velUl3Kg9PRY6cldJfdsWXl7x7JbWhbd4KmAHpH6qiOrg4dC60ZWbd6xoKd37pb2HOlmt66jpyNGnxYTG7nZd2hf6JUX7rbd9Nn3fvyNK&#43;4bW766bl7FBmOHdCfK7hJP468yrnoju0ThcDZyYPHyDYPq2ryzjJgbZaJ270uOsru0A8ToWDUqmf1QPjJd8F9Au5MMwFccKQptXr6&#43;v6xjvHLHnaG9D5fdeX3NY0ee&#43;&#43;kbH/3deqrdt9/5n/7zJyofPuSwqQuRC/YHrc6G&#43;3cX3z2w8vbNS2&#43;OZHQ0v/DaTdL9vmakuHXnQlvq1nC2i9e53S51nR3dBTcf3fxfP3gd&#43;9VHH77/ldce3rd9RW9jXqSqaG3t8oq6ysVVq/PLYj1zPu0ouxtJxdDwtOQokQsSqUt8P1kZyXTmKLvLJNoBqgBJPfgvoN2JqymoaF62tte/eV9g2/Hg7odDI&#43;dCY68Gx18tP35n6ZnL4chrv/HMux&#43;9j135T3/96MjXngo9cpXmUZdjad5/BpofLT05XHx3/4rb2pfclGGh/OJjG0qvqas7WB4ZWtQ1ULClwxrrrqSOz4Y7Xc6&#43;7csfuv/ABx&#43;8hz3qt2&#43;/9eiZK6xv0TZny&#43;o5vX5fb1lOZyC/ObSgrq64pLaqqHK9sbu6BGV3KFZdVte7xyFslakjobmI&#43;fDxB/AZgbhaSrCXi2V3ifiR0ErgQPp0gd&#43;fdiduxA7WW1Zu2hrovya066HQyHOh8ZdC4/D6K/aHlwLX3e8/bdkddDx/23&#43;8/d//969/Yod&#43;5X&#43;&#43;1/D40bIHJ2a5Ff3Wu4lQ3rol7/T&#43;kvt2rjrRuexm63Y&#43;w6NuY9mxdRVXVa8dLd68rWigM2dL&#43;5xtbZkXqSu2deZdtrfyG6&#43;fxV70j7//9fvf&#43;eLVBxom5m729dfl9PqBrw&#43;UWppvryxYX7OsvL5yYWhtTunnj7FzA8ruMgnL4jM8vSjcIzkQuRSImsTuUsYZgksZZ46yO9aiOvmRUI8qSVIGfnnanbiL3NLIwprWkpadga03hfY9ERp7MWQZ3ZY6Pl&#43;k8ppH/aeuuCjIg&#43;FHrjr53df&#43;9al1Gf6tP72z8&#43;WTalbGYWkeofxdPcuPRxa7srt&#43;&#43;dG1lVeG1&#43;9b0bll3hbrTja7Bz4zpS4M9hYdv7bjN2//N/afjz/&#43;y7lnbt/aoY0BbPP1hXNg9AkuOh5/uwJ5G6sXV9ZVLAqvyXWN4w27I4CWa&#43;FqxJyYG2G9TEZlxnYXsFJpVSCp9ZKUgZ&#43;ddiduIa8ssri&#43;vXTznsodd4RHnkekbgfrL&#43;tSVwQvf8Z/39W6FBGv733tzC/&#43;/Hvs1n/52yenv///9LkZBUL5y60e&#43;/v3FN/dt&#43;LWlsU3mH5NF/B68MrQxj3Lu/vn2sH6v8Hrn1swA9nakbOzt/D5s8f/9tePP/3009&#43;&#43;/daJW7YaZbZEfL0Bze4Ky/FzQHd5bmPVolBd2ZKqhjx/&#43;i/JG3YH0s2OJA5WBWL0nKtFVMQvSKYzx7C7MFn3Pkk2&#43;Nlpd5J&#43;LK83dJV17A8O3hUePRccf80Gwfp5Q&#43;o6ZSduKIUCNS&#43;WP3h55OmbX/rZd7Bn//2f//fN37y1/snr9AIZgnTaW463/p7aX3LPFus&#43;urQ&#43;GEfi9U17lvX25lvBepsVr5sWzEAO7C7/0fcnrhP/x9efxaRRAAxstLriJ0Xi&#43;BIfHN9UtTBUV764anV643in3YGMmFPxukTzCK91eUP2ahKf7TrMe&#43;QkU&#43;UAyVF2xwdVSUPHqMyN0YwgyQC/Oe1O0kluaWRRbWvp5v3B4fvDo&#43;dDByD1Cxe9HkvtoOKWO9Wld53axw4f&#43;/rT/7Avw//2wz8d&#43;dpTRoFMQF2Yt&#43;N4/D29v/jugeW3tqY&#43;jl92dF3gqqoN&#43;1b29uZZUm/9N9jd8F&#43;Gcv&#43;J3e//6V3sJ3//&#43;yePPXDlju4ChPJGGeui&#43;5qYdhcuOr6nzIrjA3WBBeG1OSXpcXxUuyvRyoVwNbAOCY5HpoyG0y&#43;T68&#43;vRT5QY/RUGSA5yu4og6YDlkV5aVKwZz714Gen3Ul6yClpmV/VUtKyKzh4j&#43;V1K1h/1b64PoXUFYFrT&#43;uX3nUqHz6046X7vvPOz7GL//lvH7/w329k1Fh6nUvjeMvxfcuON6fmsXdLjm0ov7Jm7ciq7v65Wz3RD6/Y2Vv49a889fFHf8Ye8tZP3rjuqkao3SgzQZuvr9bh8snw50zE8RW5G2sWl9cGiyrWGXt&#43;Cohqd6BsLTegQ/ASwauESf3&#43;N4Tg6tq5JFVelQGSI3ZHjO6sU4mfpAz88rQ7SQOFoc0rm/YFtt8ZHnkueOA1&#43;xI7hB2v14XKK5/wn7zk0rtByzO3PPTDiU7XH/7&#43;l9teutcokDlcdLx1L8Blpaf2Ft/Vt/Tm1oVJG1e/8NpNxYcb6g6UdWwthOHgdc/E6&#43;Daqzb94uc/&#43;Jfdu/PS83cd3FNxyRg6gxZfb9Bh8dggji&#43;xQvmuYP7q2pUramrnlm0yDoGkAitDqE6nqnzVT44c6BxBNv5O5mA0BSRw3zp6Y9SaJQez9BxZBNXq&#43;SRlYN&#43;m3UlKyStvXbq2v6LvcHjkafvi&#43;oXQ2DTidZ3gwefLTkzxiLraxw4f/NIj79g3xL/9wXv3ffeC62&#43;Wi4Hu&#43;IOlJwdX3tGx5MZmQ8yzZ9nRdcErw5GhxQOdOXLnuim8TOaZJ2587w9vY3/48/u/v&#43;/OXbu3LDYKGAxs8vWWO/wdD3Ycjw/toYJwfdmikIsG1RPPQ7uT1JFbGplfvblk8/7wvsdCkLoFJD0TryvKj99eGu3Su8HA&#43;bsu/Pz72N3/9s9/fPkXP2p95hajQEYhl&#43;RlXP14yb3blh1vTVRH/eJjG0uvqVszUtzXkwuve6YfXjg0UvXD733pb3/7BHvCG//&#43;wpHL18YK2YXNvv61cVx0jwEcb12Mz2msWVRaFy6scOkDcIjHoN1JiphX2b6ycXtwx&#43;3hsZfsrvgZxusGgWOn/afievrshqeuv/Vb5&#43;SxtW/&#43;4e3DGTnUTkfi&#43;MsRx/tP7V11onvpTZHZvFR&#43;4bWblh9ZW3V5oGN7EaS&#43;vfXfMvr&#43;dSen7tr761/&#43;GP/7//jH3554&#43;PD4rjKjQHTafH01DmFPl4mL8XO6KvPq61YtqWpgEE&#43;SDe1Oko71dJra9vLuq6yu&#43;AOvWWpPhNeF4JVP&#43;u87fKn2YjH6xYe&#43;&#43;6411O5Pf/3o4R9&#43;JTPvl9OxHQ/B4&#43;/JoRW3tc3sYfWLjm30X1O7fv/K/p48eH1b279Z70U1PJex7N&#43;56rWXTv35fetBCG/99I07burb1pVnlJmUiK&#43;30mHrmeH39Rdbj7NtqZ5fXhcszJAX0pAMhXYnyWVuoHXlpi3hobuC468kMGT/nPFzZXfeaNz1HpuO52977L&#43;&#43;&#43;s9P/4W9/xtv/3TwlQx&#43;qp2NFsSfGSk&#43;0b1kmkH80qPrg4dCndsKJx45563e&#43;BsOR374/Ym3s1946f4jl681CsRmYMPsuuWdWAPu5nRX5tU2lFiPsE3TLXPE82CHp91JUrAeFF/VXtYxUrX/Sdvr0R85N3sqbrxnsvviJiPw8KHr//3ZX/3FunP3f95/94Z/fzacqffLKbQg/r7ty463xDOcfuG1m1YcWbN6rLRPQnZveX2or&#43;gLD14tD5d9952fP3T/gcHeIqPMFLT5&#43;usdep49COJLrCC&#43;sXbhypoaNzzbjngP2p0khdzSyOLVPcHtt4ZGXwkltCveSeXVj/nvu&#43;ZS1cXF3tfOfO3X1oXYf3366aM/&#43;mr7c7caBTKQi6PtTu9feUfH4phvjpfe&#43;KbdSwfafd67yn7VeN2XLjz0r39a97x951sv33pdl1EgLiK&#43;3pDDzQmiz3Z8R6igoqGyoGKjr7jZOIgImQ20O0kwCNnnVrSsbNoS3vuQdZV9/NXQ2DnDxwnmwAvld9zk8FxcrHn82CM/ev29v36II&#43;G77/58&#43;NVTmXy/nHAxiD9zsPju3sneJ7vk2IbQoVDn1nnbWjP&#43;BTAGWzty4fIf/&#43;jr&#43;D/98IM/vXLu3pGhYqNMnFjd8jO7Fy5ObMH3lOfWN6xaEF5LwZMEQruTRAK1F4Y2l3XuD488b6v9paSr3abihnun2zmvc/hrT/2P/TjSP//t4xv//bnMH2pnYzVTLi89uXP5cfMy/NJj6&#43;sOlvX15sHrHuuNHxv2P/bAlfJ29l/98s0z944YBaZBkrrlTazL8PiwqW7JkuoGCp4kCtqdJAyofUF1a&#43;XAsfDoS3ZvPLybxA55ncqrnvDfO42R807an7v1S7/40d/&#43;&#43;Q8cEq/97w86nr/NKJCBXOylP7V7xW2fP9Vu&#43;dG1a0eLt3T6tm3&#43;N9NnGc7hy9a88R/n8D/4j7//9T&#43;/&#43;eJV43VGgenRPP1H1M0Y&#43;11zreGilbW1vhIKniQA2p0kBqh9cUN7cOcdE4&#43;Ldwg42ZTfPtsH1AQeuuL&#43;733x9x//BUfFr//yx72vnal&#43;bCaX893H5f4zo6vuaF90fWPx4YbmXUusJ8Z7K2TfvXXJHTf1/e6d/8X/3Xt//M1zT928s2eeUWa6JH60fGzssfQdlXMr6oN5ZRxnR2YL7U4SQE5JZMWGvvDuU/aTZV9OWciuE7j2lP/&#43;Kx1imzaDr5z8yR9/869PP8Wx8cAPvrThqeut97M5imUY1mX48aqbN7QNL4S3vHTP29aOnLHh0hefuxP/X59&#43;&#43;umvfvnm8Ws7jDIzoXU6b45JFPZT7boq84MNFXPLU/pceuI9aHcyW3JKI6uatoX3PZ7i3niD4BVny&#43;45ZlptRtR/4ciLP/v2x//4Gw6Pr//6J4jpjQKZSM2d/T0jFTv7CrZ3OEyWyezonvudN17B/9Tf/vrxf3z92X07VhgFZsZAU&#43;IeYjMtIHi/r7Myv6reX1Cx0TjWCIkf2p3MiryyltK2XeH9T4XGRe3pxHrm/JnExNllD15&#43;5Gtn3/3o/dveOG/MykTqbu/uGSkf3LJkcGDxzv7CbZ2OV5hnMo&#43;cvvz37/7izL0jUV7NPjNm/2z52dFX6usM5NfUl8zj8&#43;zITKHdyczJL2/xbx4J7386dCANF9qdVB55aGY3vkel/MHL1zxxrOzBzO6W95850HBrR8&#43;&#43;ssGBJYNbFluCB/1F27u8I/itHbn7d66axsNlpyTi66syjZtiEMF3VeTV168qquRbZ8hMoN3JDJlb0VLWORred9Z6Nbv1ClfTtaknePD58ttvNvSWzfjPjDfc2t63129H7bbXL7LTW4JPLAPrk3ybe5zYgm9oWFUUpODJtKHdyUyYWx4p70DU/lRoLFnPl50ZgWtPJ2RsnTdYfXxz3x7/zi1Lda9/DgUflZZ0jKebDL&#43;vG4KvX8kInkwX2p1Mm/zySFn7vtB&#43;RO3uUjsIXv502YkbDMklg8FXTr74s&#43;&#43;89ad3cAi989H7333356e&#43;98VNZ280ioGax67BXPw18pNN/W2dfXtKh1RvfFQoeAcDG329AYdl00ipJfj6hpWFlbwGT6YB7U6mR35Zk9UhP/JscPwVw6wuoeKG&#43;/ynkzvKHSLHkeNMUV83d&#43;RrZzELf438pFJ7e3efda0dao9pd2AJ3jRc9pKi59NNB79E8Lm1DcXzAhQ8iRecdmh3Ei&#43;5/hb/5l2h/c&#43;Gxi/Y73I1zeoGgoeeKrsriY&#43;SFVsjIXDHZxgd3Pat81/91ZtGSUHie/w18pNHzZ19vfvKhuJRu2CNond4LvncdLTtG189&#43;9Mff1PAZ/3BsfisZn3v2xdeePq2u45v271lsSqQDAYa03Qj3JRYEXxuTUMp74MncYLTDu1O4iKnJFIS2RHedzYtj6KbFnb4npSXwdQ8ds1Hf/&#43;r2DqezvbuF&#43;6wGgJ2itpvn3DCd2/rHg1cMkI&#43;Dnb2z0ul4CFpuHzid9HSJx9/oMpA6hO5WkKBWT06PjYuDNwViOBLfV2BvGBDRW4pXwlPpgbHC&#43;1O4mLlpoHQ3kdceK3diRW&#43;J&#43;fqO2J00Uycqn7xZ99BYWkQPPHmN4y5CafyvqGOgyFb2NNQu7Czr2Brqh50o9QOhSMiRxCPv8gEqozYHX8RtQO9NYDyqlgCsa64uzNwV5T6OivnltUH&#43;bIZMiU4Umh3MjVL13SFdj9k3/xmqtSdBK67Pxnh&#43;3ff/TmOmck64Q1UoC9tgnc&#43;et8okFgCJ3e3XFVnqdrqkzflHQ87e&#43;emQPAQOX4NJN3lTsTu8LrKOXxwNWL3KRecIW1uGio/OX1&#43;X3uwYGVdDQVPYoMjhXYnU7CoriM0eHfQehqdS6&#43;1O7EeTHtn4nvCLSl99tmp733RyI&#43;KXKGXK&#43;6i&#43;fH/97BeIIGUn9q/6di6nduW2JfbTW3HzeIdvfnJFrxo&#43;70/vG3kGzjtDiSCxyw9MyG4bqj8ZNgvm4lUz19aXW8cp4To4Eih3UksikJNwa032q&#43;HyRi1C9Z7ZRI9eB4HDFKcA&#43;BlPJ0Uli56/NULJAr/mbG1N7du37lsqH&#43;RQ9jTYunglkU7upN4j9zuLYvtn/CzJx4&#43;bMwySKndMyRwV/SV&#43;jbWLZ4fWmccrYQocKTQ7mRS8itaKnoOhMZfsUfSpef1MDMmeMXT5XfcZIhwllheis/uajydDL6TOF5NJpQDtXf0bRleNdQ/m6j9IluXDg7M35a0m&#43;BvOtomv8OU186ddkfLQHrmv/jyGZWZEKyXvWZE4K4o9SGIr2soLijnm2ZIdHCk0O4kOrmlkeLIUHj0XCaqXQgcO&#43;M/dcihw5ljeSm&#43;nnkJ1tUVekhdlo0z7o&#43;f0D07u0crbLUnwu4WS5P3phlldyPfidgdwToWAYj13/vD27LslC2D6dHq66tx6NP19JXM6SnPDdRX5vo5hJ5EAUcK7U6i4CuOLFvXU7XvyeDEe10zkuBlz1kvjnMYccbIqLopb15X4&#43;nkGXbCOx&#43;9H8&#43;y06Li/r2Raxqsa&#43;2zutwehSSNsJuu3Z0p4XfEWa&#43;DqzDdmRH0F8/pCM1dXlM3p9g8fgnBwUK7kyjMr24NDZ6wRtKNm8rMLCqv/kLZvUcMKc4YdUdc1MfSKVQ/fNSUqBvfy06Prrmlbcf2pYnpk9fZutQaYdeTm3DBK7sfPrjamGUgdke8/utf/hh/MfnFl89MudS0afb1hU1rZhB9pb5NdYvnB3kBnpjg8KHdiUlBoLW8&#43;2DYGkn3Sob2yX/O&#43;LmKG&#43;41vDhjVFCOQFyXNPJf/Nl3ul&#43;4QyZlPN1Xf/WmPMlOIcvGOeQ&#43;Nv4zB2rv6B3YtWq4b1Hi&#43;uQ1rAvwCxL&#43;FPpZjqpLONbja9zwOrgZ4/f1&#43;X01DaV8EzwxwOFDu5NLyC1tKY7sCI&#43;&#43;EBy/EBo7Z8oyA0ns3XEqLoeqYXRnr7saT&#43;e8/00uxifkxvfQvYMdB4LD1iD5JKhd2CoX4E0jzhLE4vgRZnZHXGKxBtO5/PE1cdBXMqcrkFdeF&#43;QFeKKDw4d2J5/jK44sru&#43;u3vugdbk9w/vkdSoPP5LA4XVRO94hexkxJwrHpL6IAN9LYcTxxqxpYd/dvgECHhqY5S1wMbH655ck/A74M/eOyI9gPJRGHk&#43;rJpNu9xZfX5Vpygylr3hOa1XhkuoGPuKGKHD40O7kcwpDbZVbrg15S&#43;0WB16ouOluw5GzYdPZG2/71nmI/Lvv/vyJN78Br6tb3ZCPaF5M70Ri/dnY3X/mQN3t3VsHVwxZffIOJScWS/CLtif6DngxNxIi&#43;CcePnzX8W1ffPmM3O2mdJ5su/c3ZHifvI7f11fqq69fxf55osDhQ7uTCfL8zcWtu8Kj50JufbvrbAhecbY8CU&#43;vSz1Bq08&#43;lPiRdJOS&#43;P55hOlK8HqC7NW4uaTaPQMeKT9N&#43;krmdFfk&#43;mvDOSUM34kFDh/anVj4iiNL6tur9jxm3wKX4SPpJqHymkf9911tyDKzKD89sv76Jkh3dk&#43;cnQ5brb/JeELtTdobYPHBuNUNk1B7gm9tFyKZPU5&#43;EnwDxdYTaheF1/AGOQJodzLBvMrmir6rw9YtcBn2xNlpcOBc4LpTpWdMZWYOB6pPDPTvKUlh4G5j9c8vTHj/fHrYbD901jN98hp9pT78ra4vncsH2BHanQg5JZGVm3rDI&#43;c8HLgLwYPPld96m8OamUHg5K7I1Ul5dk0cLN3ZV5DKd8Anicx9dk089JXM6QjOXVnLN8gR2p3YLKxpD&#43;64LaMfSxc/1tvf7z5miDMTONBwvGPbzhXDfalXO5Dn2&#43;Rtdfgygxho8trldhO/FcGvqVtRVLneOMZJtkG7k0iuP1LStjc8ej5znyc/PcbPV17ziP9khl2AD9472H5ZVar75C9h6WB/UZKeP58KPHQLXAxg967KfH8dh9dlO7Q7iSyu7wzvPuX5PvlLGD8XuO7&#43;hL8fNnn4z4yvvall&#43;47lqRtMFwUJ35P&#43;Avik0Obrr/Pm5XYT6&#43;64ORtql/D9sFkO7Z7tzK1o9neOh8Ze9vJguqgceKHiljszZYRd6J4dXWOBWb&#43;&#43;ffYgfE/i&#43;2GTR/8aX1ao3Ubujquor2T4ns3Q7tnOsnU94b2PWG&#43;LyZ7A/SLBy54tv/2W0jOXGSp1G2Vnxtbf0Lxj&#43;7K0Bu6fsyM5r49LHv3rvTySLgp&#43;X3/JnE3VixeE1xrHO8keaPespqAiUt59eWjsldD4y4b5soTgFU9bj6B3t&#43;BD92zvGqtM6xV3jYm3y5gGdS3Wg2sCDv95nb4SX1dFXqA&#43;wPA9a6Hds5pla3vDex8NZWXgrggeerLs7mtd20XvR&#43;B&#43;fZMVuLvE7jaZEr4PNPp6g6b5sgK/1T/fVLPQeriN48An2QDtnr3kl0fKuq4Ijb1kv&#43;bVdF5WUXnNo2X3HDW06hLC92zvHg3Y97ibik0nSXg5bMIZaPLkM&#43;nipa/U112RG6yv4LvjshPaPXuxrrjveTi7hspPTuWRh8vuPWKYNe34z4yvv75xp8sCd2Gny8P35qy4/y02EHxT9cJFVQzfsxHaPUuZW95c3n2lPVQegTvtbhE4&#43;qD/3sOGX9OLNVQegXtSX&#43;I&#43;Q&#43;yr7659Ni3UXm2qLguxw/e8yrqK3FKG71kH7Z6lLFu7ObT7IQbuBoGjD7hJ8AfWX9&#43;03Roqn/Yb4aJjh&#43;9zTLOmnYivr8b0XJZivxl2Y/USDp7PQmj3bCTPj8D9YHj0RXuoPO1&#43;CYFjp/33TbypPb1U3jfUOR60Hynvum55m6U7rXvfHXJNL1B7rUNyWQzs3hnIL68P8sVx2Qbtno0sqW8PDZ8Kjl8wxEaEwLEH/PelP4JffUvbtsEVLrnHPRr2o&#43;t6802/ppFmRu0mfX4fIvi1NcvmBTYY5wHibWj3rCOnJOJvHwmPvsCh8jGoPPJQegfZlZ/a13Jlvf3qVcOp7mKn9eR5h2XTAq&#43;1T0JfiW9zsGBVXY1xKiDehnbPOopCTYHtx0PWC2NMpRGdysOPpPE2ueoTA737/Ol40&#43;u0QONj0Q4XjK0b4Aj5yekr9fWU51bXl/LJNlkF7Z51rNzYG9r7GO0eD9Z98Ol4V6z/zPiG6zZt377U9Xa32NlXkN5b47L8vvap8VvD65qqFnJsXVZBu2cXef6m8t5DobGXg9n66NnpUnnV42UnbjDsm2wqT&#43;7qOBC2BtNlgt3T&#43;2Ba60GzIYfPyKUgfO8K5JU3BI0TAvEwtHt2sbAmEhy8JzT2ajDb3gg3C4JXnC2/7bgh4KRSd3v3ll0l9ni6TLC7NbYuz5BuarBeD1NpmoxEwe/rKctdU7civ6zROCcQr0K7ZxPFkeLIztD&#43;5&#43;xued4INw2Clz1bcdPd/lOpeB&#43;8/8x445F1O7cudfFoeZOd/YXbOlN743ubr391Tha&#43;HmaG&#43;HN6S30t4aIlNQ3maYF4FNo9i0CzPdB/TWjsFXu0PO0&#43;PYIHnw9cm4pb4SvvG&#43;oaq3Txbe7RGFiQ0rF1clN71ryvPTH4fZ2BvMqGCl8xx9ZlBbR7FrG4vj04/GB47NXQuKkuEhfj56xxdncm9zJ8w63tW4dWZcYV989ZbL01znBwchjYZA&#43;Pp9qni9&#43;Hv2trlhUENhpnBuJJaPcswt82GLJuc2e3/KwIXnG24pY7/acvN6ycEPxnxiPX1EOWGdQtL9g3vie5c77N17&#43;WF9pnij1yvjVUuKy23jgzEE9Cu2cLef6m4Jbr7Pe9cjzdbAkefC5w7emyexL/uJvK&#43;4a7RyvsPvkMs/vgwMLkvlSm2e6Nr3BIi8SP1TmfH6ir9PGptFkA7Z4tLK5vr9z1kP1GONNVZCaMn6u86vHyW29LbBBff1vn1sGM65afYEfvXFPJCQEh&#43;zr7tjf2xs8S&#43;6m0a2qXz63YZJwfiPeg3bOFspZt4f1P0&#43;6JJXj5M4HrTiUwiG88um779mUZavfB/sKEvzJuoNnXX8ex8QnCtntTeMHCMN/47n1o96zAVxyp7D8SHj0XYrd8whk/X3nVF6wg/tQhQ9XTpfzUPuulcFthysy0&#43;8CCRD5zvvViyG4oiswGv6&#43;9Yl5JbZVxiiDeg3bPCuZXtVbuOhMao9qTRfCyZwNHH7CeanfmMsPZ8VN918DAruJMVbvF4h09iXmsjTUwvpYhe&#43;KxXxmXU1dfwmfOex7aPStYub7dfrY8nz6bXKzh9Dfe7b93hm&#43;PbTjevm1wRSbbfcnOvllfem&#43;2H1PDgfFJwu6c31i3JM/Ph9Z5HNo9Kyht3RPa/zRj91RwwLonvvz47f6TVxvynooDjUfW7di2LKPtPthfNPO73lusrnjrfTAcPZdU/L6WUNGCEN8o43Fod&#43;&#43;T54&#43;UD1xvu4d2TxHBg89XHnmo/PZb4r8YHzi5p&#43;NAyJRl5rFoW9f074tr9Q1ssN/OzhveUoDf11GRX1LHS&#43;8eh3b3PguqNwcH77LVTrunlOBlzwWOnS6/88Z4HB&#43;6e3vvXn9mB&#43;4Wi3f05JryjgG8vpGX2FOL39ddllu12m&#43;cKIjHoN29z9LVPeHdD1Lt6cK6a&#43;7a0&#43;V33Oy//yrD6Dq1d/RsGSp2yDLjWLwzzrve6fV0YT&#43;Sdn3dMj5w3tvQ7t5neeOQ9V442j2tWIPqjz1g9dXfd01plAfgHFh/Q/P27csdssw8dvYXmSLX2WxdX7f64fnguTTiz4mE5xdWbjDOFcRL0O4eJ7c04u&#43;&#43;LMhueXcwcT3&#43;&#43;O1l9xzR3ydbfmp/y1X1OzP3TnedgYXR73pvs8fDr&#43;X1dVewubJgRU2tcbogXoJ29zgFgbbg9uuD1r1wtLtrsJ9iW3HjPWUnbrC6609fHji5u2sskKmPqDNZdMnbYCVY3&#43;Trb8jh02Tdgv3A&#43;fKGoHG6IF6Cdvc4RaHN4cG7bLs7HEPSjTXszg7lQ7eP9e8uH&#43;o3NJmhLLKeaQOpt/kGmi4G67y47ir8Od3luTUNHFjnZWh3j7OgtiO053EG7q5m/Pzqy67b3ls91FU62LdycGDZ4JalDmVmCksH&#43;5ft7CzsX2c/Hz7o8ApxC7nr6pblljYZZwziGWh3L&#43;MrjizfuDU4ep6Pl3cz4bEXNu27crB17a7m2uHW6uH2yqEu/2DvqsH&#43;5Rmj&#43;QFIfTm2GVs&#43;3B4c3LSqn8G6u&#43;kpy22sWVQUXM&#43;R816Fdvcyuf6msvZ9obGXaXc3UzX2VMuu3cORhl1N9buaJxhuqRneHBrqLB/qKRnsX&#43;HKgH6ptVV9K7CF2M7hthC2eWLjNwa2BK3brohr6fHntISLltQ0MHz3KrS7l5lbsSnYdyg09gp75t1M9fhjHTsHLC9qdv&#43;cSO1wS/Xw5qBl&#43;u60d92L0VdiS4Y6K9D&#43;wLbtitSZ29wY3F5l6oS4C39Oe2XBqvqa/DI&#43;cN6b0O5eprByU9X2G4J8p7u7qR0707ulfXdTXXS7X0KdFdO3ha3eewnre1dejOwNDScE2&#43;Wov3fVULcdoLdXDrdVDbfUYksc26bRGN5RnWvqhLiMzsDcitXBgsBG47xBvAHt7mUWhDdUD93LAfMuZ/XobVt6myy1T213nToEzcOI7FurrF5xeLejYqirzIqqLeuvsqJ8iLl/mWXoAXh6MuBvW&#43;EoD4v3lFg1dJWhNtvlIav&#43;iOg8ptF1mqoH6&#43;YaLiFuo7Mir3p16aKqNcZ5g3gD2t3LLG/YULXn0SAvurubDfuv2dq1cZpqdzl1w6vnGy4hbqO7InfNmhWr6mqM8wbxBrS7lymL9IX3P8OL7i6nae/Y9s51u5rijowzgvUrDJcQt9FTkbtx9RI&#43;08ar0O5eJth7MDR6jnZ3Oa27hne2r/WY3XdvKjdcQtxGT3luc/2C0Opy47xBvAHt7mXCA1eFRs8bLiFuo31wy2DbGs/ZPWC4hLiNnrLc1trCmtWlxnmDeAPa3ctUbb/BEAlxIV3bu4ZbV3vN7o1BwyVTcurY6HOnb1NcP7R5sG6JUSZJYNV3HNxmZE4GSqK8kZmJwO6bq&#43;atblhpnDeIN6DdvUz14ImgwyXEbfQNtHlrSF39sGX3sOGSKfnJd7&#43;J85GRvvvVC6NNFUbJGRNV4ciUdRkrQvNCnxRQRgrH3xpwMb6OYMG6umXGeYN4A&#43;yltLtnCe9&#43;wBAJcSFbeps9ZneLpmqHS6ZA7P7Hd9&#43;&#43;8OQZfMYHW6OfffLRB7MP4q/sWYN6UJuRD0TYxlpk7WpSgTJSTwLbHGnD7&#43;uszN9Ys9g4bxBvgL2Udvcs4X1PGSIhLmRr1yZTjV6g1nTJVIjdnzt9m8r5wu1HkIOEDypzZiAQl6qMfAHONhoQ0yqcqfh9XYH8xqpFxnmDeAPswLS7ZwmNPG&#43;IhLiQbV0bp/GgmIyhznTJVDjtDn711o&#43;R&#43;d2vXpBJhOAwvVyYP3Vs1LAs4mnJx2d1FR9eB19/6WlL13b9giyiiqkcqSRqYdRj5ChkKcF5VR6Z0pOPv1IG3yL9TQR/Tlcgrzm8wDhvEG&#43;AHZh29yyhkRcMkcyeEy&#43;8aeQkinVXXthy69fUJD5//&#43;fvPf21/1U58XD9k9&#43;PcynUjzWqSSyCBfUNEIxiyWBHx3raHUS1u2SK3ZWhVfrkow/ge1VYAnQsIm0CSSiAOicmtCSLSP2S9EqMJLP0eiTHmS/pj&#43;&#43;&#43;rW8YcrCpxvZjI9MseH9Od0VeJFRknDeIN8A&#43;Rrt7ltBogu0O1WGP2Xvvfxj5CeGjv/4fKoeeZRJrwSSMqwrEw4OvvRXPUmijoNi773&#43;icrCI86thY4xiQtt1XzJyZsOO9vUevO6eCLtDfnKRWzLxF5MXnjyDD/IZs&#43;BIVV4XM2pDfIzCkh8jdlezJGfK2F1mSQ5Qg/JgdNQG5Jo9/qoyUgAJ60IBNFZkUtWcHmy7twRpd2&#43;CHYx29ywJt/sr37ZOW/hr5CcE19odG6Zy4HUpqXJmz87N62h3YNgd1lQhuMTBkL0&#43;lk25XGWqHJG6jppl5IOos5w5CmOWuFxdOwDYHimjuuhlUh89gC1EDr6yykkL3eV5rZWFxnmDeAPsYLS7Z0ms3dddeUEEjL/J6KyGOPWO8aTaHaB&#43;/VtEtTvAJumRumwVksqZPTtodxu9k1xPhqrVpXf8lQLQs8xSntZ7xY1ZRj6Yjd2xIpk01ijfBZG6TEoZtZ0A4kdOmu1ux&#43;6tlYzdvQl2MNrdsyTW7hLISlIRNgQJ4Rmm1PNVDhyJSdj30IPfNnq2ZZag6sFnrCiqpzELwTe2wXmZXNkd9WBFKIbCRhlZEdAXd9rdWQzbKUG/lBQkXy&#43;mmCzfgNfdBafdkaPCX4DYPWoLwLC73iWuSJLdJ6tWOvCVvKWM2k4gC7rB7rzu7lWwg9HuniWxdv&#43;f31qXOcWCSrqQqNGjLkgfvhSD5GQpPekD30TJksSXAB8wqVYkQK6yOpWwVbo&#43;pSqU0Yu9&#43;/4nepmJ3Esrly1UawdSBkkV07dTJeTLpiIZTZyv/9e7yJzyQsb2TtrdQswd41K0dNTL8LQ7Dm5TZlXWjKFMVdjIB1FnOXMU&#43;qzJqs0Uu9tj5ucb5w3iDbCD0e6eJYF2hx2xr0CZULV1ovrsM3yQWSJyWFYVVspH9KwmAWwHQUorQc0FaBko/ce2u/gVNeCDrNcoowQMo&#43;tlsHYleJTHXGTqC8oG6HZ3FsNcVSEqF2SWlNSbOPjWUlKvMypbuz15v3uC7a4Gr&#43;nRvOQoa8ZQ5mQaBlFnSU7UMe0ySz6rZY2SMm5OXYyXMmo7QYxNTR32/e5NVbwjzptgB6PdPUto5FlDJDNGrIa/&#43;Cx6Rhgts5TvlT4hOUxCeDIJIHI9rhWVQvYqB9h1TGF3VKLaBACfZSnV1BC7600NbJU0NfTVSTG9ctkkw8TOYrJVSCpHcK7X&#43;SNMxoAnn1WXaLvLVXa91x1CRQ6SsmYMZU52gRwoQ&#43;uZkoMmhZ4pyCxj0riCIOP51TA6KeNCu/NZdR4GOxjt7lnCex4LjZsumQEqFhd/y7Vn3VuiRtXZLpNK/wo4GHYE0lbQrQmQg6T8Kh41yiikHimjL&#43;X0MRDRIqmchNvd2cSRbvl47rzvG2gb9uCTaGtMl0xFbLvLQHRYU/QMm8pgdSQ17C62MqX81196GlWhEudIe1USSPCNqlBMULOMwnJDHTZM5K02DDkqoLeXcJ/dy3ydwbnr&#43;Zx5j4IdjHb3LFW7ThoimRlGGDpZsI4WgJqLz3qwjpKiTz0ZDpZM5VfxqFEGwLjS1NBTbLurDY5RTDZPFRDitzvQda665bFqvUxUurd1DbU0mHbMZKy3yDRVOVwyBbHtDtRt4iopj0qB2MqUa&#43;EqqRVFtTskLZmS9DolR01C4frDc1SKcQUBuMHuPWU5m8N8R5xnwQ5Gu3uWqsHbE/KOOLmorIehkiMd9XrOoQe/jWLGLNU3jiSX3mccu8uCSFgdViT2RYqhbWHKYvisFxCmZXe5TCBNHGnu6B31MejYOeCx97vb74gLGS6ZEoTgsJ0uRQN4VCJj6Bymv&#43;PgNuQgdFYPtEFEjhqcN7srsDgKoAb8VXaXpYAqJkDAWIsU1ut0FsZmoDZk4j8d5bGU0f8vi&#43;iZU25qCugpy22rKaxtKDHOG8QbYG&#43;k3T1L1bZrg2PnDZdMF&#43;UzZxKTCSJCyFs0r8esEtTq0bzUaTgYOUjKr84yaCVIGaxLZUqOWiqq3dWCaquSYXcgjRhoXr6y89pEVFqHh3ZuXus5u1caLiFuo6c8N1K/ILS63DhvEG&#43;AUxDt7lnC/VeGZm13CZfhLUhOB5lICFKlmOr9RsJctTiQwrqSneYG9qKm3fUGhFzv11sJwF5oCrurBVXOZHY3fBzD7lG73KXfQqpC0rczBk17R7d3rPOS3Xc1N&#43;xuDBguIW6jpyJ34&#43;rF5auDxnmDeAOcgmh3zxLo2mffFPeSoZP4UdePnWGojJxHkKpyVLe5Pqxd5Su744PEuEgxPK08qlYtDQhldxRQHtUrx&#43;S72g3uKCarU2VUMafd8aV0bTuLAaM2vbzexNF/mdhs3H/Vts713rJ7/e6NfsMlxG10V&#43;SuWbO8uL7aOG8Qb4CzEO3uWUo2toT3nQ2Nz9zuEvUiOUNV5yzxMcyqygiqYxzulH57ZXfduJKj7A6Fq2LKr&#43;Jg5EvbQj7LXykgPpakVief9ZaEU9v6gmobnMWAasTIqvWvANSGqV6NKVkzesuW3kbL7l4aOb823a83JVPRWZFXs6ZkSXWDcd4g3gBnIdrdsyytXVe1&#43;&#43;HgLOwudoSxjHyg4lQ9rEdJZ5QPoDoRMxI&#43;wPeQIuyoi1PmKrMCFJOlVDGs9Omv/a8yOipBjghVCoiPsQ3KslJMV7sqpq9dMqXm2HZHVaokkj7YEEjnPOYaa4xB3dip3i3tuz1l99qh&#43;kLDJcRtdAbyK1ZXFlZuMM4bxBvgRES7e5b5oY3VgyeC468YOiHJQyJ7/DXyY1Az9ljnjv7dkKJn7N5YPVibb7iEuAt/TkdlQXF9dX7ZJuO8QbwB7e5l5gU2hbdda9k9Ec&#43;0IbFBsK6enaf3QExJ1dhTrcO7hltWm47MXBrDO6pzTZ0QN9Hjz20NFy6trc/1NxnnDeINaHcvk1/eGOg5GBp/eTaX3kk8QOfidaSo1yZiEB57ftPeQ4Ot60xHzo6rd/b87L9&#43;aGQKj5645Ydv/DvmAnx4&#43;clH7r/xGqPMrNhUuS3s011C3EZPWW5j9cKi0HpfcbNx3iDeAOci2t2z5JQ0l7QOh8Zens2weRIPYvfv//y96ard5vyakVvst7wnctg8nI1NiqptSN1qhlya/vrxR4ly/PDG8oFK2t3trKtdxsDdw&#43;Cgpt29zJK1fcH9z9PuySb&#43;MXRRqRs7tbVrU2Lt/qc//A6H97e&#43;/JqRD8Tu&#43;IsWAED4bundToj4jcIzYGjtqr5y0yWK507fNiXGIk5ka/Vnu5Jp4M/pLs/lU&#43;q8DQ4Q2t3LzK9uDw0/yJ55l1Mz9nBff1sCb4pDFC7&#43;QxrvaTLmit3hdZVzw&#43;igFP7Ki8&#43;pzBnSVDvYsMjUiYasKHYyFnEixWj3GeL3dVXkVzRUGqcL4iVwgNDuXqYo1B7eeXtwnJ3zrqZ67Mn2HVttNSYmfNfD8UdP3GLMddpdZeKvnjkTmqp31sa6HU6P0eUFa0h6JjAWcSJL0e4zpr2yYGVtrXG6IF4CBwjt7mXmVrRWbjkaHHuFdnc355p2HxhqWZOQ2P3qnT0iP7n0/ptf/NwokFy7N4a3V8V7O5y8Kg3JyJ8SWYp2nyH&#43;nJZwUVFwvXG6IF4CBwjt7mV8xZGSzaPBkfO0u8tZt/&#43;GHe0bEhK7i9QRvivNG1fTnXZHgb9&#43;/JGROTOGN1X2Bxw6mYQYdj91bPS7X73wk&#43;9&#43;E3&#43;/cPsR9a50QZZy2n20qULeNSdvYDMKYPK507ehZhT7&#43;ktPo4y87h2zUD/WIstGXSOWkk4FtWFYNmrzApmqHixivC8OxP5qScdvDXjcULc0p4Sj5b0MDhDa3eMsW78luOcJ2t3lNIzetbW7KSF2l/F00iGPwB2fjavpYvdvffm1O64aA888cK&#43;oHWnWo&#43;rqhtetusQlMYEIZb16JmwH80m&#43;Sn98921dk5JpyBXWlHw9wcGqAFyLHHmHrMzFZ5mlclRCjohfkE1ybtgdB7epMgDCnpihJShc5uKrOV8Gb3y1pOP39ZTl1KwuNU4UxGNg16LdPc6S&#43;s7Qrvtpd5dTM/ZQT3&#43;n1TM/u855GU8HW8tgOpgbk/C9Xkbs7kzOK/TTp3aoYYGpk8mJancEvpIJlUJ70KcYUb3HHUgB3e6qKhSD5oEysZKr2B0J5pYgXrlZQnnkoB78FdnrLQNVG/yNMlgcVsakvlVqyzEXZVQxFZ3LF0Hl0q&#43;A&#43;mVFeiVJx&#43;/rLM/z14eNEwXxGNivaHePUxRqrdxxu213Ct69hMdeaNs5PBxZPcvwXcbTqRvhVOe8fi&#43;72B3KFzCJ4H7WUbtNU/WOmrmmTiYHhpPNUzkIlyVHKRnA8ZKpYlyZxOKqjNgXf1UOkEhaBejK7kbADYzucaxdXxBI/bCyykEldmUTGx91y3XQaJACepeAqiRl4Xuf39dWWbgwtMY4URCPgZ2Kdvc4vuKIv/ua0Og53hfncjbuu3KwbVbPtFEuf/nJR6TXHUhHvX7ju/O6e6IY3hQcqJzGM2iddlcKVDmCRL3Qs0xKGWV3uFlyJCZWKJ1LMZnUna2DSrB21IA2AaJqfUEgdlcbANRKZVIaBIjFVQED1dTQtxDYdUzaJkgw9kX3TbWL88sajRMF8RjYqWh371PSvDW07yn7oXWmUYh7WD16fHv7xtnYXcbTRU2qrx4kz&#43;671k/jojtQblM5ImAjBAeGXO2FPre7qmeyJMUmqxwghpZOciOpAk67A71MjMoFqWGy5OxOSAqwuz&#43;nvn5VTimfUudxsFPR7t5n&#43;Zq20J6HaXeXUz32hf6&#43;DsuRMxW8CtNV4C7Y&#43;vj8snpy7N6Av0Orp3HRHSTc7vgQFSk2WeWq5/9Xb/0YMfRoU4WzC8HYAEEvE6fdv26PtHdiXBpIEn1&#43;X0fFXH9tyDhFEO&#43;BnY129z5zKyKBwXt53d31nG8dGhpuaZiZ3dXz6W4YHTRmycV4SF0mk2T34aaabdXTuOgOYDV7kz&#43;X6GQ983&#43;0h7BNZnd1zVvlRGUyAUs/PGJ3pVjnhsVp98m6/YGyu5GfOqzA3ddctWBRFS&#43;6ex/sbLR7VhDouSI8&#43;jwvvbucDfsP72xbPzO7i8IRvhv5QEbOI8nQuWT1zFsvj3EYJSZOiUb1tCpmjKpDU0CVEf1/96sXVI6TyewuV8T1EXMziN1VB8Bkfezqwrw&#43;qi6l2N3ya2uWFwQ2GucH4j2ws9HuWUFxY39o/9nQ&#43;CuGToirqBs71d8rD5yftuBhaxD1PW&#43;QusyVsP7RE7fg8x1XjellZkeDFbuvW9FXPr1XwzntDsS1sCA0CRGqAW66lcXl&#43;KsErwafIxMehWuRg0V0H09md1kWC2J1QDZAkqp/SrsDKYMtRzHZAKlKdD5Yt0Qu7eMvvhQKAJTEelPTLQ&#43;7d1XkV9ZV8K2v2QD2NNo9KygKt1QO3R&#43;yHklrGoW4h/DYc&#43;2D23c11&#43;1uqnUY1M00DDfW7KgrMnUyFVHtDtXJCHk9QYFwoSojcbAklSnyNhIWNAo47Q5QTMpLgoBlG1TheOwedcuR1FL4CiJ4I&#43;kdFUnE72sNFS6vrTNODsSTYL&#43;i3bMCtNYDvZeFR18MWuH7eUMqxD1s2H/1zs3rdzdmmN13bazYFnLoZCoQ1MJ8hjIBNAl/Q6gCPjujW4mMlX0FaBJhsSyFavWue5nrzFQgX1&#43;dBNaqux5zMWloGDlAzwEoKRsGsDHYTn2u/tVQOT5LZJ90/Nbf9TVL51VuME4OxJPQ7lnEqsYtof3PhMZfpd3dTN3Y/f19bVbsPtOR82lhaO3K&#43;B8vT9KA39cVyA/Vl7NbPkug3bOI&#43;VUtwR0nQqOvBDm2zsWEx55tGxqCLzMnfG/Y1Vi9sy7WW19J&#43;rG65YuW19YbpwXiVWj3LCK3tKm8&#43;2Bo7GV2zruc9fuPbW/fYNk9M8L3hmGrW3564&#43;lISrEfUbe2dtncik3GaYF4Fdo9u1ixsS&#43;093G7c940CnEPtWOne603ysxk5Hw6qBtau6Kv3GEU4hr6Sn1dFXmBhoBxQiAehnbPLopCTZXbb4Hdg&#43;MvM3x3LeGx51uG9w1FGnZngN0bdjVW7awtMHRCXAXs3hxesLh6tXFCIB6Gds8uckqaSztGQ6Pn2DnvctaM3ry1q8nldh&#43;2/jYMbyzfEjR1QtxDn/1C97q64lw&#43;Wz6boN2zjmVru4O7H&#43;RjbVxO9fijXdv6LYnO7nXvyaRu2HqITe3Q6sWGToir6CvxtVcWlNRVGacC4m1o96yjIBAJbLmer3t3Pecb91wx2LbGxSPnYffVuzaFtlflGzoh7gGBO9hQs7Swcr1xKiDehnbPRoojg6H9Twc5ts7d1I2d7O9r32Xd&#43;G5o1Q1I4N5gjaerMI1C3AMC966KvMr6AG9zzzZo92xkQVWkcscdwfELhk6IqwiPPd&#43;8e2SopcGV4XvdcGT1rsbqHbXzDJ0QF&#43;G37N5YtYgvhctCaPespDhS0rYrNPKcHb5zbJ17aRi7q7&#43;3dY/7bny3x9OtHl63arovhSOppK/U112RG6wrz/VzPF3WQbtnKQtq2ip33hkcfy00bhqFuIfw2HPNu0aHW&#43;otwV/q17RiX3FvquHz6VwO7B6pXrC4ijfCZSO0e5aSUxIpad0TGnmB4bvLaRi9c6C3xQ7fDcVOm0dP3PLmd9/46Q&#43;/d/bUXcas6dMwvL6UN8K5mT6/r7s8t6quLK&#43;s0Tj8STZAu2cvi&#43;rag4N3W&#43;E7B8&#43;7mKqxZyLDI9aTbWYdvr/wyOn3//iHD//y5wvPPGHMmiYNVuBev6CXz6dzMX0lcyJV85cwcM9WaPfsJbcU4fve0CjC9wsM391Mw&#43;iJ/t7WBNj90TPvv/eHjz74y2vPzsruw82rh9eXbAnmGjoh7qGv1NdTzivuWQ3tntUsqusIDt4Vsq6&#43;M3x3L1VjTzftPjDc0rCrcVZj6xJkdwTu1TvqigydEFeBwL25egGHymcztHtWk&#43;ePlLTtCY08z0fXuRxr8HzfbMP3hNjdDtxXMXB3M32lc3rKcivrAgzcsxnaPdtZWNseGrQHzzuMQtxDeOwZhO9DLat3N81c8LO2u32POwL3Wg6VdzF&#43;HwL3ppqFi8IM3LMa2j3bySmNlLQMh0eet98rY0qFuIe6sfv6&#43;jfP5ta4RMTuq4fXrdxSycDdvVj3uAfyKuorGbhnObQ7iSyobgvuOB48gPCdY&#43;vcS3js&#43;U17Dw22rp6x4Gdndwnca3fUzDV0QlwF7L6hdsnC8FrjMCfZBu1OIr7iyIrG7eGRZ23BnzOkQlzD&#43;dqxM13b&#43;2f86LpZx&#43;6rh9by4XSuxnqqfCCvpK4qp4RPlc92aHdiMS/YUtFzeWj8teD4y4zgXcz5tSM372hfu2fTTAQ/C7tbD6fb3RjcXp1n6IS4CL8P1NUXzwtsMA5wkoXQ7sSmOLKkoa1q3xN2&#43;G4YhbiI6vEnWob37m6q2z39u&#43;NmF7s3DNYv6K/wmUYhrqG/eE5bVeGSqgYczuYBTrIP2p1MkF/W6N&#43;8Kzz6aojPpnU15&#43;vG7u/rb7fCd1PAUzBTu9tX3Df4eRecm&#43;krmdNdnlteF8wt5WA6YkG7k8&#43;ZX9VWueM26&#43;E2plGIiwiPPb9h35HBtjXTFfyM7G6pfXdT9fbqAkMnxD30lfr6Snxr65YXVq43DmqStdDu5HN8xZHl6/su9s9zeJ17qR77Qtvg0K7G2mmNn5&#43;&#43;3euGmxusPvnVi/sDplGIe0Dg3h4qWF5d5yvmYDoyAe1OLiG/vMW/eSQ0&#43;lLwwCvsn3cx5&#43;tHTvYNTO/V79O1&#43;7A8mc7qk&#43;dgOvdij5PPDdQF8vx8Fxz5HNqdmBSF20Pbb0L4HuTD511MeOyFdSPX72xfu2djvOH7NO2u&#43;uTnGTohLsJvvem1oWElx8kTA9qdmPiKI0tWd4f3PMTH07qcqrGzjXsui//lsNO0ewP&#43;DjYs7K9wGIW4hxJfc&#43;2ChcE1OGyNA5lkObQ7iUJuaWRV07bwyAsh6&#43;WwvADvXmrGHu3cscWyexz989OyOwL34XUrBvjQWRfTVzKnMzh3ZW0NL7cTJ7Q7iU5BoKWi9/KQ1T//smEU4ibON4ye2NrVFM/4&#43;Tjtbl1uj6zevalya5iX291LX4mv159T1VDGy&#43;0kKrQ7mRTr&#43;fODd1sX4E2jEBcRHnt&#43;/f5rrRvkpuqfj9vuq3c111ovgis3jULcgv0iuLX1KworeLmdRId2J5PiK44sXdNTte8L9g1yHD/vXqrGnm7evX84Uh9b8PHY/eItcIv6eLndxfSV&#43;iI18xdV8R2vZFJodxKLnJJISfNAeOQcn1DrcmrGHt08uH24uT7GE2rjs7tcbjd1QtwD1N5WVbiyjpfbSSxodzIF&#43;eVNZZ3j4dHzQT6h1t3UjZ7p3tq7q2nSEXYx7S6LrN61sWxryNQJcRF&#43;X1cgv7QuzLfAkdjQ7mRq5lW2BvquCo29Ghx/xTAKcRX1Y/f297Xuht2jCX5yu19U&#43;6bKbVV8fbt7QdTeXZEXbKjIKeHD5MkU0O4kLorCrZXbbg7B7nzEjbtZM3p8S0/EsrtD8DFid&#43;tye2N4Rw0fXONiSn09Fbk19aX5ZZuMw5MQJ7Q7iZeFtW3B7beGxl6i4N3N&#43;XUj127tarIFf4nCJ7O7qH1nXaGpE&#43;Ie/L7u8tz6huJ5FRuNA5OQqNDuZBosaegIDd1rvSKWN8G7mvPr9x/e2tVoCH4SuzfsaqoZrJ/fx/vfXAvUXpG7un5lUZCvgCPxQruT6bF8fU9o&#43;Ay76F1OeOz5TfsObe/YqAs&#43;mt2h9lrrFXC8/821&#43;HOg9nV1yxaE1hoHIyExoN3JtFm5oTc0fDI49orVS&#43;/wCnEJ4bHnGvdetq1jkxK8w&#43;5Qe/XQmiV8u6t7sTrk89bVLV8YptrJ9KDdyUxYsR6CP2VF8BS8iwmPPbNp7xXbOiF4p92tDvkhvrjdzUDtZZbaF1DtZPrQ7mRGFEdWbhoI7VJd9LwP3qWEx57dtPeQXIPX7P7krqbaodWM2l2M39dVnrcWUTs75MmMoN3JzFmxYUtw1wP2IDsK3r2Ex17YsO9qCP7co6ff/6PY/XFb7Xz/m0ux7msvz1tdv2J&#43;cJ1x0BESJ7Q7mRXL1vUGh&#43;4Njr3MQXZuBoJfv//oM08&#43;atv9z68&#43;eYrD6FyLPLKmoX4VR8iT2UC7k9mydE1ncOeJ0NgrvE3O3Zx/8KXX//SnP370l/dfeuRuwyjEJdhqz61tKCms5MvfyKyg3UkCWFy/ObT9prAVwb8qIrnUKyS9nA&#43;Ovxw88Nr95777h/fe&#43;&#43;Av77/40N2wiOEVkmb8Of0lc7oCeaGG8rnlfGQNmS20O0kM86tbK/uvDo&#43;&#43;yPfBu4xz1tsBxl8LD5&#43;886Gn3vn9e&#43;//&#43;S9PPfEAXNJXMgd/TceQtOD3Qe2bQ/P89aE8f6NxcBEyA2h3kiCKIwWVrWXt&#43;8Ijz/F1sa7hfPDAq&#43;HxV8Pbb1lc33HDXY&#43;987v3/vT&#43;Bycffbq6wd8dyKPg3UBfqa/P72uuWbCitpZvfiOJgnYniSS/vKWkZWfVvi9Yguc4u3QTRMg&#43;er5y4JoF1W2&#43;4sgNJybsfveDzxZUbKxoqGwPFfSV&#43;BA4Gr4hKcLujceHdfXLl1Q1UO0kgdDuJMHklUVWrO8LD98bsgTPV8KnhXNoWqGBFR55uqxjX2GoFWrHf42y&#43;10PPmv9T/kbV9TUNtUsRODYT8enHPzsfSVzuirzq&#43;r9RZXrfcVUO0kktDtJPDklkYW1mwMDR8Jjr9hBPHxDx6eK8fNWowpq3/PAyk1b8stb1P&#43;LYXf7f6p5QWhtff2q7orcgeI5HGqXIuyr7H2lc9qqCkvrwnP5RleSBGh3khQQLM4LtZe27w/vfzo4/lpw/AIFn3wmQvYQGlXbblxc35lTesl/itPuAP9ThRUbAnWB9qp51gVgBPGGikhisdXeXZ63pn7FkqqG3NIm9X9BSAKh3UkSyS9vXbFhW2jnneFR2zpWEH/O4SSSEM4FrYcGvla177HSzfsKw52&#43;EvO/I6rdhXy7l35d3fLuijwriGcvfVLwSftpc9W8QENgfmAde&#43;NJ8qDdSXLJLW1ZUNNe3jVWtf9s8CCC&#43;FcYxCea81azSUL27bcsWzcwt6LV&#43;F8QYtgdwDRFleuD1eXt4bl9JXM4nD7BIGQvntNdkbu&#43;ZumKqtr8Mt72RpIL7U5SQUGgbcXGodCuexFc2l3HtpMuURSZAfgNz0vIHh456&#43;&#43;4fEF1R44jZFfEtruQX7ppRXXtajuI53D6xOCfuOetNVwYqA8sqFzLkJ2kANqdpIickpaFtZ2lHeNV&#43;x6Hjfjumdlh/27jr9j3vJ0LbLl&#43;&#43;XqE7JuN39wgHrsDX3GkKLCuvD7YXL0AcqLjZ47f7oov9XUF8&#43;vqi5dUNfBJNSRl0O4kpcytaF22rqdy63Xh0RfklrkgL8ZPG/vJsvD62Kuh3Q&#43;VtAxbV9nte95iE6fdhdzSpkXhNTV1JR2Vc&#43;2rxbwYPx2su92s0XP4vLFmsb8uPK&#43;Cz40nKYV2JykHoWFVZ3HL7uDg3WG7o97qW7YEzzh&#43;Ss4F7VHxltr3PVbefXBxQ0ee3/ELT8K07C7MK99QXFu9tnZ5ZyD/4sV4On4KpDGED5Gq&#43;aG68oWhtTklHBhPUg3tTtJDXlnL4oYuf8doaNcZK4K34ng&#43;2y4G1tA5y&#43;sHXqsaebqi/9oVG7cXVEYfPTcZM7A7sEbbBdaV1obX1Szrsh9eS8dPih2y9/pzWkNFVXX&#43;JVUNHD1H0gXtTtJJfnlk6equ8u5D4b2PWkO&#43;xy9cfI0s43jBGjcXGnvJHqbwWnjk2cD2W1c1bS8MNsfTFW8wM7sLcPz84LryuuCG6iXWA&#43;r99qNvOKheYV9i7/HntIUKa&#43;tKllfX8Rk1JL3Q7iT9FARal6/vL&#43;&#43;9Mrzn4bBlMsTxr1wM5bNW8/YXt66vo8Xzanjk6crtN5VEhubHHBUfm9nYXbCfbbeuoj64sXox4ng1Gjx7Q3lb6vjbXZ7bEi6qrS1eXlPH97cSN0C7E7cwr7Jl&#43;fre8p5Dwd0PWo63ri5fCGZdKG8H6&#43;MvyX1uVitn/1OV224sjgwtqG6fsdeF2dtdgOPnh9aV1QXX1S5rDxZAclZ3vS25S8znYWQwfIn1t7sir7lqQXVdKb1OXAXtTtxFQaBl2bo&#43;f9dlwcH7rHH1VuQqz8AxLOhN7MHwttfxeffDFQPXrmwaXFC9eZZeFxJld0H66v21oYbalS2h&#43;T3luZbwxPEe1rz97fpKrUf9dAbmbqxaHKorX1Zdn89&#43;eOIyaHfiRvLLW5Y0dJVu3l&#43;5/fbQvqesXnrLeXp3vWeiefkiCNZftr/gq6HRc8Gh&#43;8u7r1y&#43;YUthqM34ZWZDYu2uQMCKsDVcX7apelFH5dyestwJwVs47JihiNTtv90VuS2hotW1K/x14QWhdXxtK3EntDtxLwhY51e1rWraERi4LrjrjB3Kw3&#43;CRwbYX5T6K6HR82jHVG6/xb957&#43;KGbv3dbokiSXYXckqaFoTWltWFoL1IeEFnRb5IceKqfIZqfmLjfb1lPrRaNgfnbapeXF3vX1ZTV1DBTnjiamh3kgEUBNqWrun2t19WueO24O5Hw/aV6YuOz0TNY&#43;MRrF9so&#43;w7Wzl4b3nvkVVNQ0WhmQyGj5Ok2l0x179paXV9oDawtnZ5S3h&#43;ZyD/YjR/UZaGQd3GxHZa71/HZHdFXltgXmPNouq60pLaqvmVCNZ58zrJAGh3kjH4SlqKQm3L1m0r6zxQuf3O4L4nQiPP2aZ8JTSGCNj1prdaJNhOO1gffSG4H1K/P9B/dGXTroW1nXn&#43;xAfrBqmxu&#43;BDm6xi4/JwXWV9YF3tspZgUUfgYqd9mQTEtkcNs6YL2ZiLXkcOpN4eLGisWlTbUFxSXbUwuIavaiWZBe1OMo/c0khhqHP5hoHyrqsqtp8I7nk4tP&#43;Z4NhLQUui0tHtHtOL0a1RgUFs1ci50J4vBIdPlvdeX9y8c2Ftb3759J5IMxtSaXeduf6NiytXl9cH6&#43;qKN1Ut2hya11We3w3TT2hVk71t1lQwsTpZtbX2Hhi9LK&#43;9sqAlPH9t7fJwfdnK2trCsvW5jNRJZkK7k8xmXrBj2dq&#43;lZF9Ff1HQkP3BPc&#43;aQX0o&#43;egVfuGOnssXqpNb/W6T6x99EVsT3D/06HhB6wb1tvHV2zcsbCm3Vec9EjdSbrsrjO/ct3KcE2gOlBXu2pDzZK2UGFnRX53eR7k2ltqvbHGGng/cbVeOdhGd3P8XFqJjOq3Bvbbj&#43;LpKcvtKs9rDxQ0Vy9YU7s8VFteGg4vCTVwADzxALQ78Qhzy1vmV/ctbBgobh4q77qifMstVky/72xo/wvBMes2s4uyT47pJ3R&#43;ITj2SnDkfGjf06G9jwd23lvee9i/ef&#43;SdVvm12wrDE7xDrdk4wa7K/L8jUUV6xdXrC6urg42VNTWFa&#43;vWtpaWdgZmNtVYV&#43;qh&#43;l1bOt/HugbFlfYBaR90Fc6R5btt//2&#43;HPQjOgM5CNAbwotXF27oqreX1YXWhauX1CxtqB845ykjXggJPXQ7sRr&#43;Iojuf7WvPL2BTVty9e1rWzaWdx&#43;WfmWG8LD94V3PxLa/5zdh//KBNb95dYYN9PWkzFudbBbS6kaRl8OjpwL732iatepyp23lfZcszKyZ&#43;XG7iX1kYJAJK9sc05JGsL0qLjK7jq5pU35/k1zyzYtCK1dUVvrrw8H6gJVNf41VSs2Vi&#43;OVM/fXD2vPVzQEZrbVZnfHcjrKc&#43;19G94vcyKxbsrcrsCeZ3BuSjcXlXQWl3UVL1gffXS2upihObl9cGSuuol1Q2FFevn&#43;jeihcH72YhXod2Jl4HpQU5JpKCicUHVpsV1zUvWdC/buKOkdU9Fz&#43;WhLceqdtxaNXx/eO9jof3PhvY/Hxx5YXKeQ4HQ3ifDux&#43;oGrwzvO2Gyr4r/R0jK5qGlqwdWFzftrB6U2FwU67fGv2XvHHvs8G1dieEJBzanZBsgXYnJHug3QnJFmh3QrIH2p2QbIF2JyR7oN0JyRZod0KyB9qdkGyBdicke6DdCckWaHdCsgfanZBsgXYnJHug3QnJFmh3QrIH2p2QbIF2JyR7oN0JyRZod0KyB9qdkGyBdicke6DdCckWaHdCsgfanZBsgXYnJHug3QnJFsTu7//5w7sfes6YRQjxGLQ7IdnCdXc&#43;8uvf/v73f3z/xJlnjFmEEI9BuxOSLXTvPoao/f5Hz20bu8mYRQjxGLQ7IYQQ4jVod0IIIcRr0O6EEEKI16DdCSGEEK9BuxNCCCFeg3YnhHxOQ8do646rF4V7jHxCSGZBuxPiCiDUw8cf&#43;OZ33sQxifTmW7&#43;48PobEK1RLNnIBsRe7&#43;nHX0QxBbZz5PBdzgaBUQwgp3zDoFGMEJIMcCDT7oSkGUTMb7/zB1vrlySI0yiZbOBgrDe23aWMkT748OOtozfOoBghJBngcKPdCUkniHqV2m89&#43;RTMCqDAs&#43;e/4s7YXcpI1wK2ExE5nG1v/me6uaXYm2/9AsXQfMEsfEYOvqwqQwhJEjjWaHdC0gnsaIlxKqemhvjtjoaIykEDRcwNzasueimGv6oYBI8cJJVDCEkSONBod0LSBlwogS8idWOWE0TAKAaPYhFYE37Vr3aPHL4LmfircoBc/DYyIW9E3qqew8cfMJQMDcsgABRwXv6XMrrdAcogE0mtS4rhr1GGsTshKQDHGu1OSNpQ4SzMbcwyUCX1BEMrMUO3yDGk6zQx2gf2opckdYFfykuDQ0&#43;64KPaHUj4rpopht2xnVhL1AUJIQkHxxrtTkjaECUjGfkGKsRH4CvBMXQrOcqmUpXhTsPEanX4IM0CNBogXdW2UHaXgB7rkrUo/asyxopUvtK5qgofgNTjXIoQkgxwuNHuhKQN0a0y4mTAtWJKFakDqFcyZVKqMvQpilWZotjTj7&#43;oChhIeShf5ahhASrHqFMhJdV3kWJGwgbgu6hFCCFJAocb7U5I2ojT7mJK49p8&#43;YZBS5gXu82ntLu6NB7jpnMpr/fDq6VUjl6njuTjb9RJrFQ1FPTWAyEkGeBAo90JSRuiZCQj32Ayocqy07W7XsBAys/M7rGvuwty7x9K6pmEkISDA412JyRtKHfGHlU3mVBlWTfYXXUkxBgzD5z9/ISQZICjjHYnJG2o4XL6sDUnMtrcKKO8Kz3tYnej9143MRoQdvFYLYkZ2122EEl1&#43;0e1u2wkkp5JCEk4OMpod0LSiQpnDV9Cq0rVagCdPqpOhKpuHxdx6p3esLg0HVTN0jFutBLgY1XtDOyOZbGdUgbfxSim2x0l2TNPSGrAgUa7E5JO4Dy5Yo0EF8KaQIXCMgBN9yJyIHuZRFI94UrDWBafIVpRO5IyMZaVHKwICwJD1TIZj92xAfgA1FqwbaqVoBeTb4QWgCqp108ISQY40Gh3QtKMLng9wdPKlwjEldFV0mNloGJoSahTqlXyBtINYCQVzcdvdz1B2/oqJiuGhK9AtROSAnC40e6EuAIE1nAkpAjX4oPz6jhMDzdjlqCucOuoAhL0y6QhVCx4&#43;PgDUgzoK5Lyes34LMVUjr4NqHmyq/h6MYDJyUoSQhIO7U4IIYR4DdqdEEII8Rq0OyGEEOI1aHdCCCHEa9DuhBBCiNeg3QkhhBCvQbsTQgghXoN2J4QQQrwG7U4ImS3lGwZjPNaGEJJ6aHdCUs2icM&#43;tJ5/SHyuLz8YzZTMLfB18i29e&#43;jo4QkgawSFJuxOSOiZ7pDwEb5TMIGh3QtwGDknanZDUodQOI8rj3PF35PBdh48/oBfLLGh3QtwGDknanZAUAYvbZv/8ta3egHYnxG3gkKTdCUkRErhPaUFE82fPf0VdmMcH6FMvsCjco78u/cLrb8gb4WQWJiUfBfBZDXaT6/2q80Au9iNT5gKUxLah5YHa1NqR4xwu17rjar0e43tJPbIg/kox6ZyQr6Yva3w1QkhCwPFFuxOSCuBRUdqUgbvSs570YXcSK&#43;tJOdJ4xTuSWp1zKSSlZABnI0c1GlRCjt4IUD0QSHphVZXUg6TPlcsQzs1DyugRhYS4ExxZtDshqUA5zxkKG6AkBC86hFaVEVUBsaYYHbWhgNSJwjJLAmXUg1lSj8yFgJEpkyhj1/r59qgtlKVQXolcNRGQLznYQlE&#43;ZslKo9pdFlSrwOLqqwH11aQqQkiiwGFFuxOSCpTzjPwpgflkQSVmmdTDbkFXrzErKtJDrgb0Rd1CrAU5Rt/A25eO8JdeAafd4xkqKCXVVyOEJAQcVrQ7IalgWnaHp&#43;FRufitrlIrBaqQV4&#43;DBZFx1FkADQWYWCpE5XofAIi6hWJuVUY2ydD2ZHZ3bgCQr6a2QUrS7oQkFhxWtDshqUA5b0qT6Re24T&#43;n3SHp04&#43;/KJlISr0ySwkeSddwQ8eo6BwJH1SxadldChhfYTK7qwKKraM36tvg/GqEkISAw4p2JyRFiMliDyKDnsV/kKW6XC0LGgpEEIwAXWYZXfEo6ZS3BMr4qwbYS5mU2V19NUhdfTXZBqNCQsgswWFFuxOSIkTGMBw8Z8xSqMBd79aWnKgKlMFxqNPIBxLfQ&#43;f4DJvadVwyYn8Gdhc9Gw2UOO2u8vUvQrsTkgxwWNHuhKQIpTcEr7rgkQ8HSw4Caymg5irfKzGjvFocjQCZK60BfZasTsSviulzJZpXqpbySDIpGHaXS/6oUwXfQJoRU9pdWhh6QwTfSJoLepuDEDJ7cFjR7oSkDhEhEqyGUB7WVNeelWVFupirP1UGSekTi2BxlFeLQ7oyC/lqliFv6TnAX6hUImZJKC/Kj8fuaCWgPHLUWtQQvyntDvSvpm8D8o2ShJDZgMOKdickpYgvjQTVqahaRbSSYD61COYqv6qESQgVsxAcO2dJTC9z9bYCZkmvPpIsHo/dgT4yTpJMxmN3o72ifzW9M4AQMktwTNHuhKQaiBwKh9gAFKsErCMFxLsA8tO7r5EviyNTNQsEGFRm4YMxC8iCahaqxWfZAORgrlqjgFnIMbYQJWUt2HjUIGWUnqPWoyNfDTXIpHy1qD8CIWRm0O6EEEKI16DdCSGEEK9BuxNCCCFeg3YnhBBCvAbtTgghhHgN2p0QQgjxGrQ7IYQQ4jVod0IIIcRr0O6EEEKI16DdCUkdtzqeQfvN77ypP4HOG0x8t4vp7Xf&#43;cPb8V5yPotOfMy8JOTGecEcIiR8cULQ7ISnCaXdJxivjMp2Jb&#43;VIRjtG2R1fX3/4PAVPyOzBoUS7E5IixO7qbSsNHaPOF6x5APlGImm0WiB1JW/1bHkgdsdvIpMI7uV9dxdef0OVIYTMDBxKtDshKcKwuwD5IRNpZl308gaXGKG/vOXFyDSIWgkWjFEtZmGRqDXL19FDcBQWc0PzKtOwO4j6&#43;xBCZgAOJdqdkBQxmb30mFXewq7e166Qt6xKCwA1YBL21Tu01XvcBZSUaiWhvO5RIBuDSsSykvAZwlY9CkjIMRyP&#43;FtfLz7rETmQfN3uAGWMfFmvvlX4CshxfndCyHTBoUS7E5IiJrO75EPA&#43;CwWxGfdqUam7mNd4bopVRl8wILyWS8gK5WkVyIJzlaZele5kjQSCijN6x0PkmPYXeWrbdDtju&#43;FGrCdAA0OKUAImTE4uGh3QlKECNVpd4jN8t5nn8mkKFP3pQTTKqgVL0KuIkKoUSJ&#43;LCgFAOR6&#43;PgDalJqgDtVjmyMblPVIFCrRg2SI5NAGgpYtZK3s2Z7iSh2l&#43;aCYXc9oRLnUoSQGYADinYnJEVMZncozbbbhESlg1ovJk5VHeDiRV2ERg1OyjcMSgHVJSAbo1wLVFyuclBYcmRdqoCqxFkGGJMK2WzD7miR4ANQ3QDGJQZCyAzAoUS7E5IiJrO75CPJpDKxjFkTp&#43;pxuXhxSrtjQdW7rpJaymn3qJVIjiw12fYbQbm9RBS7SxtFFZNvoW&#43;A6irQ&#43;y0IITMAxxHtTkiKmMyO0rkNR6oc3XwyV49o47G7LCXpwutvyCJIainZGF2uzkqA5MhSk22/vrXAXsK0u2qyGD0Q&#43;gYsCvdIC0C/0k8ImQE4jmh3QlJEVDsqpcHHKlOuxEu8LnP1sWbiRV2fhpjVJNoEqhddctRSsjG6XI1KBMmRpaJuP4gndpdlkaRDAjjtDmQAgXMVhJBpgeOIdickRUS1owqyDR0q5eOvHtaDKe0uK0IN&#43;gVyKaCWkjK6XI1KBMmRpaTNgWr1As6gXCb1zUPTRL6O/t2j2l0aCrQ7IbMExxHtTkiKMOwO50moiuTsi9a71vXR72BKu4uGVZsAjpeRekjKwTOwO&#43;qRSbU9ULt8Bb0lIWXU5mFjRO1Izh4IfQPUdXfj&#43;xJCpguOI9qdkBQhQnUmeE4PsgWIcGK21pstTGl3IEKFeuF1JVck1baYgd2B&#43;gqoWW9/6OPgJrIuTdgGvQyQb6HGzKuNNDoqCCEzAIcS7U5IinDaHY40nKcjwlM&#43;VogXY9sdMbq6xwwJK1KRsRSYmd0BFtGbC/hshNoTMy4mbAZaGEYDBci30BNK6ttDCJkxOKBod0JcilyEjqH/KWnoGIWYlVkX2Q&#43;HV3NnjNQjGLMIIW6AdifEpahQ29lpTwghsaHdCXEdt558SnWqzyZwJ4RkLbQ7Ia5DLkhD8FQ7IWRm0O6EuI6GON7ITgghMaDdCSGEEK9BuxNCCCFeg3YnhBBCvAbtTgghhHgN2p2QzEaeV6OY7OZ45E/rvvnyDYO3nnyKg/YJyVBod0IyGAgYx7CRvvmdN/WXtQCoGvkffPhx/EPx0VCQqox8QkhGgOOXdickU4lqdyRD5OqFNLQ7IVkCjl/anZBMReyuHLwo3KN8f/b8V1QxsHX0Rghbz4kN7U5IRoPjl3YnJFMx7C7IU2zjETNCeVgcOGN62p2QjIZ2JySDiWr304&#43;/iMwLr78hk5iLSUmqjPF&#43;WCQU06/WO&#43;0u9bz51i/4VhtC3A&#43;OVtqdkEzFaXeoV7SthrtD9vImWSRVTBZESSwr2kZCMVXAsPvZ81/B5AcffmyM1yOEuBMcsLQ7IZmKkvTh4w8gHMekqB0a1iNsUTWSypEr9GpSFVDy1u2OhoLMRabMJYS4HBywtDshmYrY3UhQsnEd3Wl3hVx6h9SlWaD8reyuluW974RkEDhmaXdCMhUVu&#43;ODdJ4jKUMrlKH1TOeldyQV0MsiKPDBhx/LrPjvpiOEpB0cs7Q7IZmK2F1dHccHTELJxsA3p91VZzvkjWYB6hHTG3aXJIJXw/QIIe4HxyztTkimYtgd4bVl488&#43;O/34i6oMMOwO98ukLmxpGTjtDverh&#43;Eg3FflCSFuBgcs7U5IpmLYXeUgOW9vQzIm9c72qHZXo&#43;ilWmOwHiHEteCApd0JyVScdgfSx&#43;68vQ1JJlXsLqrGX3XNHh/0RfSapVqjV4AQ4k5wtNLuhGQqUe2uXH74&#43;ANGjiojOoew8UGNm0NS0bnT7qoSfFCZhBB3gkOVdickU4lqd3Dh9TeQD1VL37vT7shX8ToSPhs3xTntDlSbQM8khLgQHKq0OyFZCsJ0IxBHjsTuhJCMhnYnhBBCvAbtTgghhHgN2p0QQgjxGrQ7IYQQ4jVod0IIIcRr0O6EEEKI16DdCSGEEK9BuxNCCCFeg3YnhBBCvAbtTgghhHgN2p0QQgjxGrQ7IYQQ4jVod0IIIcRr0O6EEEKI16DdCSGEEK9BuxNCCCFeg3YnhBBCvAbtTgghhHgN2p0QQgjxGrQ7IYQQ4jVod0IIIcRr0O6EEEKI16DdCSGEEK9BuxNCCCFeg3YnhBBCvAbtTgghhHgN2p0QQgjxGrQ7IYQQ4jVod0IIIcRr0O6EEEKI16DdCSGEEK9BuxNCCCFew7I7/jExMTExMTF5KdHuTExMTExM3kqfffb/A&#43;v&#43;ybaNIW3GAAAAAElFTkSuQmCC"
	
	
	
	loading="lazy"
	
		alt="graphic"
	
	
></p>
<h4 id="ap架构eurekanacos">AP架构：Eureka/Nacos
</h4><p>当网络分区出现后，为了保证可用性，系统B可以返回旧值，保证系统的可用性。</p>
<p>当数据出现不一致时，虽然A, B上的注册信息不完全相同，但每个Eureka节点依然能够正常对外提供服务，这会出现查询服务信息时如果请求A查不到，但请求B就能查到。如此保证了可用性但牺牲了一致性结论：违背了一致性C的要求，只满足可用性和分区容错，即AP</p>
<img src="C:\Users\hp\Desktop\开发文档\SpringCloud\Figure\image-20241204212201682.png" alt="image-20241204212201682" style="zoom: 67%;" />
<h4 id="cp架构zookeeperconsul">CP架构：Zookeeper/Consul
</h4><p>当网络分区出现后，为了保证一致性，<strong>就必须拒接请求</strong>，否则无法保证一致性，Consul 遵循CAP原理中的CP原则，保证了强一致性和分区容错性，且使用的是Raft算法，比zookeeper使用的Paxos算法更加简单。虽然保证了强一致性，但是可用性就相应下降了，例如服务注册的时间会稍长一些，因为 Consul 的 raft 协议要求必须过半数的节点都写入成功才认为注册成功 ；在leader挂掉了之后，重新选举出leader之前会导致Consul 服务不可用。结论：违背了可用性A的要求，只满足一致性和分区容错，即CP</p>
<p><img src="data:application/octet-stream;base64,iVBORw0KGgoAAAANSUhEUgAAAoYAAAH5CAIAAACTdGinAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAN&#43;gSURBVHhe7J0HQBRJvv//7&#43;69u/f2di/ndznHd7euOayueVd3zVkx54QBFMEAIqIooiIqQcyKijlgIOecc84wMMBMT3dP6J7&#43;/3p6bJueYRhgwEHrc79ze6p/Xd3MVP2&#43;Vd3VVf&#43;PQSAQCAQCYQUgSUYgEAgEwipAkoxAIBAIhFWAJBmBQCAQCKsASTICgUAgEFYBkmQEAoFAIKwCJMkIBAKBQFgFSJIRCAQCgbAKkCQjEAgEAmEVIElGIBAIBMIqQJKMQCAQCIRVgCQZgUAgEAirAEkyAoFAIBBWAZJkBAKBQCCsAiTJCAQCgUBYBUiSEQgEAoGwCpAkIxAIBAJhFSBJRiAQCATCKkCSjEAgEAiEVYAkuT&#43;i7dgQCAQC0V9BktzvEGmwoSEQCASiX4IkuX8hUt&#43;ODIFAIBD9DyTJ/QgTuivaBYZAIBCIfgaS5P6CSHHBRIj2giEQCASiP4Ekub9gjtYKfUy4IRAIBMIaQZLcXzBTa810QyAQCITVgSS5v2Cm1prphkAgEAirA0lyf8FMrTXTDYFAIBBWB5Lk/oKZWit0M&#43;2JQCAQCOsCSTKHimGaWxvysyJCo8ISnyXWFNfK9Xs4VBjTlFefFxPx6nl4Um5SDVWL6fd0A5W0WpYfkRX74qke2IiNTiwokeGtDEPpvUSYKbRCN9OeCASi71FDqGlrKsiODosOSwhJrCqobh9q1DjTXCApiIkKex6WkJVYpRbt7wby2uKapGdJYVGhEVn5DS1NuniHsE6QJHPIGCYtN9b3&#43;PL5qxfv/nz3iyuh5fo9HG0VTOq56HPrl879crGD9&#43;6XyrAK/Z5u0JYZUnp&#43;2fHNMybpmTZp0sY1uwJuFtfmdVhbzNRaM90QCMRbAdryGUXJASfXLF67cOcU&#43;6cBIaX6PRzyWibdP9F/46qF0xbaHbd/Jn9ept/TbcpDr76AqLZ49bxlx87H5qbp4h3COkGSzEEwTGVt1p0Ql6WOK1YNnXVo/8XotBZGooRdNNQirDop//LOAIel05bZb/J8FJStzm/mDuwa0D8GPU68F&#43;h3zOP0sWPHdbi7HNxls3L7mm17/B9dTS6tIlW43l1Ep3IrcgBDIBBWBckwVQ15918eXrl/5YqRsw/u8QtPaWEaIJkNNQq8Pr3gusPlPTazl9utO3r3WjqRI&#43;EO7Brq1rq27BcZL2/duH7Vy3Gjw/SB00fPHv/Vfs&#43;wjASGadV7IawOJMkCGjK0kftvO9uMHPbl0kPXThYxGWzJVTNMbU3ew&#43;s75&#43;1atm6WS5TPywZSTXdP7uT5UaXnlvkdOzLNI&#43;dWfBOtQ15bnOy96czKL76atWfLsUcJUrmkQ0Hl0nnjECUKDYFAWB9Nudpo1weHlo4d9dXiAxc9CxlQZYbRMExdQ/GzIIclDjYr5xx4deJZnYyguleNseL4Mv81PuvGjhw66BNgwMABA5Ak9wOQJAvAJUx1TOI19wPzxm3csn/Fyej7GXUSolWScz/x8j7HRTbrNx488KwwpALvriJDL7mqNf1JZlJCcFJzQR3bMGYT22obwj2feKxbOsvO1uXm8yZZhSlN5XeZaQgEwsogmpma&#43;NSgY4cWT9q02XGJZ&#43;TtlGqJEpPkPU69fmD/0mXr1u7f/yjncZmC0HSzCqtaatsyQ9Ke37h65dIlH2d/9xVr562d/tX&#43;U0iSrRskyWJq4&#43;9FOo5zWGozYsYRrweJ6Y2V6UHOd3bMXvDl5pVOV4PrWgo7HIHVXZRNTGVQxu0Dm2dt2&#43;YYGCxpLWC0WlOayu8yNA6jiQjE2weVSJ765CfR&#43;z/fu2zxkKmHjt6OTW&#43;uS7/jdt9u5pJpm5baB96saMzX3aOzAM2xZObRM/a7F3613wdJsnWDJFmMojyq7tG203Y2E8cu2H4m8HRk2GnHjYeWLl7lGOQaXJTVqmyzeEzBG5jcgJQLO1ZM27zOMfC2pK29JHMmQrSXMyEdpSMQfYqwIBra&#43;wxeGV//1P6cw9Jxn87Z6uV7Ojbq9H7bw0vmrXa4euBWQVozAcJJ6317BpLk/gOSZAPkBUzF1QdeG1dNHLFij93y02eWL169ftGOvdfzg/OZVv3NZoDS0iTWXN9QXlxRUmycktKyGmlNi4pQmahZWlpWQ0R7RniunT9z5xrnm0&#43;bZLrR3p3GLvMdEIi3A18ETdj7C1bMVN54embLqnFDV&#43;zavtzn7PKl69bN2&#43;J0OTMoj2ki9F7sXTktiUnrG02EGog1Nc3VUhWuNBZqkCT3H5AkG6CRM3hFwaOTd7ZN2Lpi2tj5S8cuPLDK6c6T5PpqOaN&#43;c89aplaWpD7wu7xn4z7bjUbZtHWH/anHJ0Pq&#43;cfGBrBBiZCUFV3ddXXXoukrvXaciS5sIRSCva&#43;tG/TkWASip/Dlr1N7T9Fg0FMueuZzb/v4HSsh1CwZu3Df0t0378fXVMkY5ZtQI6epivQnF646bjywTR9bxGzeaud1//jTupzqN0r&#43;BiTJ/QckycZpir2WcfgLu7kjBwwbN2DWoaVu4Yklzcp24YOV5JT7vpcc1u/dut4oG7Zs23nykdezjiRZq6XVyuaKmuSQe262bls3rT/y8Ozz0laF8PlRT6JWT45FIHoKX/46tfcZaeLt3KNTHBeMGjBk9ICZzgtcXkXns29fCnq7MlaSHwdccVi/v6NQs3HzzhP3jj1BktzvQZJsnDeSPHj0gEk7FzrceV5Q36h7TeE1Gi1NyJvq6ksLy4oLjVJUVFxSrbubZPzGtZZWYk0xV&#43;JOb7FbZ79ul&#43;/V&#43;OIsKakUv/XQ7djVvaMQCMvAlz/DIijcZbj3veKNJA8aOWDittk7gx5l1zS0G9hFabUk1lzXUFpY3mGoKSqpbqpqVinQjet&#43;DpJkA1QtjDw/667XpY1Tdq6ZNs1mztipK&#43;euO342siyphcEtN9ha2VjalPo01Hvf6W1rdrj4HrqVkNLQBlXF4Azdjl3dOwqBsAB84TNa/oR7OXsfUbcy8sLch95XN07ZtWba9KVzxn25YuZK99OvChOkjFzQ/O8pSJL7D0iSDZDlMKV&#43;dzxsF475atveTY5&#43;DosWzpg1e93Gi9mXcxhpRw&#43;Fu05zQlDGiSV7bVbOXnDg&#43;MuUCIxspmhjTdyeBK7uHYVA9Ai&#43;vJoufEI3057vJvICpuzCA68dC0ZOtd2zYW&#43;g4xKbWTOnr9jgn3ohi2nsYA6/7oAkuf&#43;AJFmIimHaJLlPUgPWH9puO3HmgWOBV0Pi7/q7rN23YpHNzov7r2elthDN&#43;vBBUJrG8rSImDuX716/bJQr124Evcx4kd1W39ru9UKyobgl&#43;d5Lb2ePNcsc93s6X375oryhSjfVnjHe66iF6I&#43;YWWSFbqY93zkgILQ1FTxPv7jlyM6tY7/ae9j38ovkhwFuG/cvn7dsh7/j5YwEiaJJ/0SZ1NLNlRlRcXcu3&#43;8g1Fy&#43;cjXoeVpIZltNi7E58pEk9x&#43;QJAvBGKY04&#43;kZr1nDbRbZjdz&#43;8k50lbq1rua&#43;60P7mfMmrlqy0&#43;9GbXOe/t5ykwpPf356575JA74cPsAoA4eO&#43;mzd2bUBZUml7daNakm5X3h8mvOSxaPG2rs9jIthtFD3OuZ9jVqIfkuXiqz5nu8QCoYpz37p671g9PKF2wZtfn4trEKDNdc9OvrMYcbiz1cu2OJzpaw&#43;W/9EuZnS5ISec3CePGB6B6Hmk0FDxqw&#43;tfx8aUyhsXWjkCT3H5Akv0HZVCxN8LvnsWP5uNkb955zDq9IrJHTylasODjxhsPO2QsWLXTYeCHudkaDioLGa3d6ycrG0ua4Gy9OO&#43;9fbON04MTBoMjnJbU1jNbYKEkePmS9Z1EL0W8RFtlOS62Zbu8SKmmZNCnw8Qm7NZPnbnDw3htaHlspo1VyrPR&#43;2h1HB4g0c&#43;02&#43;EZdT63HVdD&#43;R73k9wgkyTq0FKPGW3JCM72Xe65d/Oln9o6BryIZppbdB3KZXZEd6LN&#43;zoopS0YsD3C5ki7BKMFbg2YCKq5uyXmVc3Lx0WVzBg1cvd07&#43;IFUmiNtluqtRSqVyTCCpLXtB3bwIeu9ilqIfoywyJoutWa6vTvoQk1bQVTW2TWn1i8aN85u17ln4QxTxe5TMkxuTeEV360LVn2xYNTS844XUkBiux5qWLSUmiJkuAyiilRaHFIX7XLMdvvcqbuPP4x6KYUWQUurTKFQ06YmMUK8DZAk68AlTMmzrFvOB1d9vnqd3bxD0Reia&#43;ogmd0H&#43;ijFqmNyL9uf275wwrTly5yv&#43;qeoMht1B5oFF3AwhikqirkQuGbK&#43;gljBn4yceqClaudnHY48bg5Ofn63opKlONwagF8yAJDIPoH5pRaoQ9v7ziElCl7kXfX9fC6L1evsZ1/MOx8eBXUd93sQKC9LYr6xPzrjgE7F34xY/lip8DzCYq0et2BXYRsKJZEBLy64Oayf6&#43;T3bo9m2bOnTJlzMiv5q7euN7pwC6nIycuPLhb0JbTxnRzqSlE74AkWYe8hsm&#43;nHxl99a1Nhtd/V0jyGhdq/UN8mom61Li5V2b19hsPHTBNVIZI3LoED7UtDFMRl5coPfGldvnz1swf958Mavmz9&#43;779SDFy2YbkJNHj4HMASi32C64Ar3Cu0dR9HA5FzPuO6wc8Oy9c4&#43;B1/Jwyv0e/Rg9UzOtbRrDtvXL13vcu5gKBZRqd/TJfDKzJq7zkEHVy1dtEAfYN6weP78tVsP&#43;p1NbUpoZrq71hSiV0CSrENDMG0VLZVZGalJaXlleRKqSfQGgs5BWpGVnpKUll&#43;eL6EFM9CaQBhqVAzTKmsuL0lLzkyIT9CbkJSEhJyc4toGleb1hJpC&#43;HyMYnovAtFb8CXPsPyJdplp7zgakpFVtVZlZ6YlpeWW5DVqJOJQAw6VrZU6h7xSIw7mQeFtRE1uVV5KUqI&#43;vgiApNT0vLLSVpVU9R585/0KJMm9hzDOdGTmY&#43;IoE7sQiF5EWPI4EyLaZaYhEO8zSJJ7CaNxRpTImZl0dIjRRASiF&#43;HLXEfGI0o3aiI3BMI6eDtFEklyb8D/lrxxiBI5MxOjhxhNRCB6EWGZ68iEiHaJjMMwBYF4qwiLZJ&#43;WSiTJFsfM37JTBxG8P3&#43;I6CMC0evwZY43HlE6mIju7UIg&#43;hxheRRZr4Mk2eKY&#43;ROa4yNE6C80BKLvMF34TO8FOkoH&#43;KM6ckAg&#43;gRhSTRqvQuSZItj5i/Hu5njDIj8OUMg&#43;pROC1&#43;nDiboybEIhCUQlkET1osgSbY45v9svGdXnTlDIPqaTstfpw4m6MmxCESPERZAzoSY2GVJkCRbHPN/NvM9AaGzOf4IhOXptAh26mCCnhyLQPQYYQE0WgY7dbAASJItjpk/m5luPF1yRiB6BXNKoTk&#43;Run2gQiEJTCnAJrj0yOQJFsc4W/GmVHM8RHSJWcEolcwsxSa6Saie0chEBbCnNLH&#43;5h26z5IknsD4c/GmSEiB84QCKvGzMJqphsCYU2YU2Z5H94sDJLkXsL0zybayxsCYdWYWVJ5t049EQirwZwyy/vwZmGQJHcP0a/CmRDRLjMNgbBqzCymfIE2xxmBsA7MKbO8D28WBklyNxD9JELjEaWbaQjEuwAq04h&#43;iDnFVujDmYVBktxVRL&#43;HoYkQ7eWNx2giAvHWEJbI7hXKTg83sQuBeEvwZdZE8RT5gFkYJMldQvRjdGQiRHvBhHSUjkC8BYTFkbeuYvpYE7sQiLcHXzB5M0TkwJklQZJsPiZ&#43;BtEuMPPp3lEIhCURlkITZiYmDjGxC4HoZYSljzMRor3mm8VAkmwmnf4AIgcw8&#43;neUQiEZRCWP844RIlgZtLRIR2lIxC9j7D0GRqPKN3QOIwmWgAkyeYg&#43;vbBjKKltFqC1iooGqNoFd2Rm1E6zRyB6BWEJY8zISZ2mcDoIUYTESbQaBmCZhSUFqO0avSt9Qhh6evIeETpQhPSUXqPQJJsDuZ&#43;9RI1nSDTvJKqnzarS6AydQFzT4FAWBZhyTNa&#43;Dp1MMTQ3zAF0Sn1Km1sG/VSqglp1lSQXYonCCFGS58wkTNDTOwC&#43;L0dOXQHJMnm0PlXD11iqDJpcsqzUrmnhNxRRD5p0nSlbdv5KRCI3sCckif0MeHGI3IWfUR0CqWLJwkyyr1C5VCitC9SgjBDdxn6zYgu0lHpE6ZzZpSO0oFOj&#43;0OSJLNQfjVG//2oUtcTWov1qlHpyj&#43;Eof9KQ7bV6rMxuhmczW5k/wRiF7CzJJnphuH0FloCDPBKaaS1J6tUQ9Owv8cp/hrvMKtXJWroFuRJncNYekz&#43;tV16mCCbh9oCiTJZiL89tv9APBBRTPlpPZOo2ZNHvmDSPl/vJKBfZGOe1erUuUUtHahzdsZRnJGIPoAvuSZLnxmunEInXlDmAPNMEqaKcLpGw0amxzyW&#43;HY/3sl/3qofHomcb5GnYXRsLdrw1Tea4QF0Oi31qmDCbp9oCmQJJuP8R8Amq3QFQ6RUnOzid/EYN8MZfUY7KdR8uHJioBadYNKix4DIawW48XaAKEbZyYQeYIhzEStZZrU2nsSzdQM/JcxGIgxSPJ/vJL/LBobm4qDTkvUWlBlhHmYWQbN8emInhxrBCTJ5sN/9W&#43;&#43;fdBjqD8hzZRDifJv8dg3w2Rf0&#43;kx2DdCZT&#43;KlK/MI283akoJ9qGyxX40BMJyGCnWxhC6cWYC8z0RPPBFQTypU2kfN2m2FSl/G4t9I4wVY5BksG&#43;Eyv83GttYQIJaV5HsQ2X0xZoBXwZNf1vm&#43;HRET441ApJk8&#43;G/ev0PAP8naCZXQe8oUv5fguI7EXJej8FgG1T5T7HY/GzipZRSUObcvkYg&#43;hq&#43;QJsunkI3zjrFTDcEB3R9cZpJkdMb8sm/xyu&#43;Ff5Gj7mO8n&#43;Hyf8Sp1iRS8a0UjiFbl&#43;bA1cGOy2J5vh0RE&#43;ONQKS5C7Bf/usqbXaBBnlVaUan4b/MBKasW/0mLOvv5J9N0L&#43;rwSFY4kSVNnsoV4IRN/Rrkzr08SIfDhDWBZQWdBa9wrVyBT8&#43;xHYf&#43;puWQvt66Hy70Vgg5NwlzJVeAslQ0O9OsfMAmuOjwl6cqwYJMk8/K9i&#43;svV&#43;2gZLUbR3tXK8WmKn0Xph3SBcZVH&#43;PHDcGxIEr6nRFmI0&#43;gZEMLa4As9byJEe3lDWBCIDBKV1qNCNToF2vfskK6O7LsR2IgU/GCZqopE8aRTzCyw5vj0EUiSefhfpdMfhvXJU1DX69WLcohfx4Do6jWYrzZCSf6vUPlPo7DJ6cS5GnW6bgA2AtGXCEu20ISIdplpCIsA32QmRgfWqWdlEb&#43;Ixv4nTB9GjNo3w&#43;Q/j8amZRIX69TZGI26yp1hTmk1x6ePQJLMw/8qnfwwaq0Wp7S3G9U2OcRf4jCh&#43;vJmmAg1bWE2caFWXa9Cc&#43;Mh&#43;g5hsTY0HlG6&#43;YboIRAN5JT2Sr16fjb5u1gFHzFMG3guzSWv1atbNCiedEqnX5AVFWckyTz8r9LJD1OrpKNaNduLyD/EskO6RFWFN16VOWH&#43;VjgGtWhFHvlcqqkktVbx4yPedYRluiMTItolMg6jiYhuU0nSoS3UhgJWjz/SvYVsjoHnH2MVcFRkK1WjfM9/B2F55K2rmHNsN7LtMkiSeTr/SXSz3GljWinXcuWnKbiokohMJMmcfZyo2F&#43;qfCWl0DzyiN5GWKBNG48oXWhCOkpHdAmNblWJsBZqb6lyaHIn8cSowVFu5SpQZYJic3svERZGoXUD08d2O9uugSSZh/89RN/7m3TQ0QqS9qpS/StBYXoIBphRSf5BJDZAp8oFCroFaTKi13hTal&#43;bENEusC7R7QMRQmQabRmhPVyu&#43;nOc4vudxROj9uMobGCSAnIoIbRt76MmC0uiUesSJo4yscvCIEnm4b904feuT6G1WiWtzVdQV&#43;pU87Pxb4a1E1qjZlSS/zNU/kG4/AvdUK9UOTs0Aw32QvQGfFHmzJBOHUzQ7QMRHNyqElkYfaFWPT2T4ONDVw3iybfC5TMy2UEqkNv7F0&#43;EJdGodYmOjuLTDXdZHiTJPIbf&#43;5sUFa2VqOmgRvXENMUvouVfN9BaQ&#43;P1WOj2H6/kX9PNwjM8GferVcspdnAHAmFx3pRdfYIRzPExSrcPRHCAHjeq2FVqRqbgP43qTv&#43;YMy6e/CoG&#43;ywVv1avwd6j29fCMsgZjygdzEyM&#43;vOJovTeAkmyEOFXr9/WMlqNVlutpO9LNJsKyF9Gi6cEEVUSoXXk8z9h7B3slXnkgyZNOcmdDoGwJPriq//UIbxbp55CuncUAoBvDFrhZYT2dqNmVR75o0jsvwymBOmqfRDGvma5sUD5pJmqfi&#43;GevGljzcRpvd2hOEhhim9DpJkEcLfgDWafeWJiWujof78NU4BagotU15rjSqu0Iw6cG3bv8YrFuQQL6Ua/ZkRCMvBl2DT8G7mOPN07ygEQGkZBcWEtlCLsok/xSm&#43;EcpGA1F86KpBDv8ZKv9nAvtCR0wbpT/TO4uo9IEZxRwfEaJDhNZ3IEkWIfoltHJKG9FCHSxTDU3CvxehX5jl/5ktySbs&#43;5EY1KIDZarYNqoJ3b9GWBS&#43;BJuGdzPHWUj3jkJI1dqXUsqpVPVxouK7EdjXDMJC9wxU&#43;QeR2MAk3L1ClSij3ulllYVFz/Sfab4nh8iftz4FSbKIdj8GdJGrldpD5eyss99rPySy55IM9t9h8nFphGu5KhujabS0C8Jy8IXYNLybOc4iunHIew50kYtw2kn3ytNHEd1/hNyRQZ6fpxPHKlXF7/LcvXxpNaf0dduZt74GSbKINz&#43;GRqtNk1Pna9RfZRA/j8ZAPoWlXyjJ3Vbl/wyV/zJGAbXIv1adp6AVaK0ohIV4U4511hFmuiF6DkkzSTLqVJV6Ujrx0yh24UVRNOi5QZ6/iVHMyCSu1qsLcfodnbu3SwW2286cvQWQJIvQ/xgqrVaqpgNq1XOyyF/HGJ/lziKqDAb1c1U&#43;GdSoqVGiZVARlkFfjl&#43;bUUQ&#43;YIheQkUzdUqtT7V6WibbvhdFAMsaxKuNBeRdiUai0r6LjfwuFdhuO5vj3yu885Lc1W9W/3uUk1RIs3pVHgmtzg87nuXOIpL8P2HyP8WxQzPCWqh3tBYh3gL6oiwwIaJdvCF6gxKCfWVjcQ75qxjFB2bPmtk9g3j113h2rs34NnZB2Heuq2x&#43;gRV5gpnGfM9e5N2W5G58uez9apzSPpeqd5eQnyR2Mgu8RSSZs3/EK9zKVbGtFEah&#43;UMQloEPMIY1QbRLaAgLotYNsX7UpNlWpPxngrmrSvTcBibhJyrZoV4k/Y7FE1FpBTOKyIcz05jp1ru8w5LMf79d&#43;5bbNFpo0jqXKf8Yh32341UlwIR63HNJ/m4EO9fmvlJlJalVIk1GmMT8Ys17mjCRG8KCtKi1RTi9q1j5&#43;1jFt3thSFdH9oNIbLBurk2JWqt6B&#43;OJsMAaLbMiB876AUiS30DpZrlLk1O&#43;Naop6bhpoeWVmDeRQ1ft66HsHexJafjVek2egjbrihHvK10o1gJno8ZhmILoIRrdqhLQT/WuVo9L7c6qEj0xiCcfhMmnZRJ3GjXQJtBf07uDsMByJkK0l7N&#43;wPsjyZyZAvS4QaUFPR6chP0k6o3oiso6Z/zejhy6auz8Ia/kv4zGJqbh/rXoPWWEKcwq0AJ4f5HxGE1E9ATQwTqV1qtK9U8zVqmxuHHzEf0mBvs8Hb9Wr9ZfU79BWB5FJkS0y9A4RB&#43;tGiTJLLADNLCYoG80aJblkt&#43;L6HzWTNN7u20fhMt/Ho2tySPDW6gqNNcmogP4Am1&#43;EREewpmQjtIR3QD6pBBP8hT05Xr1/GwCeqv/2eNZM7tnH4bLfxGNbSkko1up2n4z16awMBo1HlG6yHgMU6yX92F4l6GJobQMRjHPmqnZWcTvYxVQf4SK26mJqkFPDNq2Xw&#43;V/ztRsT6ffCF95&#43;fGQ3STTgp017Fsbu85Gl08uSvRTEknoJ8KlVpUzfvMuHgyOAm3LVRGtfaLeCIsiSZMiGgXZ0KMJlop71svmbd2SNRa0ONdxcp/xCu&#43;E6GvQiLd7ciEFcBS9uMo7ONE/HC5Kgctq4zogA5Lc3exeIbvLdAffdikARX8Y6zio15&#43;5ckc&#43;2kUNjQZP1GlylfQ1r2ssrAMmjYRpvcCJnZZF&#43;&#43;DJHPwH3nTp0IXOVtB2xcrByXh32pff0TqKzShWy/ZrCzicr26QDc3nv5yEQgB7Yrya/hEoZlJNw5BCIHvDSQvWUZtKiA/TlR8sxem6OqewZUszCFvNKhLCauNJ3zR402IiV1m0pNj&#43;473R5IBPoU3RkFp49uo45Wqsan4T6IssFCaBe0PcYrpmawqV5LsalQIhIg35fg1fEpHZhrzPRFGgT5odCvlVq4akYz/KIpfpebtG1zJX&#43;IU87OJW42aKlJrfXNtCoseZ4Z06mCabh/Yp7xXkgzwiawpaW0FSXtVqadkEKDHokJsDfadCGxDARnSzM61Cb150R&#43;DeM/hizIH/9G0mcBMN4Qh8I2BzhXi9JEK1aQ0QrRKjZUYRLmdRcpXUqpBN0ugNf3KfLnjrCPMdDNK947qa96H4V0i9D8MrdUW4tTtRvXcbOIX0exCyKLiaw32jTD5/yUo1uSToS1Uq4a9J4ZA8OiLsjHjEaWDmaBTB0RHqHRDrK/U62extp5b1kL7IFw&#43;IFGxpZCMbaPaNOwzO6uBK3rmFEDzPUV076i&#43;5t2WZMDoD6BVa7VtGvqeRL2pkPxLfE9nufua7lHNtyOwH0Vi/xuN/TgKg22L1Mn/0C3g&#43;Pd4BTS9k2V0qwZaEvq/AYHgY4yhCTGxS0SnDgijqGhGotLebNBA6/l3sT2KJ1DluXjyndfxBP79KBz7hiXugUPO0PcYmKg4VaVOk9Ps3L3W8ntzRc&#43;cAmi&#43;p4juHdXXvPOSbBypWpuDUduKyN/GQnFnh3GJyq75BqUcVPMnkex0mJ&#43;nE0tyiKkZBGxb6k7410LZufE&#43;S8VdytgBkyRt9WUK0VfwMUZoRjHHB9FtmtRaaDGvy2dXjevhqhKcav48ChuUiE9JJ5bmEl&#43;k4/9KUIAwizy7Ydw7URCaJqbhRytUZVY0d6/5JdR8T0O6cUhf895JMjfLXVwbdaJS9WmKoicjqEEsoQ37SaJiSjq&#43;Ko90KlF6Vaou16m9q1SOJcrlueSkdOJfCfjPorEe3hWHBvJPo7AvM4hr9ZpCnEZvRSE4uAAjso4w0w3RJSCe4DQT2UodLlcNTurRrJn/FcpO3jcoCf8qg1iTR&#43;4rVZ6qUl2tV5&#43;sUjkUK5fmkhPSiH8ksG39Ht6Bgy4ESP6cLCJYoikhrOTGm7Bsmr4gkSdYl&#43;iqf1/THyW5R9&#43;pgmJqVVpoIf4tHvtBpPg1J1HZNW1QMb5IJ45UqMJaqHKCrlFqG1TaZrW2UaWtVmrzcTqmjXYuU0FFAkEVHdslg7YtVNc/xipA5m80aDBregSEeLtwMYmzTumSM8IcMIqBin&#43;gTPkXdpWaHlXzj8Kx6ZmEZ6UqurVdPIF/q0ltnoKGOONYohqTivdwek7oiEM8&#43;Vs8O0jlrkRjNU18M4un0I2zd4p&#43;Ksnd&#43;Rm4We6yMPpCnXpWFgE9V8NZukRl14T9OU4BmXhVqaDD3WSsUENam4ZtPh&#43;vVE3LJH4b29MRZN&#43;JwP6VoNhSqISaWY3WikLo4CqDmVWiS84I00DnUqVlUuX0&#43;Rr2lQ0unojqrJkGbe6/xysWZJNnqtWJMsro7ECQBnHmVQvlXqH6PJ34dUxPX3r&#43;PvusDbcvVkIEq7OKuTb5sslZR4jcwN4p&#43;q8kd/mXgDItpxjoZY5PxX8V/WaWO5Eqg/Gl1oQtziGfN1NlBHsbuSN5hEuEvZWk9nQ1Ow7zRz3uK0OdH5io2FOiDJVq9OdAvCt0p0y/PsrMY7vkjDANVG0ZxVyoVQ9Pxv9XEE&#43;6YV8Pla/OJ19J2WntIduOfh2IM9AIKMLpY5WqL9KJHnbKoa8M8QQu/kCpEvrl&#43;nO8TYTFU2gcokShvVP0a0nu2o8Bxf2uRLOhQPmbGOxDk7N0CXcZ2g8jsX8mKKCtClorN&#43;MesoLSpshp6Ct/nKj4IJytCaIMu2Q/icKgFh0qV&#43;XjtBSqL&#43;JdoTtlWnCUOcea74nolFKCDmrUrMwjfxaFfStcXE/Ntx9Hsb3Vk1VqCFAQK/S5d0ybRpsgo1zLVX&#43;NZ2&#43;89aQpAPbzaGxUCg7RqRBnX&#43;jQn&#43;OtwRfPLtk7RX&#43;XZLN&#43;D3CCwhbbRq3JJ/8vQWF0ii7zJflv8YqlueTDpq71U6EWTc9kJyTp9t0toU3NIIIaNPkKNNfmuwNfoLv6gwoPNH2smW4I08C3B41h6NTa5JIQDUR1s6v2L93EA11dYya0RTMhjZ0g7GuWiCdzs4ngRk1x7861yRc902cQuhk1DsOUd4R3QJLBOgF6k&#43;EtlHMZOyQS&#43;rgdFWIzJXlcGuFbo87EuvY0F&#43;TTuUw5OgXvSYOatz/GKWZmEpfq1HVKNNfmO0LXynR7zDnWHB&#43;EOTSqtC&#43;l1J4SJajp93v8btKUDOJynSZX0bV4ki6nHIqVI5Jxi7yvDA2LBdlsK79eqSW6diHm09XSJ/TnTUhH6f2bd0OSwYwDO0iaXVXCtUw1LpX4dmdPX8yR5AXZZKqcblJ1eFKj1Cq1txs0K3LJHj4B4uwbYfJvh8s3FZARLewyqKiv/A7AlWOhmY/oQDARor1giG5A616hTJFTTqWqT1Pw/wmzQF1elUfmKbr8EKqcoK/Vqxdms8PKRBl2w74ZJv9JlNyuSBnTys612Tui3I3SJzzE6FGm9/ZL&#43;q8k8xu8GQH0OEdBB9SqP08nfmahVSWgCkHftKvztjeptSCfO4qUP7DEK//Q0Ye/ZWgSvq1QCdlCmEAvRvV3hEWZNzMRHWXaEN1GQWkzMPpMtfoz3So1FllVwrZQ2abp8pQd9SrtKym1oYDs4cwknMEf8kG4fFQKvrtYGd9GQXDrhZeVe6MM9kaeb5l&#43;LckA/3sIE/WoaAa082q9enke&#43;asYCxRczjYWkHjXBbBVo02R0XtLVRaZhYezH0ZiAxMVxytVWZiVL4OK6By&#43;EIvMTERHmTBEN4DvDVSznKQv1KoX5ZA9nGlAaKCC&#43;nN0hWa1NlFG7SxSitaT7bZ9TTfQDFQZGhy5CnauTUvTG2WwN/J8y/R3SQb4n6RdOmxJVNrYVmpFHvnLmJ7OnyU065Hkb4SxqjwpneAGYOvPhOif8CWYK1uij&#43;YjPFBkiG4DNb5B9wh5fjb5vxZdVcJKJPk/dLevfxaFTc0gjlWqoPGhP5PF6KgkCtNF1ildcu4f9FNJFiH8Ydi9at0ryK&#43;k7JCujxN7NMudoXE3rrt6ownaB3A9toWWuXHN23&#43;Gyn8RjU1h59pUlxHsDNiIfkq7EqzDMMUchEeJDNE9IJ5I1dpnzRqHEmXPh1iLrHs3riEEhTRr1uZb5sY1b9DK/1UMNiuLuCvRVJJalSXjidHCKEoUWad0ybl/0B8l2SjC34Z9XbiM1EL9&#43;WMcuyiTqNj10Lo3vKuSpC/WqRdkE9&#43;x6PVA2/YbofLfxChW5JHX6zWNXbwqhPXwpvjqE1iMJiL6mDYNk6ugbQvJ38diH1rijQmhdW94VzFO&#43;9aoZ2YS/225/joYG0/C5H&#43;KU6zLV95p1Fj0TWW&#43;IHfVTGCmW3/inZFkgP1hKC207LRJMsq7WjUxDYfyapEhGEIbl0b4deUlKLgsqG4ZGO1QrByejH9g0SrE2Yfh2L8T8U0FytAWqk63ODmiP8KFFtGvxyeK0hF9AFQl6CnGtlHHKlWjU3olnkzJIK7UaUCV9afsDCgGEE8SZBQ0EQYlGZ9loYf23Qjsk0R8R5ES/vAGldZyBY8vyF0y05jj0594lyQZ0EL5kWm052pUQ5Kwn0b1aJa7juxv8YplueQjs6cKobXsWhcgll9msOtPWGSqEJHBnwnZfpyoOFyhglqEbl/3X4wGGC7R6C5Er6Kk2S6yZ6Xqk0R2ecTeiCddnSoEWgkYxTxs0oxLxX/c8SwLPTEungxLxk9UqaB7Y9EmvrAsC02EaC/Y&#43;8I7JsnsBLDXG9RLc0H85BaZlMPQfhiJ/V&#43;C4ky1GpTPnMJK0EwBzs5NPygJ7/mEmibsZ1HY5HR2brxinDZnpk9EP4KPTOh37UtyFfSlOs38bPLHUZYcIio0yBm6pIF1apB/c2otRmnhqryqVP&#43;IV3zQ4wk1TdgvY7AvM3DvalU1qbXcAGxhQebNKOb4vIO8O5LMLsxCM0&#43;bNQuyib/GQXvWrKm4umFfD2WHJu4tVUHzGWpRR0UGUuCS4F/otYe3UE6lyj/GKSx&#43;10to0LD9KFw&#43;K4sIaaYqSQvebkJYBVwx4wzR23DxJLhRMy2T&#43;EOshYd0CQ1iwrfCsSMVKhnFnrGjnxhSuHjSrNa&#43;kGp2FitBMns1nvyXLp4sySEi2aXnLBVPuD9OaCYw0&#43;2d4t2R5Dql9lkzZVfMDon8fgQ0HvWSbHFV/nOcYlEOCXUV9FimYaQatgkJ21BhhLRptDVKrUJXzWDjvgTaCiSo8jd6p60Nxi&#43;DujSXDGrQQO8cvav81rFsROFzs1SGiI6ARu2jJs2WQuXvYxWWHZIpsn8kKJbnkY&#43;bNaTuJnmLhr0vzcYT/YWwwM/dqtFCiMMpdvqjKpK&#43;2aCZkUn8LrYXW/lfC2WHjv4rQbEqj3wgsVQ84csvb6Yx3/Md4V2QZErL4JQ2vo3axU36qtM8oSRbSpWhG/qhbpnx6w3s2/RqLVNCaONldLKczlbQ5SS76jgYtCihziTKqKdNVDZGQ6sWKlgpQZ&#43;sYpdo/EFkrzxO5u2DcPYO9rYiJVwhnFr/HSHeEhYPJ3yGFswTIQTiiYJi72xtLVQOTsJ7784wNKAhnszPZt84KsTZNxjh3wQZnSKncxR0BckGEy6eVJI0xLeQZoobm63SMrBxtIJdovGj8N7tK38YLv/faMyxRJmPa1ssoMnC8stZp5jv&#43;S7wLkiynNKmyimvKtWIlHZLo1hclSHzYcm4a7mqmKCb1NpmNRNYp16ZR87KIuZlk6CCTqWsQctgWyEJNW1iGrG9SHmlXl1OsA9383H6VBU7TuT7vTNOhDPQ&#43;/8Jkw9JwjcXKMNa0JIUbxk&#43;nFgwqFg8Q4QQEJ4kGXW4QjVQt0pN71XVn0ZhI1PwY5UqUFxoPdcqtedq1MtzyZmZxIJscmexPp7YFyttC8k5WQQIMGxD/xh0uk3DPlE&#43;UqH6W7zie73ZiYd48kGYHK7TTjcAW/8dvaGrZVBYeDnrFPM93wX6tyTDrwQdUBDI8zXqedkE1B9RebKUKoPM/3eYfEAiDvXkWbMGOp9QKyJbqbX55K9j2NVSobX75zjFx4ms/SNe8cdYxfcj2Cm1/5mgWJFLPm5i3xhW0Qw0dTcXkEOTcfDvjbcXeINaCtcD7egyXWtA/30h&#43;hw&#43;nHBmKXojzz5Gq9VSFEWz6wFaC3Ap0FUFqTtdrZqeSXzUa1IH/VpoN0Mc2FPCtpvhR6witc91qz3&#43;KpodR/btCOyv8fp48vd4xR9ise9GsOkfJ&#43;Lr88lXUkqi1kKXFY5dnUcOTGTHjfZqPPlBJPbvBAV8LRUk3X5R526UQe4Q3jrFfM93gf4tyVAo65XaJ03sY5WfRWMWWafMqIEe/yIaW5ZLxrSylQFKR0gz&#43;5wJ2tFQT6CCgX0rnJ2WBOyjcFakoYZA&#43;xq2oRm7s0gJqgwda7BkGb2vVPWXuN5t23L3xL7KILyqVDldXPcNYUH4cCI0i2DxDPsYjUZDEIRardZ/tgKg0cyu2NaomZxusaXNjRoo6K9iMBDXVDkF/WNayzxo0qzLJ/&#43;VoODiCfeMjI8nnOJCOnwEkQYhfy7VQEe5QaVNkNHQde7tB94QWr8fic3OIs5Wq4vazd3bvTLIH2XOgeZ7vgv0Y0lWadlZKh81aUDwem9IJMgq1IRfRmNzs4iAWjXUnxa1Nl9BHypXfZKI/9iM2eehRo3ULbECcl6v0sop5lkztbEA2rbsa/69904UXDl8LTMziZsNmrquL11lLWgphmwgpCV5hTXZxS0YriZbGiQ5MaVFRekN2kZpk7q1sDivMCW9orZV0SaXSgoSywtyMutUtXJ9Bu1RMUyzVFKdnVRcXtEELip5raomNSclOrQToqLiM7Jq22oIpYpubq7Nz4oMj9Pv6pBXIguPfhWdnZpfKyHVZGcxBm&#43;qbswMLy4py2pkmgl9ooh2sUpDMq2lLVW5STnV2eVtpJpiGFA7rKmioigxu6pR2swwHU6mzH7J9XhjTm5ybFRoaJj&#43;8l8TnxOdI6lvIWmlgqjJqSvMTC2UFNXDGXoUJVtbW/Pz85OTkyMjI1NTUwsKCqqrqyHxrYg0/CWcHt&#43;VaDYVsIOZRbXJUga1EuT2d7HsENGr9WrocUJIycZop1LlvxMV5sy2C9L4WSq&#43;v1SZLGPn8cAo5r5EA31lkHPIuffiCWQOHYmF2exQLzgvfF2vvznezMf8o8z3fEfox5LcqmHSMRpamr&#43;JYVuRogJkKYMiDu3WEcl4UIOmWqnVzcPFTg02NYOAk5rTjgZFhwbvkCT2oVG8jFJQTJ1Kmyij1&#43;SRH4b17u2mb4axLxfuKFK&#43;kvbbuTZpJSOJrEu76OX79GhgZkUt1pgVmXBs6VV/v/0RVHRGIpbtG&#43;Dlu2vv7RfZ1XmlGXFntwb5HDv0siWk1GglbmGYlIzYR0dsA27dSgSXttKQlqcOx&#43;xtpppi2tSpixavd3YLyQ&#43;pl7aqk1NfeB&#43;eP3uNfm/HfPllO5tpM9XG3cH7RUKjTKK7TWqC2qQnMQdnBV68cSiWSanTJ5oCb2JyrmbdP7Ht2OMjt/Ka2kB/2ximLOnO7YAt7g9j0pIZRqp3NYAiGUl4dcwxT7sVi6dOna6/&#43;tesO7bkaHx4ZqOquaruybGXvq67feP9wyVyskcjFYqLi4OCgvbt2zd//vxdu3b5&#43;Pg8efIkOztbLjfemOpV4Ldo0Whj26ilueyqcZadpVJoX4cucph8Yhr&#43;uImChjK0akBZj1eqJqSx99vMjyejU9k3hlPklJJmIC5FtVKLc8hvmZdD9wwaE/C1/DFOAa2HiFYKeia6b44TS97MxMyjzPF51&#43;iXkgzlGPp8ka2UW7lqeDIOwtMbU9iAQfn&#43;fgQ2LhV3KWNv/0KlrSS1F&#43;vU07v&#43;quJPorAv0gl2Hg&#43;CHcoBdlk35TU0PHu1rwztBraPXqKMa6Nkmn441yatZmS5zXmPg86fP&#43;V59XZo8ZM7wSF2E30O7dp0NeXUpdv3A06cPR909mZMalVFXk70w73r/d2PeiZJwxv0GbQH&#43;oqxiaE3di88EXAhooDRSguCm&#43;9tctmzY8oyx52OB93FHHZ33&#43;&#43;yf8e6eQtXLNq670FmcLWkWRUdd/&#43;43ZgZGxet2&#43;ju7qj3NAIc/Npc3d137nHcPn/hQXvXe9F1rfWvJVlLU3hVdn36q7j0ktgieYtCPytcVdStl9uGnzzlu&#43;MVE1PNpZlC3VoneeoZfs5px7lQr5c1zRj0NaH9URh1MdBzvv2Nl/ExDAPtAONQOFP3tDzUZe&#43;6NfNmrNq6Z/9ed3c3&#43;AP2bHLf8MWCjW4THEKfJBXLazOTz&#43;665Lxr56XUwCSZHNSgB0AX&#43;cKFCxs2bBg&#43;fPi0adNWrly5e/fu48ePX7169dmzZ7GxsTk5OdBvlslk&#43;gN6DagU3Co1&#43;0tVAxIVbDwxqEc9N65/DHFgchp&#43;tEJVQmilam05SZ&#43;rUX&#43;ejv82pmvx5BfR2FeZxJlqdTXJBhPotvrVqGdnEr&#43;PZeMJnEvkbyn7dgTbRz9QpkqV03KNlmYf4onMTDo9qlOHd5N&#43;KckQCqRqxr1c9XGCWbd6umdQrKHd&#43;pc47HiFKgdjB0lBq5ZbNhxaqV1tBEAlh6oCfeuXUqpWyT49AnV/0UzNySSgr9yrbVvI/P8SFAG16jKif96&#43;1lLKpvKKO84PPbZv8gyzOxgYvHW8z55Fm4552mw&#43;vtjG&#43;/LzzCIVLqOrKzJeXd6yz8/jwoOmtjzjf6kRSZY&#43;sjt6PnhjQGFSkZQUQ5BkVVNN9F23Pe5rth59zEvyebsxW46fDH5MkkV6T&#43;PA8TprIcnEgqxbR3d6e7jei9dJMtfHpNXKxtDz8V6r93rd2xNUVVBH6pK7LMmKhur08853D&#43;8&#43;FV5wv4qWsXd/uyjJ4Uf3bnPf6nD9eX51OUlicPUFz8hH6z2OeU9wePkkKVVSFn5n77ZjO5yOhJY9rmXfke0JnCSvXbv2k08&#43;GThw4KBBg4YMGTJixIixY8cuWLDA0dExICAgLCysoqJCf0CvAZUCOpr7SpVQTXpvhAcXTwYkKHyq1fkKGr69KpJdzWl5Lsk2yrsVT&#43;ZmkbGtVL2utw21&#43;75EMyUdh74y9KRF/pYyLp4MTcZvNGgqSVo3rsbQzER0lGl7X&#43;iXkpyF0f616llZxI8ie/EWE5S8gUmKTQXkC6mmXqWFcv&#43;CXV2RHJKEd1tB/xTHDsC&#43;Uq&#43;uUWohz1KC9qxUQRv5Z9G9FQg4&#43;1EUNjOTOF2tKsLZWNCPCrhWo8KK44sfn77stHi7zfSpNvYz5q/dMn3EyjkTptksmfilzfiJazbsu3DmfmRa/tPE0LMHly7fYrNuh6eX69nXnA84GxR15XF6wuOghDvHr/jvcbLfNHvisrVrd4PPBe/9N49tXmfrOG394QPup/SHtOPYyeP7ti9ZunbJ1gNvesm&#43;dmNsvbwfvmAY04rxOqIQDJNeXnDX097nuOu9hNeSDLtoNdnw8kysh81uj9s7r1fm1&#43;qfG3OS7GK7eqb92T1H9Jei51Lw2fvZ0TkSipueRqthsOKm7HvX967ZvWj2aodD246e9ToDfifOnnV1WLd26YRZm&#43;wc95w9e5w7nCfg9tkrMTG5NVIKV7KS7LF3u8c2e9&#43;wtBexmTFBt2Jigv2bQja6eZ6ZYPf0yaOgyrATR9YvsJk5z2b34R0eZ0&#43;xp9Bzzi8w8HHak4zW&#43;jZznwTzkjxAx8c6QJ4HDx4Mqjxr1qxVq1bZ29sfPXoU3O7fvx8VFQX95rq6OqWyOwsMmwA6fNDdhObyDyMtuRCyyECPhyXjO4uUkboxJRBPHjVp1ueT0C8XeZpvf49XrMtn5wWC3CDPXAV9uJy9B27BRdmN2v9GY/OyCd8adgA2wRZCQzMT0VGG9t7RzyQZGoPQRb7RoP4ig/htL89y91EExk5b06SpImmZhh2C4VGh&#43;nMc&#43;ypCt&#43;8LQcP2o3D50lwyqpWdow6a53Ft1FHdG5Df6M3b1/DnfCtcPjkdf9LM9tH70axeFIk1vPSJdJ2xce74USNHjBw6aOggiNsDPhk0ZNCwUcNGjBo1evyoqdvnb/S6c//oo9s7186bMmnEqNGjRo0aOXzUiCFDhwwZOGzc0MXHZu64dn7HsvOrRs6eNHz48KGDBw4ZOnQ4HL1wwdzNG9Z8MWXqoKEjRoyEw1hGjhg&#43;YshA6LQNHDJiGHiNHDVsyITJs7fa320vyafvPtdALxlXdADGG95MqFIKcu8e2&#43;lz/GA7SaZMSrL9zKGDh48a/vrC9ExbO2pzsNe9ArVGdyuAIumaJxUvHJ3Xzvp8&#43;Kgxb5xha8TwoUOHDBw8dNjw4brP7Zi8ctSckyfvp5RSuIyX5G0eYWEe1655zJ/v4eHkVBCyca&#43;n94Ttdx&#43;cd83xW7pu7vhBg4cNGzGSy2rEsKHDBg0YAt/l2C&#43;/2H7F/kZldjWuu/zOEUoyp8ccnELzDB06dMyYMcuXLz948ODVq1djY2NBlXEchz68SqXSaDQ0TWu7O9sj9wjsQp16UjrRe0O6wKAC/jgK21RIPmnW1KnYOTcy5LRLmQpO2pNOBQSNb0fIQZXj2&#43;g6pRaj2IfKkO0/Enr39jX0ST7Uzd0b3sJ2V3SlkFNQoZmJ6CihvY/0M0kuI&#43;h7EvZtgV/HKL7dm4P&#43;Qe&#43;/SCegLw4d2Wa1Nk9BH69UfalrR3e7iwz2Nd0cdf/m5qhr0mAU&#43;35zdCvlWKIck4L36k0zqKJ/jlOszCNvNGia1ez6bv0CLaXGq7Jrk59Ghty/4X/Kz27ejjkjRw0d&#43;NncdbOdb7ueDw6&#43;ez/4cfSTJ2EpwQdDAnfbHw3ccyr4elBw8BXPYJ91O9at&#43;/zLHbu8n16NKUyLeZUTdvnZg6PH3RwWf7Fhxw53n&#43;Dge5ePPPPeautweK6d70m/G8E6rp0&#43;dG7z51vWrR&#43;33mffCZ/rlzwPrF29delWl4ftJfnA4WdZ13yvn3LtgIOvzd3zqN&#43;LG&#43;ef3nXYaESS61&#43;eifFYusvjjqEkH9q1bcGh4KP&#43;3HW95kl4cGRJRmkriBF4UkpFbfi5qNMrnd1Pbz8eHHBN7wVfQXCwz5GdOzZ8vmi367GjwcGX9OmveRga/Cwzs0wio3CVKUl2G73pzJHtay9u/mrutKVfLXV09b0UGBx8Ozj4vOtOlzmfrN9ib&#43;Px2PtJQWyRXIqZu0KaqJfMI1Rl2B44cCCo8sSJE2fPnr1ixYpt27aBNp85c&#43;b69esvXrxIT0&#43;vqamBfjNFdec2ehFO32rULM9jh3R9GN6L8eSPcYoZmcSVejVEMFaPMdqtXAVN5O9E9OgmMxwL8WRQkmJDAfm8mZJTTJXu4ZpdETuPYe/9Rdxt83/EKzbkE8GNaohjr&#43;MJ/EdoiC7TbyQZOnbQBnwupdYXKAck4qIi0m0DrfpGGHtPibNvhrGjCmEDWs3QeU2Vs7NmgmpCO2B6JvGLaMvM78HNUedUouSmxwN7IdXsKVH&#43;PZ59K5Fv24L289fDXVsPu9Fw3t/FYpsLlPB3NZmhydD5kEqllW&#43;V6upqDMNojVrZ2lif9irp9OaTayZMHjto6vr9Ky6XXUtsqm5SKEgF0ZhffM3xgafDnpsFAamaNlLLSJOZAo8AzxPzl/rdDM&#43;vYdh7x8afJT&#43;29/B7sPlSeUalvofXlv2y2HuBj8fxr44X3E8pVrRkhvud8N/n6h9e8LxB0qp&#43;Lcm77J9GHNjrvHp6Z8xbarMtwMfp5l3btawkJ5otyZ0/S6YIdVt10pXDlx1WHgtKuJjF1GL6Pbo/Nif8gv/ROfbXnpvzLLkDST5iN2z57pXz5m6fNnX61B3r9t58Xi6BKwLtLXtx6dmmIV7nru2LZlIbGOi2NjQ06H&#43;5zggLC/P09Fy6dKlefl&#43;j6yrrVVm4zQEKPXz48C&#43;&#43;&#43;ALkef/&#43;/QEBASDMeXl5VVVVTU1NMpmMIAjoOnfab4biL6e0D5s0K/LIfyZY7H4b1FCop1yFhZrL1d8PwuTQmveqUmdj7KyZVaT2eoNmUhr&#43;8yjLzIX5Ubj8tzHYoXJVAa5t1b2s/KRJs72IfVkZzi6KJ9y1gUHc62E3&#43;tvh8j/GYvbFEMfYIKb7XuFfkb2Bpunm5mb9z2/d1NXVQVmC8tztGzDdpt9IMnRVE2TsPZn/S2AnpBQVjm4btDF/GY1Bcw/sL3EKUKw/xrLT5ewvZeeIhnLWotYGNWjW5pOwF6qWRe4tQ92ArEbp5qiLaKHaNOzoksdNmmW5JJwaqg3n9v0I7Lex7CRc3OX9JoatYHwm3TDd7SZsdAp&#43;sEwV1dp5rwJCG3SloF/yFnF0dExMTCRbG0qe&#43;T1y27xn8arlM2csmj9k&#43;sKvxi&#43;yXex02elSWlJhWmv1s9Bjtp5bdq7yjD8Z2tKCU3pJPuu/cOvDp3EVILa6P7gbklyvUbU0FOcXZ2QXN8jqCImKfi3JR/1DGjJfZcVHdEZUbHhKycuX8XcP2uoluUE34hqqe08lWZZHlARf9/Vz2n/xUUxZaStDvOmmQjsk&#43;ulZ7z2T7QMf90CSdy8aNHHG&#43;HkrZy/ZtmbGDre9fo/K6wt1bz2XvbgZsmmC7&#43;XbntlMdgsD7ScfHx/9L9cZq1evnjVr1tixY/Vi2zEiVR40aNCIESPGjx//1VdfLViwYOXKlba2tkePHr169eqrV69ycnIg7ncaTBtV2pg2CtrBf4pTfNdyd6eghkI95eMJ1F/IH7bdy1X5Chr0sl6lhb7y8lzyd7Ht2t89Me5x2NhUHFr58W1wFlb17zRq5mWTED041YcT/SASg/gGV8Vd3q9iejq3EpwXVHmibgB5okwYTzgx5k0PtK2vX7&#43;u//mtle3bt9vZ2Xl4eEC1hfIMBUl/9X1FP5BkWve8JxNjR0JNySCgHItKRjfsOxHYr2PYZY/HpOKLc8jNBaytzyehybwmj9xUQD5tZp&#43;3giQnyahtRcp/JVj&#43;PjnUkI8TFB4VqiyMbtOwr0ME1LJ19a9QmeMVg5JwaFmvyCXX5esvb2kuOTaVgCv5bWyPxoVCX398GnGqSlWre/ik/5aNAcXR3d1dHwjfEqM/HXXd71RF0osHx&#43;w91i/fvMpl05otjhtGrlg2&#43;bOZK75c6bJyz4XLd3wjX504d3CH/cb9i3c9On6rqE6uImpjiDin8&#43;cvLdofG5bCvxGlk&#43;SXF3fPcfRwvfYgrTgr6kLZw&#43;3Ox88tPfz01rO4NB3RwX6P9k7fZ79r0q4Hp25Ecolp6Vlp2WVFlfmtyvCI&#43;7479cO7tBXqVrWssro4NzstLUPvypOZnpFXVCutJwmC0g3vstNLcqWsSVqaUZablpKU8Mp33yX7OWvtT6w&#43;GnL/ZQJ3ZEjgcd8VQ/c4Oq/yS7v0nEtrT05JWrG0vjyRKAm6fe&#43;Vx8XMvLJW/V&#43;pp4Jhnj84fWLbZ/Z&#43;D7ooyTdPzF965oSzS2XIRmf7JUMmLZyx3X3TQV/3lfb&#43;B04EFdakqCillih8dit41eyLQQ8v1jBFOHsv2vBGdM/RdZVZVeY3RIBIz58/H1pvFy5ciIyMrKmpgb5yR1N1QpEnaIabxXpCGm6RfiqI&#43;m9jFFA3oYZCPeUqLNRcqL8QT2A7tIWC8zap2Vl4IR0U8QOL3lUGxf1RJDsD/&#43;lqdkUcOaUtxGmfGjUEN&#43;gr/y1eMSQZn5ZJQHyDKMddHuyC6AcxECJht2f&#43;&#43;o9Xst/EYJPTCb9adR27UBUXTzglFhpLS0vLvn379L&#43;ZtcINMJw9e7a/v396ejqOmzs2wlL0A0lm34UntdfqNZ&#43;lsqtKWKQKfZyogI7v2Rp1eAuVKqfzFKxBUc7G2DVYYFuiZmcFiW6loHkL3dmPwi0/ux60MaG7D40MaGNCCxrCBPSVHzZpbAvJQ&#43;WquxINdGT56wFLl9MRrZR/rRpaDEOSun/rHhry0BpYmE0ENaih3uq/ZWNYgySPHDrIc/2Xj93Wbd95xPbQnedhWTH3rtyxH3/4gMMy34xjJ87edV6&#43;b9Pc5euXbPI8uuV44No1AV7e4TmteEXW4wr/BSdO&#43;C46kRuW1aL/kzhJfuq5&#43;/Npyz9fPdfGw9vL4Xnw&#43;o1bloz&#43;Yt7s&#43;YttdCyaM33upOGTJkwcOnHul7MWcok2KzbZbD7l6ncrueHJo/u&#43;OzhJ1tIVLcktmf6XjtpvsbFZqXflWbds5a7Dt2Lu1xCVeDtJzswIS/Bac9rOZsmSxQumT54xceRnE78cM3X&#43;nAVLbJYuhSPnz5g6bfTAiZMmj5luM2M&#43;l1t7tnnYHI15EJVP4/X1Dc1lNXIFIRrt3ANJvntu/tbb5496kSEbPQ4f&#43;mzj5fMPklMSk0MO7blx2OV8cuWrZgVBVafdu3Fm1uorwS&#43;ekUw11buSzKNPFcBJ8p49ewICAqBzY1qSoaJVklqoR0OTcagIFumnDk7CNxaQIEtQQ6GechUWai5ff5vVrFyFtWgOlLKrS33YC8s3QZf3J1HsOnUnq9iZ7RUUO4kC9JU3FJBHKlQPmjQxbWw8gSjHXR7EPYh&#43;EAMhEkI8FOVmvkEf6YeRGDQ&#43;ghs1pfDlvkGsyv1CkgFQ5alTp0LoCw8P7/uJa6xakuFnBD2GgnVLd&#43;v4p2bMXtmpgagPSFRsKSTvNLLNSShCHXUU4dRQyFblsYscizKxlIHMQ5f3q0ziYp26gH09iV2FDVQ5ro1qhDrcPqRwrXsQ0fsSjV2xErrRPflCuPUwbjeyAybb1SMBGo3m/v379m8VJwf7YE/7SH9XL/8np4OSMmPCk&#43;5dCNi//WzAbf80OjoivCT40MVjTnsPHTz5NPjUnQd7Vx0/4xEUK62Pj7wRZj/V40Tg1uC62DKpUtFQnZOUEXk34pX32WN2yyfMWTZ3x3p7f99Tjk8uLt&#43;4dc3EeZvWbNrBnXTbumUbZo2eNX36iOnrF6&#43;25RLtHVzsD14&#43;e&#43;tRdvOzp28kmapoDJXEuR7eumrGpPkr1m3ebG&#43;/k/XeZm&#43;/YeWChTPHzNju89i3lCiUt5Pk3Pz4jEtOV47ocgZ27Wpn9vabVixcOmnQzJlzJi&#43;zXwGZGuLmb&#43;&#43;X&#43;uBpbG3qy5Sol8a4/vLlscM7bBePXLr78JnTL18G69PbEZ5ckFAgaSx40E6SH/jNt3sc4HmGCdl4wvPMBIfwJ0m1irqybD&#43;n&#43;557j4WV3yuux1tjwq8G2E/ddfFeVKJO70ELz58/r7&#43;8zli/fv3cuXPHjRunD4Qdo5diHfCRu3E9YcKE6dOnL1q0CBoBO3fuPH78&#43;PXr18PCwnJzc6VSqdEb11DMoVKXEPS1ejX0ZS0ymhLqINTEnUVKqJVQN03EE5lGe71ebZPLLlQjysRS9s0wdg7dudnEjQZNMU7DHwsaebdRkyijoIMuquZcPIEYCLIN8XBAItvhEWVovkFQhf43xK5GFT/5AXwR7UyhwIKCgvQ/v/VhZ2e3YsUKKFSjRo36/PPPDxw48Pz58z6YqUaEVUsyFBqpml24dH42O7SKf8jaE4OmsWu56hX7BJctOlB4oLAYBQr05Xr1nCzi112cWMd8gxb6N8LYoV5wlnM17MvK0DWHqgvarNHqZ3figevkYgo4QAf6WKVqdGqP&#43;so/isRsC/VvSerP0R4IalAi694q9fV1bZI6hbSxSSovzUxOOL3Z/4DdSrdnviFlTThbyVVtjS2S&#43;vrG6iZ5YVbic79NLr4ePs&#43;kWbce&#43;nnPmurhc8szW5klrZdWRz85tsN10eQF08aP/2LB8MmODicfxtQ1pz7ziTuxcI&#43;b7xrvpNDkUu6khRG3491nHz3g8oVLzKUX&#43;VxiXX1DXUNLc1sFSUVG8&#43;8lc5Icf/TwbtfV631uRKSm1dWxg0PqCuvq4h6fP&#43;L85Qw3fyOSXKPE8Zb6Foku59fUCizlvv&#43;t9cMOuR3feLvuYareoR2N0jopkf3owvM9Uxxsphhj0pQpYz/7dNTwgcNHfzZ&#43;/JQpk/Xp7Zhnd37LhbyYyKBOJZlsLKu44RTis9f5UfnVhHysKODeec/ZU9397iUV6GbvVKvVIIf6y&#43;uM6OjokydPLlu2jNNdHr32CtDv0MEN74LLXrlyJQTNwMBAkOGSkhLIsLW1FcPYCU4oijL6IBnqFCjTk2ZqWibxcwsN1YQ66FHJjsyAWgl100Q8gYDjW8tO/AenFmViKYN4AkESWvmLcsjAOjX8sSqaPS9OsX&#43;70XgCMRAcQluoQ&#43;UqiI26TLqzdB70lX8ZgzmUKKEv3n7oKGzrjaYp&#43;I24X98Kqa6ufvDgARSqadOmIUk2ApShVo02pJkdgvF/CRaY5Q5E6CdRGLSOofxVK4WFxjhQrqB4uVewc3Z&#43;EN6jdxVMG2T&#43;j3gFqKPp28hC6pTaeBllW6T8Q1z3H3J/LZQdYgZfb0QLBV91u3pkNdAalbQgqSA06Pn9oAunj7qv&#43;mLDglmTVrlvOeh/48ZNaHTfCr4XklKeXKeRkq2NeTEvD&#43;6&#43;6OZwPOTKvmMetlPWeF18/khCV5IyrDk/7dGVu6cPnPKw3b7dftp0dw/d8K6CcP&#43;ko7P3urgvdbt1LiDoPmQYFHTxhLP3xs83rV47du0pR4/AoKDbQUEhj1&#43;kZje2ShiJmhFMFaKXZI/DezzWb7vyNLu6Rre0hU6hiuJunPaYPsMjwIgkc8O7dMD3jivxutLkuNTI2NTKllIFGygrjQ7vUrYx9Wl1xRmvMhqzq9lJGiTZUZk33G&#43;ccTfEece63Qs&#43;nTV&#43;1KAhYz9fsmmZo/seV/0uIV5XXwWGVRak3dVL8ubDYY8OXL55etrOR2fbS7Kmrbo16kTUdXd7v&#43;TTV55VP3G4curY1LV3Lr8saoLgrr9EczHxEpQQ7iWoSZMmQZd61apV0JU5fPgw9MXhp3/16lVGRkZtba05L0FBPIEO3KMmzY4i5Z/jFD0fbwwiBF1k3TvB7Lv&#43;&#43;tN0DOgi9C4OlLHL1cCxvTQHMNi3w7F/JbCrRUETX3/uzoB4CNcGf8vvYhUfhb9R5f/XFVWGADsuFXcuY&#43;fuBZmHL1wH/EdkVopGo4FmooeHx6xZs5AkG4Fg77podxezrwZZZGjVDyKxgYmKIxUqaM&#43;aI31QdjCKSZfToOKg5Rbpoxs1EHuoBtMziEw4n3nAtVFa5lo9O4VZT6ZM&#43;TBc/rd47GQVO6uXwtyT9ylqXJZ7w/Xa2qE2nw8dOmTIkEGfDBo4kJ0nZDAEapZR4yYvOvrEPY7Jb9YqKtLLLm65fmD&#43;4u0bv1q658spR87eSSzUgjxCr4mmNGqNqk6lioh5fs1&#43;4Ql/XpLdv9q7a8XUFaumTZz0BWQImQ4ZzJ5oEPwftuDzp0OHLp657Nj51OI0RqKwsCTDfxvb6uMfujt52jp4vix4WMu0qjuQ5NZSJtEz9s7pNd4pfmGNaugN0hStVqlVRmhICM45&#43;tW&#43;RV8M/XTeOp9nfoWqghb9rnaoNWqlgq59/Sx5/cGwa9sDAg6P3f4AxFgoyQzZqK0MSnl&#43;duOBhwccTqV5zD3rcWzq0by7SdJuBNouTRWyYsUKV1fX69evJyQkSCQS9qrVaoihHXWIRYAHxJNsBb2lUPnXOAUUe1FF6Ib9OIpdS&#43;Z0lQq0x5w/H9pPcoodnjI7i4BjLdJHN2r/qYsni7OJMtGt6o4BPwXFPl&#43;flkn8MhrjJfm1MItPYdSgiQPnhRjrW6MuIUT3yeEbEpo1giTZFPCjJcooryr1pDQCpBSatKKfvxv2xzh2SNddieb1o47OgY5jFan1qFCNT8N/2Gtz1H0rnB37vb1I2X4h0s6B5vnRClVPhnpB7f1RJHvb3KeaHeqlMi&#43;49CW0mpRkP0m8usd1xZTFX345a9PhDa7&#43;3uf8/f2P&#43;fvv3rFqxZzRSxwCQq9VM5U4o24ra8vye&#43;5vCz3pRWtcFx2MuxVX2wJ9S31mQPuXoLTa9KdnQh3HuziumW9rP23a2sULtu09dvKEv78vnIHFz9/f68wpV7uldttWu19OK0w1Kslxboe3b543fb3dAXf3M2dOnQE8z5xx3bNx7dLxM3af61iS8UpNfURCSICf10Enh4OOhy5ejqhOrmEU7SRZG1ONEbKyvPD7Ib4nAg87nzjpeyg4NSS7UT&#43;hpiHKJkaalB7sc3KZzcF9trv83B28bx&#43;/nJpU3gItBSNzedBqBitpq4iPeBn/5Pqt9Mtb/A&#43;uHDtn2&#43;odRy5fuhIYHH0trKK4FmMoGSOLz4u55LZz385FG5yXLDnoGega35zwel7uLmG0l/zJJ59Au2vs2LGzZ89es2bN7t27PT09r1y58vjx49jY2Nzc3Pr6&#43;m5MqKmimZhWCprjY1Lx70dYRg6hq7C5gHzS9Lo32BngBvEEatnBMnZeoN5b3hg6MB8nKpy60ksG4NqiWqmDZap/JyhEkgwmOoVRA0mGL/Z/o7FFOSSoeznJ3ngTXAFsCs3qQJLcIVDGcUp7tkYNQgg/sOiH77aBdJ2vUWdhtLl1SEebhn1j2LZQ2dWlWsw3aHPMyGRF0Zzb6ULqlNqwFmpKBiHKsEsGtehX0disTCKkmZKq2S/fyqAYuk5aFXrv0PpDmzbuDEzzS5DXNMnl8ly5/OHtUyd3TN0f&#43;DQ5QSe2WlqiUYbH3T9oP&#43;HTtRs91j4gQ4opUD7B3ySU5LACrTrmjmfwxk/dnTevP&#43;gxZ4nHjn13Iiqa&#43;DUhdIc2yptSHh096b3VPTizA0mOdT68cfbkwcPYySxHj/50NM8XY8cv3no&#43;5GI5UYy1l2QtRdNKVW2ENN719O7F0ydPn73rjN2VlNCktro6Rq1mquPuhu8Z7336/M4nbaEFJdVFIUEHN&#43;6aNWvanAPrXW4FJ2UVSiS6dXjao6UZWqWRZuLZ3ndO7J852u7IFd9n8udeZy4c3BLwJK6gmFQr6I7uEkFuFFaWUuS/2W/T5M8njJm4/MBsj/RbsfUYqVGzXyRIb2VZatCF9dPWfzZx2MBVW73uPaWZsm6VGV6SQYYH6dacGDZs2Keffjpx4sQlS5bs3bsX9oaHh/d82QkQhma11rOS1eOfWGKIKGeQ2&#43;V6dZ6ia81oiYqdd2h9Pvkzy12JyCDnedlkQC37LFl/VjOA1h1IOMS6z1JxkR5zJjpLR/ZN9s1sbHEOGdlKtWiEg91gS2TWBZLkDslX0NcbNPCj/iIagx6k6CfvtoHAh7dQUDm7VIcUlDaujR378KdeG3f94yhsSQ67FkVHw6w6AqcYiAjQxxVl2CX7mm7&#43;EO5h9n2J5vUsPFYDrWHaimUloRFPr/r7nHLb53Zgj4uLs4uLy14XF/sDxy&#43;6BSaFFjRCpxPkQlGfV/LU9bLT7LmjhkyevmWyXUhgRHmjft4uDqEkBxdos4N9PT1mLfQ&#43;tdvjmseydd2V5LjDh3fuXDR/1yHvCxfu3bt9j&#43;fx/Qcvo3OrCuREm7q9JONVdMOrxGBPr51r97t7OQU&#43;vRyeHVsoqW5U4ThD0/C35NTE&#43;90POLbf3tl5r4Ozq5PjUf9D555duZcUkVxS2tjcShBGfiqVlGmOL4rwv3Bgi&#43;tBzx0&#43;0XfTciuVpZmxd15cOHXG57b/3eRsiQz6ysZqAXyFFdWZj4N27jxh53jo&#43;o2TgX6XPFy8zt/zDC7IKm&#43;FL5hhcgoT/U/YTLUZOmboJ7NXuV0LqGeyIbnrcJLMLc44ffr01atX79mz5&#43;TJk0FBQS9fvkxMTASHmpqanr&#43;FAq3wwDp2nObPo7EPLPf4aXomkSTjlw02l1bd2Ezowv6q15r4v4xmJ&#43;cPauhaXQZXBcW&#43;rv1FunFJBhOdyKjpHsNhnyTi9sXKp80a0zMfWBVIko0ARUhOaYMbNSBRf4u3cJH9KoMwf/wUD/sICqNPV6n/bunr4e1n0djGAvKhRNOlVi0HqDi0XUQZdsO&#43;HaGvRZkYDbXIiqoRSHJTEV4ak1OU&#43;PDRNc9VM9Z8NmQ4&#43;3B33OgRk5Y5BxyOkSTUY5gab22qL4p68nCfjevSibNnTf98xuqJ0/e6X3wRU9dag6vUehF6I8l&#43;PueypTfOeBzf9IXDpYuud165b9jsvGnH&#43;dtx6ckVFaXQO2Mpr6hIzU1/etHJ/cgm96AMQ0mmK5rjpRkBvicCDhx&#43;EFlUD40DI2shaXFGk1yWHXR0p/dR3RzXDfJ8uvzSo3Mu6&#43;dtdrsacauSqpC2KVvr6muq9GeuyKqoiHgYcPjgohlr5syYv2LjjouJgZlMjXGF0lAaHGuulxQlVsede3TecaPNht2eQX7FVCYoKa1kJFF1ib6nD3ntc770ID49rbaxoplogzbdGzSUWiJvepn47Px&#43;m4OHXW&#43;/kGLpWS/KAtac9Dy/4lhcZHKxqq2kofZp&#43;JPjB5YvWz5xxqyJ09fsO70vvOJ5iawJZ0hzJ7fWU1JScvv2bWhbQZ/Y0dHx3LlzT58&#43;zcnJseCboCrd6wnX6zULsi3/KuOiHLKui7e1AKhcGRh9pELVkyEgpg1y3lGkfNasaev6La8inJ6W2SNJ5ux7keyD9v2l7MM46NXoc7dukCQboU7FNiHtipVQqiz&#43;rMVqJRnay/tKVbG6YYr6s5qNpST5v3TzloxNxU9UqhJkVBe7672JlmaUcqq1rK3iWdx9tz0LJk8bNXnI2A1ffjl/68LhS5ZunGcbEBAbn9CY8eya1zk72w1LbO0cjwc&#43;e&#43;7vc9xrxZe7dzhvPfbkSWYV9JV1TyDfSPJph72Rdzc5HTgya03g3dunk1/st1u5ZObn85at2bDO1narLQf8d/2mDasXTF2/Yrl7QKqBJDPaCmWTqqWkOL8kK6e6UU5CT9NIIdPIGemLoiifvVs99x28FweSrJbRirKaouyk6OSc8sbKFpmiMKQsxNPrkIP&#43;zLYbbW1XbXc97eAbeeVBZEx8Umppc2krgxsRfDhhi7wpK&#43;7GqQt7tjlt2LnX9eTpZ&#43;FP8iuK5dpWFXyHFKNsJBrSC6MuP7rg6uZkt8ft3IGbBc&#43;z2l43vtgcZI0pMVcP&#43;OzdsXrH9aNXM0vkypbWOqwksSC/OD6rqjH9Se2rYz5HNm5x2LXp6D0PrwsvvNZ7OK77cvU2&#43;wvhl7OYYn46FvNobW0tLCxMS0uLjY3NyMgoLi6ura1ta2tTq438hd2jWvdkZ3Oh8tcxCui6icp8D81qJfnPcYrD5ewMl93QQpEkQ278Nm/Cc3Vk39DNR/RFOnG2WpUK3Sx99lYNkmQjpMspKEzjevC6rQn7PJ1IkVFEF1cLxiltsowdRfWXXrtx/csYxd5SZUwr&#43;yaS/qzmAZ2AEoKel92jG9dC&#43;1UMNjuLCKxVyzXajkYO9TFaSqNorGjIicx7df6hv&#43;OeHRtXb3RabXfRxeXo9ROrXR22r9/scvx6wIXnlw477rBbsXX99vMnb8bnyon81BdJXquP79i2Yo3byTsxL4obSorzavPDstIvXb14eu2SYy6rNwc7TrFzPrnQMzrs5aXS5/v2rFgwfcL0&#43;UuW2awSsnT5siUzJ6&#43;2Webub0SSO1ovGfqMhKyxsiorNS89NTUxMvX5qXt&#43;TqvXe9ofeZZS3ybBpIqa3MqCjFSOuIjUOyceetnu3LYOzr5Sf&#43;pVe8498klhsjucdoshmmubipILs8KiwoIuHHVy3rh105rDh88/CZPKK3V3I9&#43;gljGSyJJIn1N7t&#43;/c7rz1cPC5mxEpKSkZBVW5VW01pYmFMRf99m3fs3X/7vOJN&#43;Ob5aS&#43;D403VUtyYwoenQ45beuwc936AyfcQmqeJ&#43;YRieef&#43;e1avXrxJldfpysZwbFVeVUyuXgGsQ6BCEgQhAUF2BBoXB4oU45M6ZV4MieLKNDNDdIloNkd30Y5l6l6b7aDP8Up3MpVCW1dk2RwVdIMNBemZrSTZDD&#43;ozDRHPt9rGJBNnG9Xg1N/C53hvocJMlGeCjRjE7p0aRUJuzTFPyuRFNBarvUZpNptM&#43;bNfbFyt/1WqsW/t5VeeStBnVjFzunEpU2tpWC3r8ow27bt8LZoRnwx0LzH&#43;qnNaAhFSXP/J46L3NatXGLnYf3y8hHecXphbWlpeX1FbmlRaFpyZcDjuy0W7F6xU5fB5/o0ISyyvo2hYZWyJrbKnIzbp8M3r9i96HA9Ucf3zjqcGvvfNvV02csXTVmlduapZu9F0w9dOq6W0xdesa90leH92zau37r6SuvYiNzc7NyOXJyc6OTYoPP7zp0aKP7TcMb1x1KMsYwVVnPL16yXbxn9eLFixYsnjd19vzFY5b77DiTUNKoaCmKrbyxK/DAmsUcS1YsXrZ7m9PZyy&#43;jI3JzM/Rnzy2ullTJGKzjqe&#43;rom5HHF7itmXVqo0OewMfB0QWxKWXlVU3SdWUeBi0VsOoWvCWqsrigvSXd8NO7Thpv3LJkiVrXa7supR747T7I/fVu5z9HH3jo3Ka6tvU/HDuivDroW7LDtrab951&#43;sLT8MiSisImZXObgmqrbqpOycl5cvOM64E1azc4XXK6lJVb2cYd1SlardbMV5i6zY0G9cBExY97510JaOKHNJs1w4GQJjU7hGpLIdl7E4b8OoZ9EHZfoulSEx9&#43;7QaV9kUzNV43vEuUp1CSORM5GLWPwuW/i8EOlCrboOj14u9sGZAkGyG8hVqaQ/5fPLv&#43;tkXWXBLavxNx6ILHtnXtrixGaSNbKChVf9WtqdLD6QVEBn/jR7o3oJxKlKFSqqtDqzLk9Pka9ShLdALgT/swnF0Fa0o64V3NjtXs&#43;nPtXoFS4lXRt6PO7jt18JSn79PwmmaQQEHHqo5UJEbdOu/rctTzchz07Rra2vW6ZLlhxQ9OBF576h4QERLgFXJ6t/u&#43;3bsPHd/tG3zaO/DhkSMPXya9qFXW1KY1ZD&#43;8cenhlVsJuU1y9vGrPgNARspLUx88Dbn4ILGyrgw&#43;MgWFya&#43;uOl96&#43;jwlE4Is5yUGZ5j6otj79913e&#43;3freeAx27vl5dflTfLlHhFet1Tz3tnDuh37Tmw&#43;&#43;DFk1djUmtbpG8Gl3VOferzZD8HXzcX5yN&#43;l2JL4prZd5o7hajJbXjh/ficswNc1NmHng9Knly7GH3Jwz84Hr7DRlm7LGqTniT47T3rFXDsQkRCuaS53fePabU1uaE37xx1Pubz4NT9wpK6N2tDvnWeNmnmZhF/i&#43;uVeDI0mX3Kk9RuBaTOaVFroabvLlb&#43;Nsby01xDht&#43;OYCf4PFimimylunTDGOQ7RUafrFIPSmJfghLlDCbUY6MOQtO9G82uOgUdBv9a4YLK1guSZCPU6iaR2ZBPQvOqhwuHGdpvYhULc8jr9Zou3WsiddNKB9SqhySxi6lZtmJDwf19rGJ2FvFANzdsVxuS9yTsaq9/tsQddfjToHE9P5u4K9GUEKIXCt8mWi2tVrQppA3Njc1NUrlCTYEeCK5No6VxRZtU2ihpasHbcErTPgzRSoVK1tTSKpe0KOQtTfLmeklDfX1jU71U1tzcIpNIZBiBQftDTWhIWWuLrLUNV2ro9lGW0tIqQiaXt8hwtUbFdieUSgJrbWyRYwT0RDsY1QSFTKPEZTJJfROckaNBUt&#43;MtWAq6IBClhp5k6z5zb76xpamVpxQs9NQmf/lawiMkNZLJY2NEmkLrsIp4WsnHUKrlRqsWS5thBM3SmVNMpW8tUXRIpG26b7D9g8t1IQclzZIm1qaWhS4StP&#43;8uDPVJNYW5uksalZBk0NlcY67q7oqCK1L6XU8lzywzB2tISozPfQ/hSnWKZba8H8HwtQ6N6SOF2l/md8u8WMLWLfDJNDq3pJDvlCys5q2aUrU9LMjQZ2XK2Jh9wiVQYTOfD2rXD5b2Mx&#43;OafNlPlJHtjskvf0lsBSbIRIKDUKbV3GzVbC5XQ&#43;ft&#43;pCXnzPpeBNsftS9WpsgpiXnqB2Uap9n7w3Ft1L5S5XjdPAOgo6Kcu2c/jsI&#43;TsQ3FJCX6tQ5ChqaIxkYXUKw83V0SqtGW0rQLmUqyOEHPbsv9zVde/bv8ew8KnAloMcQNay//iAQnQIlGarVzQYNtPKHJuEQASwy6RBnUO&#43;g9kFYyNUt9KQ/ZceAB8QTuCRofEPHAzrKo1Pwb1topl6Q9p9GYYOTcIic0OsoxLXVSm2anC4jaXOaaNB3hxDkoJu62PRqHAaSLFZlrqf&#43;70TFpgIlaHwlyc6w3S9AkmwcKD/wEzaoGNCbv8ZbcnVxKLXQxx2bip&#43;rUaebMXUlXAn0p2UU&#43;xRErtFC29azUvXnWAw6lBZp20J9XpdPQuVU0exMe9kKGi4MOr7m3G4C5X4g0czIJEBQe3gx7FQhMewEXq&#43;kVJvGCqcKQSC6DxRnUEHoqIEE/rkHE8IbGhtPQuVfpBNck1p/vo4BD4hsUNNBvqFJnY3RrmWqX0Zj0FcW5dwNAyEEPbYtUsa3UdDfhbOkyulT1eonzRoIL52Sj9PQcJmcTkCE7DSeiFQZTLgX/pzfxrBLCcS10RA8zWkQWAlIkjsEVIGkmYgWdskHKPH/G82qoPBX74n9KkYxKZ04WK4CLSwj2UFMokIDH&#43;HsmRgd1KABDT5crgppZpddq1GyL2gdLFNNSsM/DGfvOYtyNt9&#43;Fs0uNr6nhH13EGpmvoK&#43;Vq/ZVaycmkEszyPP16hj26gW3UJVhkCXPUlGnaxSzcoiejh7CdS9X0Rjo1Lw7UVKqJAGE&#43;AhEO8CEE9Aol5KKWjlj0/Df2bR&#43;ep/F6uYkkEcqWAXg4IeIcQT0asKcHZo2YNAQpfxWKUKLLSFKsLZu2LQCN5bovwsFQcZ60lf&#43;RfRik9T8ANlqudSCrrsWRh9sU69o0gJErsmn7xQp06UsW9zGB2wWa9iR4B7VKqmZRLmj2AVSTIYJMKf8OsYBfR5IJQFN2q4de36UTxBktwJIEgVpBYUcXQKW4ugM2eRvilnw5Nxx1LV4yaqitQ2q7XQMeUNNA/Eyb9WPTeL&#43;GeC4vex2M4idhoaqELgCfIJl/THWOy7EWwRFF0SfASp5tKNXi3s/SBcPiKFLbVhLRT8jQUKVvvnZRHQtISWx8&#43;jsXFpuFu5Kg2j4dqEFybTaKFeJcioE1Wqz9N7OsoaLhJONzoVdyhRRrdSmG75NgTinQSKNuhiPq7dV6oamcwuDAw10YLxZEwqwSlitVIrbR9PGlXaMkJ7plo9M5P4a7zi7/EKxxIltA8gzoCBgu4rUUJf&#43;TvG4gn0Wfl4IkznDfZ&#43;KxwDUd&#43;rm9hAQbHrH0OvfXoG8esY9i79r2Iw6IFAOwD6GKCRwgtr08UTqPtHK1Sgo6KcOzWRJMOVfDsCG5/Gfg&#43;JMnYNm37UP&#43;ZAktwJ8Ityt18CatULdZN5fWC5l/1/GoV9koRPzyQ2FpD7SpVQZKHfCQatRRDLpbkklPI/xCp&#43;EMlWlX8nKqDzerNBDcUaGpVQ9E9VsfPzQff9W&#43;2XlPkoHIOW5s&#43;j2Hn7oIwKd3EGe&#43;dlE9D5hkyg8oDAH69UfZVBsLfUwtkwARUMeq5Dk/G52SR0XuF6vKpUp6pU4OZSptxeRC7IJkam4FDTRDl31bj&#43;MTQvoI1cp2vPmnF/C4Hor0CLs0Wjhf7i2Rr17Cy2xlmwrwyhYHASPiuL2FxIHihTQm2FOgs1F&#43;qvXbFycQ4JvVio&#43;9&#43;LwL4fyU6Tt063/k22ggbBjmihwJ9bwhna68JsvxOBQRSCDgm0no3Gkz/FKSDz09VqaKnnKWgIUNCa/yId/z27xiI7ovvDcOyXMRj0QOZnk3AlcD1coIOIB9dpW0hCOIK93VtKQCjJv4kBPcYhsiXJKPij&#43;uP9NiTJ5gLdU&#43;izLslhhxZDQ8yCY57/m51iRg5N12HJ&#43;JhUHLqMoIVQtqAoizx/HaOAWgSqXEXSTWotXNK5GvUX6QQ0FH4Yif0qRvHHOMVf4hRQuKGIf5lBDElSwK5fxrCVEGo&#43;VCc4148iMdh1oU6dImcXPE&#43;X01frNVMycNB1o/UN6tKQZBwqM7QP4Aqhff2jSLZr28PWve6vZusPtNahZaD/lhGI94MygoY&#43;K0gUaCTolqX6ypAP1E2ooVBPobZCnYWaC/UXarHIEwykdGuhMliigSa&#43;RK2tUmpBvyel4xDioAcP0YaNJ/EKaDQvzCampOODEtnwAs1oEGno&#43;0K4gHP9OIqd2Od6gzodo6HLmyKjIU6OSzW&#43;uPvXQtkpByC&#43;QZSDWAdXCHEPoh9Eg558AyDG0P2AvxraAQfLlCldfCXMqkCSbC6Ebo6qh03s09bRKexzF1Gx6LZBwYXyDTIPsgrlGwy0CvqphmUUEv&#43;ga5AGNWpyFDSme5PhQZNmd7ESevDQMr1Sr7kn0byQamJbqcgW6nmzJrBOfaCMvcP8q2jsexHyP8Syq6OAkMOBYNA3dS1j5ymD/i5UMKO1AqoWXA9c1U&#43;i2CuE2gjqbljZumoQiaA5D614aFN3Y1ZtBKJfo6C0RTh9p1GzvVAJbWjQKlEF6bZB3YQaCvUUaivUWS6eiDq&#43;nEFTANR3ZR47oUc&#43;TuMUO2svXNKOIqVNLnm0QgWN9QcSzUspBY1m6EaHNGtAbqENPS4N/2U0&#43;9Tsr3GK5bnsc2KIjbkKOqqV2lvKrvkI/V2j8QRSIIhx8QQMrhDinkXiyZ/jsPnZ&#43;LkaVY6iyzMrWBVIkrsGNCdB5/aUKAckso&#43;CRMWibwzatmvzycA6NdQf6Ci3aJgXUupinTpNTkNZFJXGOqU2oY3yrFQtzSWhcwz1BzwTZFQlSUNNO1TOjjSB/rHFX5c0YR/q7qvPzdZPPKu/UATi/aOapJ80sRIInVoQKlFN6Rv7R4JicyF5tV6dr2CfiDWqtE&#43;aKBDjLIxu0bR7qxg2a5Tsc1/3ctWSHGJqOg6BCPrHSTIK0p82a/aXqqBTDvJv9H5bLxmI&#43;h9ioaNCBNSqsth3WPp3&#43;x5JctdQ0eyip5Gt1OEKVsxEhaNv7APdg97J6YRTiTK8hQINhksC6ZVTRp6dKGl2PlsQYOiMgjNUp0pSW4DTIVI2EIC6fz&#43;SvUPek7tGXbU/xik2FLA1uYyg5Wg0F&#43;I9hqTZuS1fSjUuZSqLzH/XDeMe9EJ7Ha4BesMQ4uCSQJuxDuJJq0ZbTtLpcjq0hYprY8UY&#43;segx5sK2Zvw34vo63gCrZltRUro3Fcr2eXj9Bfab0GS3B240VWgyhPT2CH7vTFPXqf2&#43;1jFjEzidqO5a9FBWW3TsI1c0OO7Es3OYuUIi94uM21QRaGificC&#43;1u8wiaXvfEOl4HkGIEAoFZCK9&#43;ZfYTEDlGGLmbfx5O/xLFDPh83mRtPoPK2athFrqBvHdSg3lqoHJTUd00KiCfwLYH8Qxd/dT57472YEL321V9BktwdoDjiFKttT5uo&#43;dlEb8yT16lBR3lMCn65zoyphHVAeYUyW0HSV&#43;rVK/PIX8cojD5e6iWDKvQ/YfI/xWKbC0hoRkAMgsY4UmQEAoDOKMQT6GsGN2qmZRDf6mBgc68aBISJaTj0NfXX1BlQeaGVX4TTF2rVi3MIbjy2KM/eM2iywOn&#43;Gc8uyayfBvhdeVUDSXL3kVPaKlLrV6NemE38O4Gd4asvhflfCYpNBeTzZnOrEAe0JT0r2ZlPPrT0uq0mDOILfDnjdC/v35OwE550aX5vBOJ9QKbRFuPsMOy5WcQ/4tmV2vtSmAcmsXP1RLR0bWxHjm6ChPFpuAVf5erU4Gv5USQ2OQ13KlFCtx5i2jujxwCS5B4BJYGbU35VHvnHWMWHfdjvnJxOXG/Q5JsxhZ6QfJw&#43;UMZOe2LBt6s7tf8Ok/8&#43;BjtSocpT0BB3UOcYgTCKRsuUE9pHTZrFOeTvdZPmiqpS79mMTAKayyBv&#43;ksxj3Q5vbuYHTFu8eV5OjLufhs0Wbyr1AU4&#43;/D4HYsnSJJ7CvSVy0ntwyYNNNmGJrNrVPRN23ZeNpkooxu6uGwTNCAu1bFznkAbXJRhbxh8FVB/JqThzqVsA1yqfnfuLyEQFgcqM9dXDm5kF0cfkMjee&#43;v5C0Lm2Io8MqvrryOWELRfrXpWFmHBl0JNGMST74SzE3pD1zyujWqxmsVbLQiSZAsAKoPTTIqc3lBA/lN3B7sPVBn65fWqLq/wD1UuopXaWaTs7TcuuPFc34vAfheDuZapoDffikZzIRBmQLOPlpnoVnY9x7/FsxOJ9EE82VbErvDf1XgCIeiVlNpYQPb2XTcunnw/Avt7nOJ4haoQf2df1kCSbAGgaEDxgA7rSykFzbepGcQf4hS9XYvW5ZMgcl0d8w/91Pg2yqFE&#43;cNeluRvhbPT&#43;83LJqARndDGTjeP&#43;scIhDlw8aRGqX3WzA7DnpRO/DZWAZokqmKWNbtipUrb5RmhJSptTCtlW6j8Vi9L8oe6Nz9tctj5GFLl7DRh717/mANJssWA0gx95XQ5O1/0jEziJ1GWWe&#43;sIwNJhnLZDUmOa2MXSe09Sf6abvKg38UqPk9n9ViuW1YSgUB0CajaCopJkNGHK9hWvmVXbTc0kGQQua6&#43;SNSoYhem29qbkgydY/jD/xSn&#43;DKDuFKvwXTLSr7DIEm2GFBOoBa1aNiXo0CKoAD93uxVxrphy/PIcpJd579L1Cm1DySatfnk93rtWfL/hLEvaC3MJu80srP0daOeIxAIqDTQV25Ws0ukn65WT0wjfhPTi/Fkc6GyQdXldf4rSXYCzqW5ZO&#43;NRPtWuPyX0djyXPJxE7uaJHwn7/btNiTJvUImRp&#43;sUi3KIf8Sz06PJSpkFrFZWURYC7sKm/6U5lFK0Keq2EWfPuqFVu1/hcrhj/1ngmJOFnG2Rl3/Dr0siEC8RZJllEeFam42uzb5d3unMb0kh&#43;RWY9Of0jyguQAXNrl3XoL6Rpj8h5HYx4mK&#43;dlEYJ26VfNe3G9DktwrYLpXltlh2KXKwb0zqc2oFPxYpSqxi2ueZMip9fnkP&#43;ItuSQcb9&#43;OYNd4sS1UQnu2hNCto64/LQKB6D4yjbaCpIMl7DDsfyf2Sl95fBp&#43;ulqV3sU55&#43;PaKOgi/6V3hs5A&#43;35kCg5/8gspVU6yD4/fh3iCJLkXqSTZaWDtipVDkvCfWnq58j/GsZ3Rq/XQeDRr3DV0WKFLHdSgnpCGQ9vTsm9WQG4/imLXcNxdooSGSI2SvSR0uxqBsCBlBDuV9NZC5cAk/Ee6ly0tGE/&#43;Gq9YmE3cadS0mTcSk6TZ&#43;HaxTj0iGf9BpCUXqwX7r1D5T6LYldT3laqeNrMrH78/99uQJPci0KyD7nJ0KwXd2U9T8G9ZYg0y3r4VLv95NOZQosxT0C1mDHgA5Q5p1tgVKX8fq4DLsOwAzv8Ok0OzY3uRElrN8Cdr&#43;uHK4QiElQO1vEWjDWthF3AbnKT4wKLx5KNw&#43;a9iMJcyVQHOjmfWn7JjJCp2SpPNBeQvoi3/5vSH4diIFHxPiTJNTisodhDr&#43;xNPkCT3LlCS6pTsIOcjFeww7F9Gs5NuWkQOoY38P2Hysan4gVLl82Z2EfKOJt6BAg3t2RdSVo&#43;hSWvxZ1G/jmEny9xfqnymuwz9WREIhKWBulyt1Ea0sMucT01nZ5a2VF8Z8oFW/uR0HPQeVL&#43;h4zkPoMMK/XXQ4y2FJDTELTs1L6j772IVk9MJ13LVSynVbEZn4x0DSXJfoCvE2mv1mlHJOLRtLXiTB1T5f6MxaE4myjosvlC1XknZNZ7/kdArbzdOSMOPVqgy5BAuEAhErwON72Kc9q9Rf5LI9pUtWKkhtz/EYgfLVCmyDuf2gYr&#43;tJld2vUPcZaPJ98Ik0/JILyq2Ml33894giS5LwCxatNoszD6XI2aGw3xnQjMUm3bD8PlQ5Px5bkk9FP9atQPmzTQugR71kxBS9a/Vn2wTGmTS4KPxd9F/rPuefbJKnaUmQT1jxGIPgG0EvQyVU6frlItZGfDVnzbQre&#43;IJ58N4IdOroqj3QpUwbUqh8L4skDica3Rn2gVLkwhxiUZPn7bX&#43;PVyzKIc/WqFNk7OS7&#43;r/2PQNJct8BfeVGlfa&#43;RDMvmwAx&#43;yZ0ly33DAZy&#43;3UM9mkKviaftCtWgm0tVK7NV36WikM3&#43;lsWXQ8DGhPfYJsC2Kws4kaDOh9/b4ZeIBBWA0mz81nebGDXc/xDLDvm2bK3334bg41NxTcUsMGEiyer80hQ659HYdCZFvn3xNh4Eib/KBwDPb7dqCl5v9eJQ5Lcd0BfGQobFDjovG4rUv5J11cWlc5u29d1GvmzKOyv8Yp/JeJg/0xQ/C1e8XOdHltw1Ug40X&#43;HySHnxTmkb626mECTVyMQbwGIJ9AYLsDpexLNhgLyVzHYty33WBcEHjQSWvPQc&#43;XjCcQWiDAfhLN7Rf7dNi6e/CtBsSyXvFSnLiXYxeL0f&#43;F7CZLkvgbKm4JiQJWX5BCf6FZ66Y1XhHvJoBkOzYi/xCmW5rDvX&#43;V0cWlIBAJhWdTsax0MdC5nZ7GrtkP1hB6nqNpap0HnGOLJ93QrSUD/G/4EaF7o/6r3GCTJfQ20AEGVa5XaBBnlVq4am4r/sjfnybOgQf2B9uzHCYoDpconTZoywqyXJRAIRO8BIga1sFr3Wge7FHoq/rNoCz/i7SXj4smwJPxwuep5s6aSpNEIUQBJ8tsEahGo8pcZxC9jsN5eSqWH9nVd/xj0eGMBGdHCvryPqg8CYVVAxXQuU01OJ34RjfXepNM9N&#43;gff1230uLARMWOImV8Gzs4FIUTDiTJbxPoZZYStG&#43;NemE2u/6aqOBaj0EVgvbsX&#43;IU&#43;0uV4bp3FlVoci4Ewspo1WjzFbR3tWpOFqvKolpsPcb1j/&#43;doID&#43;cXQr&#43;/bm&#43;zq82ghIkt8y0NdMl1MXatmXo/6RoPiod&#43;aU74lBc/unUezYS/tiZaj0/ZrcDoHoXyhpdo2KczWqBdnE3&#43;IVH1jZvTdo3H8Qzq4UNykN31uiBD2G/jF6/CUESfLbB2pRnZJ9Ocq2SPk76&#43;sr/yQKG56Mn69RV5BamYZtQ6AahEBYJ1A3udmnbzdq1heQP7eyvjL0j38WxU72d7leU0lqMQrFEzFIkq0CUOUSgn4g0WwvUn6agn8/gp0nT1Sa&#43;96gf/yjSGxmJjuZTqqchotEKx8jENYPQTOFOKvKGwuU0J7&#43;tkVfW&#43;q2cdPyz88mzlSrszFdPNFfL&#43;INSJKtiDbdjDyHy1V/iWNHZ/yHQZnuYwM9/r8EhU&#43;1uk3DznOCQCD6EVK1NklG7y9V/joa&#43;28rGO31kyhsSJLiYp1apmHf3UIYBUmyFQHNxkYVO6e8W7nqqwzix1FvrSJ9XyfGy3JJ0ONkGdueReOrEYj&#43;BTe910sp5VyqnJyOfy/ircUTaNx/nIivzif9atUZGA3te3S/rSOQJFsdMo22EKdPVamGJbNzYVp2nrxO7Wuh7Nyc/0hQrMwjbzZoWjVsQwGBQPRTuGHYRypUAxLZubf6OJ58XRdPQI/X5ZN3JRoZxaC58E2DJNnqUOvWqEiX0zcaNMtzyV9GY5Zd/sy0fTeCbc9uKmRXWiwh2PYs6h8jEP0XqMKgyiky&#43;kq9ZmEOafEZ703bDyKxgUn4jiJlWAtVTmpBj1H/2DRIkq0Ubp68y/WaaZnsywwfhbMLLYuKu2UNms/fi8AGJOLr88lbjRo0kw4C8c4AWgg9VN8a9dQMds0baOX39oAviFffj8SGJOFbCpUPmjToZpuZIEm2UqAAa7TsqqiPmygo06CUUL5Fhd6y9p0I9uVjxxLlKylVrUQvCyIQ7w7QN4VWfj5O35Vo1uaT/6ebDVsUASxrP4xkXz52LmNfPq5ValHn2EyQJFs10LZt0TBQi7YVsi8zQCnvjTnlvx4q/99obHQqfqBM&#43;UKqeW9XKkUg3m1UNNOgW89xUwE5KAn/QWSv9JWhf/zLGGxCGu5WrgpvQffbugaSZKsGyjL0VpvU2mQZ5VSqHJmCf68X&#43;sofhMtnZBKnq1VwlhY16h8jEO8mtK6VL1FpY1opu2Ll0GS8N6YL/G4E&#43;/Lx&#43;Rp2cHWrBk2G3zWQJPcPZBrtCynlUqaakkH8PlZhkfUcv6Zrz/42VjE&#43;DT9RpUqRs3qsPx8CgXh3aVZrnzRp9pYqJ6bhv41RWKSvzA2u/kOsAmKUTzWrx&#43;/5ysfdA0ly/wCat4RuuXK/GjW0QL9nibbtN9hVyuWzsvTtWSV6WRCBeD&#43;AnitOabMw2qdaNTOT&#43;MASY7C/yS7uJF&#43;YTVyoU&#43;cq0MvH3QRJcn8CWp0ZcopT5X8mKP4njG2ZiiqGOQb9Y9DjjxPYlcP9a9XpcqoJ9Y8RiPeMFrU2VU6dAVXOYl/rAE3tXjyBoyCeDE5SbMgnL9WpMzG6BfWPuwuS5P5HBUnfadSszCN/FMmucSaqHubYf4XKvx0uX5VLJsvoBvTqPgLxHlNM0Dca1ItziO&#43;Gsz1dUawwx0CPvxMu31xAZspp1LjvIUiS&#43;x/c9F53GzVOJcoxKTiosvltW&#43;gfQ637V4JiUwF5q0FTr9LilD5bBALxHsJO74XTQQ2aXcXsax1d6itz8WRQomJ7ofK&#43;RCNRaQn0/nHPQJLcX5GqtbkK2qFY&#43;ZsY7Lu6laNML1MBe6GmfRQu/1U0tjyXjGyh6pVa1KBFIBBAk0qbidG2hewaFd&#43;JYCcOMieefDscg/izIZ9MlNGN6H6bJUCS3F9R0kyLhp1T3rVM9Xk68fNodvEoUbUR2n&#43;FspO/f5qCu5arXkjZl/dR/xiBQHCQNDsM&#43;2mTZn&#43;pcnwq/tPO1rz5Rhi7stOENNyjQhXWQoEeo/6xRUCS3L9pUrNtW/dy1eR04tcx2DfDjMwpD&#43;1Z0OMfRmKjUtjJubIwGioPatAiEAghEBNAWZNktHOZanwa/otodmIiw74ypHwjVA6a/VkqfrBMVYRrQc5RPLEUSJL7N9yc8qCy1&#43;o1MzLZvrLhK8tf0/WPhyfjnpXqFDk7GBK9vI9AIAxR0uwTsXQ5HVCr/jydAN0F9RXFk/8MZfvHY1Nxn2o1eMo0aGUaS4Ikud8D1QEqUjmp9a5Wzc0m/hGv&#43;H4kxg/Q&#43;HYE9psYBfShoX&#43;cKGP7x&#43;hlQQQC0REQHqDXW4DTxyvZV5b/HKf4bgTG3XuD/vF3IrDfxyqmZhAuZaoMjAZPdLvasiBJfheAWgF1o1apfS7VbC5UDkrC&#43;Xf//xqvmJfNvnycq2AntwM9RoqMQCBMwE1MVKPUPmzSrM4nP07Eub4yCPM/ExQ2ueSVeg1oNvSPkR5bHCTJ7xT1Ku19icauWDkkCYfmLbRnl&#43;eRF&#43;vUWbr2LLq/hEAgzKcUU10obV2V1vy3qJbfR8v&#43;FKdYm09eq9fkK3T9YxRPegEkye8U3Dx50a3UrmLlslxyfjZ5s0GDUVoVGn&#43;BQCC6iAxT5JVVXMysWJpQPy&#43;1dVEOeU/CxhM1utnWayBJfgepVbIvR92VaG41avIU6N4SAoHoDo2NjREREX4Pnu2&#43;8&#43;p4YtHtRk0RjuJJ74IkGYFAIBBGKC0tDQgIOKojKipKn4roTZAkIxAIBMIIWVlZ&#43;/fvX6vj/v37&#43;lREb4IkGYFAIBDt0Gq1FEXFxcWtWrVqso4LFy6AWtA0unHduyBJRiAQCEQ71Gp1c3Pz48eP586dO0LHsWPH6urqFAqF3gPROyBJRiAQCEQ7QHrz8/MDAgK&#43;&#43;OKLATr27NmTlJTU0NCg90D0DkiSEQgEAtEO6CI/e/Zs//7948aN4yR5zZo1ly5dysvL03sgegckyQgEAoFoR01Nja&#43;v76pVq0aNGsVJ8uzZs52cnGJjY/UeiN4BSTICgUAg2lFaWgpiMGXKlKFDh3KSDN3lhQsXPn36VO&#43;B6B2QJCMQCARCD03TOI6npqZu3rx55MiRAwcO5CR52LBhEydOvHbtmlwuV6vVem&#43;EpUGSjEAgEAg9IAn19fUvXrywsbH55JNPQIw/1gEb0GM&#43;ffp0eXk5hmF6b4SlQZKMQCAQCD0kSaalpfn6&#43;oIk8HrMMWjQICcnp1evXtXV1em9EZYGSTICgUAg9EAP&#43;OHDh7t37548ebJIkgcOHLhq1aqzZ88WFBTovRGWBkkyAoFAIPS0trb6&#43;fktXrx49OjRIkn&#43;5JNPpk&#43;f7uDgkJKSovdGWBokyQgEAoFgoWm6oaHBzc1t3LhxQ4YMEUoybIMkg04vWbIkIiICPLVatEKj5UGSjEAgEAgWCP3Z2dn29vbDhg3jx1oLAZ2GjvLDhw/BE8RDfxjCciBJRiAQCAS71ER1dXVoaOi6dev0CmyMCRMmXLx4saKiAsdx/ZEIy4EkGYFAIBCsJOfk5Fy9etXGxgakl79fzcN9/Oyzz44cORITEyOVSvVHIiwHkuR&#43;AqViZJWyyoyMlPjohIzozNqSOoymuWc58K9STTbXF2UVZ2XmVcurZIya0u3RoaU08tqi2tzknKLa/DpCoUTLqyEQ7zkQBEi8ra46Ozk7IS42Jim9qLpETj94GeHq6jpz5kxOgI1K8qhRI7du2eh39tyrJ5E5uZW1hFKui0EIi4AkuZ9AtjB5t/KDdjtsWjJrxa5Ze5/4PStRqjlxhX&#43;bZI1JL332nt231/1&#43;0Z18pk2p26NDQyqKH/k8Obz&#43;oM8Tz6d1FU2CfQgE4n1ExTD1NTnP7rpsdFm2aMHsNfbe9wJK6L2&#43;N6GLzC01oZdkUOHXusxJ8tAhg2dNm7R60eK1c3YdPHzzSW1zMXQZ9NkiegqS5LcFVAlZY2lm5vP7YY/vd07wrfuXzlzzPnzs8EHn4/7OFxOfJtWpNTpJ1moYIk&#43;Sfztg7w7HTfs8nxaFVDFywYR3lFJRE3Y2zHPZTnuPzUefP8tprsIZvZp3BN7E1KWUpLyCM79KKUquYyTosRECYeW0VSjLY1KjQ7iYYZLg&#43;/evXbty7uSRw4edD7s4n/C5E3GnWG539MzEiROHDx&#43;uU2DQ4Dd6DHCSPGjgJ599OmzGhM9WT5hmt&#43;mA88O0JyUtSsogoKjkjCS7Ljv85bNH&#43;nO&#43;5sHjkKfxJYklWCuOpFwMkuS3RRvDlCYFn/CaO2bF52M6Z&#43;K0Mcs913tGJuVWyzCFDFeRKkp/s4hWMY2vamM9D&#43;1y32p35UlubQXFqIQ3kiiSqn5S/nzv/tUrlyzf7/qiJKSewUwPlmxIY6IP3jq05LPPxiw&#43;eMM5iklB0/UgEFZO8ZPWh7ZuW2bpg4Ypxo8ZM23OOud9T/MelMgbW7HGJmlJZc0Bl4MDBw7k5tHk&#43;sftRVkPeEwZNdBt7iCXtTZfbL/pfjtfQRoElLZKJuVMtM&#43;qRTMm6c/5mnFT5kzffWvv7erCOlLvjHgNkuS3BZTF5qrMyMhL3jd9vTm83J3dNsxcP234qKEDR01dOHWr17aD&#43;l3e5y94B8UEx1TXt4gLMa0mJAmBSRe2uhy9tvdCYkpNflFZQtjNq3cCXuN3LsBrt6fjokVTP580ee6CXUftTgT4&#43;Op3XnkUfy&#43;5pUzS7m42VhhZcWG5z&#43;bJo0d/OmmT91L/irB8uX4fAoGwTpryiJz7r&#43;4G6oOGt4e3t4PjtkWzRwz9bMjEAZ8usdni6Ort7cnuOuvtfeFS8KuXJa2FcvaeWU1NTUxMzI4dO/Sqy0mxTpKNMnrIgGUTByz5ctKIaZsXb3HzOfc6oATcuRYUmVDeUNNaTiZ6hnuumDZh5tSFG7aeOKkLZqe8j&#43;w8unflio17VjldCYysSW9gCLSGhQAkyVaAltbSGkqjkVfmlF7bdWXbpC/HDf9yk/umx8SzEr0Ho9XSFOujgX8oWgsJ3B5GqyFk2ddcb9vPPHgp0iuxuUwam/LcY&#43;&#43;XE&#43;cMHjJ0yJDBgwYNHvgJ2&#43;79BLYGDx4iZvzqY4t9Sl7lCH9ybW3S0zCHye5LRn81beroJYfG2796EF9DvzkpAoGwWqCi0rpw0aBRR8U/ct8zeezssUuHTPf0up9SyjC6qg4&#43;lJYNKGo2pNBMVnbOpUuXVq1aBXKre4gM6G5c6&#43;EkWsQn0KVuH1SGDRkyb9J05xOhGYmt5a2sJG&#43;cNmHjOtcbD3CyGE5Lq5nGV/VRBw6tnTZrxrJVvpm&#43;6UwTwV4QggNJ8ttGSzH1aW2p1&#43;9fOXP0qKe7x9mT3oFXrlx7EJYcVqYpb2M9GEZOyEqynt98cM7nzLmHQS&#43;ySuWEfpSjolRZGXLvlLvz5t1&#43;zyLvpic9v&#43;l22Wu/ncvFQ143rl2/4Xdo&#43;9EV4&#43;ZNm/vZ9K127qd9bty4fKMdwS9Tn2W2VjWrdFcDKBimLD/i5rklyzy2Lj3it3WFrd2U&#43;YdO3E1LkDJS3guBQFgjNGguJi1If3z1nrfH6ePHTpzx8bl67cKdkBsPU9NKGiGisJWYbGUqI8siL1046&#43;Vz4&#43;nNTOL0rYhdu3bNmDGDlVqdGLOmE16jneVPoIE/auyCpat8zp7ThxKWmzduPLn7MD6tSlLfWq40lGQId3hOU961gF2LtyxatikASbIYJMlvE1qJq1trW&#43;P9M87bbJ4/dsi4WeO2XN5zKT2zsKr&#43;DbX19dlF2Y&#43;vH9rmsHDxfJvDe7xfJDXJm3SSrKkNl8a6nHI7scr20oPEsISsu767VrruOrjvUePjQpVGJa96GRC&#43;b7b9ZqeFDkH3MiprKLVC0YLL2pplKow0MrZCq2nUKF7F3T&#43;3c8qe4y4uEcXeh1w2zhs7b5tPyPl8Takc9ZMRCKtFo6Xlirb8oqRbF3Yu3Dh2zJjBi5bs9L6QXxyrDyavKcmof3nihdeq5YumL7A7bve4Za1H8MyZM8eMGcPqra5L/Lpf/PqDAPj0yZBhQ8dNsdvnWl5ZQijkLQ0tcowg4Qr0V8IwreWMoSRDi0Fd0VL&#43;LGj/2n0r1&#43;y6lnUph5GiB8oCkCS/TeSFsZX3Dl1zWb5lwbjJnw0dOOzToZ8v&#43;XLxli3b7KDF&#43;hr7Xbu27nK0sz96ye1C5O2QzJS82iZSDcUY5LE&#43;7nqS17zjpy7bX8yIS3mck3TV6/il034R0YWKqroybe3jF&#43;fcHeevc/UJ8kspy5Zirc2VDVEXYx/ePPWw&#43;FVO2&#43;s3m9&#43;gbCqURB4LPnVgzvLzx/3v1MnCbp3etXPK5&#43;sOXHd6IsmuQy9QIRBWSx2JxUcGnTixadnqKZ9NHjpkyMCxY6fMW7Rt&#43;wZ9MHmNncOu7ftcDp08H3z/dmzqixyJ8wn/Tz/9dIhuXmtWgnkNbn//moUT6IGDBg4dudl2bVbW/bTwJ5f2BT59nprJMNBV0GNUkmk1Ux1a/9L98Ib1K1bsOxZRGNrKyNGwawFIkt8mbVkvSi7ZejuuXiJkwawl08dOHTds4CefDB0zefS0JTNmzl&#43;xepP9lcTAHKb6zdrh7GtU2Xe9rq4Y4eR62vZi4v0HlyKeXPS&#43;mXY7qrZN0SIvD6985nz&#43;oOuyZaf8QzMzGKaFYciGwrqnhx/6HFrr8uDso4IahVYw9BrkWSUrTcg&#43;u&#43;7s3h1THV94P82itRVpt474rfpi/Y4zq70z44rb4Kym359CIBBviUpcFvbkvKvLkiUb9NEEWLhkydyZUydMGDJg&#43;JCRg0ZM&#43;nz6nDlL189Z4&#43;F0&#43;llCbUsNSUqam2/evAmuC6ZPnjFuyKdDB7aTZB3jRgyaPWHoZ2PGD/ls&#43;lcz53NZu7s75Obejg3285pne/rMncDKtlz564dbekleO23C8iU7PH1S0kJycnIy03MenQg/uXrz2r1L7K/dzK8thG6A/gAEC5Lkt4la1qioyirLS08V8upWauBmzy1Thw0ZOGn1/hXnkgOvvUwKeRFVVJciZ9reKGgjw6SEXtjr&#43;NmgBVOmT5i3YcGa/XuOXruVWJ7dXE9S6enPfU8ttTl0OODg49LIClkbnI69VS4lG2KSHwcc2WB/wif4RjmV9&#43;a3hv2SupwnDxwXHLbbvSqg&#43;FqqTKvF25Ku5JxduWuH29zd9x5l1kh0fggEwvogKE1TQ3lhQWpqhj6aAFGpqQ&#43;vnbC3mzAAwsSnM/cd9A&#43;&#43;l5B872V8dFJuoxwnaVqpUtXU1KQkJ73yd768ZdySz4dxMgzw0rxl5og7dpPWrd05fkPAuRsvU1JTwYqKcuXyWmnWs5KA7edOn59/OvlpRoP&#43;WvSSbDNtwsTRE6fNWLFy8Spg5aqF01YunrPU&#43;da&#43;e9Wp9SR0MVATXwiSZGtAqVFK64uy8uIjE6IjI5/djbzmcfG4447t21wDn/mn0bnFVXh5alpKbGhyRkqlrFLGqNhbPSCO6UlPL5zZuvXA&#43;vVb1m1dt/vswYtRCTUtdW1FjQUBdzy32gyeuHrLIfubkZefRb7mZWTknWs&#43;rg4zvrLd7mZ7p/BJYauCewJE4wyZXRJ78dSaxY47DzmHN7&#43;o1o0gq3nVGuV8ZNeu&#43;cuPnH2Vn9zKyA1eQUQgEFaEhgRFbClPS0mMiYx8ERl5LyjwpIedrZPTKcfjT19kVVVircWZ0VnRL2Pjc3JKG1s1FNu31dJtWc/zb&#43;w7d2jL5s1r1q7dPGeOzbDhIzlJ3jx9&#43;G3bCWtXbh23xudk4AN9OOG4ez7y9DJHu51DbE6fCM4oaNbNHqiX5KXTJnw&#43;dsqc&#43;Zs3r7YFttrarty6c90mt0sHLqU&#43;Tm4oqidfz0KIYEGS/NYB1WuWN6WEntt/bMWMlXNnzFiyZca2QI9LkYXFpTWSVomCIsgCadXda2479m50OHCr4FYe08oOiIDOKq5olTSUlVWnpBTHxCUWlKdK5FKVpj43KvHkkiPLRn86cPCo0eM/mzrji2kzXjN9xoypUyaP/2zY0DGTV45Z5nf6cWYFw7AvHaukTP3jrIdH7Odt3ulw/kpla6ZKJ8mqLHnNFX&#43;ndWunLbfzTwrMZupBwxEIhNWiaGCyr6Zf3Wm7ZuGMGfNmzFi66ZCfR3TFi9z6qrrWNlyFNVVWPvR4eGTbuq2n3C5GZWMkt4IEhbcRzRWNNSmFhbHx8flnzgRP/vwrTpInDx24dPTgiaNGDx41edIXX&#43;nDCceXk2dMGjn2szEDR09dduTBySQmr4mX5HXTJqxatvvMhfzCyAqgtKLiVUbyOa9dGzcs3Lb2SNjZV41NqI0vAEny24RsLJFmPEsMvXrt4tH9q2Yt/nTA6MEDBoyaMmD67lUOZ27eunOXBf49czlg97YFU&#43;dMmDZn2yk7/&#43;jb8fV5NQRFaxlZpaY8Ku1J0G1f3ws3bvjfvRt09&#43;6Nyxf9Pd29DjsdPLhzo828OWM&#43;m2OzdvH2PXYbF25dOn3stOVfLbHd43TAyc5x5&#43;rtHhce38iVFbeoKKxekeob5bNh5dSF8212Ol2&#43;5qM7/d27Z69fcbJfNn3O&#43;Blz9j50edJU0YxuXSMQVkibWllWlBIVef3C4xObj22eMvmzoQMGDBkwYMyUZTvWnb174qq&#43;St&#43;6dD7A0WbPkqnjJi&#43;fv8HjxPXQFzkV1QyDMYRaWVeZ&#43;STugd&#43;1wJsODkfHjp3ISfL8&#43;QsOurgc3LHCYeXUL2ctGTdn/VY7W7stKxdPGj9n5vw5tvs3Otq5HNxgdzBgz&#43;mUV3nNjUZfgmLvUtdhksios3Yn1q&#43;Yv/WiQyD0qglC1zVBAEiS3ybSpDu5J&#43;bsXz5p1Kjhw4YMGvzJAHYiu08GDhg0bMiwkaM&#43;5Rk5auSwoYMHDho4aNDQEWPmbpvhFucfLlFqtExpiOLJNo&#43;tMz8dOXLkqFEjdd5frd6z4VrpjfTqVln6C78jbjPnuPk&#43;OJtUmv38ZPSFPQvsL&#43;08F19W01wdczv9yMzjx88t8y0Ny5Opmitr7znf2zV59vjhgwcPHfY6N/bso4YNGzxo0KgvBtn4bPJJK6p9M8YMgUBYDcVYy4MbhzZtGDXyyxFDRwxl58aEgMLGlMFDh4z8dAQfU0aNHDlsMFTqgQOHDB7y1YhRW3efexLKaCsZCSZNCvHa4Tx95MyxUO2HDxw4kBXkjwfsPe6ZKWurSb1actN2x4FzCw89jc6Mz4q47rPSxm3fMbe4xpcVWa3Su1fdj9vNPHQ5LDPZ6FQhLLRWUa9K9Eny3bZstdv6w49iGtoakSS/Bkny2wSvymqIuvz8pt8ZAw7v3mw3Y8iyZatm2J3ZfVifeObMSdhz2N3Vdtvho37PHxeok55dz/acbr9s/qdTVm9wdAVH8Ai8E3IvS54taaG1hdGXzh6bu/rcnfD71Q3V8WdTru1b7Hhz94WMxlaSqM1rirkaG50YlCApaahqq4kKPb7p&#43;Oq5Nltd1&#43;4/43lKf0qWUyfOHFjnunnhVwsOLNt/P7S8CaoQenMBgbAympRETvqre8FnzgToq&#43;5rjjudcVmyesmSCZNWbrB3djtzxku/48wZ90Nn7LccPubjEBQXkvaqvOjaecelaz6fOGeN08RluwePHMtK8oABR097N9EUkX&#43;74YH9/hM31/gkZ5TllCTeDVizzOPgKY8MRUyTlKYKs6OiQ668Si2pq2otJ4xLMkPJG&#43;URJ6I81yxeemDtoftR9W0NaJDXa5AkWwG6CTU1akCjgU3dvJVV0Xdebh958uS57S&#43;Z6Erd1Hdq&#43;B9GayuL4q4FrP3SZa/HtqfkGW/fR1tGbVqyafrGwJtJxZU0halVkI8ajqCljDY/6lLgsXn215/HxSgaJKntJBnOy2g1FEWpNSRNZdYVX/TetGDD3PWbL&#43;Zfymq3vCO7qEvOleLLmzfN3zB33cmAvOoMWoteXUAgrBR2/l01pYZYQGkoLdsBlSZp8z38j3osWOJzPTy3XEvL2YCihr1UTSIT7nj5yL4Rs06cCjiRnOB2wHbuvJnL1p1PtTkVPXLyLE6ST3t7Q5iic2&#43;BJB/2fbztamF2dUF7SdadmaJoCD80TbWWaxOMSrJW1VpTdffgfccF8xbuW&#43;f2MLoe9ZLfgCT5bQO6KC&#43;Qlzx7fvNK4IW7j7LqM1sZghJI8nNNdFJKa&#43;qdu7efBt5LyG6orqgryAx9mBCXGllOZWZml0XcDg8JfxSWXtiQU1YVHXL5fNDl&#43;0GpsrSyYrrh7v2z3pvnuV15npKtaGgVSTJexTSGJsQnBQZnFMTerHzhsm/5SptlB9zDS181MwphL5gimOawyqijB1cuWzLPbvuV5Fs5MkyF2rUIhDWibJNURgZFBl3wCUp4nFjLLtP0RpK9r4fHZzflRT&#43;6/CzoVnByU1JRg7IiNi85/tbjtIyctIb6pITIp08fvwjNbjx7N/rzr2aygvzxgCOnvRsoTVnouQTPJW7&#43;z/aHSPIby0SSDHpcnxad/eBqTE5pcll5a7TRZ8n1sobI58c3H1oyf84G/90X0vKbCRxJ8muQJL9NaKVC1Vrbkhec/Wi/y9ZNK9cdOvKi6HkDI1MLJDlEFR36sO7Rftc9rmsdAoLiMtIbm2taSTnJtX7VWi2uaGtuqi1tqA1PivA5vnn57m0uTndLb4dH1UW7&#43;XmeWLz24o2I/CpFAy6S5OYkJvfIhYBLc2wfPj7jmuu3dsMi23mbz18rqMnXTUQiQM0wBfUlN/1sF67/cvF0u4dH7ldIFBp07xqBsCbUNI1jrc0V6Qkvjm31tF29eM&#43;t48H5rZhKIMmnr4dHpFRG3PLY6mm/w/5Ckl9EQ0lls1SGE6AHbB&#43;Bpog2oqWhqaHuwYMH06Z9xc3Xtf/o4ezGqhdXjly2W3DsasS5NLK8raq9JNO0Gs&#43;&#43;cSbYbvm5RzFXM8trwkGS10&#43;bsHr5nnOXSsrjaoHq2trInDTfE9tXr5m5fuWhl94vGiTC1d3fe5Akv03khTGV9w5dPWxrZ7vZ/sTVY48yo8pltQS7VtobSX5BR&#43;dUESVRmfdOBR23c3Sy237kvEtQ3vOsNjW7YnK9mkyKvnPex26Xs92B/W6nfILv34sKSUx&#43;eP/yCfeNK/YdDdx3rziqrE2haNCIJLk2monZfdb7/ITN98462j7ZO3vp6kMrXENiyprbxI924FNbS1XC88OrXBfO&#43;HLpid2&#43;sbkysq&#43;LCQKBMEUtgSVE3PTx2uGwdYvbbrdrt0PzcyraVBpaIMlnroenFSiqC3OeRdw547V3r9M2V3u784FPkzJ0cx1QpLwl5X76tYOnXPcsX7F85Cj9e8m7Vs2M8LU/csBl457zQWEFBVISU4kkWU6pK2ICjp1bs9wrmJfkpdMmfDH&#43;y/mLt&#43;/YYAfstLNbt23n2mW2x7a6Pb4dWZFfS5DovWQBSJLfDiq5VFaZl/3I/8HBlS5bNq7d6nL8afyD0sbMvKLi7Ozc7OxXV89eWDXB43SgSxKT1KBbuaXwftG9/S52yxev27nA4ebJ4NSiJml5ZXJR6pUrxx132axea7N3517/a9HRkZnPM154XvFyWr1su&#43;vll7eqmGKMYQgJU3AlPfjg6p1nth2&#43;Gx2Xmv3yYrb/8kMePpP3hp8&#43;5PbUw9bJI8g9KK&#43;iwfh7x3hTdf5tj9uu27bZnz1&#43;LTZXTrbo9yAQiLeKRsGQdZLqyIwEv7Ou9luWblvpdMv9akpxXq6kPC8PAkpsUNbj3e4uxxauv3Y7pqSOUZFMY23&#43;q8dHdx5dvXLVzA2OJ64FFNYlVZRJSlJTbnvdcFlrt375jBkzhg4bxk3gtXb6uMDt8x0P&#43;Gw7l5ZY0Ky7j9ZQmfro9vYVx/c677mXfDU6JiP9wQXX/U42W7zuJTwormtIvZ56fa/d5lU27Vm&#43;znaj57NTz&#43;vL2y/TjgCQJL8dGrMiU85sOu18wMb&#43;YsDN0Mzs7JLG1Izch5cPOTqvXLl&#43;5crFc5bP&#43;szG6ezdW61MMZRbWs1g9Yr6rMLcF4&#43;CvN3Wrz54xN0zNtbzzBWv9S7&#43;V&#43;7eScuISitIDA8L9d/rv3fd5mXbnDz8/ZMzo6ol0O1WaKD1K2OwiPyok/tWrlw6df6KpctXLpq1cuaYZfv8191qfhZf1FiSk19SW1yL4UrjN6QpFYHVldQW5eTklZfWSOUauCYEAmEFyPOZyhtPAg7u2rBln/fNkyE5LzJqs1NTy&#43;57PPLcumX96pVL565cOHnupuOLjyQ/z2giGZpmlCTW1FCcWxwWlBGww9v98Oxd171PeoRf3Xv8zMUD514&#43;CU24ePHilClTQI9Blb9YsGXtoYeXnuZAt5u9E87eOVO2FESlea323jJ72uLlc2xsVqxYNGvO5nnLjvmH5WQpSHlbTVtNfm52Rlp70jNzskobyyRKHI1HMQBJ8tuhKS8&#43;M3DPpfMX7P0zYnIkuiZnWUP58wenDh/btm3XNsB527azF0NSMoSLq7Buktr88OenD1y/fM43Oel84CN/hwvP4/NyGaaNYbC60oJ7XveO7XOy9z5/NyZZQ9XrDwRIhimpLXkW7OnqAR1d9hQsbpdfXcxi2FYvAoHop2DFTM29V9fPujkeD3yRGdrINCoZZWNpY&#43;j5F&#43;ecnHbtYKv69u2Op&#43;&#43;feFafXYXrj&#43;KQFjJZl0JvX9lx8O41P5&#43;4e8cD7kX5hTeWNylBG0AYOEmev/nwoQe1SaXt5iQg64saXp55dtZpt9123Sl2bHM8c&#43;DU87C8Wi6oIboKkuS3g4bA8KbqJklTlQTHCHZQBTQ51cq21oa6&#43;srK6kqgtrKysalNAbVHMN0cuGnU0PpsqGlubpQoFJKmVkl1UxvGTn8DfVtarSRbGlrqa2qqGiUtmEKrFXRk2VYtnKKlvhZOUcWegqWuWdaEMySa0g6B6L9QJKNqkTU31lXXN8lwmZodjwLRQC2TyCQ1NdX66l7d0NrQpiZEfVMNyRBNMmlzVW1Ls6QRa6mXtMglcrVSo&#43;UlGTh87GRdq0qhbHcsrSbVssa2RjgDd4qqyurGmoY2GaHighqiqyBJRiAQCIQRhJLs7e2tT0X0JkiSEX0KNJxFhkAgrBMkyX0PkmRE3yESY84QCIR1giS570GSjOh1RBpsaAgEwgpBktz3IElG9C4i9TVhCATCqkCS3PcgSUb0LiLd5YzDaCICgbASkCT3PUiSEb2LadEV7uUMgUBYCUiS&#43;x4kyYhexBytFfqYcEMgEH0MkuS&#43;B0kyorcwX2vNdEMgEH0JkuS&#43;B0kyorcQCq1prTXTDYFA9CVIkvseJMmI3kIotKa1VuQJhkAg3jpIkvseJMkIBAKBMAKS5L4HSTICgUAgjIAkue9BkoxAIBAIIyBJ7nuQJCMQCATCCEiS&#43;x4kyQgEAoEwApLkvgdJMgKBQCCMgCS570GSjEAgEAgjIEnue5AkIxAIBMIISJL7HiTJCAQCgTACkuS&#43;5x2X5P/Xccawy8Rec&#43;jG4T08o1FEeZp5CqFbb1yVUXrvRJCz0ISIPgKGKV3FIjkITYjoI2CY0iW6mqH5/j28sG7zts77voEkue/pZ5IsrIpGq6Uo0dBHlIOhv8hMYHovYOhgOgW2zTEhhh8NzRBRekduALerUzPqbIjRRPMRZm5oRulqOo&#43;JPIFOD&#43;fgMunIjNKNdJGJMCeFg083sSFCmA7bHVn3EGXCGb&#43;rhwhzE9JReqf0/JKsECTJfU&#43;/kWSuqojKvdFqIEzs1B9SzPTnPM00/hARplMM9xrSkT&#43;3Df&#43;KEoUfeQwTjboBHaUbRehs5nl7AuTWaYa8A&#43;fckYkwsYtD6GDUjGJiFw/vwDl3ZDwmPnLbQjOdDnDbwn85hNtCuurTDQwP72GGPJCPKCvDFHPgjurGgdYPkuS&#43;p39IMlfcjZZ7ozWBTxTuNeopQuRj4pBu5AaYToFt0Uch3EejDvwuzjiE20KMJgImnM08RPgRtk1YD&#43;koE1G6OT5G4Xw68uz0cENMZCVMN8dHhGEO/EfRUdxHUSLQaQp8FJlhIpdilI7SzcQwc9gWWbcRHtu9rLhDunes9YMkue/pTzeujZb7jmoCl87vNedAoym8CTH0NIqhm&#43;kUbptPgY1O93LGp/AbwnQhRhN5DPfyKYYZmnAGDPcCRhO7BORg2nj4bWG6aLsjuF1CZyEmDjSEy8SE8fDbwnTRtiFCB8CEP/dRlAjw6UaNd&#43;AQbgOiXR1ZtxEey22LMuxJ5oAwN1HOXaInx1ozSJL7nn4vyYCJymC6ngj3dpS5IZxnRyZE9BEwncJtw7&#43;ccfCJHPwGh9CTh0vsKN00Ih/RNv9R5MbBJfLGpQgRfewqfM7CfEQfeXhPfq&#43;hm2EKIDrEzKOMwh0uykT0kYf35PcauhlNEfoLHUTO/F7DdCGcG58o3AaE24A5u0TpXQKOFRqfwiPc7h5chqJsu0oPD7dakCT3Pe&#43;UJHMOnZoQ0cdOMcxBiGHm5hgPvy1M57aFH4UYfhR6ij6aiYmjuF1CByHCRH7baGLPgaw44zGaOZ/I&#43;xuaCGGiCQcTZhTDvUY9&#43;UTe39CEmN4lhP8o8jRM5zaE2zzCbcDMXd0DcjCapzCx52cBDE/EwaUbmiEdpfd3kCT3Pe94L9kQE85c/obGw20LdxmaaQwdhCn8tigrM7eFH3lE6dzHjswQw8SOPAFhOr9tNLEnQCYd5SPaZejGp3TkBtuio0QfO8XQ3zBPHtEuo8eKNgDRdkcfuW2h8RhudzWFQ5gO/1rQhJj4KNrVPQzP2FV6noN1giS573nfJVn40XTmhhuGmNjFYdpBeAqhp/CjyIc3o4mcGcUw3ainKJHLkDNDhIlGt40eZT5wuJlm6MxhuCGC9xeZ&#43;QidhTmYNkNnDsMNEUJnDj7FMF0I/9G0GweXaOjJGf9RiOhjTzDMqqOTdgPIgbdu08PDrRYkyX3PuybJnI9pE9KljxxGEzk6Pdx0CrcN//Ibon&#43;FG0Yx3NuRv5mewkTY5j9y28K9gPCj0W2Rv0UwzBNSeBPBpxjuAjo6hEvkNkwb52YaQwf&#43;cKO7RBsiDI/iUwzThfAfeWdD4&#43;G2zUnhEX3sBpCDofG7&#43;H97gihPUYZciqEZ0lF6fwdJct/zXveSTeQG/3aULberIxMi&#43;giYTuG2&#43;RThR/hXtJeH22ViryHdSIQNkQOXIkzsaJvHaGI3MHqijjKHdG4Xv8Ft8wgThekcRhNNYNRZmMhvd5QtpHO7&#43;A1um0e0LfwI8CmG6Ubh0/kDOUTbwo88hj5GrYcYzcHiOfckQ4tcjBWCJLnvQZJshI5OxGH&#43;LkNP0ymwzRmP4TafwnkKHQDRR8BoimEiYDrRnEPgo9AMMT&#43;xIwxzFn4U7TX8yGN0W5goBNI72mWIyNPwWOFH0V7Djzwmtjv6KEwHRB95hP4mjhWlcAj9O/XpNh1l28PTGebQUZ6d0u0DrRwkyX1Pv5fkrtYE3t8wNy6FSxRuizCayCHaZehpOgW2DR1EmHbgchCZEMMUHqPpHTkbRehsZm6QYv4pjDqLUngfw3Qhwo&#43;8v8iHx8QuESI3owd25GOYLkT4UbQtMh5ROphRROmGnnyKKB3gUzpyAIwmdgnIgTc&#43;hf9XiNDHNB15mp&#43;DkO4dZf0gSe57&#43;pMkG0VYE7iK0anxzvyGMF2E4V5DT95HtEuYbsJ4hNsijPobYriXTzE8lkvhzSgin47MBKbdTB8rRJQD91GUyCFKNOFjdFeXEObDGY/Rj6JEDlGiCR&#43;juzpC5Ml/5PPhTAifwu/lUziE2wD/kdvgnA2texg9XJRi&#43;BFhQZAk9z39W5K7UQOtrdK&#43;50EExVArAX4Iw9&#43;io0TuX34v78NvCDGa2D34MwoRJlrwXAgASXLf03NJ1hqzrtKdmoSqHwKBQPQeSJL7Hpqmq6qq4uPj79y5c&#43;PGjaioqNLSUqVSqd/dMSINNrQugdQVgUAgrAskyf0Fkfp2ZOaDJBmBQCCsCyTJ/YKOdFeUzpmZIElGIBAI6wJJsvVjQnFFuzgzEyTJCAQCYV0gSbZ&#43;OpVboUNHPoYgSUYgEAjrAkmy9dOp3AodOvIxBEkyAoFAWBdIkq0fM&#43;XWHB8hSJIRCATCukCSbP3wWmtabs1040GSjEAgENYFkmTrx0ytFbqZ9uRAkoxAIBDWBZJk68dMoRW6mfbkQJKMQCAQ1gWSZOvHTKEVupn25ECSbEWgmUoRCASAJNn6MUdrRT5gnWJJETBUlG5oDBwiNCGij4BhSlexYJ7mZwXpQuMTTSDaa9oZgUD0a5AkdxEQO0qjJEhMhsllejCFDFeRKkrLKyGlolU4gZOYglASCiWOYXK5XEFgJKUklRSJEZABHIIrlAo2H3DD4QhKp6YaFeug4HPXgeFyUkNq6Ndyq9WdguBPQeCYTC6XKQg5nELz5kJM0Elo5zSDM56O9ECU3pEbwGXYkRmlq&#43;k8XcrTqGdHOYjSRT7cXqEZhU8XegqNp6Nto/CHd&#43;ppgo4O72q2nH9Xj0Ig3luQJHcRhZauzY&#43;8&#43;/CEs/dhZz3HfJ0D4x8m1IAqsy5amqlLbku&#43;cfvGg9Pn70Xc9X1x49jxI66Hz97yelL1MiS0&#43;tnpO3dCjl1NfH7VPzLA2fuoyzH/oMCElsRaRk0z8uKEqicnb51zd3Zx0efv7Ox2&#43;rLng6KwPJlap/taSq2tTWxOunnj2sMzfncj759/dv3YUXfXw&#43;eDvZ7WJJYqOOU2LcymYqQwgIpCqtHYatRfZEYxsYuHd&#43;CcOzIRHe0SpnNmTroQUQq3zacY7hV&#43;FMKlG&#43;416s8ndpQbh3AvbHPWPQyP7WpuQmfu2C4djkC8h6Smpm7ZsgVUGbh27Zo&#43;FWEEmmFUhKxUUv7yrpfj7umfL585bdasmbNmffXl/DXjVp454BuTX4214RRDa5i8W3W3Nttv3jVl7q6jjuuO71mydNGcRduOrj2fH&#43;jtk3Xkq1079o1dfc7VdvO5rbPWLp61YtdRp8cND3MwuaSm6InvM8cZu1bN&#43;nz2bDjBrFnTZ836YuayLdN33T1&#43;O6&#43;kgWwjKK2G0ObcqLix1XbD7q/m2x/fu&#43;7o7iVLFs5ZvOPEWv&#43;ipxmtPZVkEaJgym&#43;LNjg3PpHH/ERAlG6Oj1E4H0NPox9FiYAwRbQtcuY&#43;iv4VbRilIx8ThwCm94owzLxLCI/tYVZAz3NAIN55pFIpqDL0lYGKigp9KsIIOMPUFkTfuP3/2zsP6CivLM9v98Tt7tk5M72nz&#43;zM7pyenbA7Z/bMnDF2u3GDAQewDdhuwLgBG5PBgEgmY0Bgkkkm2IBtcjQYcMAEGYRAElEgEQUCRBBIgAAhqaRSqLRPesX19X3ve/VVUKGqur9zXee&#43;//2/V4Woqj&#43;fkIvJfUYPndhl8JLP1nybkZGakbH9y7ULJvXrO2bMR5M3XUo9V&#43;aP5M39R/fu/Gzbnm&#43;PWTpj&#43;c5dew8cPpl7/ErZ6Z1rzsxqN6Znx2av9R/wwZoFmzN27M04eir3dGFV3ukTBV/PWDtxRJ8O/ScuXr40I2NHRkZ6xu6MjOXrlk8d0u3dIaOWTdpy7cCFcn8kb&#43;g/rGfnlq/2fWf8Z7NW7kpJPXg4&#43;&#43;LxK&#43;WFD2ujFMkC2WODVQ9I0VAA9FgnvRVyhM0S7ZKIAqyIHpa4F8ASiwKpE5EAHmLDS&#43;wxlBXmaUDw9jCPEoR/AsMwjJ/qIt/D9P0rp45s/XyvofP7LT&#43;VmfdAXDf7fHcLsr/aNqrjhEEj2yYfXpl22x/JX/Qb3f3V5m17d52z95OMe3fKXfKY&#43;4c3npnVdky3l5u37THo88w1ub4Ch8jOGq&#43;v9OaRzWkT2k/qM6jNW0sWfn/mlPgDU12sOny&#43;3MtHVqwc2GF4n7Ftxh9YlXaz0uWsPbfx&#43;vq&#43;w7q92uK1Ad0&#43;OvDZofsPxAV6PZDHDRXJAvNSoG6RSJ1MyRIAJ0xVm6oIyBbsIX6YqjpG2mRhQME6FrEukAouKQK416IaDFvEKOCBZuQJ4Z8jiMghDMMwdRTn&#43;LJmb/pgeOtneo1e&#43;s0Xt8rzK2vld7Mf5qWfXtRrwbhRrUbsWroz/1EkDxzdvfcrXZJn7j2z/2FNmcufj/WR3H5M734vvD17ccq5nApfad1PdYnwzT6xY&#43;7M9s8OGz6339qbOy84yusD3&#43;sTQVtReS29cPOIz5LHNu/66bxt2QUuZ3ldJL87rFvv9t2nzT544eDD2gq3/y4gj/1rC&#43;y&#43;O2rfSYkil9IpC8A9waYZRPCrRcAiMRCzTZuAGARSkSLcykb20KiiIKBBi2qw2oKPDQerc6SulhbDiGEYJmhuHfGljl45rteTT3XpPWn&#43;Rykpm1P8fLP2k3Vj3xg5YGDTnmvnbz1T7nHV1H3jevDoPiN&#43;33fx6pyr530&#43;p/&#43;U&#43;kj&#43;8NUxSeNeTtr05bGrxeLyu06&#43;6/OlZ2ydPqJZy2HjV7x/2Hfk9o9j9U6O7&#43;CkzTNHNm0zecq6g6dcznvnNt7YkDSs53tvDFy6Prfggv&#43;cOmCjf68Ftt4grd5niWJ4t9WOtGdKyEi1gWJlEz3ZpU5xAVa9hJgFcolvAWkmokBVJKBbGQD1WO0WadOOgiX8cyL4YBiGYerwR3LHJ55o&#43;kyLVs&#43;99FLrl/y0efH5F5/9bfPn/9Ck/exp6w7le1yldT/eNWR00qQ3hq3ZdrbgRv31rqQukme/NmbMrHbvp6ZkF7n8wSkjec6IZq&#43;O&#43;2D9vFxfdkmd&#43;kO4ykieMrhp0yFjl&#43;9JczlviUiu&#43;/GuyV1Grf/2YtFNn09cs0t&#43;2OUX9AR&#43;gzS8jWLd/G5LRtJsp1SzRG0I4CcFU4zVUtWhCFIBnXiInywBuctqCoABO9Vddo6yiTwqnAPD2cswsUaVz1d0uyAvc3f2uXM3xdu4WGtw3PYVZJw/lb0p7fqFgjK/aBfxVl927/rlnJ0Hcy9cve7x3Ck4XXh8V2rGqZQTt4tL4dos3vFH8ltNnmzXsc/QYXPnTpn7Yxaumvvp9ynH84s9LqeI5C&#43;Hjh6a3HnE&#43;q/P3rylRvK42e0mH9yXc&#43;dRaspInjmiWeuRk1Z/cMJ3XAg4XGUkTx/etNW4Sav3H3M574hI/mLYsMFTuo7ZtDPvdiGKZMEPG/2ChgBvk&#43;Z3UjwCp2wMZYU6MuwCRR0JrLZY7bJaYl30WMcjgVwSUaA6BaoCaP0EbICe7LJzjk3wUeqxUlELoyoME9fc9/kOH0/bPKH7wlWrDub5fPUXVwqFx3xp49YsWdh02Pcb04L9sWqHz3ftTMpXH3cZuW7Dzu9dNSdSP8388K1BY5f0mn/sVP5Dvyvu8UfywKd&#43;k/T&#43;un2pLtdNF8Htcnk8Hq9X/l1yKJE8dUSzpoNGffrePl9GQZ36Q7LKSJ49tumrH87cdPiSy/nQGMmCH/b6BYrpnTLgOylMZYPNZKPVOdotBrMcQSN7AItYl2CRTFWzBOuk155gx4MbgeohCkGdSgXrAQ8JijBPjuyDYZhYwOnz3Sw6k5L20QerPt045Zu8w0cyKs5uT9m6cjFmxrjFIzv07dH9yVdHDBg5zS/Ws3TNtpXfX8nMK69&#43;9PNHCiKSr57es21R5&#43;Fr1u1I8biPn00/8eXCZR9MnDR&#43;1rw1B3ceKyytIHEQj5Tn&#43;q4v3zp3xO&#43;fen3gBxvnHXtwttj/HYKaBzdLsr46l3Vo58WaXPFnpFAiucLnK7iUtmLzgDbj3h3baezO1YeuXav/0nt9Tq&#43;voPD01r3T3pk1LrnjtMzVGbdKXM5q25FshenNMuCbqZyCh5jxUj1HKGa/eQloeyxihC5HxGDwQ6NuwQrp7ZhVEZZYx5AtGKwbbBLzFKMeFfBwQrB&#43;hokTbp/0ZUzduGxB80Ffr1u6oPCr4VMHd2qFadG8VbOnn2na9InfNHumWQu/WM9LXYa8MSN9acqtsoelTkdZqYbC0tLTh7avn9Mx6dPPt3z18GHa5ctH0/bsmdVncf/2r/VfmLQo43z&#43;7dKyitKKug&#43;V9D&#43;kOKRIXMju35A86vkW7/Sf986CU3uybsovUNGZ9LOfD/ly1bL3v6/Ykx9aJNdRenZv/qc95vXr8UKroVM2pOwuLb1cWvqw9MbD0tTMXXPe7/jasBELR6dU7xNZ7XL67EWyAdObpXwzJQXgXmJQyEgsA24Hj6pj8BL8xAPASDa4tEjdyoB1rUGg3auKoSkYPJJOUgBZGrBy2j9BIM2kGCb&#43;qbznu33iyLY10weNWrN67a5jh3bsTfkGs&#43;ajbz58e/TQwU&#43;&#43;OWPchyv9Yj3f7c1MyS46cTTrVsqSXStmJWuYkJz83pC&#43;PTu3eOWtt3v3nTx58JgxQwe/&#43;&#43;4bbbq&#43;1PzZl7q80iVp1Nj3k&#43;evSV6Tk3a6/q9A45NKkcq3Lu0&#43;9NX0uRPH9&#43;ry3sjh4itTzwezkz9csXz7kfSrNXV/U28zkifRSBZX22Xn9x9a&#43;eHSgV3Gjxn6bnLymOTkycnjJycPGjd10pDpXyzcdibzhvtWua1IDkjo747qG6vhrRaPyJuyXBJRQkSDRzsyQMywhKNk2Uc1W51ARCubAI&#43;0NilqRwaCMjMMEw63juzNnDbwq117Nl5znrpedPd6/o2r&#43;X4Ob8/fOGjeB5Of6r124cZ0v1jH9RuFxXcram/nHr62YeSKCe900tChU6fX2r/c5rnfNn/xxZfqPuXRr/&#43;YAVM6Tdm/&#43;eAN/6OJW2563Onfr5o&#43;uVOnvv5feaduAyf2W3xsfea9yhpPncXj9uXvKU6ZOW/mkhEf7ki9fOcOysuHOTvzViTN/2jlwI9PHLlwX72QfZjz3cXPB8x77&#43;1Ob7wB1Wfc3Em77u7O97nq78HnrvZd3lm0a9as6UtGz9t18No98Uch/2eR2CbEt2ft27qVKCu&#43;gV9gQ/x6I3tgZB8bwzAGnPduF5/Lull0Me/Oxf2bl65&#43;P2nSiCQ//d5O6tr696&#43;2b/J8l45d&#43;/jFpOFJSROSF2xYe&#43;re0Rv3Hl7NyT99NFPD3szMresWfji67TtTps5fnJm53a//mONnM8/evXFXXErGN5Veb/Htq&#43;fPZGYe8//KMw9nnTmed//avWp33T/U5PN5vT5HUfXt8xfOX8rOLbxTXlVV/5EikpqSwvL8Excv5mddenC/TPPz6sJQdiXrQvYRcXLGozp26sKZoqoih0/eg8/r9jkKnUW5uecv51wsKq6oFgeZv02tEsrbM7&#43;nMwzDWFFVXlaUdy4v&#43;/iJrOPHT54/fvpGQXFBSXlu5ubFy0f3Hzu4v58eXfp3fuHVtq80afXG653f8Yv9B/XvP2r8nDUrs4uPP/DVXeA5H3jv593Iy8s&#43;lX/jQXmp/9pO/njXpkWd&#43;yz&#43;eNOqgsrzjz4b0ueq8pUVlBRdO3Ol&#43;NqdCn8gMZFDfEGhIg6nK8MwTCQpvHDm21ljZ/Xv2uOtrl17T&#43;g2dO36/aevuysK7xQUXr5w5eIFP&#43;lbLqx9d/aUiU/1WjV/7X6/eEGML1&#43;5XlRUXlNWW3/5deuwK2PWmlmz&#43;ictWXv0whmfr6zuTmQkf76oc&#43;vRo&#43;b23XBj38Xy&#43;jsXk0Lf2fVZOz4fvjB1&#43;Z78uP7ZrqDBaapWUBh2wUg7NcORzDAME0mKr10&#43;uGrRqsmDJg994&#43;23B/&#43;u7ZypC9ftO7Y7Zf/uH7Fx8e653ccNH/LkH2a/P2&#43;dX5SkHNi9//TJi0UPXO7qu6fdOSt3LJs1cVTy7JVfrTuce/pBeYnP4aqL5KWLOjfr321Qm2Gbl6Wcyb1XnHvqeM53G/cvmbh87sykBbs/T71cXONOmM8NCQBOSrU8Xu/d4uLc3Nz0jIy0tLSzZ88WFRXV1lr&#43;eBbeS7DS7cCRzDAME0nctTWVpSWl1zLvZc1ZPX/Gy23nDO/bd86oNr26tPkRL7Rq07Jp82a/e&#43;K3LZ9t&#43;YJflLTv3qbr7OTP005XVD8QkVpV4riyM2/PjFkjJg9OWrLhzNUzPkflo0ju&#43;fyLv235dtKyDUtPHFs6c&#43;z0N1/r2qZ3v8Fzl6cc3n&#43;jKM/teeB/XAkNxKRV1bpcR48dW7J0aZ&#43;&#43;fbt16zZv3rwDBw6Ulz/63oMC3gtoxaDgSGYYhmkAys77Ln&#43;ybdmctm3nTJkyd8vGGcum9ZrQv8Mrnfq07T564pSZ/k98BD6cMXdsr/H9OrzcqW/7XtMnzf/m64MXblbXVoijvB6f45Lj6r59W7/dtD716M17N32OmrpIXr2oc8f33&#43;qQNKTbgClj&#43;86eO2jk1FFDZ8yYtmb95rSTV25cKy&#43;/4/XWnZDw4LDUlohkcX08e86cjh07vvzyy8nJySkpKWVl9X9LoAPvBVQlWDiSGYZhGoBHkdyu3Zxl245fdpY8PLUy94txAyavHbT4&#43;KWbZR5C5QNPzopzm8b1nbQu6ZOsK4XlHq8Xvbl7fWJZ56tT6/&#43;9XhHJdZ/etXrywG&#43;/fXfgoLa/afHSC0PWjFh37WxBRb0Nb090DGEp9TAjmSxDhiOZYRimAUCR/On2rCvVZWWnV19cN3jAu0Pb9xg/ZfrchYT5sxe&#43;32fS0F6vDF4xZMnJq7f1F7eu8nsPT&#43;3K2fHJqk&#43;nvT9szDvPD/5w7qLdl3atXPLelJ5t33x7co/JO3bm3QnhQyriFTthKUY0kqdMsR/JuMKEI5lhGKYB0Ebyql4Durz89DMtWrZ67nnCc8893&#43;J3LVq//pt3lv44kj0iiGurKipLS8oelty&#43;lHN&#43;3fvrRr3&#43;h1efb9H89888NWDM0h0p7toTB1cdnf3WqK59u/aZ9fGhnIxyx91qT3Xdv8Of6NgMyx8iuVOnkCM5fDiSGYZhGgBtJG8YNmDY5M7DFi1fu&#43;VbwrYvvv1k9KfJ73YcserHkezwuG/lpn359bzJi6ZNnjxlRvKszz5aunrL1s&#43;XzJg55KUhC1bu&#43;N7rySu6ePf4N0dWTV8zbeiY5PFjP9302ZEHR2/5auHjMBIVm3npCjuSIwJHMsMwTAOAInnJuu/PFZ6/lv5JxopRvUYt7jXtm7QjZ64QcnOu7Jz7/ZIRb49bKyO5trK84vbVOzeyL&#43;Wlbl/6wfReb/Tv&#43;kbXPiP6zktdui//Tmke/EtQ3/t8dZ&#43;ZWV3qu7Dt0tZxE4d26z5kQtJnR5enFeYWlD8oh89yTkRspmaYkRwpOJIZhmEagEeR3LbtnLnJ01I3vb9&#43;wYipo/q36/j2c6&#43;&#43;3avvgMGEgf0Hv/P7Hm91bdXvMxnJ93KPnFo&#43;euWUoYOTRk1avHbRjkPf7j90JCsn6&#43;LdK3fuV9VeoZHsqfWV3yy/eeJs9ndfb14yZ8zIcRMWJS06svNYoXxEiYnN7AwnkiMIRzLDMEwDICP5k&#43;S2L773Xv&#43;kj6cOWDxlYPLI/u06dGvVrts7IpMJ/foMeOu17l27tIRIPn8o57P3lk8aPnDQpPnbD39X5Cv44cOqRVRcyN75xezXhq9Y9SiS/Yhr4ru3cvftmjd&#43;wbQFgxce3nGUIzlwfKqRvMdeJEeWhorkYD8HuzF8bjZ5DDYfErZF4Vch7gJXxDGcT5YCVQmWiJyAC0OWAlUJjYDnhHZHwT5g&#43;/7QHk842LnHxvz4I4CM5PkD2z79fNs3x3Yds3LbJ5MPLh/Vc&#43;TCnlO/2peZk0c4cyJvx&#43;zdn4x4a&#43;yjb1xXlDoKLxddvZyXd7WguPR&#43;ja/6h78YvufzHT3y9Ypxzw37eBmJZGGqqa4ouV&#43;Qf/P6zbybpdp/RyGhgPg0JKj6413mSG4gAjzTxSsBF4gqRFQ9WDFPJcRvs4LyY9SlWipEt7IJ5ChgAUSHigjkTFJagtUBw5mCgNsl8hCr0hKCTspAQIMADNKsLQxZClRFArqhIWBd9FYV0ICLQBTVAMDI0BCwLnqralTU3j5ZnjFlw9zhbTsk9Z24ftbaI6e&#43;&#43;uji5vEDJq8f/MmJK0UOaXMU5Rce35WVtmvXN1t3LRu7cvrgrhO&#43;GLny/HX1n29y1/hKrpReOXw0fe&#43;uXV/s2vXRgtmz3mo/Y/Hqg2d9vvt&#43;E6PHnMpCxJH8UuOMZPwUJ0967bOf&#43;DHmpSBYRZ0KQNROCVanyV7cEhEvAVXU2gRWuhXB&#43;sNB3FfAuwODNFsVwTCSYIO2tBhGABik2aoA81LFPJXYPEHeFy6zLpA9vpXgHhOUx8qAUT1EEUtSGLnEtxJiA4L1NAbKLx64trznZ3Nmtvvg6Lq0ggf3iqtPrFAj&#43;caBL1LHtZ7wduvWL77QulXzNq&#43;&#43;&#43;dKobZO&#43;vFFwX7m0rXroO7cxb&#43;PQkX06tm79QuvWLVt2GPzbPluWfH1BWPkflwgYuuaKgUgmiGd8wBcGiGZn&#43;Ar0VqJWl8il1gAjWRLcY7SiwGC2v8XKGVnEvWjviOh2PFqkx8oZcLuK4Sis2/EQ1BPUpbkA3BsAG/HLpXpIQEUsSamiVLSAbmXAqB6ihHCIWJJSRalosdIfF1V3Lt87tOFwWtrytOIzBZV1/2Zi0fG7p3ZtTTm5PfMmfDP5Qd7xC9vmf7V8vmThstXLdpxJOVP6sFIJ2dpKX&#43;GxO8c2bVm9xO/&#43;7Mv5W88dOn/Pb0hsSMQSyFSt&#43;IxkgdRhqrWpYrAK9AYRL1UbmcoCBRqsY7QioE5BUQ/UHiVtAStkyDlqAdBjnfRWyBE2YwwbVeQhhgKgxzrpVbBBQJZm1L2AHOECoMeiQC6JKABdW2CQ4F5ARlYFBnlrVeDBEEU1SOQJaskRgHsBGVlV40O81df/9wPy4zB/TP1nXyL8sgV&#43;0yP8asIivgDmAohOSkRyRkbGnFiJZO0z3vAaML887BxlVqA3iOJWlgRECTQS7ASkaKWbIR7Sw5LYAK0YKeSdkrsmSwCcMFVtqiIgW2zu0iK3k0PIEgAnTFWbVsF&#43;1WCFasZLOyPVIxVVx0gbiLgX4F5gZ6Q2BrDZfmGISAy4F9gZET2muXr16tq1axfUc&#43;jQIb/KKJBYtSqCduqKiUgWz3IoFRCxzVAA0a0KUHV5ixuBKoqG9HiJUZfYSZY2MeySI2wgWOkRR30Y2rsGEfxqEbBoMBhKizrVOkEEv1oYw8iA1owVMtWOrDyisfLLXja4B3AvsDmSqIqKHY8VYq/cLhvcA7gX2BzFDSIbOnbs&#43;EQ9H3/8sV9lfgxJVnMR1FFsRDJGPPXDeTGYzerUrEBvFkWjNQgMPV4CRJdLq1JRRSunxDCKFIYHQEaqDRQrm&#43;jJLrIMiOpXzwTISLuXNALSG5YqBoN6Di4AejyVBah9sIoE6&#43;LWUGCTjVowMmCY4pHszYoE6&#43;LWUPEBR7Id1FjF4KksMz9EcseOEMmljTmSBeRJH9QLwGy2c5T2rs2iaIjBygOlFWVpUXWtk4jyQFlaQMdOUiFDzjGUapaoDQH8pOyDzfgEc6lmidoQsFmiKoBhJMAjYtOODB6BTZtEiqpTFiwxZCmwcgoMI4GdjYDhBDISS1mwxJBlfMCRbIeAcYsNVh6ARnJysozkgBsjS3BPZ/zCEJA&#43;YAG4lwSrQC8a3OMGRuotbrSoUyu/TScWRQ9L2eOpBBu0WOkho30MUARQ1JHAaosUZWMuaTOjGmC7dkQagrpLVSRWOoCnxKkdGTwCYhO3agGyt6MAZCkAxf5ILLGiTgHpJAXI3o4CkGV8wJFsBgetLCvseCTxFskBMW8MVpG9uJVFgKkEL8UtmQJyZJiqhCCKhhikooqkIVjpQYEPsXOPcgSN7AEsYl2iFQ1ozViE3upYocsRNLIHSI&#43;XAiuFiCrYoJ4AQG/wYLAfe0iPl4Dq0RYYSANoR6InTmwjIwERSa/6BapHW3EDR7IZHLQBI9OmLQYimTzF1Sd9UK8BbFY32lSgQIFbCSiyAK1HIp3YICBLgVZRRYFZtLMFL7V&#43;gapbObUIM/HjJZmqS0DbYxEjdKuRCnGqe/GSTNUlYOgNS4GqWKGegwuAHosCsgSw37CXKBLst&#43;OBRi0YQQM9wWqEdWIwbIEmoCcO4Eg2AylrJy9tOmPjKhleALIwZBkQ7Ff3mhXRy8LAkjjlLTGrmA3yBFIYVQG0upVZCzbbvBextH8XWrPVgaqOwUvwEw9gGBGITbvRyqPqGLwkPSmMXGpHKthgMMNInolLC9FVJyhEF4BiZRAQD25UzCNZZlQPKOpeUKwMAq0Yo3Akm4GUtZOXNs04kus&#43;4/pRJPvH0SL0ZzF&#43;AYjeTgFEtyoryFTtA&#43;6VZUCdgqLulQqUFuKxKjADeEoKQ5YGyF65JKKEiAaPdhQU&#43;BxZgHZJRAkRDR7tyArixCeoJQ12ABvxYx0XBhSYgiLBvQCWspFmtSTQGFA9cIjN7dIGW0CR4F4AS9lIs1pxA0eyGZyy5qAV2DRrI7lR/09QmBCe/cFusfKrrz2pqHqMov7qtNi0MdHH8HshRlChod1rJcpbmIIHGox5KhEjKKLYRGu2EuUtTMEDDUYrxigcyQGxGbTEJsoKNZLN/15yAxHKszienvoMwzCNDY5kOwTMWmKQZUUMRzLDMAzTcHAk24TErZ2ygiOZYRiG0cCRLDAnKABZa7Os4EhmGIZhNHAkCwKGKABObRGDFRzJDMMwjAaOZIGdHAWwmZSELFU4khmGYRgNHMkCCFFDjgaF&#43;UCOZIZhGEYDR7LAnKAhYD6QI5lhGIbRwJEsMCeowDDSAqdpd3EkMwzDMBo4kgXmBDWMrIAt2l0cyQzDMIwGjmSBNkGxqC0DZhtHMsMwDKOBI1mgJihWDGXA4OFIZhiGYTRwJAsgPq1KQkRZBqwMsRrJoX3AdUN/LLY4HxeGLAWqEhQRP5BhGAbDkSyBiFULQ0aiQiCWIhlHjiF&#43;xIgU1sMHjtWWlhB0UgQ7ikC7V2ClByS0XQzDxCIcyQDJWlkqAQ0BiZlIJmFgyAYrZwPFiTg24Mn4MRgKMCxlj8uOjlEVO8hdIWxkGCZG4UgGSNaKssKmzYpYiuSABU64JY1a4WB1AtHteAjqCbAku&#43;SSiAKskF41B0RuCW0vwzAxCkcyEFTQBmUmxEYkq0lgyAbIDwks8Rbch4A8zVAA9FgnvQo2CAx&#43;uSSiACuihyXugyWcvQzDxBwcyUCwKRuUGRMDkayNAUM2yBEYRAMF4D5YrA7ESwCcMFVtWgX7sYGYYarqGGmTFTJhbmcYJrbgSAZwxNpJ2aDMmFj68S6MIRvkCAwQJHgL7sNBHh7wZBDBrxbGPMLAkjiJTUAMgNTVUrHSGYaJS&#43;I1kkNISgFErJ29QZkxsXGVbL&#43;kH261jQD3oSFOsDqEjFQbKFY20VstZY8LsOolxBwC4Z/AMEwMEd&#43;RHGxYCmBjwL02bSoxeZVszgY5AgN2klFoiO02SzVL1IaAzRJQVB0DS1WHCpkwtzMME1vEfSQHG5l4o9XegAYzsRrJcKtCpthm3hgO6plCgSKAoo4k6i5QVB0DS6yLHut4JJCKWipWOsMwcUkiRHJQwUk2ilIxTwMSe5EMwWCOB21&#43;SNG80T74HOitDof7hUb2AOnxUgCKqmvBOumttgQknL0Mw8QcCRLJouxDNorCGEY2ibFIJqlglRBSJ2aJeYtN1JPxkkzVJWDorZZYF5AlgP3qFqtdZkLeyDBMLJI4kSwqKMhebYVGLEWyNhK0IQEi3gI9KAC2BURrJgp4VB2Dl6QnBRBdlBapWxkMGw2EtothmBgloSJZlH3IRrVCJjYi2RwGZEqccql6yNIm2nOIKCGiwaMdWUGcsIRzZDEMw4RJ3EeyBJag2ARvlBU&#43;jT2S7QeMVRpZnYB1rYFhGCaRie9IxkCmEt0M3hXURgOx9&#43;NdDMMwTBRInEgWQLKqo2jCkcwwDMNoiNdIFmhztzGkMkcywzAMoyGOI9mKx57KHMkMwzCMhgSMZMHjTWWOZIZhGEZDYkay4DGmMkcywzAMoyFhI1nwuFKZI5lhGIbREFuRHPEEhQMjeGZAOJIZhmEYDTEayRFM0IY40wxHMsMwDKMhdiM5ggnaEGca4EhmGIZhNMR0JIuKFBE/0ABHMsMwDKMh1iNZVKSI4FFmOJIZhmEYDXEQyaJiiziP5GD/PYmI&#43;60MWj0osxXSLG6D3YULQ5YCVYkI4R8b8JGHj/0zG&#43;irZAeruw5WDxlyYGjn298lnLgwZClQldCI1DmNmfiIZFExROxFMrzqtC8JIqoe7S5ATM0GlYB&#43;bIBeKwqwwVAG8JSY5dKqtISgkwKsdEArBgs&#43;xHygfBh2CgNLbMCFgSU2aCsEyAmyYKSF6AH9IWN1Rxgh4lIhIjarpSUEnZSBgIY4IBYjGYA8JnojJ8YimbxUtC8JLBKDurRZANG1RcAK9FpRYj4hIPbNwhnQDAZptirAsCS6ilYMAe09hoDYLguw6gEiku2AVgwN9SjD4fLxgEFtIgU5EC&#43;1d6p9AFoREFOzQQAGabYqwM4yYMUTMRfJBBzJ6rRxEkuRrH3ea18DIJqdAc&#43;R2LRJiBmXqkCpEAMugOjmwqiKhOh2PAT1BFiqulVFinCO0j4SrGgPN28BtGJoyKPwgaInhXVozBUasJGcoNVJbyiCVhQQ3Y6HoJ5AlolGrEeyAEey1tDYiLFIlrd2XidglljZJGJqVQRVIQQ0qET2TLNZTM0FQI910qtgg8DKj3tAK9pH3lfACoiVjehWHjvYtAVEfTziVhUleGSwhQM5H5cUMXhJRhJVFIq5AOixTnoVbBCoSwJRVEOsEweRLMCRbOVpPMRMJMPLAxrA8EowjAB5oOq0Es1gA/QBdwmERxburQrAvURVANiOPWQJgBOmqk2rYD82yCWUVDBkGT7qgQHvQhisPGQkl2qRKQZPIwLciyxQAOhhKsEeAVmGjOF89S6kCCUVjLqEAsgSACdMVZtWwX5ikEssag3xRGxFsoEYSuXYiGTxXIenO&#43;4lZBSwMLDEI9UGWOkANuAD5a2hJNDYh2zBp0m0Z0obHlnZoLEqjHkEQK8VI4V6YMC7sDIIXRYAvVaUWC2JHhriEO35WISejLBHQJYhE9T5WNRu1O6SiJEsQGsGEfxqYQwjgVTwCHtUfxwQN5EsiJVUjoFIxq8BAVkKgnoxkKMI8nDDgWAwFAA9FiWqIiHbtaWCReJR/cSAsbOXNALSWy2JThoB7iOCOJCcGfAurAxS104NZ5IRLEWDS1UCFsawNDsBKz1Y4Bw794tF7UarXVpdQEaqDRQrm&#43;jNS9IItGLcEE&#43;RLIiJVI6NSMaIparYR2uWZ8KILDFaEYMNsg/qHHU7wWqjRExJYcjIUKpZojYEbJaAgnVtj8Xw0R4b8C7MBjkVt&#43;YCcC&#43;AJdHDRD3N6o7wUvRWFTKwlxyiPROL2l49xGapZonaELBZghW1EWjFuCHOIlnQ&#43;FO5sUeyeKIbCjwAnlqV6rRC9RjMKtKM91oVQHptaYER3Fo5CapN7tWeAIo6kqi7QMG6tsdi&#43;IR2F2aDOhWKLC2gy4Ysw0QcohaM4BajKhIrPVjIAwDwUusJaLBC9QgFigCKOpKou7CiNgLZYyWeiL9IFjTyVI6ZH&#43;8CxLOfvACCej2oZnmgVRFUxYA0wxbSqLrAqgdUUSjaXUTHWPm1wDnQyB4gPV4KQCE2Fa0YGupR6mPQYjaQKT5TuxFGxKM1h4z2NLhTjNX9RurxwDnkQLzUeohfohUFAU/DCF2OoJE9QHq8FGCFOHGDR/FEXEayoDGnMkeyaXs4dySQfthFGlUX4JG41RZAlhKzQasAZKouAUNvtZQ9lIp90YzV&#43;YKAp5kNMMV3oTaAtNlxhoP2NHy/gNX9Gh6PYaQCZtmIW2gA7MGlooqqEy/JVF0Cht5qiXUBscUr8RrJAo5kM0E8qfHrRBDs60H1G04go2DvSyJ2QYECt7gRqDaCeSoguljiLeouK7&#43;qY/CS9KQAqx5QRXKCHcxbAp5mNsgpuQvSW40EsCR6mMg7lQUK3GJURWLQrUZapB8K0PZWBoCIYqnarDyqjsFL0pMCcE8wjGKdOI5kQSPMY0HsRTKBvGzsFIFMSWHIMiDkHNiuXeJGgpeihzKjGrR7taKEiAaPdhQU5nOCPVx7jhS1I0lAA6A1BNwlgPOtKgS0e4miLuVtwJJAYwe8kSBHBgNg5SQKeLAoIaLBox1ZIZ14o1XFE/EdyY2T2I7kEF4A6hbDIXgU/otNe9eywgTOCf&#43;oRkVQv5z4&#43;&#43;UHi/YrgMVgvz7B&#43;uOVhP06cCRHnxiOZH6/YBiGaTg4kqNPzH/jmmEYhmkIOJKjD0cywzAMo4EjOfpwJDMMwzAaOJKjD0cywzAMo4EjOfpwJDMMwzAaOJKjD0cywzAMo4EjOfpwJDMMwzAaOJKjD0cywzAMo4EjOfpwJDMMwzAaOJKjD0cywzAMo4EjOfpwJDMJivxAVnHLn8zKMFo4kqNPzERysO&#43;bqj/i77w2D7SyBfV4pFncBrVLS8AT5L2Ec0fqXqyEc3IEIQ/J/AjN0xAgh9g/MyL3zjB24EiOPjEZyaLXFoB7CTFg5AgbsAJF0IpWgFPusioDeBrQHBD1NFwEMjUUgHuJYaoutQUQXZSVaMbgUUdYIVN1qS0CUbQeQE7NxTARhyM5&#43;sRqJJshBvmeRQqAXm0AooiluVRUUWuzIihzQPCDDHiyzbvGB0KRJSnAqgdUUWsDyIH2i/jN2wGrHiCiXIpbcwG41xLQwDAhwJEcfWIgkuEdSpZUDOAp3gVYLdUGULfIUrHSJbBRLYDo5goZ2BvwEJv3Yj4Qi2ZDwO0SooglVrSHEKw8Wj3g4SAG3C7QegwIf8BimIjDkRx94u0qWbURRd0LiraRhSFTQHWaaThzUMiHrS0wAHgqC5A9VjCq0wox1RYmoKKdQoGoohUFWLfySMRUWwBewlQtDFmqBDQwTAhwJEef&#43;Pm7ZHVElmpJtIoV6gj2anfhEfRWBeBeoiqhYee&#43;JKAbzOpI3EKRpVrYAOAeIKLqMRvwEnqtR9xCkaVa2ADgHiAGrceA3GIuhok4HMnRJ8Yi2eoNiCh4GbDXNmqpEIMsLVa6AbJFPTyEMwG8V55sONyqF9i0BSQovzDjAhFjWGq3mLcHxL5fOGWRpVoYslQJaGCYEOBIjj6xEcnkfUp9A8IKmVqNoLdqrMxQWrQG0mtLBYvEo/XbRz3KcL5VL7C5RVsYWGKDWtgDPTRqAdoee7BBQPzawsASG9SSBri1D5xgKIaJOBzJ0Sc2frwLbiXqGxCZQpElKYlVA0sB7gmGERDwKPMhYkoqTPAJpFfPtzIL1JG4xQU6gYh2PBJyptYjwSPR4wJkTxRcUlEhoh0PxjDSEtAf7IEMYweO5OgTn3&#43;XjCFLgGyRBQrc4kYineYiYAXbcGmBEdxaOYMCDlFPU&#43;8CL&#43;UUF2CnB4hox4OBkR2PwNBrT7DyA0S048HASDRWZcA8ZZhIwZEcfWI1kgmGN6mA719gsGrMJ6hTs6I9TbtFu4vooYFPA&#43;BkaCRWvcCOTfTawsglnmoLgF42YICCkRkwS6AnorYwcomn2gKgxyLGbBYN2UiWDBMROJKjT5xEMkG&#43;Z0mbwUwM2gZ6LdqpKkoFbrUFkKUkKENApBnOkY3sJXiJdQNkO7klEFHrFEvtXgHoVgaBOpIHysJLAHowwC2BiFqnWGr3CkC3Y9Ca1R4rDBMROJKjT7xFshiRqdkMt1YN9ATziIDN2l3mqYDoYokVsjQDZrjV7gVRO1XBNnmmVLTbiQhmAJZW26GsgJHWCQoe4QZ0EDFEBDMAS/N27VSgNQRlZpjw4UiOPrHx412yAFBIaSEeXDCVkAYvoReQpUSKViMMXsIW4lFRDXhXwO0A7Ap2i50C8BKmpADzUqBVSCORTlkGiEHdgpcwJQWYlwKtAo1VqRADFMM0EBzJ0SdmrpIbCPmORt7dcC9RlSgg79TOXdt/bNgJh1sV2OyAbVY9YCVqdYlhFHHwfVk9VBUhGh6kYcQwjROO5OiT6JHMMAzzGMkpdx8tdWc8bIz1ycHsFoPG/kuHd0QNX7GFTBtJHS51Hy9z51V67td6nR7/VzV24UhmGIZ5bHQ/52ydXfnbrMZY/7b/zl9vyPn5yqOifr0jn0wbSbU8WfnqKeeUq9X7S9w3qrz&#43;L2vMwpHMMAzz2PiHTMcv0sp/sq/8v3CFVH&#43;2v/yXBx0tTlSOvFT9dbHrdo230h3DwcyRzDAM89j40/3lP02lMcNlv8SfZv44tfwXaY5fpTsGX6y7Vr5VzZEcLhzJDMMkIiJU/lem47mTlX846xx8sYrLfg28WNXvQtWL2c6/OuAQqSy&#43;km2ynR/dqDntiOG/UuZIZhiGeWyIIBF5vORW7fEyt9Pj47Jf5W5fca1vRWHt/znk&#43;PP9dZH8b0cq3jlXlfrA7f/ixiAcyQzDMI8NESRdzlVllbvv1MT8jyZFGXEtXOPxfVPsanGi8lcHHT/ZV/7Phyo6nXbuue/yO2IQjmSGYZjHhojkIXnVIlqY0Nhf4n7jjPOfDlWISP6HzIp2p5w773EkhwtHMsMwiQhHcphwJDcEHMkMwyQiHMlhwpHcEHAkMwyTiHAkhwlHckPAkcwwTCLCkRwmHMkNAUcywzCJCEdymHAkNwQcyQzDJCIcyWHCkdwQcCQzDJOIcCSHCUdyQ8CRzDBMIsKRHCYcyQ0BRzLDMIkIR3KYcCQ3BBzJDMMkIhzJYcKR3BBwJDMMk4hwJIdJWom7y1nnvxzmSI4kHMkMwyQiHMlhklXmHnO5&#43;pmsyp&#43;mciRHDI5khmESEY7kMDnr8My7UfNSDkdyJOFIZhgmEeFIDhOO5IaAI5lhmITgXq134&#43;3aHuer/i7DIfKYIzlMOJIbAo5khmESAo7kyMKR3BBwJDMMkxBwJEcWjuSGgCOZYZiEgCM5snAkNwQcyQzDJAQcyZGFI7kh4EhmGCYh4EiOLBzJDQFHMsMwCQFHcmThSG4IOJIZhkkIOJIjC0dyQ8CRzDBMQsCRHFk4khsCjmSGYRICjuTI0hgi2ev1ejwecetfhwFHMsMwTPTgSI4sjSGSRY46nc7a2lr/Ogw4khmGYaIHR3JkiX4ki6thEZyVlZX3798vKCi4cOHCyZMn09PTr1696neEAUcywzBM9OBIjizRj2SPxyMy8vr165mZmRs2bJg2bVpSUlK3bt02bdrkd4QBRzLDMEz04EiOLFGIZLfbXVVVJa6Jr127dvr0aXFB/M0336xatWrWrFlDhw4V2dmqVasnn3xy8eLF/g1hwJHMMAwTPTiSI0sUItnpdBYXF588eXL79u0ihvv169ehQ4cXXnihZcuWzZo1e/rpp0UeP/HEExzJDMMwMQZHcmSJeCR7vd7q6uqSkhJxTZydnb13794tW7Z8&#43;umnM2bMGDFiRNeuXV988cWmTZuKDCZwJDMMw8QYHMmRJeKR7PF4Hj58eOnSpd27dy9cuLB///7t2rWTl8JN6vEn8BNP/Gc9/gVHMsMwTMzBkRxZwo9kcU18//79ixcvpqen79ixY926dYsWLRJZOGzYsO7du7/yyivNmzeX35omGUzgSGYYhokxOJIjSwiRLK6DRfKJJK6srCwvL79582ZOTs6XX345ffr0QYMGdejQoUWLFv6Y/TEykgX&#43;9Y8ROSour8Pk3r17e/bsmTZt2uuvv86RzDAM07BwJEeWYCNZ5HFpaenVq1czMzO3bt26ZMkSkX/vvfde7969O3XqJFJQ5PHTTz8tU9YQwCqdO3eeHDYTJ04cMGCAuER&#43;9tlnOZIZhmEaFo7kyBJsJLvd7qKioqysrDVr1kyYMOHNN9987rnn5PelCTKPJX4pijRp0qRt27YzZ87cv3&#43;/uJT3P/powZHMMExCwJEcWcKJ5PHjx4tLW20k&#43;6P4EX41Wog8fuqpp8RV&#43;&#43;eff56Tk1NZWel/9NGCI5lhmISAIzmyhPCN6wcPHly8eDElJWXFihVTp04dOnRojx495HetRTz/7ne/E3Hoj&#43;JH&#43;KPSiLioHRA5Bg0aNG3atH379hUUFNTU1PgffbTgSGYYJiHgSI4swUay1&#43;utra0V150imAsLC69duyYuQ0XyLV&#43;&#43;XFw09&#43;7du3379s2bN/fH7CP8yfwIv/pjkpOTRdJHiry8PPHYSkpKqqqqxB8j/I8&#43;WnAkMwyTEHAkR5ZgI1nF6XTeuXNHBPN33323du3aBQsWTJo0KSkpqWfPnh07dnzhhReeeeaZJk2a&#43;NO4Hn8I/5iI/E9QjQSOZIZhEgKO5MgSfiSL62a3211dXV1RUVFWVnb//v38/Pxjx45t3rx5xowZPXr0aNOmzVNPPeUP3nr8yVyPX&#43;JIZhiGiTk4kiNL&#43;JFMEAktP9T6woUL6enpW7ZsWbp06fTp00eNGtW3b98OHTq0atXq6aefJnks4EhmGIaJMTiSI0vEIxkQ2SwRV89FRUWHDx9et27duHHjOnbsqP0sEY5khmGYGIMjObI0XCQDLpdLpHJhYeH58&#43;fFdfP27dtXrFgxd&#43;5cEc99&#43;vRp3779s88&#43;26RJE45khmGYGIMjObJEIZIJ8vO/rly5sm/fvmXLlg0fPvwPf/jDiy&#43;&#43;uHz5cr8j9uFIZhgmIeBIjizRj2Sv11tTU1NWVnbr1q3c3NzDhw&#43;npKRs27bt7Nmzfkfsw5HMMExCwJEcWaIfySoul6uysjL6H&#43;jRcHAkMwyTEHAkR5bGEMniutntdkf/Az0aDo5khmESAo7kyNIYIjn&#43;4EhmGCYh4EiOLBzJDQFHMsMwCQFHcmThSG4IOJIZhkkIOJIjC0dyQ8CRzDBMQsCRHFk4khsCjmSGYRICjuTIwpHcEHAkM1q8FsUwsQpHcmThSG4IOJIZLSSJcTFMTMKRHFk4khsCjmSGQAJYWwwTe3AkRxaO5IaAI5khkPS1KoaJMUQkr79d2/1c1d8&#43;iuQ&#43;uVUF1d47NVyh1IES95Sr1a1O1kXyrzMdr&#43;Q4v&#43;NIDhuOZAYgoSsKILoohokximu8Kwtr3zxb9Tfp/khune1cWVS79raLK4Saeb2m6znnvx&#43;t&#43;Om&#43;8r/LcDx3svKbYo7kcOFIZgBz6JqnDNN48fh8D13e7HLPxPya5icq/&#43;qAP5L/75GKrueq3jrPFUq1P&#43;VscrzibzMcP9lX/tcHHf9xtOKjGzWXKj3lbn5/CB2OZEaAs1aWFjsehml01Hp9OQ7Pslu1z2dX/uUBxx&#43;n1uWxqJ&#43;lOX6VzhVi/fKg4y/SHH&#43;6v&#43;4rKb6k4g86r592Liyoyavkv58PHY5kRmA/a&#43;07GaZR8KDWe67Cs/hmzRtnnH&#43;fWSHDmCviJVL5nw9XiC/yhtu1V5wep4ffH0KBI5kRBJWyQZkZ5jFzxuFZWVT7yinnL9J&#43;uD7minj9ZF/5n6SW/32mo09u1Rd3au/U8PtDKHAkMwKcsgFfSPadDPM4gevj3592/u9DfH0cjfp5muM/j1W8e6Fq931XQbWnlt8kgoQjmRHglJVlwL6TYR4nuRWeNbdr259yktjgauj61yMVk69WH3joruAf9QoSjmRGglPW/Cqy72SYx4PD7b1e5V1RWNvulPMf&#43;fo46vXXBx1NsypHXa7e98B9o4r/VjkIOJIZwGbQYpvZyTDRRjwjXV7fjSrv7vuuvrlV8ueBG1v9pP6HoX6W5hDR9cuQ6r/V/9y4OIec3KjqiWOVyVerU0vcVR4fXy3bhCM50TBEKYxwAUSHYphGRLXHd7va&#43;3Wxq&#43;f5qn8/WvFHjfLnuf7r/vL/ke5odbJy5KXqCVdCqS5n6z4W9E8bdyr/94OOJscqJ&#43;VXn6vw3Oe/VbYHR3KiYUhTPMJlGIlimEaBeC6K6&#43;OiGu&#43;&#43;B&#43;4xl6v/4ZDjzxvlJbKoX6U7Wp6snHil&#43;uBDd1aZJ4RaXljbOrvyf2Y4GuefOXC1znaKR3uy3MPXynbgSE4cIETVwpCRWsTDMI0C8Xb/0OUVIdfvQt318S/Syn/aWONKPLwPr9ccLHHfrfGWuEKpnHLPJ/U/Sd5o/9gBJa7mm5&#43;oXFRQc9XpLRd/aGKMcCQnDjhH1QKITgrQigzz2HC4vUdK3TOv1/zH0QoRVI3zO7p/klr37dwOp517H7iLa7whXzWW1Nal8sT86r9Jd/xZ405l8Uv&#43;eVr5W&#43;eqNt9xXXHyB3sFgCM5EcDxaSgCmYoiGEYMEz3kU7Cw2jv9Wk2zrMpfHnT8VAmGRlJ/ecDxTFblpPy6z4Ku9Yb&#43;yhFXmxVu79qi2ibHKkTGk3tpVCX&#43;bPRHqXX/W1SXs859D/jfpQgAR3IiIN&#43;yApaKeSowTxmmwYGn4I0qz7C8qn86VPGzNJoKjad&#43;nub4f3XhVLX4Zs3Wu65d9127Q6pv77m&#43;uFMrfr3/fLhCxDy5l0ZYv0p3/C6r8mv&#43;p6ICwZEc38D7lSgtAQ1mwtnLMOECzz9RMRHJ4pLxT1LrrpX/PtMhLnDbnnK&#43;djqUeu5k5b8eqfu3H8RpjfZbArj&#43;6kDdr1f8KcT/O8dYwJEc3&#43;C3LC3YYOUxEPJGhokA8PwTdb/Wu&#43;527Tvnq36dWRdUjfn/Dvppavmf7a/7PA3xUP/3oYoQ6m8zHL9Iq0t3cnKjreYnKifmVx8vc/t/5xgLOJLjG/yWpQUbZAVFaLsYJjLg51&#43;1x3fN6V1XVNssq/Iv0uo&#43;i6Mxp3KClPgtEH/&#43;&#43;KPU8uF51eccngf8fycHgiM5voG3LMMrAXsMNi2h7WKYCECefG6vr8zlPePwfHarduDFqpYnK//xUMXP9tdlM8kJrujUL9Icv86saJPtfO9S9Y57rnu13kqXR&#43;Ctx&#43;12i97/m8c8giM5voF3LXjj0mLTphLaLoYJF6tnnrhWvlvjTS1xT86v6XDa&#43;W&#43;HK/4h0/F3GVyPof7jaEX7U86512vOOjwij8Xvjohhl8slI1k0Yika&#43;RvHSDiS4xt44zI/723aGKaxYPV8FdfKTk/d/xB1styz94Fr6926n0zeyPU4anux6/sHrjMOT0mtt6r&#43;eliGsWzk5XKdWk/9RP39TDg4kuMb&#43;a4ly4BNG8M0Fmw&#43;X8Fmx8w8RkQew/e0/VJCwpEc39h8O7JpY5jGgv3nKzjtmJlIEUKyii2uehI3lX2&#43;/w/abXUTYx7LmQAAAABJRU5ErkJggg=="
	
	
	
	loading="lazy"
	
		alt="graphic"
	
	
></p>
<h4 id="三个注册中心异同点consul除了能够实现服务注册与发现更能做到服务的动态配置与管理">三个注册中心异同点：Consul除了能够实现服务注册与发现，更能做到服务的动态配置与管理
</h4><p><img src="C:%5cUsers%5chp%5cDesktop%5c%e5%bc%80%e5%8f%91%e6%96%87%e6%a1%a3%5cSpringCloud%5cFigure%5cimage-20241204212353981.png"
	
	
	
	loading="lazy"
	
		alt="image-20241204212353981"
	
	
></p>
<h3 id="持久化配置并注册为windows服务">持久化配置并注册为windows服务
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cmd" data-lang="cmd"><span class="line"><span class="cl">// G:\consul\consul_start.bat
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">@</span><span class="k">echo</span>.服务启动......  
</span></span><span class="line"><span class="cl"><span class="p">@</span><span class="k">echo</span> off  
</span></span><span class="line"><span class="cl"><span class="p">@</span>sc create Consul binpath= <span class="s2">&#34;G:\consul\consul.exe agent -server -ui -bind=127.0.0.1 -client=0.0.0.0 -bootstrap-expect  1  -data-dir G:\consul\mydata&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">@</span>net start Consul
</span></span><span class="line"><span class="cl"><span class="p">@</span>sc config Consul start= AUTO  
</span></span><span class="line"><span class="cl"><span class="p">@</span><span class="k">echo</span>.Consul start is OK......success
</span></span><span class="line"><span class="cl"><span class="p">@</span><span class="k">pause</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>以管理员身份运行！！！如果报错1073，需要以管理员身份先运行cmd，执行sc delete Consul，再用管理员身份运行此bat即可</p>
<p>这样任务管理器后台就有了consul.exe</p>
<h2 id="loadbalancer负载均衡">LoadBalancer：负载均衡
</h2><h3 id="本地客户端负载均衡loadbalancer与服务器端负载均衡nginx的区别面试">本地客户端负载均衡：LoadBalancer与服务器端负载均衡：Nginx的区别（面试）
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">Nginx是服务器负载均衡</span><span class="err">，客户端所有请求都会交给</span><span class="n">nginx</span><span class="err">，然后由</span><span class="n">nginx实现转发请求</span><span class="err">，即负载均衡是由服务端实现的。</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">loadbalancer本地负载均衡</span><span class="err">，在调用微服务接口时候，会在注册中心上获取注册信息服务列表之后缓存到</span><span class="n">JVM本地</span><span class="err">，从而在本地实现</span><span class="n">RPC远程服务调用技术</span><span class="err">。</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="pomconsumer">pom（consumer）
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="c">&lt;!--SpringCloud consul discovery --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-consul-discovery<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">&lt;!--loadbalancer--&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-loadbalancer<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="负载均衡默认使用轮询算法">负载均衡默认使用轮询算法
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">负载均衡算法：rest接口第几次请求数 % 服务器集群总数量 = 实际调用服务器位置下标，每次服务重启动后rest接口计数从1开始。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">List&lt;ServiceInstance&gt; instances = discoveryClient.getInstances(&#34;cloud-payment-service&#34;);
</span></span><span class="line"><span class="cl">如：List [0] instances = 127.0.0.1:8002
</span></span><span class="line"><span class="cl">   List [1] instances = 127.0.0.1:8001
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">8001+ 8002 组合成为集群，它们共计2台机器，集群总数为2， 按照轮询算法原理：
</span></span><span class="line"><span class="cl">当总请求数为1时： 1 % 2 =1 对应下标位置为1 ，则获得服务地址为127.0.0.1:8001
</span></span><span class="line"><span class="cl">当总请求数位2时： 2 % 2 =0 对应下标位置为0 ，则获得服务地址为127.0.0.1:8002
</span></span><span class="line"><span class="cl">当总请求数位3时： 3 % 2 =1 对应下标位置为1 ，则获得服务地址为127.0.0.1:8001
</span></span><span class="line"><span class="cl">当总请求数位4时： 4 % 2 =0 对应下标位置为0 ，则获得服务地址为127.0.0.1:8002
</span></span><span class="line"><span class="cl">如此类推......
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="C:%5cUsers%5chp%5cDesktop%5c%e5%bc%80%e5%8f%91%e6%96%87%e6%a1%a3%5cSpringCloud%5cFigure%5cimage-20241205145755054.png"
	
	
	
	loading="lazy"
	
		alt="image-20241205150736874"
	
	
></p>
<h2 id="openfeign服务接口调用和负载均衡默认集成了loadbalancer">OpenFeign：服务接口调用和负载均衡（默认集成了LoadBalancer）
</h2><h3 id="工作原理特点">工作原理+特点
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">OpenFeign 是一个声明式的 Web 服务客户端，它可以帮助消费者（即客户端）以更简洁的方式调用微服务。OpenFeign 是基于 Java 的，特别是在 Spring Cloud 中被广泛使用，通常用于简化微服务之间的 HTTP 通信。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">它的工作原理类似于中间件，允许通过接口声明来定义如何与其他服务进行交互，而不需要显式编写 HTTP 请求代码。OpenFeign 会根据在接口中定义的方法自动生成相应的 HTTP 请求，并通过注解（如 `@RequestMapping` 或 `@GetMapping`）来指定请求的细节。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">OpenFeign 的特点包括：
</span></span><span class="line"><span class="cl">1、声明式调用：只需要定义接口，OpenFeign 会自动处理 HTTP 请求和响应的细节。
</span></span><span class="line"><span class="cl">2、集成 Spring Cloud：如果使用 Spring Cloud，OpenFeign 可以很容易地集成到你的微服务架构中，通过负载均衡、容错处理等功能与其他微服务交互。
</span></span><span class="line"><span class="cl">3、自动化：OpenFeign 通过代理模式生成服务的实现类，因此你不需要手动编写 HTTP 请求处理逻辑。
</span></span><span class="line"><span class="cl">4、注解驱动：通过注解（例如 @FeignClient、@RequestMapping 等），可以非常直观地配置请求和服务之间的映射关系。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">总结：
</span></span><span class="line"><span class="cl">OpenFeign 作为一种中间件，简化了微服务客户端的开发工作，通过声明式的方式自动生成调用逻辑，可以使得微服务的通信变得更加便捷和高效。
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="openfeign与resttemplate区别">OpenFeign与RestTemplate区别
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">使用 OpenFeign 不需要像 RestTemplate 那样手动指定微服务的 URL。OpenFeign 会自动处理微服务之间的通信，简化了 URL 的管理。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">使用 RestTemplate 需要手动维护每个微服务的 URL 地址，尤其是在微服务规模较大的时候，可能会出现 URL 变更、服务发现等问题，增加了管理的复杂度。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">使用 Feign 时，你只需要定义接口并使用注解来指定请求的路径和方法，不需要手动构造 URL。Feign 会通过服务名自动解析 URL，服务名会由 Spring Cloud 的服务发现机制（例如 Eureka 或 Consul）来解析。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">优点：
</span></span><span class="line"><span class="cl">简化配置：你不需要管理微服务的 URL，服务名通过注册中心自动解析。
</span></span><span class="line"><span class="cl">负载均衡：与 Spring Cloud 的负载均衡机制集成，自动处理多实例选择。
</span></span><span class="line"><span class="cl">服务发现：与 Spring Cloud 配合使用时，OpenFeign 会根据服务注册信息自动路由请求，而不需要硬编码 URL。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">小结：
</span></span><span class="line"><span class="cl">OpenFeign 提供了更简洁、更灵活的方式来调用微服务，它通过服务名和注解的方式自动构造 HTTP 请求，避免了手动拼接 URL 和显式管理微服务地址的问题。
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="pomconsumer-1">pom（consumer）
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="c">&lt;!--openfeign--&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-openfeign<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="resilience4j是spring-cloud-circuit-breaker接口规范的实现类circuitbreakerbulkheadratelimiter">Resilience4j是Spring Cloud Circuit Breaker接口规范的实现类：CircuitBreaker+BulkHead+RateLimiter
</h2><h3 id="circuitbreaker断路器服务熔断和服务降级面试必考题">CircuitBreaker：断路器，服务熔断和服务降级（面试必考题）
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">1、微服务不可能只连一个数据库，如何处理微服务之间多个数据库之间分布式事务之间的调用，保障数据的一致性？
</span></span><span class="line"><span class="cl">2、微服务要做一些安全加固和高可用，有哪些兜底的方法来做服务的熔断和降级？
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="配置参数">配置参数
</h4><div class="table-wrapper"><table>
  <thead>
      <tr>
          <th><strong>failure-rate-threshold</strong></th>
          <th><strong>以百分比配置失败率峰值</strong></th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>sliding-window-type</strong></td>
          <td><strong>断路器的滑动窗口期类型 可以基于“次数”（COUNT_BASED）或者“时间”（TIME_BASED）进行熔断，默认是COUNT_BASED。</strong></td>
      </tr>
      <tr>
          <td><strong>sliding-window-size</strong></td>
          <td><strong>若COUNT_BASED，则10次调用中有50%失败（即5次）打开熔断断路器；若为TIME_BASED则，此时还有额外的两个设置属性，含义为：在N秒内（sliding-window-size）100%（slow-call-rate-threshold）的请求超过N秒（slow-call-duration-threshold）打开断路器。</strong></td>
      </tr>
      <tr>
          <td><strong>slowCallRateThreshold</strong></td>
          <td><strong>以百分比的方式配置，断路器把调用时间大于slowCallDurationThreshold的调用视为慢调用，当慢调用比例大于等于峰值时，断路器开启，并进入服务降级。</strong></td>
      </tr>
      <tr>
          <td><strong>slowCallDurationThreshold</strong></td>
          <td><strong>配置调用时间的峰值，高于该峰值的视为慢调用。</strong></td>
      </tr>
      <tr>
          <td><strong>permitted-number-of-calls-in-half-open-state</strong></td>
          <td><strong>运行断路器在HALF_OPEN状态下时进行N次调用，如果故障或慢速调用仍然高于阈值，断路器再次进入打开状态。</strong></td>
      </tr>
      <tr>
          <td><strong>minimum-number-of-calls</strong></td>
          <td><strong>在每个滑动窗口期样本数，配置断路器计算错误率或者慢调用率的最小调用数。比如设置为5意味着，在计算故障率之前，必须至少调用5次。如果只记录了4次，即使4次都失败了，断路器也不会进入到打开状态。</strong></td>
      </tr>
      <tr>
          <td><strong>wait-duration-in-open-state</strong></td>
          <td><strong>从OPEN到HALF_OPEN状态需要等待的时间</strong></td>
      </tr>
  </tbody>
</table></div>
<h4 id="pomconsumer-2">pom（consumer）
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="c">&lt;!--resilience4j-circuitbreaker--&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-circuitbreaker-resilience4j<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c">&lt;!-- 由于断路保护等需要AOP实现，所以必须导入AOP包 --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-aop<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="断路器开启或关闭的条件">断路器开启或关闭的条件
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">1、当到达一定的峰值和失败率后，断路器将会进入OPEN状态（保险丝熔断导致跳闸），服务熔断
</span></span><span class="line"><span class="cl">2、当OPEN时，所有请求都不会调用主业务逻辑方法，而是直接走fallbackMethod兜底方法，服务降级
</span></span><span class="line"><span class="cl">3、一段时间后，断路器会从OPEN进入HALF_OPEN，会放几个请求过去探探链路是否通，如果成功，断路器会进入CLOSE，恢复可以；如果失败，继续开启。重复上述...
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="bulkhead舱壁隔离依赖隔离负载保护">BulkHead：舱壁隔离，依赖隔离，负载保护
</h3><h4 id="关注点舱壁种类">关注点+舱壁种类
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">主要关注并发执行的请求数量，限制对于下游服务的最大并发数量，侧重于某一个时刻的最大请求个数，防止资源耗尽导致的服务间连锁反应
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">SemaphoreBulkhead（信号量舱壁）、FixedThreadPoolBulkhead（固定线程池舱壁）
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ratelimiter限流侧重于一段时间内的最多请求次数">RateLimiter：限流，侧重于一段时间内的最多请求次数
</h3><h4 id="说说常见限流算法面试">说说常见限流算法（面试）
</h4><p>漏桶算法（Leaky Bucket）</p>
<p><img src="C:%5cUsers%5chp%5cDesktop%5c%e5%bc%80%e5%8f%91%e6%96%87%e6%a1%a3%5cSpringCloud%5cFigure%5cimage-20241206155112050.png"
	
	
	
	loading="lazy"
	
		alt="image-20241206155112050"
	
	
></p>
<p><img src="C:%5cUsers%5chp%5cDesktop%5c%e5%bc%80%e5%8f%91%e6%96%87%e6%a1%a3%5cSpringCloud%5cFigure%5cimage-20241206154943972.png"
	
	
	
	loading="lazy"
	
		alt="image-20241206154943972"
	
	
></p>
<p>令牌桶算法（Token Bucket，默认使用）</p>
<p><img src="C:%5cUsers%5chp%5cDesktop%5c%e5%bc%80%e5%8f%91%e6%96%87%e6%a1%a3%5cSpringCloud%5cFigure%5cimage-20241206155953594.png"
	
	
	
	loading="lazy"
	
		alt="image-20241206155953594"
	
	
></p>
<p><img src="C:%5cUsers%5chp%5cDesktop%5c%e5%bc%80%e5%8f%91%e6%96%87%e6%a1%a3%5cSpringCloud%5cFigure%5cimage-20241206162354365.png"
	
	
	
	loading="lazy"
	
		alt="image-20241206162354365"
	
	
></p>
<p><img src="C:%5cUsers%5chp%5cDesktop%5c%e5%bc%80%e5%8f%91%e6%96%87%e6%a1%a3%5cSpringCloud%5cFigure%5cimage-20241206162641752.png"
	
	
	
	loading="lazy"
	
		alt="image-20241206162641752"
	
	
></p>
<p><img src="C:%5cUsers%5chp%5cDesktop%5c%e5%bc%80%e5%8f%91%e6%96%87%e6%a1%a3%5cSpringCloud%5cFigure%5cimage-20241206162748845.png"
	
	
	
	loading="lazy"
	
		alt="image-20241206162748845"
	
	
></p>
<h3 id="熔断与隔离的理解与使用">熔断与隔离的理解与使用
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">熔断是用于避免特定服务器错误导致向该服务器的请求时间过长进一步导致长时间占用服务器的线程进而导致服务器线程池容易溢出再进而导致整个调用链服务雪崩的风险
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">隔离是避免服务器超负载运行导致宕机而做的一个保险，限制服务器能够处理特定请求的能力，不一口气吃成一个胖子，多出来的请求排队等待处理
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">看具体业务情况使用，可以单独使用，也可以配合起来使用
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="micrometer-tracing数据采样前身sleuthzipkin链路展现分布式链路追踪distributed-tracing">Micrometer Tracing：数据采样，前身Sleuth+ZipKin：链路展现=分布式链路追踪（Distributed Tracing）
</h2><p><img src="C:%5cUsers%5chp%5cDesktop%5c%e5%bc%80%e5%8f%91%e6%96%87%e6%a1%a3%5cSpringCloud%5cFigure%5cimage-20241206201710028.png"
	
	
	
	loading="lazy"
	
		alt="image-20241206201710028"
	
	
></p>
<p><img src="C:%5cUsers%5chp%5cDesktop%5c%e5%bc%80%e5%8f%91%e6%96%87%e6%a1%a3%5cSpringCloud%5cFigure%5cimage-20241206203731769.png"
	
	
	
	loading="lazy"
	
		alt="image-20241206203731769"
	
	
></p>
<p><img src="C:%5cUsers%5chp%5cDesktop%5c%e5%bc%80%e5%8f%91%e6%96%87%e6%a1%a3%5cSpringCloud%5cFigure%5cimage-20241206203711661.png"
	
	
	
	loading="lazy"
	
		alt="image-20241206203711661"
	
	
></p>
<h3 id="zipkin">Zipkin
</h3><h4 id="cmd指令-1">cmd指令
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cmd" data-lang="cmd"><span class="line"><span class="cl">运行
</span></span><span class="line"><span class="cl">java -jar zipkin-server-3.4.3-exec.jar
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">打开
</span></span><span class="line"><span class="cl">http://127.0.0.1:9411/
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="pomserviceconsumer">pom（service、consumer）
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="c">&lt;!-- 父工程 --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;micrometer-tracing.version&gt;</span>1.2.0<span class="nt">&lt;/micrometer-tracing.version&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;micrometer-observation.version&gt;</span>1.12.0<span class="nt">&lt;/micrometer-observation.version&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;feign-micrometer.version&gt;</span>12.5<span class="nt">&lt;/feign-micrometer.version&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;zipkin-reporter-brave.version&gt;</span>2.17.0<span class="nt">&lt;/zipkin-reporter-brave.version&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c">&lt;!--micrometer-tracing-bom导入链路追踪版本中心  1--&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;groupId&gt;</span>io.micrometer<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;artifactId&gt;</span>micrometer-tracing-bom<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;version&gt;</span>${micrometer-tracing.version}<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;type&gt;</span>pom<span class="nt">&lt;/type&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;scope&gt;</span>import<span class="nt">&lt;/scope&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="c">&lt;!--micrometer-tracing指标追踪  2--&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;groupId&gt;</span>io.micrometer<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;artifactId&gt;</span>micrometer-tracing<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;version&gt;</span>${micrometer-tracing.version}<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="c">&lt;!--micrometer-tracing-bridge-brave适配zipkin的桥接包 3--&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;groupId&gt;</span>io.micrometer<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;artifactId&gt;</span>micrometer-tracing-bridge-brave<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;version&gt;</span>${micrometer-tracing.version}<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="c">&lt;!--micrometer-observation 4--&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;groupId&gt;</span>io.micrometer<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;artifactId&gt;</span>micrometer-observation<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;version&gt;</span>${micrometer-observation.version}<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="c">&lt;!--feign-micrometer 5--&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;groupId&gt;</span>io.github.openfeign<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;artifactId&gt;</span>feign-micrometer<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;version&gt;</span>${feign-micrometer.version}<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="c">&lt;!--zipkin-reporter-brave 6--&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;groupId&gt;</span>io.zipkin.reporter2<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;artifactId&gt;</span>zipkin-reporter-brave<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;version&gt;</span>${zipkin-reporter-brave.version}<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">8001、80
</span></span><span class="line"><span class="cl">        <span class="c">&lt;!--micrometer-tracing指标追踪  2--&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;groupId&gt;</span>io.micrometer<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;artifactId&gt;</span>micrometer-tracing<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="c">&lt;!--micrometer-tracing-bridge-brave适配zipkin的桥接包 3--&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;groupId&gt;</span>io.micrometer<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;artifactId&gt;</span>micrometer-tracing-bridge-brave<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="c">&lt;!--micrometer-observation 4--&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;groupId&gt;</span>io.micrometer<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;artifactId&gt;</span>micrometer-observation<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="c">&lt;!--feign-micrometer 5--&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;groupId&gt;</span>io.github.openfeign<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;artifactId&gt;</span>feign-micrometer<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="c">&lt;!--zipkin-reporter-brave 6--&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;groupId&gt;</span>io.zipkin.reporter2<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;artifactId&gt;</span>zipkin-reporter-brave<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="C:%5cUsers%5chp%5cDesktop%5c%e5%bc%80%e5%8f%91%e6%96%87%e6%a1%a3%5cSpringCloud%5cFigure%5cimage-20241206204938401.png"
	
	
	
	loading="lazy"
	
		alt="image-20241206204938401"
	
	
></p>
<h3 id="yml-1">yml
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">management</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">zipkin</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">tracing</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">endpoint</span><span class="p">:</span><span class="w"> </span><span class="l">http://localhost:9411/api/v2/spans </span><span class="w"> </span><span class="c"># 固定写法</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">tracing</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">sampling</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">probability</span><span class="p">:</span><span class="w"> </span><span class="m">1.0</span><span class="w">  </span><span class="c"># 采样率默认为0.1，即十次只能有一次被记录下，值越大收集越及时</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="gateway服务网关">GateWay：服务网关
</h2><h3 id="gateway与nginx区别">GateWay与Nginx区别
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Nginx更适用于通用的Web服务和反向代理，而Gateway更适用于微服务架构中的请求管理和集中控制
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Nginx可以理解为是服务器之间的保护，Gateway是服务器内部的
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="gateway与openfeign区别">GateWay与OpenFeign区别
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Gateway主要是把外部的请求进行分发/外部调用微服务，OpenFeign用于微服务之间的调用
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">eg：OpenFeign是服务间调用，请求A服务，A服务需要B服务，此时使用OpenFeign，Gateway是在A之前，Nginx是在网关之前
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">请求过了Nginx直接就是访问网关，然后才是分发到各个微服务
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">现在是通过OpenFeign到Gateway，再由Gateway分发路由（Gateway也是一个微服务），但实际中是通过Nginx直接访问GateWay，再由GateWay分发，服务之间的调用再使用OpenFeign
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="C:%5cUsers%5chp%5cDesktop%5c%e5%bc%80%e5%8f%91%e6%96%87%e6%a1%a3%5cSpringCloud%5cFigure%5cdownload.png"
	
	
	
	loading="lazy"
	
		alt="download"
	
	
></p>
<p><img src="C:%5cUsers%5chp%5cDesktop%5c%e5%bc%80%e5%8f%91%e6%96%87%e6%a1%a3%5cSpringCloud%5cFigure%5cimage-20241208201821402.png"
	
	
	
	loading="lazy"
	
		alt="image-20241208201821402"
	
	
></p>
<p><img src="C:%5cUsers%5chp%5cDesktop%5c%e5%bc%80%e5%8f%91%e6%96%87%e6%a1%a3%5cSpringCloud%5cFigure%5cimage-20241208204807421.png"
	
	
	
	loading="lazy"
	
		alt="image-20241208204807421"
	
	
></p>
<h3 id="三大概念routepredicatefilter">三大概念：Route、Predicate、Filter
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Route（路由）：构建网关的基本模块，由ID、目标URI，一系列的断言和过滤器组成，如果断言为true则匹配该路由
</span></span><span class="line"><span class="cl">Predicate（断言）：开发人员可以匹配HTTP请求中的所有内容（例如请求头或请求参数），如果请求与断言相匹配则进行路由
</span></span><span class="line"><span class="cl">Filter（过滤）：指Spring框架中的GatewayFilter实例，使用过滤器，可以在请求被路由之前或之后对请求进行修改
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="C:%5cUsers%5chp%5cDesktop%5c%e5%bc%80%e5%8f%91%e6%96%87%e6%a1%a3%5cSpringCloud%5cFigure%5cimage-20241208204538713.png"
	
	
	
	loading="lazy"
	
		alt="image-20241208204538713"
	
	
></p>
<p><img src="C:%5cUsers%5chp%5cDesktop%5c%e5%bc%80%e5%8f%91%e6%96%87%e6%a1%a3%5cSpringCloud%5cFigure%5cimage-20241208205036979.png"
	
	
	
	loading="lazy"
	
		alt="image-20241208205036979"
	
	
></p>
<h3 id="filter请求鉴权异常处理记录接口调用时长统计">Filter：请求鉴权、异常处理、记录接口调用时长统计&hellip;
</h3><h4 id="filter与predicate区别">Filter与Predicate区别
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Predicate：根据条件是否进行路由转发；Filter则是进入了路由，在请求到达接口之前和接口响应之后做一些操作
</span></span><span class="line"><span class="cl">（过滤器可以替代断言，但是断言不能替代过滤器）
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="pom-7">pom
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl">        <span class="c">&lt;!--gateway--&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-gateway<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="c">&lt;!--服务注册发现consul discovery,网关也要注册进服务注册中心统一管控--&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-consul-discovery<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="c">&lt;!-- 指标监控健康检查的actuator,网关是响应式编程删除掉spring-boot-starter-web dependency--&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-actuator<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="yml-2">yml
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">spring</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">application</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">cloud-gateway </span><span class="w"> </span><span class="c"># 以微服务注册进consul或nacos服务列表内</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">cloud</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">consul</span><span class="p">:</span><span class="w">  </span><span class="c"># 配置consul地址</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l">localhost</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">8500</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">discovery</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">prefer-agent-address</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">service-name</span><span class="p">:</span><span class="w"> </span><span class="l">${spring.application.name}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">gateway</span><span class="p">:</span><span class="w">  </span><span class="c"># 所有的请求都会发给网关，由网关进行转发</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">routes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l">pay_route1 </span><span class="w"> </span><span class="c"># 路由的ID（类似于mysql的主键），没有固定规则但要求唯一，建议配合服务名</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">uri</span><span class="p">:</span><span class="w"> </span><span class="l">http://localhost:8001 </span><span class="w"> </span><span class="c"># 匹配后提供服务的路由地址，http://localhost:8001 -&gt; http://localhost:9527</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">predicates</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="l">Path=/pay/gateway/get/** </span><span class="w"> </span><span class="c"># 断言，路径相匹配的进行路由</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l">pay_route2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">uri</span><span class="p">:</span><span class="w"> </span><span class="l">http://localhost:8001</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">predicates</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="l">Path=/pay/gateway/info/**</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h1 id="heading-1">……………………………………………………………………
</h1><h2 id="cloudalibaba-provider-payment9001servicesentinelopenfeign">cloudalibaba-provider-payment9001（service）(Sentinel+OpenFeign)
</h2><h3 id="pom-8">pom
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependencies&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="c">&lt;!--alibaba-sentinel--&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;groupId&gt;</span>com.alibaba.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-alibaba-sentinel<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c">&lt;!--nacos-discovery--&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;groupId&gt;</span>com.alibaba.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c">&lt;!-- 引入自己定义的api通用包 --&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;groupId&gt;</span>com.xz.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;artifactId&gt;</span>cloud-api-commons<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="c">&lt;!--SpringBoot通用依赖模块--&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-actuator<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="c">&lt;!--hutool--&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;groupId&gt;</span>cn.hutool<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;artifactId&gt;</span>hutool-all<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="c">&lt;!--lombok--&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;groupId&gt;</span>org.projectlombok<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;artifactId&gt;</span>lombok<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;scope&gt;</span>provided<span class="nt">&lt;/scope&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="c">&lt;!--test--&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-test<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependencies&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;build&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;plugins&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;plugin&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;artifactId&gt;</span>spring-boot-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/plugin&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/plugins&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/build&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="applicationyml">application.yml
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yml" data-lang="yml"><span class="line"><span class="cl"><span class="nt">server</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">9001</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spring</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">application</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nacos-payment-provider</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">cloud</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">nacos</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">discovery</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">server-addr</span><span class="p">:</span><span class="w"> </span><span class="l">localhost:8848 </span><span class="w"> </span><span class="c"># 配置nacos的地址</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">sentinel</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">transport</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">dashboard</span><span class="p">:</span><span class="w"> </span><span class="l">localhost:8080 </span><span class="w"> </span><span class="c"># Sentinel dashboard控制台房屋地址（让8080端口的Sentinel将此服务器纳入流量管理）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">8719</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="main9001">Main9001
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@SpringBootApplication</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Main9001</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">SpringApplication</span><span class="p">.</span><span class="na">run</span><span class="p">(</span><span class="n">Main9001</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="controllerpayalibabacontroller">controller.PayAlibabaController
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RestController</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&#34;/pay&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">PayAlibabaController</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Value</span><span class="p">(</span><span class="s">&#34;${server.port}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">serverPort</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/nacos/{id}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getPayInfo</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&#34;id&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;nacos registry, serverPort：&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">serverPort</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;\t id &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">id</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/nacos/get/{orderNo}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@SentinelResource</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;getPayByOrderNo&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">blockHandler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;handlerBlockHandler&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ResultData</span><span class="w"> </span><span class="nf">getPayByOrderNo</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&#34;orderNo&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">orderNo</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 模拟从数据库查询出数据并赋值给DTO</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">PayDTO</span><span class="w"> </span><span class="n">payDTO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">PayDTO</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">payDTO</span><span class="p">.</span><span class="na">setId</span><span class="p">(</span><span class="n">1024</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">payDTO</span><span class="p">.</span><span class="na">setOrderNo</span><span class="p">(</span><span class="n">orderNo</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">payDTO</span><span class="p">.</span><span class="na">setAmount</span><span class="p">(</span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">9</span><span class="p">.</span><span class="na">9</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">payDTO</span><span class="p">.</span><span class="na">setPayNo</span><span class="p">(</span><span class="s">&#34;pay:&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">IdUtil</span><span class="p">.</span><span class="na">fastUUID</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">payDTO</span><span class="p">.</span><span class="na">setUserId</span><span class="p">(</span><span class="n">1</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ResultData</span><span class="p">.</span><span class="na">success</span><span class="p">(</span><span class="s">&#34;查询返回值：&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">payDTO</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ResultData</span><span class="w"> </span><span class="nf">handlerBlockHandler</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&#34;orderNo&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">orderNo</span><span class="p">,</span><span class="w"> </span><span class="n">BlockException</span><span class="w"> </span><span class="n">exception</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ResultData</span><span class="p">.</span><span class="na">fail</span><span class="p">(</span><span class="n">ReturnCodeEnum</span><span class="p">.</span><span class="na">RC500</span><span class="p">.</span><span class="na">getCode</span><span class="p">(),</span><span class="w"> </span><span class="s">&#34;getPayByOrderNo服务不可用，触发Sentinel流控配置规则&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="cloudalibaba-consumer-order83resttemplateopenfeign">cloudalibaba-consumer-order83（RestTemplate、OpenFeign）
</h2><h3 id="pom-9">pom
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependencies&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- 引入自己定义的api通用包 --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>com.xz.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>cloud-api-commons<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--openfeign--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-openfeign<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--alibaba-sentinel--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>com.alibaba.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-alibaba-sentinel<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--nacos-discovery--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>com.alibaba.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--loadbalancer--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-loadbalancer<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--web + actuator--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-actuator<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--lombok--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.projectlombok<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>lombok<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependencies&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">&lt;build&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;plugins&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;plugin&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;artifactId&gt;</span>spring-boot-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/plugin&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/plugins&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/build&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="applicationyml-1">application.yml
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yml" data-lang="yml"><span class="line"><span class="cl"><span class="nt">server</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">83</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spring</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">application</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nacos-order-consumer</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">cloud</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">nacos</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">discovery</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">server-addr</span><span class="p">:</span><span class="w"> </span><span class="l">localhost:8848 </span><span class="w"> </span><span class="c"># 配置nacos的地址</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># 消费者将要去访问的微服务名称（nacos微服务提供者叫什么就写什么）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">service-url</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">nacos-user-service</span><span class="p">:</span><span class="w"> </span><span class="l">http://nacos-payment-provider</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># 激活Sentinel对Feign的支持</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">feign</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">sentinel</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="main83">Main83
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@SpringBootApplication</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@EnableFeignClients</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Main83</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">SpringApplication</span><span class="p">.</span><span class="na">run</span><span class="p">(</span><span class="n">Main83</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="configresttemplate">config.RestTemplate
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Configuration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">RestTemplateConfig</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Bean</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@LoadBalanced</span><span class="w">  </span><span class="c1">// 使RestTemplate具有负载均衡的能力</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">RestTemplate</span><span class="w"> </span><span class="nf">restTemplate</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RestTemplate</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="controllerorderalibabacontroller">controller.OrderAlibabaController
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RestController</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&#34;/order&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">OrderAlibabaController</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Resource</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">RestTemplate</span><span class="w"> </span><span class="n">restTemplate</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Value</span><span class="p">(</span><span class="s">&#34;${service-url.nacos-user-service}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">serverURL</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/nacos/{id}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">paymentInfo</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&#34;id&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">restTemplate</span><span class="p">.</span><span class="na">getForObject</span><span class="p">(</span><span class="n">serverURL</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;/pay/nacos/&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;\t&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;      此乃OrderNacosController83调用者&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// ============================================================================================</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Resource</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">PayFeignSentinelApi</span><span class="w"> </span><span class="n">payFeignSentinelApi</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/pay/nacos/get/{orderNo}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ResultData</span><span class="w"> </span><span class="nf">getPayByOrderNo</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&#34;orderNo&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">orderNo</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">payFeignSentinelApi</span><span class="p">.</span><span class="na">getPayByOrderNo</span><span class="p">(</span><span class="n">orderNo</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="cloudalibaba-config-nacos-client3377加载nacos服务中心配置">cloudalibaba-config-nacos-client3377（加载Nacos服务中心配置）
</h2><h3 id="pom-10">pom
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="c">&lt;!-- 服务配置中心 --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependencies&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--bootstrap--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-bootstrap<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--nacos-config--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>com.alibaba.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--nacos-discovery--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>com.alibaba.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--web + actuator--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-actuator<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--lombok--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.projectlombok<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>lombok<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependencies&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">&lt;build&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;plugins&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;plugin&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;artifactId&gt;</span>spring-boot-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/plugin&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/plugins&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/build&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="yml-3">yml
</h3><h4 id="bootstrappom需要引入nacos-configbootstrap">bootstrap：pom需要引入nacos-config、bootstrap
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yml" data-lang="yml"><span class="line"><span class="cl"><span class="c"># 服务配置中心Nacos配置</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spring</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">application</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nacos-config-client</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">cloud</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">nacos</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">discovery</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">server-addr</span><span class="p">:</span><span class="w"> </span><span class="l">localhost:8848 </span><span class="w"> </span><span class="c"># Nacos服务注册中心地址</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">config</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">server-addr</span><span class="p">:</span><span class="w"> </span><span class="l">localhost:8848 </span><span class="w"> </span><span class="c"># Nacos作为配置中心地址</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">file-extension</span><span class="p">:</span><span class="w"> </span><span class="l">yaml </span><span class="w"> </span><span class="c"># 指定yaml格式的配置</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="l">PROD_GROUP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">a71156c4-a112-4cee-a7ed-a06773090e67</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># Nacos端配置文件DataId命名规则：</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># ${spring.application.name}-${spring.profiles.active}.${spring.cloud.nacos.config.file-extension}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># 本案例写进Nacos配置管理-配置列表的DataId是：nacos-config-client-dev.yaml（应用名-环境.扩展名）</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="application-1">application
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yml" data-lang="yml"><span class="line"><span class="cl"><span class="nt">server</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">3377</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spring</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">profiles</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">active</span><span class="p">:</span><span class="w"> </span><span class="l">prod </span><span class="w"> </span><span class="c"># 开发环境</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># prod 生产环境  test 测试环境</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="main3377">Main3377
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@SpringBootApplication</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Main3377</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">SpringApplication</span><span class="p">.</span><span class="na">run</span><span class="p">(</span><span class="n">Main3377</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="controllernacosconfigclientcontroller">controller.NacosConfigClientController
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RestController</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@RefreshScope</span><span class="w">  </span><span class="c1">// 使当前类下的配置支持Nacos动态刷新功能</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&#34;/config&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">NacosConfigClientController</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Value</span><span class="p">(</span><span class="s">&#34;${config.info}&#34;</span><span class="p">)</span><span class="w">  </span><span class="c1">// 从Nacos服务配置中心中的nacos-config-client-dev.yaml配置文件获取</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">configInfo</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/info&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getConfigInfo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">configInfo</span><span class="p">;</span><span class="w">  </span><span class="c1">// welcome to xz, nacos-config-client-dev.yaml, version=1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="cloudalibaba-sentinel-service8401">cloudalibaba-sentinel-service8401
</h2><h3 id="pom-11">pom
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependencies&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--SpringCloud alibaba sentinel --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>com.alibaba.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-alibaba-sentinel<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--nacos-discovery--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>com.alibaba.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--SpringCloud ailibaba sentinel-datasource-nacos --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>com.alibaba.csp<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>sentinel-datasource-nacos<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- 引入自己定义的api通用包 --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>com.xz.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>cloud-api-commons<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--SpringBoot通用依赖模块--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-actuator<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--hutool--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>cn.hutool<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>hutool-all<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--lombok--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.projectlombok<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>lombok<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;scope&gt;</span>provided<span class="nt">&lt;/scope&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--test--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-test<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependencies&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">&lt;build&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;plugins&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;plugin&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;artifactId&gt;</span>spring-boot-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/plugin&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/plugins&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/build&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="applicationyml-2">application.yml
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yml" data-lang="yml"><span class="line"><span class="cl"><span class="nt">server</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">8401</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spring</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">application</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">cloudalibaba-sentinel-service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">cloud</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">nacos</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">discovery</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">server-addr</span><span class="p">:</span><span class="w"> </span><span class="l">localhost:8848 </span><span class="w"> </span><span class="c"># 配置nacos的地址</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">sentinel</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">transport</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">dashboard</span><span class="p">:</span><span class="w"> </span><span class="l">localhost:8080 </span><span class="w"> </span><span class="c"># 配置sentinel dashboard控制台服务器地址</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">8719</span><span class="w">  </span><span class="c"># 默认8719端口，假如被占用会自动从8719开始一次+1扫描，直到找到未被占用的端口为止（应用所在机器新开8719端口，与控制台8080进行交互）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">web-context-unify</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">  </span><span class="c"># controller的方法对service调用不认为是同一条链路（链路限流测试）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">datasource</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">ds1</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">nacos</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">server-addr</span><span class="p">:</span><span class="w"> </span><span class="l">localhost:8848</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">data-id</span><span class="p">:</span><span class="w"> </span><span class="l">${spring.application.name}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">group-id</span><span class="p">:</span><span class="w"> </span><span class="l">DEFAULT_GROUP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">data-type</span><span class="p">:</span><span class="w"> </span><span class="l">json</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">rule-type</span><span class="p">:</span><span class="w"> </span><span class="l">flow</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="main8401">Main8401
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@SpringBootApplication</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Main8401</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">SpringApplication</span><span class="p">.</span><span class="na">run</span><span class="p">(</span><span class="n">Main8401</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="n">args</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="handlermyrequestoriginparser">handler.MyRequestOriginParser
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Component</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MyRequestOriginParser</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">RequestOriginParser</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">parseOrigin</span><span class="p">(</span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">getParameter</span><span class="p">(</span><span class="s">&#34;serverName&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="serviceflowlimitservice">service.FlowLimitService
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">FlowLimitService</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@SentinelResource</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;common&#34;</span><span class="p">)</span><span class="w">  </span><span class="c1">// sentinel中的资源名</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">common</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;---------------FlowLimitService come in&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="n">Spring</span><span class="w"> </span><span class="n">Cloud</span><span class="w"> </span><span class="n">Alibaba</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="controller-2">controller
</h3><h4 id="flowlimitcontroller">FlowLimitController
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RestController</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">FlowLimitController</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/testA&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">testA</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;-------testA-------&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/testB&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">testB</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;-------testB-------&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 流控、链路演示：
</span></span></span><span class="line"><span class="cl"><span class="cm">     * C和D请求都访问flowLimitService.common()，阈值达到后对C限流，不管D
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Resource</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">FlowLimitService</span><span class="w"> </span><span class="n">flowLimitService</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/testC&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">testC</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">flowLimitService</span><span class="p">.</span><span class="na">common</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;-------testC-------&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/testD&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">testD</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">flowLimitService</span><span class="p">.</span><span class="na">common</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;-------testD-------&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/testE&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">testE</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;      testE，排队等待&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;-------testE-------&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/testF&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">testF</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">TimeUnit</span><span class="p">.</span><span class="na">SECONDS</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="n">1</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">InterruptedException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;      testF，熔断规则—慢调用比例&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;-------testF-------&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/testG&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">testG</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">10</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">0</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;      testG，熔断规则—异常比例&#34;</span><span class="p">);</span><span class="w">  </span><span class="c1">// 如果GlobalExceptionHandler全局异常存在，会被捕获处理成返回，不算接口返回异常（不会触发异常比例熔断）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;-------testG-------&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/testH&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">testH</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">10</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">0</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;      testH，熔断规则—异常数&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;-------testH-------&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="ratelimitcontroller">RateLimitController
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RestController</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Slf4j</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">RateLimitController</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/rateLimit/byUrl&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">byUrl</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;按rest地址限流测试&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/rateLimit/byResource&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@SentinelResource</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;byResourceSentinelResource&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">blockHandler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;handlerBlockHandler&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">byResource</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;按资源名称限流测试&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">handlerBlockHandler</span><span class="p">(</span><span class="n">BlockException</span><span class="w"> </span><span class="n">blockException</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 返回值类型要与原方法保持一致</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;服务不可用，触发了@SentinelResource&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/rateLimit/doAction/{p1}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@SentinelResource</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;doActionSentinelResource&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">blockHandler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;doActionBlockHandler&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">fallback</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;doActionFallback&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">doAction</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&#34;p1&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">p1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">p1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="s">&#34;p1等于0直接异常&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;doAction&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">doActionBlockHandler</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&#34;p1&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">p1</span><span class="p">,</span><span class="w"> </span><span class="n">BlockException</span><span class="w"> </span><span class="n">blockException</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 参数要在doAction的参数基础上继续添加</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&#34;sentinel配置自定义限流了:{}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">blockException</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;sentinel配置自定义限流了&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">doActionFallback</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&#34;p1&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">p1</span><span class="p">,</span><span class="w"> </span><span class="n">Throwable</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 参数要在doAction的参数基础上继续添加</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&#34;程序逻辑异常了：{}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;程序逻辑异常了&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 热点参数限流
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/testHotKey&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@SentinelResource</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;testHotKey&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">blockHandler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;dealHandler_testHotKey&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">testHotKey</span><span class="p">(</span><span class="nd">@RequestParam</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;p1&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">required</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">p1</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                             </span><span class="nd">@RequestParam</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;p2&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">required</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">p2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;-----------testHotKey&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">dealHandler_testHotKey</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">p1</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">p2</span><span class="p">,</span><span class="w"> </span><span class="n">BlockException</span><span class="w"> </span><span class="n">exception</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;-----------dealHandler_testHotKey&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="empowercontroller">EmpowerController
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RestController</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Slf4j</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">EmpowerController</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/empower&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">requestSentinel</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&#34;测试授权规则&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;测试授权规则&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="cloudalibaba-sentinel-gateway9528sentinelgateway">cloudalibaba-sentinel-gateway9528（Sentinel+Gateway）
</h2><h3 id="pom-12">pom
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependencies&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--gateway--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-gateway<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>com.alibaba.csp<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>sentinel-transport-simple-http<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;version&gt;</span>1.8.6<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>com.alibaba.csp<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>sentinel-spring-cloud-gateway-adapter<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;version&gt;</span>1.8.6<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>javax.annotation<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>javax.annotation-api<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;version&gt;</span>1.3.2<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;scope&gt;</span>compile<span class="nt">&lt;/scope&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--lombok--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.projectlombok<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>lombok<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;scope&gt;</span>provided<span class="nt">&lt;/scope&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependencies&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">&lt;build&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;plugins&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;plugin&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;artifactId&gt;</span>spring-boot-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/plugin&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/plugins&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/build&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="applicationyml-3">application.yml
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yml" data-lang="yml"><span class="line"><span class="cl"><span class="nt">server</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">9528</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spring</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">application</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">cloudalibaba-sentinel-gateway</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">cloud</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">nacos</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">discovery</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">server-addr</span><span class="p">:</span><span class="w"> </span><span class="l">localhost:8848</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">gateway</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">routes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l">pay_route1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">uri</span><span class="p">:</span><span class="w"> </span><span class="l">http://localhost:9001 </span><span class="w"> </span><span class="c"># 若要使用动态路由lb://XXX，网关需要引入loadbalancer</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">predicates</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="l">Path=/pay/**</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="main">Main
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@SpringBootApplication</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Main</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">SpringApplication</span><span class="p">.</span><span class="na">run</span><span class="p">(</span><span class="n">Main</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="configgatewayconfiguration">config.GatewayConfiguration
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * Sentinel提供Spring Cloud Gateway的适配模块，可以提供两种资源维度的限流
</span></span></span><span class="line"><span class="cl"><span class="cm"> * （1）route维度：即在Spring配置文件中配置路由条目，资源名为对应的route Id
</span></span></span><span class="line"><span class="cl"><span class="cm"> * （2）自定义API维度：用户可以用Sentinel提供的API来自定义一些API分组
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Configuration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">GatewayConfiguration</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">ViewResolver</span><span class="o">&gt;</span><span class="w"> </span><span class="n">viewResolvers</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">ServerCodecConfigurer</span><span class="w"> </span><span class="n">serverCodecConfigurer</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">GatewayConfiguration</span><span class="p">(</span><span class="n">ObjectProvider</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">ViewResolver</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">viewResolversProvider</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="n">ServerCodecConfigurer</span><span class="w"> </span><span class="n">serverCodecConfigurer</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">viewResolvers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewResolversProvider</span><span class="p">.</span><span class="na">getIfAvailable</span><span class="p">(</span><span class="n">Collections</span><span class="p">::</span><span class="n">emptyList</span><span class="p">);</span><span class="w">  </span><span class="c1">// 视图</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">serverCodecConfigurer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">serverCodecConfigurer</span><span class="p">;</span><span class="w">  </span><span class="c1">// 编码器</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Bean</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Order</span><span class="p">(</span><span class="n">Ordered</span><span class="p">.</span><span class="na">HIGHEST_PRECEDENCE</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">SentinelGatewayBlockExceptionHandler</span><span class="w"> </span><span class="nf">sentinelGatewayBlockExceptionHandler</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// Register the block exception handler for Spring Cloud Gateway</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SentinelGatewayBlockExceptionHandler</span><span class="p">(</span><span class="n">viewResolvers</span><span class="p">,</span><span class="w"> </span><span class="n">serverCodecConfigurer</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Bean</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Order</span><span class="p">(</span><span class="o">-</span><span class="n">1</span><span class="p">)</span><span class="w">  </span><span class="c1">// 最先加载，把Sentinel的处理逻辑作为Gateway的第一个过滤器来使用</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">GlobalFilter</span><span class="w"> </span><span class="nf">sentinelGatewayFilter</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SentinelGatewayFilter</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@PostConstruct</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 标记一个方法，该方法将在类的实例化和依赖注入（例如使用 Spring 框架时）完成之后自动执行。换句话说，@PostConstruct 注解的方法会在对象的所有依赖被注入之后执行，但在该对象的任何其他方法被调用之前。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 用于进行一些初始化操作，例如资源加载、配置校验或初始化外部服务等。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 要求：注解的方法不能有参数、该方法必须是 void 类型</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">doInit</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">initBlockHandler</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 处理+自定义返回的例外信息内容，类似于触发了流控规则保护
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">initBlockHandler</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Set</span><span class="o">&lt;</span><span class="n">GatewayFlowRule</span><span class="o">&gt;</span><span class="w"> </span><span class="n">rules</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashSet</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">  </span><span class="c1">// 网关流量规则集合</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">rules</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">GatewayFlowRule</span><span class="p">(</span><span class="s">&#34;pay_route1&#34;</span><span class="p">).</span><span class="na">setCount</span><span class="p">(</span><span class="n">2</span><span class="p">).</span><span class="na">setIntervalSec</span><span class="p">(</span><span class="n">1</span><span class="p">));</span><span class="w">  </span><span class="c1">// 添加限流规则：1s内访问阈值为2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">GatewayRuleManager</span><span class="p">.</span><span class="na">loadRules</span><span class="p">(</span><span class="n">rules</span><span class="p">);</span><span class="w">  </span><span class="c1">// 添加至网关规则管理器</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">BlockRequestHandler</span><span class="w"> </span><span class="n">handler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BlockRequestHandler</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kd">public</span><span class="w"> </span><span class="n">Mono</span><span class="o">&lt;</span><span class="n">ServerResponse</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">handleRequest</span><span class="p">(</span><span class="n">ServerWebExchange</span><span class="w"> </span><span class="n">serverWebExchange</span><span class="p">,</span><span class="w"> </span><span class="n">Throwable</span><span class="w"> </span><span class="n">throwable</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">map</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&#34;errorCode&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">TOO_MANY_REQUESTS</span><span class="p">.</span><span class="na">getReasonPhrase</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">map</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&#34;errorMessage&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;请求太过频繁，系统忙不过来，触发限流...&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">ServerResponse</span><span class="p">.</span><span class="na">status</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">TOO_MANY_REQUESTS</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="p">.</span><span class="na">contentType</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="p">.</span><span class="na">body</span><span class="p">(</span><span class="n">BodyInserters</span><span class="p">.</span><span class="na">fromValue</span><span class="p">(</span><span class="n">map</span><span class="p">));</span><span class="w">  </span><span class="c1">// 设置HTTP返回的消息</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">GatewayCallbackManager</span><span class="p">.</span><span class="na">setBlockHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="seata-order-service2001">seata-order-service2001
</h2><h3 id="pom-13">pom
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span><span class="lnt">94
</span><span class="lnt">95
</span><span class="lnt">96
</span><span class="lnt">97
</span><span class="lnt">98
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependencies&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- nacos --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>com.alibaba.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--alibaba-seata--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>com.alibaba.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-alibaba-seata<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--openfeign--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-openfeign<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--loadbalancer--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-loadbalancer<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--cloud-api-commons--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>com.xz.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>cloud-api-commons<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--web + actuator--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-actuator<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--SpringBoot集成druid连接池--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>com.alibaba<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>druid-spring-boot-starter<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- Swagger3 调用方式 http://你的主机IP地址:5555/swagger-ui/index.html --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.springdoc<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>springdoc-openapi-starter-webmvc-ui<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--mybatis和springboot整合--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.mybatis.spring.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>mybatis-spring-boot-starter<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--Mysql数据库驱动8 --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>mysql<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>mysql-connector-java<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--persistence--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>javax.persistence<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>persistence-api<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--通用Mapper4--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>tk.mybatis<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>mapper<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--hutool--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>cn.hutool<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>hutool-all<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- fastjson2 --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>com.alibaba.fastjson2<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>fastjson2<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--lombok--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.projectlombok<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>lombok<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;scope&gt;</span>provided<span class="nt">&lt;/scope&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--test--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-test<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependencies&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">&lt;build&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;plugins&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;plugin&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;artifactId&gt;</span>spring-boot-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/plugin&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/plugins&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/build&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="applicationyml-4">application.yml
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yml" data-lang="yml"><span class="line"><span class="cl"><span class="nt">server</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">2001</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spring</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">application</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">seata-order-service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">cloud</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">nacos</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">discovery</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">server-addr</span><span class="p">:</span><span class="w"> </span><span class="l">localhost:8848        </span><span class="w"> </span><span class="c">#Nacos服务注册中心地址</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c"># ==========applicationName + druid-mysql8 driver===================</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">datasource</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">com.alibaba.druid.pool.DruidDataSource</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">driver-class-name</span><span class="p">:</span><span class="w"> </span><span class="l">com.mysql.cj.jdbc.Driver</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">jdbc:mysql://localhost:3306/seata_order?characterEncoding=utf8&amp;useSSL=false&amp;serverTimezone=GMT%2B8&amp;rewriteBatchedStatements=true&amp;allowPublicKeyRetrieval=true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l">root</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="m">527644117</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># ========================mybatis===================</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">mybatis</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">mapper-locations</span><span class="p">:</span><span class="w"> </span><span class="l">classpath:mapper/*.xml </span><span class="w"> </span><span class="c"># 扫描resource下的接口xml具体实现</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">type-aliases-package</span><span class="p">:</span><span class="w"> </span><span class="l">com.xz.cloud.entities</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">configuration</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">map-underscore-to-camel-case</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># ========================seata===================</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">seata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">registry</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">nacos</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">nacos</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">server-addr</span><span class="p">:</span><span class="w"> </span><span class="m">127.0.0.1</span><span class="p">:</span><span class="m">8848</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;&#34;</span><span class="w">  </span><span class="c"># 不写默认public</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="l">SEATA_GROUP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">application</span><span class="p">:</span><span class="w"> </span><span class="l">seata-server </span><span class="w"> </span><span class="c"># 就相当于Data Id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">tx-service-group</span><span class="p">:</span><span class="w"> </span><span class="l">default_tx_group</span><span class="w"> </span><span class="c"># 事务组，由它获得TC服务的集群名称</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">service</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">vgroup-mapping</span><span class="p">:</span><span class="w"> </span><span class="c"># 点击源码分析</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">default_tx_group</span><span class="p">:</span><span class="w"> </span><span class="l">default</span><span class="w"> </span><span class="c"># 事务组与TC服务集群的映射关系</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">data-source-proxy-mode</span><span class="p">:</span><span class="w"> </span><span class="l">AT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">logging</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">level</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">io</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">seata</span><span class="p">:</span><span class="w"> </span><span class="l">info </span><span class="w"> </span><span class="c"># seata的日志级别</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="seataordermainapp2001">SeataOrderMainApp2001
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@SpringBootApplication</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@MapperScan</span><span class="p">(</span><span class="s">&#34;/com.xz.springcloud.mapper&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@EnableFeignClients</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SeataOrderMainApp2001</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">SpringApplication</span><span class="p">.</span><span class="na">run</span><span class="p">(</span><span class="n">SeataOrderMainApp2001</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="entitiesorder">entities.Order
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 表名：t_order
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Table</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;t_order&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@ToString</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Order</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Serializable</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GeneratedValue</span><span class="p">(</span><span class="n">generator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;JDBC&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">id</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 用户id
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;user_id&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">userId</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 产品id
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;product_id&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">productId</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 数量
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">count</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 金额
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">money</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 订单状态: 0:创建中; 1:已完结
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">status</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return id
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="nf">getId</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">id</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param id
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setId</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">id</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 获取用户id
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return userId - 用户id
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="nf">getUserId</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">userId</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 设置用户id
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param userId 用户id
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setUserId</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">userId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">userId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">userId</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 获取产品id
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return productId - 产品id
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="nf">getProductId</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">productId</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 设置产品id
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param productId 产品id
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setProductId</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">productId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">productId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">productId</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 获取数量
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return count - 数量
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="nf">getCount</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">count</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 设置数量
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param count 数量
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setCount</span><span class="p">(</span><span class="n">Integer</span><span class="w"> </span><span class="n">count</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">count</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 获取金额
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return money - 金额
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="nf">getMoney</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">money</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 设置金额
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param money 金额
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setMoney</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">money</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">money</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">money</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 获取订单状态: 0:创建中; 1:已完结
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return status - 订单状态: 0:创建中; 1:已完结
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="nf">getStatus</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">status</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 设置订单状态: 0:创建中; 1:已完结
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param status 订单状态: 0:创建中; 1:已完结
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setStatus</span><span class="p">(</span><span class="n">Integer</span><span class="w"> </span><span class="n">status</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">status</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="mapper">mapper
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">OrderMapper</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Mapper</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">&lt;?</span><span class="n">xml</span><span class="w"> </span><span class="n">version</span><span class="o">=</span><span class="s">&#34;1.0&#34;</span><span class="w"> </span><span class="n">encoding</span><span class="o">=</span><span class="s">&#34;UTF-8&#34;</span><span class="o">?&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">&lt;!</span><span class="n">DOCTYPE</span><span class="w"> </span><span class="n">mapper</span><span class="w"> </span><span class="n">PUBLIC</span><span class="w"> </span><span class="s">&#34;-//mybatis.org//DTD Mapper 3.0//EN&#34;</span><span class="w"> </span><span class="s">&#34;http://mybatis.org/dtd/mybatis-3-mapper.dtd&#34;</span><span class="o">&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">&lt;</span><span class="n">mapper</span><span class="w"> </span><span class="n">namespace</span><span class="o">=</span><span class="s">&#34;com.xz.springcloud.mapper.OrderMapper&#34;</span><span class="o">&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">&lt;</span><span class="n">resultMap</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="s">&#34;BaseResultMap&#34;</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s">&#34;com.xz.springcloud.entities.Order&#34;</span><span class="o">&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">&lt;!--</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="n">WARNING</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nd">@mbg.generated</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">--&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">&lt;</span><span class="n">id</span><span class="w"> </span><span class="n">column</span><span class="o">=</span><span class="s">&#34;id&#34;</span><span class="w"> </span><span class="n">jdbcType</span><span class="o">=</span><span class="s">&#34;BIGINT&#34;</span><span class="w"> </span><span class="n">property</span><span class="o">=</span><span class="s">&#34;id&#34;</span><span class="w"> </span><span class="o">/&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">&lt;</span><span class="n">result</span><span class="w"> </span><span class="n">column</span><span class="o">=</span><span class="s">&#34;user_id&#34;</span><span class="w"> </span><span class="n">jdbcType</span><span class="o">=</span><span class="s">&#34;BIGINT&#34;</span><span class="w"> </span><span class="n">property</span><span class="o">=</span><span class="s">&#34;userId&#34;</span><span class="w"> </span><span class="o">/&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">&lt;</span><span class="n">result</span><span class="w"> </span><span class="n">column</span><span class="o">=</span><span class="s">&#34;product_id&#34;</span><span class="w"> </span><span class="n">jdbcType</span><span class="o">=</span><span class="s">&#34;BIGINT&#34;</span><span class="w"> </span><span class="n">property</span><span class="o">=</span><span class="s">&#34;productId&#34;</span><span class="w"> </span><span class="o">/&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">&lt;</span><span class="n">result</span><span class="w"> </span><span class="n">column</span><span class="o">=</span><span class="s">&#34;count&#34;</span><span class="w"> </span><span class="n">jdbcType</span><span class="o">=</span><span class="s">&#34;INTEGER&#34;</span><span class="w"> </span><span class="n">property</span><span class="o">=</span><span class="s">&#34;count&#34;</span><span class="w"> </span><span class="o">/&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">&lt;</span><span class="n">result</span><span class="w"> </span><span class="n">column</span><span class="o">=</span><span class="s">&#34;money&#34;</span><span class="w"> </span><span class="n">jdbcType</span><span class="o">=</span><span class="s">&#34;DECIMAL&#34;</span><span class="w"> </span><span class="n">property</span><span class="o">=</span><span class="s">&#34;money&#34;</span><span class="w"> </span><span class="o">/&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">&lt;</span><span class="n">result</span><span class="w"> </span><span class="n">column</span><span class="o">=</span><span class="s">&#34;status&#34;</span><span class="w"> </span><span class="n">jdbcType</span><span class="o">=</span><span class="s">&#34;INTEGER&#34;</span><span class="w"> </span><span class="n">property</span><span class="o">=</span><span class="s">&#34;status&#34;</span><span class="w"> </span><span class="o">/&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">&lt;/</span><span class="n">resultMap</span><span class="o">&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">&lt;/</span><span class="n">mapper</span><span class="o">&gt;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="service-1">service
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">OrderService</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 创建订单
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param order
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span><span class="n">Order</span><span class="w"> </span><span class="n">order</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Slf4j</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">OrderServiceImpl</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">OrderService</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Resource</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">OrderMapper</span><span class="w"> </span><span class="n">orderMapper</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Resource</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">StorageFeignApi</span><span class="w"> </span><span class="n">storageFeignApi</span><span class="p">;</span><span class="w">  </span><span class="c1">// 库存微服务</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Resource</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">AccountFeignAPi</span><span class="w"> </span><span class="n">accountFeignAPi</span><span class="p">;</span><span class="w">  </span><span class="c1">// 账户微服务</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GlobalTransactional</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;zzyy-create-order&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">rollbackFor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Exception</span><span class="p">.</span><span class="na">class</span><span class="p">)</span><span class="w">  </span><span class="c1">// AT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span><span class="n">Order</span><span class="w"> </span><span class="n">order</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 全局事务ID的检查，重要！</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">xid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RootContext</span><span class="p">.</span><span class="na">getXID</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 1、新建订单</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&#34;------------ 开始新建订单：&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;\t&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;xid：&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xid</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 订单新建时默认初始订单状态是0，创建中</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">order</span><span class="p">.</span><span class="na">setStatus</span><span class="p">(</span><span class="n">0</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orderMapper</span><span class="p">.</span><span class="na">insertSelective</span><span class="p">(</span><span class="n">order</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 插入订单成功后获得插入mysql的实体对象</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Order</span><span class="w"> </span><span class="n">orderFromDB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">res</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// 从mySQL查出刚插入的记录</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">orderFromDB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orderMapper</span><span class="p">.</span><span class="na">selectOne</span><span class="p">(</span><span class="n">order</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&#34;---&gt; 新建订单成功，orderFromDB info：&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">orderFromDB</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// 2、扣减库存</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&#34;---&gt; 订单微服务开始调用Storage库存，做扣减count&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">storageFeignApi</span><span class="p">.</span><span class="na">decrease</span><span class="p">(</span><span class="n">orderFromDB</span><span class="p">.</span><span class="na">getProductId</span><span class="p">(),</span><span class="w"> </span><span class="n">orderFromDB</span><span class="p">.</span><span class="na">getCount</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&#34;---&gt; 订单微服务结束调用Storage库存，做扣减完成&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// 3、扣减账户余额</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&#34;---&gt; 订单微服务开始调用Account库存，做扣减money&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">accountFeignAPi</span><span class="p">.</span><span class="na">decrease</span><span class="p">(</span><span class="n">orderFromDB</span><span class="p">.</span><span class="na">getUserId</span><span class="p">(),</span><span class="w"> </span><span class="n">order</span><span class="p">.</span><span class="na">getMoney</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&#34;---&gt; 订单微服务结束调用Account库存，做扣减完成&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// 4、修改订单状态为已完结再更新</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&#34;---&gt; 修改订单状态&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">orderFromDB</span><span class="p">.</span><span class="na">setStatus</span><span class="p">(</span><span class="n">1</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Example</span><span class="w"> </span><span class="n">whereCondition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Example</span><span class="p">(</span><span class="n">Order</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Example</span><span class="p">.</span><span class="na">Criteria</span><span class="w"> </span><span class="n">criteria</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">whereCondition</span><span class="p">.</span><span class="na">createCriteria</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">criteria</span><span class="p">.</span><span class="na">andEqualTo</span><span class="p">(</span><span class="s">&#34;userId&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">orderFromDB</span><span class="p">.</span><span class="na">getUserId</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">criteria</span><span class="p">.</span><span class="na">andEqualTo</span><span class="p">(</span><span class="s">&#34;status&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">0</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">updateResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orderMapper</span><span class="p">.</span><span class="na">updateByExampleSelective</span><span class="p">(</span><span class="n">orderFromDB</span><span class="p">,</span><span class="w"> </span><span class="n">whereCondition</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&#34;---&gt; 修改订单状态完成&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;\t&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">updateResult</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&#34;---&gt; orderFromDB info：&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">orderFromDB</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&#34;------------ 结束新建订单：&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;\t&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;xid：&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xid</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="controllerordercontroller-1">controller.OrderController
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RestController</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">OrderController</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Resource</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">OrderService</span><span class="w"> </span><span class="n">orderService</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/order/create&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ResultData</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span><span class="n">Order</span><span class="w"> </span><span class="n">order</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">orderService</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">order</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ResultData</span><span class="p">.</span><span class="na">success</span><span class="p">(</span><span class="n">order</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="seata-storage-service2002">seata-storage-service2002
</h2><h3 id="pom同2001">pom（同2001）
</h3><h3 id="applicationyml修改serverportspringapplicationnamespringdatasourceurl">application.yml（修改server.port、spring.application.name、spring.datasource.url）
</h3><h3 id="seatastoragemainapp2002">SeataStorageMainApp2002
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@SpringBootApplication</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@MapperScan</span><span class="p">(</span><span class="s">&#34;com.xz.springcloud.mapper&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@EnableFeignClients</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SeataStorageMainApp2002</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">SpringApplication</span><span class="p">.</span><span class="na">run</span><span class="p">(</span><span class="n">SeataStorageMainApp2002</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="entitiesstorage">entities.Storage
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 表名：t_storage
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Table</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;t_storage&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@ToString</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Storage</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Serializable</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GeneratedValue</span><span class="p">(</span><span class="n">generator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;JDBC&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">id</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 产品id
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;product_id&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">productId</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 总库存
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">total</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 已用库存
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">used</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 剩余库存
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">residue</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return id
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="nf">getId</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">id</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param id
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setId</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">id</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 获取产品id
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return productId - 产品id
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="nf">getProductId</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">productId</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 设置产品id
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param productId 产品id
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setProductId</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">productId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">productId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">productId</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 获取总库存
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return total - 总库存
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="nf">getTotal</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">total</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 设置总库存
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param total 总库存
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setTotal</span><span class="p">(</span><span class="n">Integer</span><span class="w"> </span><span class="n">total</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">total</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">total</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 获取已用库存
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return used - 已用库存
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="nf">getUsed</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">used</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 设置已用库存
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param used 已用库存
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setUsed</span><span class="p">(</span><span class="n">Integer</span><span class="w"> </span><span class="n">used</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">used</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">used</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 获取剩余库存
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return residue - 剩余库存
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="nf">getResidue</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">residue</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 设置剩余库存
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param residue 剩余库存
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setResidue</span><span class="p">(</span><span class="n">Integer</span><span class="w"> </span><span class="n">residue</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">residue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">residue</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="mapper-1">mapper
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">StorageMapper</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Mapper</span><span class="o">&lt;</span><span class="n">Storage</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 扣减库存
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param productId
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param count
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">decrease</span><span class="p">(</span><span class="nd">@Param</span><span class="p">(</span><span class="s">&#34;productId&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">productId</span><span class="p">,</span><span class="w"> </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&#34;count&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">count</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">&lt;?</span><span class="n">xml</span><span class="w"> </span><span class="n">version</span><span class="o">=</span><span class="s">&#34;1.0&#34;</span><span class="w"> </span><span class="n">encoding</span><span class="o">=</span><span class="s">&#34;UTF-8&#34;</span><span class="o">?&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">&lt;!</span><span class="n">DOCTYPE</span><span class="w"> </span><span class="n">mapper</span><span class="w"> </span><span class="n">PUBLIC</span><span class="w"> </span><span class="s">&#34;-//mybatis.org//DTD Mapper 3.0//EN&#34;</span><span class="w"> </span><span class="s">&#34;http://mybatis.org/dtd/mybatis-3-mapper.dtd&#34;</span><span class="o">&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">&lt;</span><span class="n">mapper</span><span class="w"> </span><span class="n">namespace</span><span class="o">=</span><span class="s">&#34;com.xz.springcloud.mapper.StorageMapper&#34;</span><span class="o">&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">&lt;</span><span class="n">resultMap</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="s">&#34;BaseResultMap&#34;</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s">&#34;com.xz.springcloud.entities.Storage&#34;</span><span class="o">&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">&lt;!--</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="n">WARNING</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nd">@mbg.generated</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">--&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">&lt;</span><span class="n">id</span><span class="w"> </span><span class="n">column</span><span class="o">=</span><span class="s">&#34;id&#34;</span><span class="w"> </span><span class="n">jdbcType</span><span class="o">=</span><span class="s">&#34;BIGINT&#34;</span><span class="w"> </span><span class="n">property</span><span class="o">=</span><span class="s">&#34;id&#34;</span><span class="w"> </span><span class="o">/&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">&lt;</span><span class="n">result</span><span class="w"> </span><span class="n">column</span><span class="o">=</span><span class="s">&#34;product_id&#34;</span><span class="w"> </span><span class="n">jdbcType</span><span class="o">=</span><span class="s">&#34;BIGINT&#34;</span><span class="w"> </span><span class="n">property</span><span class="o">=</span><span class="s">&#34;productId&#34;</span><span class="w"> </span><span class="o">/&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">&lt;</span><span class="n">result</span><span class="w"> </span><span class="n">column</span><span class="o">=</span><span class="s">&#34;total&#34;</span><span class="w"> </span><span class="n">jdbcType</span><span class="o">=</span><span class="s">&#34;INTEGER&#34;</span><span class="w"> </span><span class="n">property</span><span class="o">=</span><span class="s">&#34;total&#34;</span><span class="w"> </span><span class="o">/&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">&lt;</span><span class="n">result</span><span class="w"> </span><span class="n">column</span><span class="o">=</span><span class="s">&#34;used&#34;</span><span class="w"> </span><span class="n">jdbcType</span><span class="o">=</span><span class="s">&#34;INTEGER&#34;</span><span class="w"> </span><span class="n">property</span><span class="o">=</span><span class="s">&#34;used&#34;</span><span class="w"> </span><span class="o">/&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">&lt;</span><span class="n">result</span><span class="w"> </span><span class="n">column</span><span class="o">=</span><span class="s">&#34;residue&#34;</span><span class="w"> </span><span class="n">jdbcType</span><span class="o">=</span><span class="s">&#34;INTEGER&#34;</span><span class="w"> </span><span class="n">property</span><span class="o">=</span><span class="s">&#34;residue&#34;</span><span class="w"> </span><span class="o">/&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">&lt;/</span><span class="n">resultMap</span><span class="o">&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">&lt;!--</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">decrease</span><span class="p">(</span><span class="nd">@Param</span><span class="p">(</span><span class="s">&#34;productId&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">productId</span><span class="p">,</span><span class="w"> </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&#34;count&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">count</span><span class="p">);</span><span class="w"> </span><span class="o">--&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">&lt;</span><span class="n">update</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="s">&#34;decrease&#34;</span><span class="o">&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">update</span><span class="w"> </span><span class="n">t_storage</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">used</span><span class="o">=</span><span class="n">used</span><span class="o">+</span><span class="err">#</span><span class="p">{</span><span class="n">count</span><span class="p">},</span><span class="w"> </span><span class="n">residue</span><span class="o">=</span><span class="n">residue</span><span class="o">-</span><span class="err">#</span><span class="p">{</span><span class="n">count</span><span class="p">}</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="n">product_id</span><span class="o">=</span><span class="err">#</span><span class="p">{</span><span class="n">productId</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">&lt;/</span><span class="n">update</span><span class="o">&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">&lt;/</span><span class="n">mapper</span><span class="o">&gt;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="service-2">service
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">StorageService</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 扣减库存
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param productId
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param count
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">decrease</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">productId</span><span class="p">,</span><span class="n">Integer</span><span class="w"> </span><span class="n">count</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Slf4j</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">StorageServiceImpl</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">StorageService</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Resource</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">StorageMapper</span><span class="w"> </span><span class="n">storageMapper</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">decrease</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">productId</span><span class="p">,</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">count</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&#34;----&gt; storage-service中扣减库存开始&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">storageMapper</span><span class="p">.</span><span class="na">decrease</span><span class="p">(</span><span class="n">productId</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&#34;----&gt; storage-service中扣减库存结束&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="controllerstoragecontroller">controller.StorageController
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RestController</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">StorageController</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Resource</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">StorageService</span><span class="w"> </span><span class="n">storageService</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/storage/decrease&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ResultData</span><span class="w"> </span><span class="nf">decrease</span><span class="p">(</span><span class="nd">@RequestParam</span><span class="p">(</span><span class="s">&#34;productId&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">productId</span><span class="p">,</span><span class="w"> </span><span class="nd">@RequestParam</span><span class="p">(</span><span class="s">&#34;count&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">count</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">storageService</span><span class="p">.</span><span class="na">decrease</span><span class="p">(</span><span class="n">productId</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ResultData</span><span class="p">.</span><span class="na">success</span><span class="p">(</span><span class="s">&#34;扣减库存成功&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="seata-account-service2003">seata-account-service2003
</h2><h3 id="pom同2001-1">pom（同2001）
</h3><h3 id="applicationyml修改serverportspringapplicationnamespringdatasourceurl-1">application.yml（修改server.port、spring.application.name、spring.datasource.url）
</h3><h3 id="seatastoragemainapp2003">SeataStorageMainApp2003
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@SpringBootApplication</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@MapperScan</span><span class="p">(</span><span class="s">&#34;com.xz.springcloud.mapper&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@EnableFeignClients</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SeataAccountMainApp2003</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">SpringApplication</span><span class="p">.</span><span class="na">run</span><span class="p">(</span><span class="n">SeataAccountMainApp2003</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="entitiesstorage-1">entities.Storage
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 表名：t_account
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Table</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;t_account&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@ToString</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Account</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Serializable</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * id
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GeneratedValue</span><span class="p">(</span><span class="n">generator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;JDBC&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">id</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 用户id
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;user_id&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">userId</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 总额度
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">total</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 已用账户余额
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">used</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 剩余可用额度
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">residue</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 获取id
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return id - id
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="nf">getId</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">id</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 设置id
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param id id
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setId</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">id</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 获取用户id
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return userId - 用户id
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="nf">getUserId</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">userId</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 设置用户id
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param userId 用户id
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setUserId</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">userId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">userId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">userId</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 获取总额度
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return total - 总额度
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="nf">getTotal</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">total</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 设置总额度
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param total 总额度
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setTotal</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">total</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">total</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">total</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 获取已用账户余额
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return used - 已用账户余额
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="nf">getUsed</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">used</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 设置已用账户余额
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param used 已用账户余额
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setUsed</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">used</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">used</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">used</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 获取剩余可用额度
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return residue - 剩余可用额度
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="nf">getResidue</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">residue</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 设置剩余可用额度
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param residue 剩余可用额度
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setResidue</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">residue</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">residue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">residue</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="mapper-2">mapper
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">AccountMapper</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Mapper</span><span class="o">&lt;</span><span class="n">Account</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">decrease</span><span class="p">(</span><span class="nd">@Param</span><span class="p">(</span><span class="s">&#34;userId&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">userId</span><span class="p">,</span><span class="w"> </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&#34;money&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">money</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">&lt;?</span><span class="n">xml</span><span class="w"> </span><span class="n">version</span><span class="o">=</span><span class="s">&#34;1.0&#34;</span><span class="w"> </span><span class="n">encoding</span><span class="o">=</span><span class="s">&#34;UTF-8&#34;</span><span class="o">?&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">&lt;!</span><span class="n">DOCTYPE</span><span class="w"> </span><span class="n">mapper</span><span class="w"> </span><span class="n">PUBLIC</span><span class="w"> </span><span class="s">&#34;-//mybatis.org//DTD Mapper 3.0//EN&#34;</span><span class="w"> </span><span class="s">&#34;http://mybatis.org/dtd/mybatis-3-mapper.dtd&#34;</span><span class="o">&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">&lt;</span><span class="n">mapper</span><span class="w"> </span><span class="n">namespace</span><span class="o">=</span><span class="s">&#34;com.xz.springcloud.mapper.AccountMapper&#34;</span><span class="o">&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">&lt;</span><span class="n">resultMap</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="s">&#34;BaseResultMap&#34;</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s">&#34;com.xz.springcloud.entities.Account&#34;</span><span class="o">&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">&lt;!--</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="n">WARNING</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nd">@mbg.generated</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">--&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">&lt;</span><span class="n">id</span><span class="w"> </span><span class="n">column</span><span class="o">=</span><span class="s">&#34;id&#34;</span><span class="w"> </span><span class="n">jdbcType</span><span class="o">=</span><span class="s">&#34;BIGINT&#34;</span><span class="w"> </span><span class="n">property</span><span class="o">=</span><span class="s">&#34;id&#34;</span><span class="w"> </span><span class="o">/&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">&lt;</span><span class="n">result</span><span class="w"> </span><span class="n">column</span><span class="o">=</span><span class="s">&#34;user_id&#34;</span><span class="w"> </span><span class="n">jdbcType</span><span class="o">=</span><span class="s">&#34;BIGINT&#34;</span><span class="w"> </span><span class="n">property</span><span class="o">=</span><span class="s">&#34;userId&#34;</span><span class="w"> </span><span class="o">/&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">&lt;</span><span class="n">result</span><span class="w"> </span><span class="n">column</span><span class="o">=</span><span class="s">&#34;total&#34;</span><span class="w"> </span><span class="n">jdbcType</span><span class="o">=</span><span class="s">&#34;DECIMAL&#34;</span><span class="w"> </span><span class="n">property</span><span class="o">=</span><span class="s">&#34;total&#34;</span><span class="w"> </span><span class="o">/&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">&lt;</span><span class="n">result</span><span class="w"> </span><span class="n">column</span><span class="o">=</span><span class="s">&#34;used&#34;</span><span class="w"> </span><span class="n">jdbcType</span><span class="o">=</span><span class="s">&#34;DECIMAL&#34;</span><span class="w"> </span><span class="n">property</span><span class="o">=</span><span class="s">&#34;used&#34;</span><span class="w"> </span><span class="o">/&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">&lt;</span><span class="n">result</span><span class="w"> </span><span class="n">column</span><span class="o">=</span><span class="s">&#34;residue&#34;</span><span class="w"> </span><span class="n">jdbcType</span><span class="o">=</span><span class="s">&#34;DECIMAL&#34;</span><span class="w"> </span><span class="n">property</span><span class="o">=</span><span class="s">&#34;residue&#34;</span><span class="w"> </span><span class="o">/&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">&lt;/</span><span class="n">resultMap</span><span class="o">&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">&lt;!--</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">decrease</span><span class="p">(</span><span class="nd">@Param</span><span class="p">(</span><span class="s">&#34;userId&#34;</span><span class="p">)</span><span class="n">Long</span><span class="w"> </span><span class="n">userId</span><span class="p">,</span><span class="nd">@Param</span><span class="p">(</span><span class="s">&#34;money&#34;</span><span class="p">)</span><span class="n">Long</span><span class="w"> </span><span class="n">money</span><span class="p">);</span><span class="w"> </span><span class="o">--&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">&lt;</span><span class="n">update</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="s">&#34;decrease&#34;</span><span class="o">&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">update</span><span class="w"> </span><span class="n">t_account</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">used</span><span class="o">=</span><span class="n">used</span><span class="o">+</span><span class="err">#</span><span class="p">{</span><span class="n">money</span><span class="p">},</span><span class="w"> </span><span class="n">residue</span><span class="o">=</span><span class="n">residue</span><span class="o">-</span><span class="err">#</span><span class="p">{</span><span class="n">money</span><span class="p">}</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="n">user_id</span><span class="o">=</span><span class="err">#</span><span class="p">{</span><span class="n">userId</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">&lt;/</span><span class="n">update</span><span class="o">&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">&lt;/</span><span class="n">mapper</span><span class="o">&gt;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="service-3">service
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">AccountService</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">decrease</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">userId</span><span class="p">,</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">money</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Slf4j</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AccountServiceImpl</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">AccountService</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Resource</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">AccountMapper</span><span class="w"> </span><span class="n">accountMapper</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 扣减账户余额
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param userId
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param money
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">decrease</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">userId</span><span class="p">,</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">money</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&#34;----&gt; account-service中扣减账户余额开始&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">accountMapper</span><span class="p">.</span><span class="na">decrease</span><span class="p">(</span><span class="n">userId</span><span class="p">,</span><span class="w"> </span><span class="n">money</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">myTimeOut</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// int age = 10 / 0;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&#34;----&gt; account-service中扣减账户余额结束&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 模拟超时异常，全局回滚事务
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">myTimeOut</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">TimeUnit</span><span class="p">.</span><span class="na">SECONDS</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="n">65</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="controlleraccountcontroller">controller.AccountController
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RestController</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AccountController</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Resource</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">AccountService</span><span class="w"> </span><span class="n">accountService</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/account/decrease&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ResultData</span><span class="w"> </span><span class="nf">decrease</span><span class="p">(</span><span class="nd">@RequestParam</span><span class="p">(</span><span class="s">&#34;userId&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">userId</span><span class="p">,</span><span class="w"> </span><span class="nd">@RequestParam</span><span class="p">(</span><span class="s">&#34;money&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">money</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">accountService</span><span class="p">.</span><span class="na">decrease</span><span class="p">(</span><span class="n">userId</span><span class="p">,</span><span class="w"> </span><span class="n">money</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ResultData</span><span class="p">.</span><span class="na">success</span><span class="p">(</span><span class="s">&#34;扣减账户余额成功！&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h1 id="spring-cloud-alibaba">Spring Cloud Alibaba
</h1><p><img src="C:%5cUsers%5chp%5cDesktop%5c%e5%bc%80%e5%8f%91%e6%96%87%e6%a1%a3%5cSpringCloud%5cFigure%5cimage-20241211163546231.png"
	
	
	
	loading="lazy"
	
		alt="image-20241211163546231"
	
	
></p>
<h2 id="nacos服务注册与发现--spring-cloud-consul">Nacos：服务注册与发现 = Spring Cloud Consul
</h2><h3 id="四个注册中心异同点">四个注册中心异同点
</h3><p><img src="C:%5cUsers%5chp%5cDesktop%5c%e5%bc%80%e5%8f%91%e6%96%87%e6%a1%a3%5cSpringCloud%5cFigure%5cimage-20241211164129389.png"
	
	
	
	loading="lazy"
	
		alt="image-20241211164129389"
	
	
></p>
<h3 id="cmd指令-2">cmd指令
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cmd" data-lang="cmd"><span class="line"><span class="cl">运行
</span></span><span class="line"><span class="cl">startup.cmd -m standalone
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">打开
</span></span><span class="line"><span class="cl">http://localhost:8848/nacos
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="pom-14">pom
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="c">&lt;!--nacos-discovery  （所有微服务！） --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>com.alibaba.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">&lt;!--loadbalancer  （仅consumer！） --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-loadbalancer<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">&lt;!--bootstrap  （仅服务配置中心！）--&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-bootstrap<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c">&lt;!--nacos-config--&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>com.alibaba.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="在9001的基础上直接拷贝配置运行9002nacos同样支持负载均衡">在9001的基础上直接拷贝配置运行9002（Nacos同样支持负载均衡）
</h3><p><img src="C:%5cUsers%5chp%5cDesktop%5c%e5%bc%80%e5%8f%91%e6%96%87%e6%a1%a3%5cSpringCloud%5cFigure%5cimage-20241211193405725.png"
	
	
	
	loading="lazy"
	
	
></p>
<h3 id="服务配置中心">服务配置中心
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Nacos本身就是持久化的，故不需要像Consul那样进行持久化配置
</span></span><span class="line"><span class="cl">Nacos的数据会持久化到内嵌数据库derby中，可以自行配置持久化到MySQL中
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Nacos同Consul一样，在项目初始化时，要保证先从配置中心进行配置拉取，拉取配置之后，才能保证项目的正常启动，为了满足动态刷新和全局广播通知
</span></span><span class="line"><span class="cl">springboot中配置文件的加载是存在优先级顺序的，bootstrap优先级高于application
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Nacos严格区分yml与yaml
</span></span><span class="line"><span class="cl">修改nacos-config-client-dev.yaml，即可动态刷新获取到最新发布的yaml配置信息
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="实际问题">实际问题
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">问题1：
</span></span><span class="line"><span class="cl">实际开发中，通常一个系统会准备
</span></span><span class="line"><span class="cl">dev开发环境
</span></span><span class="line"><span class="cl">test测试环境
</span></span><span class="line"><span class="cl">prod生产环境
</span></span><span class="line"><span class="cl">如何保证指定环境启动时服务能正确读取到Nacos上相应环境的配置文件呢？
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">问题2：
</span></span><span class="line"><span class="cl">一个大型分布式微服务系统会有很多微服务子项目，
</span></span><span class="line"><span class="cl">每个微服务项目又都会有相应的开发环境、测试环境、预发环境、正式环境......
</span></span><span class="line"><span class="cl">那怎么对这些微服务配置进行分组和命名空间管理呢？
</span></span></code></pre></td></tr></table>
</div>
</div><img src="C:\Users\hp\Desktop\开发文档\SpringCloud\Figure\image-20241211210050101.png" alt="image-20241211210050101" style="zoom:50%;" />
<p><img src="C:%5cUsers%5chp%5cDesktop%5c%e5%bc%80%e5%8f%91%e6%96%87%e6%a1%a3%5cSpringCloud%5cFigure%5cimage-20241211210142204.png"
	
	
	
	loading="lazy"
	
		alt="image-20241211210142204"
	
	
></p>
<h3 id="三种方案加载不同环境下的服务中心yaml配置信息">三种方案加载不同环境下的服务中心yaml配置信息
</h3><h4 id="data-id">Data ID
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">默认空间public+默认分组DEFAULT_GROUP+新建Data ID  修改spring.profiles.active加载相应的配置
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="group">Group
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">默认空间public+新建分组PROD_GROUP+新建Data ID  修改spring.profiles.active、spring.cloud.nacos.config.group加载相应的配置
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="namespace">Namespace
</h4><p><img src="C:%5cUsers%5chp%5cDesktop%5c%e5%bc%80%e5%8f%91%e6%96%87%e6%a1%a3%5cSpringCloud%5cFigure%5cimage-20241212102713747.png"
	
	
	
	loading="lazy"
	
		alt="image-20241212102713747"
	
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">新建命名空间Prod_Namespace（命名空间ID同为Prod_Namespace）+新建分组PROD_GROUP+新建Data ID
</span></span><span class="line"><span class="cl">新建命名空间Prod2_Namespace（命名空间ID不填，自动生成）+新建分组PROD_GROUP+新建Data ID
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">修改spring.profiles.active、spring.cloud.nacos.config.group、spring.cloud.nacos.config.namespace（注意是namespace的ID而不是名字）加载相应的配置
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">eg:
</span></span><span class="line"><span class="cl">Nacos: 
</span></span><span class="line"><span class="cl">命名空间：a71156c4-a112-4cee-a7ed-a06773090e67
</span></span><span class="line"><span class="cl">Group：PROD_GROUP
</span></span><span class="line"><span class="cl">Data ID：nacos-config-client-prod.yaml
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">bootstrap:
</span></span><span class="line"><span class="cl">	group: PROD_GROUP
</span></span><span class="line"><span class="cl">	namespace: a71156c4-a112-4cee-a7ed-a06773090e67
</span></span><span class="line"><span class="cl">application：
</span></span><span class="line"><span class="cl">spring:
</span></span><span class="line"><span class="cl">  profiles:
</span></span><span class="line"><span class="cl">    active: prod  # 开发环境
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="sentinel从流量路由流量控制流量整形熔断降级系统自适应过载保护热点流量防护等多个维度帮助开发者保障微服务的稳定性">Sentinel：从流量路由、流量控制、流量整形、熔断降级、系统自适应过载保护、热点流量防护等多个维度帮助开发者保障微服务的稳定性
</h2><h3 id="流控降级和容错标准">流控降级和容错标准
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Target：针对怎样的流量：按名称划分/按HTTP请求划分，比如针对包含某个特定header的请求/按流量流向（IN/OUT）划分
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Strategy：对应怎样的流量治理策略：流量控制/流量平滑/并发请求控制/熔断器/自适应过载保护
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">FallbackAction：触发后的fallback行为：HTTP请求返回特定的状态码和header、body信息/RPC请求返回特定的返回值或异常/流量调度至其他节点
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="讲讲什么是缓存穿透击穿雪崩如何解决见redis7">讲讲什么是缓存穿透？击穿？雪崩？如何解决？（见redis7）
</h3><h3 id="服务雪崩降级熔断限流隔离超时">服务雪崩/降级/熔断/限流/隔离/超时
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">服务雪崩：一个微小的服务没有做限流以后导致调用和交互出现拖垮全局的情况
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">服务降级：服务兜底方案，如果服务无法完成正常的调用流程，就用默认的兜底方案来返回数据（比如当商品详情页系统出现故障无法调用时，会直接获取缓存中的商品介绍信息返回给前端页面）
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">服务熔断：如果下游服务因为访问压力过大导致响应很慢或者一直调用失败，上游服务为了保证系统的整体可用性，会暂时断开与下游服务的调用连接
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">服务限流：限制进入系统的流量，防止流量过大压垮系统，主要为了保护节点或者集群后面的数据节点。防止瞬时流量过大使服务和数据崩溃；还可用于平滑请求，防止类似秒杀高并发等操作，排队一分钟N个有序进行
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">服务隔离：按一定规则将系统划分多个模块，且各模块之间相互独立，不会存在强依赖关系。如果拆分后的某个服务发生故障，能够将故障产生的影响限制在某个具体服务内，不会向其他服务扩散，也就不会对整体服务产生致命影响（线程池/信号量）
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">服务超时：上游给下游设置一个最大响应时间，如果超过还未能返回结果，则断开上游与下游之间的请求连接，释放资源
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="cmd指令-3">cmd指令
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cmd" data-lang="cmd"><span class="line"><span class="cl">运行
</span></span><span class="line"><span class="cl">java -jar sentinel-dashboard-1.8.8.jar
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">打开
</span></span><span class="line"><span class="cl">http://localhost:8080
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">用户名、密码均为：sentinel
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="pom-15">pom
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="c">&lt;!--SpringCloud alibaba sentinel --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>com.alibaba.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-alibaba-sentinel<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="流控规则阈值类型qps">流控规则—阈值类型—QPS
</h3><h4 id="流控模式">流控模式
</h4><h5 id="直接单机阈值超过阈值就限流">直接、单机阈值：超过阈值就限流
</h5><p><img src="C:%5cUsers%5chp%5cDesktop%5c%e5%bc%80%e5%8f%91%e6%96%87%e6%a1%a3%5cSpringCloud%5cFigure%5cimage-20241212152825840.png"
	
	
	
	loading="lazy"
	
		alt="image-20241212152825840"
	
	
></p>
<h5 id="关联当与a关联的资源b达到阈值后就限流a自己b惹事a挂了防止下游系统出事影响到上游系统">关联：当与A关联的资源B达到阈值后，就限流A自己（B惹事，A挂了，防止下游系统出事影响到上游系统）
</h5><p><img src="C:%5cUsers%5chp%5cDesktop%5c%e5%bc%80%e5%8f%91%e6%96%87%e6%a1%a3%5cSpringCloud%5cFigure%5cimage-20241212153230183.png"
	
	
	
	loading="lazy"
	
		alt="image-20241212153230183"
	
	
></p>
<h6 id="使用jmeter压力测试1s20个请求">使用JMeter压力测试：1s20个请求
</h6><p><img src="C:%5cUsers%5chp%5cDesktop%5c%e5%bc%80%e5%8f%91%e6%96%87%e6%a1%a3%5cSpringCloud%5cFigure%5cimage-20241212154407390.png"
	
	
	
	loading="lazy"
	
		alt="image-20241212154407390"
	
	
></p>
<p><img src="C:%5cUsers%5chp%5cDesktop%5c%e5%bc%80%e5%8f%91%e6%96%87%e6%a1%a3%5cSpringCloud%5cFigure%5cimage-20241212154431445.png"
	
	
	
	loading="lazy"
	
		alt="image-20241212154431445"
	
	
></p>
<h5 id="链路来自不同链路的请求对同一目标访问时实时针对性的不同限流措施比如c请求超过阈值就限流d请求没事看人下菜">链路：来自不同链路的请求对同一目标访问时，实时针对性的不同限流措施，比如C请求超过阈值就限流，D请求没事（看人下菜）
</h5><p><img src="C:%5cUsers%5chp%5cDesktop%5c%e5%bc%80%e5%8f%91%e6%96%87%e6%a1%a3%5cSpringCloud%5cFigure%5cimage-20241212160425764.png"
	
	
	
	loading="lazy"
	
		alt="image-20241212160425764"
	
	
></p>
<h4 id="流控效果">流控效果
</h4><h5 id="直接失败blocked-by-sentinel-flow-limiting">直接失败：Blocked by Sentinel (flow limiting)
</h5><h5 id="warm-up预热时长内为单机阈值3预热时长后逐步增长到单机阈值比如秒杀系统开启的瞬间会有很多流量上来很可能会把系统打死预热方式就能保护系统慢慢地把阈值增长到设置的阈值慢慢地把流量放进来">Warm Up：预热时长内为单机阈值/3，预热时长后逐步增长到单机阈值（比如秒杀系统开启的瞬间会有很多流量上来，很可能会把系统打死，预热方式就能保护系统，慢慢地把阈值增长到设置的阈值，慢慢地把流量放进来）
</h5><p><img src="C:%5cUsers%5chp%5cDesktop%5c%e5%bc%80%e5%8f%91%e6%96%87%e6%a1%a3%5cSpringCloud%5cFigure%5cimage-20241212161352886.png"
	
	
	
	loading="lazy"
	
		alt="image-20241212161352886"
	
	
></p>
<p><img src="C:%5cUsers%5chp%5cDesktop%5c%e5%bc%80%e5%8f%91%e6%96%87%e6%a1%a3%5cSpringCloud%5cFigure%5cimage-20241212162109069.png"
	
	
	
	loading="lazy"
	
		alt="image-20241212162109069"
	
	
></p>
<p><img src="C:%5cUsers%5chp%5cDesktop%5c%e5%bc%80%e5%8f%91%e6%96%87%e6%a1%a3%5cSpringCloud%5cFigure%5cimage-20241212161616094.png"
	
	
	
	loading="lazy"
	
		alt="image-20241212161616094"
	
	
></p>
<h5 id="排队等待削峰填谷1s通过单机阈值个请求超过设定的超时时间的请求作为超时处理放弃与warm-up的区别在于warm-up在预热期间会将超过13阈值的请求直接拒绝而排队等待是不希望拒绝而是继续处理">排队等待：削峰填谷（1s通过单机阈值个请求，超过设定的超时时间的请求作为超时处理，放弃）（与Warm Up的区别在于，Warm Up在预热期间会将超过1/3阈值的请求直接拒绝，而排队等待是不希望拒绝，而是继续处理）
</h5><p><img src="C:%5cUsers%5chp%5cDesktop%5c%e5%bc%80%e5%8f%91%e6%96%87%e6%a1%a3%5cSpringCloud%5cFigure%5cimage-20241212163007441.png"
	
	
	
	loading="lazy"
	
		alt="image-20241212163007441"
	
	
></p>
<p><img src="C:%5cUsers%5chp%5cDesktop%5c%e5%bc%80%e5%8f%91%e6%96%87%e6%a1%a3%5cSpringCloud%5cFigure%5cimage-20241212163718596.png"
	
	
	
	loading="lazy"
	
		alt="image-20241212163718596"
	
	
></p>
<h6 id="使用jmeter压力测试1s20个请求-1">使用JMeter压力测试：1s20个请求
</h6><p><img src="C:%5cUsers%5chp%5cDesktop%5c%e5%bc%80%e5%8f%91%e6%96%87%e6%a1%a3%5cSpringCloud%5cFigure%5cimage-20241212164034982.png"
	
	
	
	loading="lazy"
	
		alt="image-20241212164034982"
	
	
></p>
<h3 id="流控规则阈值类型并发线程数">流控规则—阈值类型—并发线程数
</h3><p><img src="C:%5cUsers%5chp%5cDesktop%5c%e5%bc%80%e5%8f%91%e6%96%87%e6%a1%a3%5cSpringCloud%5cFigure%5cimage-20241212164738318.png"
	
	
	
	loading="lazy"
	
		alt="image-20241212164738318"
	
	
></p>
<h4 id="使用jmeter压力测试1s100个请求循环">使用JMeter压力测试：1s100个请求、循环
</h4><p><img src="C:%5cUsers%5chp%5cDesktop%5c%e5%bc%80%e5%8f%91%e6%96%87%e6%a1%a3%5cSpringCloud%5cFigure%5cimage-20241212165305676.png"
	
	
	
	loading="lazy"
	
		alt="image-20241212165305676"
	
	
></p>
<h3 id="熔断规则">熔断规则
</h3><p><img src="C:%5cUsers%5chp%5cDesktop%5c%e5%bc%80%e5%8f%91%e6%96%87%e6%a1%a3%5cSpringCloud%5cFigure%5cimage-20241212165642322.png"
	
	
	
	loading="lazy"
	
		alt="image-20241212165642322"
	
	
></p>
<p><img src="C:%5cUsers%5chp%5cDesktop%5c%e5%bc%80%e5%8f%91%e6%96%87%e6%a1%a3%5cSpringCloud%5cFigure%5cimage-20241212190416725.png"
	
	
	
	loading="lazy"
	
		alt="image-20241212190416725"
	
	
></p>
<h4 id="慢调用比例1s内至少收集5个请求在这些请求中超过200ms的比例超过01就熔断5s">慢调用比例：1s内，至少收集5个请求，在这些请求中，超过200ms的比例超过0.1，就熔断5s
</h4><p><img src="C:%5cUsers%5chp%5cDesktop%5c%e5%bc%80%e5%8f%91%e6%96%87%e6%a1%a3%5cSpringCloud%5cFigure%5cimage-20241212193233071.png"
	
	
	
	loading="lazy"
	
		alt="image-20241212193233071"
	
	
></p>
<p><img src="C:%5cUsers%5chp%5cDesktop%5c%e5%bc%80%e5%8f%91%e6%96%87%e6%a1%a3%5cSpringCloud%5cFigure%5cimage-20241212193735530.png"
	
	
	
	loading="lazy"
	
		alt="image-20241212193735530"
	
	
></p>
<h5 id="使用jmeter压力测试1s10个请求循环">使用JMeter压力测试：1s10个请求、循环
</h5><p><img src="C:%5cUsers%5chp%5cDesktop%5c%e5%bc%80%e5%8f%91%e6%96%87%e6%a1%a3%5cSpringCloud%5cFigure%5cimage-20241212194330372.png"
	
	
	
	loading="lazy"
	
		alt="image-20241212194330372"
	
	
></p>
<h4 id="异常比例1s内至少收集5个请求在这些请求中出现异常的比例超过02就熔断5s">异常比例：1s内，至少收集5个请求，在这些请求中，出现异常的比例超过0.2，就熔断5s
</h4><p><img src="C:%5cUsers%5chp%5cDesktop%5c%e5%bc%80%e5%8f%91%e6%96%87%e6%a1%a3%5cSpringCloud%5cFigure%5cimage-20241212195922331.png"
	
	
	
	loading="lazy"
	
		alt="image-20241212195922331"
	
	
></p>
<h5 id="使用jmeter压力测试1s20个请求循环">使用JMeter压力测试：1s20个请求、循环
</h5><p><img src="C:%5cUsers%5chp%5cDesktop%5c%e5%bc%80%e5%8f%91%e6%96%87%e6%a1%a3%5cSpringCloud%5cFigure%5cimage-20241212200212582.png"
	
	
	
	loading="lazy"
	
		alt="image-20241212200212582"
	
	
></p>
<h4 id="异常数1s内至少收集5个请求在这些请求中出现异常数量超过1就熔断5s">异常数：1s内，至少收集5个请求，在这些请求中，出现异常数量超过1，就熔断5s
</h4><p><img src="C:%5cUsers%5chp%5cDesktop%5c%e5%bc%80%e5%8f%91%e6%96%87%e6%a1%a3%5cSpringCloud%5cFigure%5cimage-20241212202033839.png"
	
	
	
	loading="lazy"
	
		alt="image-20241212202033839"
	
	
></p>
<h3 id="sentinelresource一个流量防卫防护组件注解用于指定需要被防护的资源对配置的资源进行流量控制熔断降级等功能">@SentinelResource：一个流量防卫防护组件注解，用于指定需要被防护的资源，对配置的资源进行流量控制、熔断降级等功能
</h3><h4 id="不使用此注解按照rest地址限流默认限流返回">不使用此注解，按照REST地址限流+默认限流返回
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/rateLimit/byUrl&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">byUrl</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;按rest地址限流测试&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><img src="C:%5cUsers%5chp%5cDesktop%5c%e5%bc%80%e5%8f%91%e6%96%87%e6%a1%a3%5cSpringCloud%5cFigure%5cimage-20241212205823933.png"
	
	
	
	loading="lazy"
	
		alt="image-20241212205823933"
	
	
></p>
<h4 id="使用此注解按资源名称限流自定义限流返回">使用此注解按资源名称限流，自定义限流返回
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/rateLimit/byResource&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@SentinelResource</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;byResourceSentinelResource&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">blockHandler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;handlerBlockHandler&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">byResource</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;按资源名称限流测试&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">handlerBlockHandler</span><span class="p">(</span><span class="n">BlockException</span><span class="w"> </span><span class="n">blockException</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 返回值类型要与原方法保持一致</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;服务不可用，触发了@SentinelResource&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><img src="C:%5cUsers%5chp%5cDesktop%5c%e5%bc%80%e5%8f%91%e6%96%87%e6%a1%a3%5cSpringCloud%5cFigure%5cimage-20241212205649011.png"
	
	
	
	loading="lazy"
	
		alt="image-20241212205649011"
	
	
></p>
<h4 id="使用此注解按资源名称限流自定义限流返回服务降级处理blockhandler针对sentinel配置出现违规情况fallback针对jvm抛出的异常启动服务降级即使有全局异常依然生效全局异常先捕获再抛出">使用此注解按资源名称限流，自定义限流返回，服务降级处理：blockHandler针对Sentinel配置出现违规情况；fallback针对JVM抛出的异常启动服务降级（即使有全局异常依然生效∵全局异常先捕获再抛出）
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/rateLimit/doAction/{p1}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@SentinelResource</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;doActionSentinelResource&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">blockHandler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;doActionBlockHandler&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">fallback</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;doActionFallback&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">doAction</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&#34;p1&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">p1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">p1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="s">&#34;p1等于0直接异常&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;doAction&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">doActionBlockHandler</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&#34;p1&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">p1</span><span class="p">,</span><span class="w"> </span><span class="n">BlockException</span><span class="w"> </span><span class="n">blockException</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 参数要在doAction的参数基础上继续添加</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&#34;sentinel配置自定义限流了:{}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">blockException</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;sentinel配置自定义限流了&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">doActionFallback</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&#34;p1&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">p1</span><span class="p">,</span><span class="w"> </span><span class="n">Throwable</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 参数要在doAction的参数基础上继续添加</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&#34;程序逻辑异常了：{}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;程序逻辑异常了&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="热点规则">热点规则
</h3><p><img src="C:%5cUsers%5chp%5cDesktop%5c%e5%bc%80%e5%8f%91%e6%96%87%e6%a1%a3%5cSpringCloud%5cFigure%5cimage-20241213144733918.png"
	
	
	
	loading="lazy"
	
		alt="image-20241213144733918"
	
	
></p>
<h4 id="只支持qps模式第参数索引个参数在统计窗口时长内如果访问次数超过单机阈值就限流调用限流方法dealhandler_testhotkey">只支持QPS模式，第“参数索引”个参数在统计窗口时长内如果访问次数超过单机阈值就限流，调用限流方法dealHandler_testHotKey
</h4><p><img src="C:%5cUsers%5chp%5cDesktop%5c%e5%bc%80%e5%8f%91%e6%96%87%e6%a1%a3%5cSpringCloud%5cFigure%5cimage-20241213151134582.png"
	
	
	
	loading="lazy"
	
		alt="image-20241213151134582"
	
	
></p>
<h4 id="当此参数等于5时允许单机阈值达到200热点参数必须是基本类型或者string">当此参数等于5时允许单机阈值达到200（热点参数必须是基本类型或者String）
</h4><p><img src="C:%5cUsers%5chp%5cDesktop%5c%e5%bc%80%e5%8f%91%e6%96%87%e6%a1%a3%5cSpringCloud%5cFigure%5cimage-20241213152235568.png"
	
	
	
	loading="lazy"
	
		alt="image-20241213152235568"
	
	
></p>
<h3 id="授权规则">授权规则
</h3><p><img src="C:%5cUsers%5chp%5cDesktop%5c%e5%bc%80%e5%8f%91%e6%96%87%e6%a1%a3%5cSpringCloud%5cFigure%5cimage-20241213153956081.png"
	
	
	
	loading="lazy"
	
		alt="image-20241213153956081"
	
	
></p>
<h4 id="当请求中包含配置的查询参数名servername若其值为testtest2限流反之通过">当请求中包含配置的查询参数名serverName，若其值为test/test2，限流，反之通过
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Component</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MyRequestOriginParser</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">RequestOriginParser</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">parseOrigin</span><span class="p">(</span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">getParameter</span><span class="p">(</span><span class="s">&#34;serverName&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><img src="C:%5cUsers%5chp%5cDesktop%5c%e5%bc%80%e5%8f%91%e6%96%87%e6%a1%a3%5cSpringCloud%5cFigure%5cimage-20241213154730481.png"
	
	
	
	loading="lazy"
	
		alt="image-20241213154730481"
	
	
></p>
<h3 id="规则持久化目前8401sentinel-service一重启配置的规则就会丢失将规则持久化进nacos保存只要nacos里面的配置不删除规则持续有效">规则持久化：目前8401Sentinel Service一重启，配置的规则就会丢失；将规则持久化进Nacos保存，只要Nacos里面的配置不删除，规则持续有效
</h3><h4 id="pom-16">pom
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="c">&lt;!--SpringCloud ailibaba sentinel-datasource-nacos --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>com.alibaba.csp<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>sentinel-datasource-nacos<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="nacos新建json配置">Nacos新建JSON配置
</h4><img src="C:\Users\hp\Desktop\开发文档\SpringCloud\Figure\image-2028.png" alt="image-20241213161522515" style="zoom: 80%;" />
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">resource：资源名称；
</span></span><span class="line"><span class="cl">limitApp：来源应用；
</span></span><span class="line"><span class="cl">grade：阈值类型，0表示线程数，1表示QPS；
</span></span><span class="line"><span class="cl">count：单机阈值；
</span></span><span class="line"><span class="cl">strategy：流控模式，0表示直接，1表示关联，2表示链路；
</span></span><span class="line"><span class="cl">controlBehavior：流控效果，0表示快速失败，1表示Warm Up，2表示排队等待；
</span></span><span class="line"><span class="cl">clusterMode：是否集群。
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="sentinel整合openfeignopenfeign在consumer调用端sentinel在provider被调用端">Sentinel整合OpenFeign：OpenFeign在Consumer调用端，Sentinel在Provider被调用端
</h2><h2 id="sentinel整合gatewayopenfeign在consumer调用端sentinel在provider被调用端">Sentinel整合Gateway：OpenFeign在Consumer调用端，Sentinel在Provider被调用端
</h2><h3 id="pom-17">pom
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-gateway<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>com.alibaba.csp<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>sentinel-transport-simple-http<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;version&gt;</span>1.8.6<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>com.alibaba.csp<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>sentinel-spring-cloud-gateway-adapter<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;version&gt;</span>1.8.6<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>javax.annotation<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>javax.annotation-api<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;version&gt;</span>1.3.2<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;scope&gt;</span>compile<span class="nt">&lt;/scope&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="seata分布式事务框架解决微服务架构下的分布式事务问题">Seata：分布式事务框架，解决微服务架构下的分布式事务问题
</h2><h3 id="面试">面试
</h3><h4 id="简历上写用了微服务bootcloud做过项目不可能只有一个数据库吧请谈谈多个数据库之间如何处理分布式事务">简历上写用了微服务boot/cloud做过项目，不可能只有一个数据库吧？请谈谈多个数据库之间如何处理分布式事务？
</h4><p><img src="C:%5cUsers%5chp%5cDesktop%5c%e5%bc%80%e5%8f%91%e6%96%87%e6%a1%a3%5cSpringCloud%5cFigure%5cimage-20241214193323544.png"
	
	
	
	loading="lazy"
	
		alt="image-20241214193323544"
	
	
></p>
<h4 id="阿里的seata-at模式如何做到对业务的无侵入">阿里的Seata-AT模式如何做到对业务的无侵入？
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Seata提供了AT、TCC、SAGA、XA事务模式
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">AT
</span></span><span class="line"><span class="cl">前提：基于支持本地ACID事务的关系型数据库，JAVA应用通过JDBC访问数据库
</span></span><span class="line"><span class="cl">整体机制：
</span></span><span class="line"><span class="cl">一阶段：业务数据和回滚日志记录再同一个本地事务中提交，释放本地锁和连接资源
</span></span><span class="line"><span class="cl">二阶段：提交异步化，非常快速地完成，回滚通过一阶段的回滚日志（undo_log表）进行反向补偿
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">在一阶段：Seata会拦截业务SQL：
</span></span><span class="line"><span class="cl">（1）解析SQL语义，找到“业务SQL”要更新的业务数据，在业务数据被更新前，将其保存成before image（原快照）
</span></span><span class="line"><span class="cl">（2）执行“业务SQL”更新业务数据
</span></span><span class="line"><span class="cl">（3）将更新之后的业务数据保存成after image，最后生成行锁
</span></span><span class="line"><span class="cl">以上操作全部在一个数据库事务内完成，这样保证了一阶段操作的原子性
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">在二阶段：
</span></span><span class="line"><span class="cl">如果是顺利提交，因为业务SQL已在一阶段提交至数据库，所以Seata只需将一阶段保存的快照数据和行锁删掉，完成数据清理即可
</span></span><span class="line"><span class="cl">如果需要出现异常需要回滚，Seata就需要回滚一阶段已经执行的“业务SQL”，还原业务数据。回滚方式便是用before image还原业务数据，但在还原前要首先校验脏写，对比“数据库当前业务数据”和after image，如果两份数据完全一致说明没有脏写，可以还原业务数据，如果不一致说明出现脏写，需要人工处理
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="一阶段">一阶段
</h5><p><img src="C:%5cUsers%5chp%5cDesktop%5c%e5%bc%80%e5%8f%91%e6%96%87%e6%a1%a3%5cSpringCloud%5cFigure%5cimage-20241216134056597.png"
	
	
	
	loading="lazy"
	
		alt="image-20241216134056597"
	
	
></p>
<h5 id="二阶段顺利">二阶段顺利
</h5><p><img src="C:%5cUsers%5chp%5cDesktop%5c%e5%bc%80%e5%8f%91%e6%96%87%e6%a1%a3%5cSpringCloud%5cFigure%5cimage-20241216140432411.png"
	
	
	
	loading="lazy"
	
		alt="image-20241216140432411"
	
	
></p>
<h5 id="二阶段回滚">二阶段回滚
</h5><p><img src="C:%5cUsers%5chp%5cDesktop%5c%e5%bc%80%e5%8f%91%e6%96%87%e6%a1%a3%5cSpringCloud%5cFigure%5cimage-20241216140925201.png"
	
	
	
	loading="lazy"
	
		alt="image-20241216140925201"
	
	
></p>
<h5 id="undo_log存储上次操作的数据异常时根据rollback_info回滚">undo_log：存储上次操作的数据，异常时根据rollback_info回滚
</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span><span class="lnt">94
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;@class&#34;</span><span class="p">:</span> <span class="s2">&#34;io.seata.rm.datasource.undo.BranchUndoLog&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;xid&#34;</span><span class="p">:</span> <span class="s2">&#34;10.249.94.181:8091:2072252975871426578&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;branchId&#34;</span><span class="p">:</span> <span class="mi">2072252975871426600</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;sqlUndoLogs&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;java.util.ArrayList&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;@class&#34;</span><span class="p">:</span> <span class="s2">&#34;io.seata.rm.datasource.undo.SQLUndoLog&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;sqlType&#34;</span><span class="p">:</span> <span class="s2">&#34;INSERT&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;tableName&#34;</span><span class="p">:</span> <span class="s2">&#34;t_order&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;beforeImage&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;@class&#34;</span><span class="p">:</span> <span class="s2">&#34;io.seata.rm.datasource.sql.struct.TableRecords$EmptyTableRecords&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;tableName&#34;</span><span class="p">:</span> <span class="s2">&#34;t_order&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;rows&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;java.util.ArrayList&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="p">[]</span>
</span></span><span class="line"><span class="cl">          <span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;afterImage&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;@class&#34;</span><span class="p">:</span> <span class="s2">&#34;io.seata.rm.datasource.sql.struct.TableRecords&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;tableName&#34;</span><span class="p">:</span> <span class="s2">&#34;t_order&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;rows&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;java.util.ArrayList&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="p">[</span>
</span></span><span class="line"><span class="cl">              <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;@class&#34;</span><span class="p">:</span> <span class="s2">&#34;io.seata.rm.datasource.sql.struct.Row&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;fields&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                  <span class="s2">&#34;java.util.ArrayList&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                  <span class="p">[</span>
</span></span><span class="line"><span class="cl">                    <span class="p">{</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;@class&#34;</span><span class="p">:</span> <span class="s2">&#34;io.seata.rm.datasource.sql.struct.Field&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;id&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;keyType&#34;</span><span class="p">:</span> <span class="s2">&#34;PRIMARY_KEY&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="mi">-5</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;value&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                        <span class="s2">&#34;java.lang.Long&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="mi">21</span>
</span></span><span class="line"><span class="cl">                      <span class="p">]</span>
</span></span><span class="line"><span class="cl">                    <span class="p">},</span>
</span></span><span class="line"><span class="cl">                    <span class="p">{</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;@class&#34;</span><span class="p">:</span> <span class="s2">&#34;io.seata.rm.datasource.sql.struct.Field&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;user_id&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;keyType&#34;</span><span class="p">:</span> <span class="s2">&#34;NULL&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="mi">-5</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;value&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                        <span class="s2">&#34;java.lang.Long&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="mi">1</span>
</span></span><span class="line"><span class="cl">                      <span class="p">]</span>
</span></span><span class="line"><span class="cl">                    <span class="p">},</span>
</span></span><span class="line"><span class="cl">                    <span class="p">{</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;@class&#34;</span><span class="p">:</span> <span class="s2">&#34;io.seata.rm.datasource.sql.struct.Field&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;product_id&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;keyType&#34;</span><span class="p">:</span> <span class="s2">&#34;NULL&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="mi">-5</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;value&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                        <span class="s2">&#34;java.lang.Long&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="mi">1</span>
</span></span><span class="line"><span class="cl">                      <span class="p">]</span>
</span></span><span class="line"><span class="cl">                    <span class="p">},</span>
</span></span><span class="line"><span class="cl">                    <span class="p">{</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;@class&#34;</span><span class="p">:</span> <span class="s2">&#34;io.seata.rm.datasource.sql.struct.Field&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;count&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;keyType&#34;</span><span class="p">:</span> <span class="s2">&#34;NULL&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;value&#34;</span><span class="p">:</span> <span class="mi">10</span>
</span></span><span class="line"><span class="cl">                    <span class="p">},</span>
</span></span><span class="line"><span class="cl">                    <span class="p">{</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;@class&#34;</span><span class="p">:</span> <span class="s2">&#34;io.seata.rm.datasource.sql.struct.Field&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;money&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;keyType&#34;</span><span class="p">:</span> <span class="s2">&#34;NULL&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;value&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                        <span class="s2">&#34;java.math.BigDecimal&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="mi">100</span>
</span></span><span class="line"><span class="cl">                      <span class="p">]</span>
</span></span><span class="line"><span class="cl">                    <span class="p">},</span>
</span></span><span class="line"><span class="cl">                    <span class="p">{</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;@class&#34;</span><span class="p">:</span> <span class="s2">&#34;io.seata.rm.datasource.sql.struct.Field&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;status&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;keyType&#34;</span><span class="p">:</span> <span class="s2">&#34;NULL&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;value&#34;</span><span class="p">:</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">                    <span class="p">}</span>
</span></span><span class="line"><span class="cl">                  <span class="p">]</span>
</span></span><span class="line"><span class="cl">                <span class="p">]</span>
</span></span><span class="line"><span class="cl">              <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">]</span>
</span></span><span class="line"><span class="cl">          <span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="对于分布式事务问题你知道的解决方案有哪些请你谈谈">对于分布式事务问题，你知道的解决方案有哪些？请你谈谈？
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">1、2PC（两阶段提交）
</span></span><span class="line"><span class="cl">2、3PC（三阶段提交）
</span></span><span class="line"><span class="cl">3、TCC（Try-Confirm-Cancel）又被称为补偿事务，类似2PC的柔性分布式解决方案，2PC改良版
</span></span><span class="line"><span class="cl">4、LocalMessage本地消息表
</span></span><span class="line"><span class="cl">5、独立消息微服务+RabbitMQ/Kafka组件，实现可靠消息最终一致性
</span></span><span class="line"><span class="cl">6、最大努力通知方案
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="上述面试问题都指向一个重要问题">上述面试问题都指向一个重要问题
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">一次业务操作需要跨多个数据源或需要跨多个系统进行远程调用，就会产生分布式事务问题，但关系型数据库提供的能力是基于单机事务的，一旦遇到分布式事务场景，就需要通过更多其他技术手段来解决问题。
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="C:%5cUsers%5chp%5cDesktop%5c%e5%bc%80%e5%8f%91%e6%96%87%e6%a1%a3%5cSpringCloud%5cFigure%5cimage-20241214194215368.png"
	
	
	
	loading="lazy"
	
		alt="image-20241214194215368"
	
	
></p>
<h3 id="seata的工作流程">Seata的工作流程
</h3><h4 id="xidtctmrm">XID、TC+TM+RM
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">XID：全局事务的唯一标识，可以在服务的调用链路中传递，绑定到服务的事务上下文中
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">TC（Transaction Coordinator）:事务协调者。维护全局和分支事务的状态，驱动全局事务提交或回滚
</span></span><span class="line"><span class="cl">就是Seata本身（有且仅有一个）
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">TM（Transaction Manager）：事务管理器。事务的发起者，负责定义全局事务的范围，并根据TC维护的全局事务和分支事务状态，做出开始全局事务、提交/回滚全局事务的决议
</span></span><span class="line"><span class="cl">标注了@GlobalTransactional启动入口动作的微服务模块（比如订单模块）（有且仅有一个）
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">RM（Resource Manager）：资源管理器。负责管理分支事务上的资源，向TC注册分支事务和报告分支事务的状态，并驱动分支事务提交或回滚
</span></span><span class="line"><span class="cl">MySQL数据库本身（可以多个）
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">一般标注@GlobalTransactional的模块既是TM也是RM
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">三个组件相互协作，TC以Seata服务器形式独立部署，TM/RM则是以Seata Client的形式集成在微服务中运行
</span></span><span class="line"><span class="cl">流程：
</span></span><span class="line"><span class="cl">（1）TM 向 TC 申请开启一个全局事务，全局事务创建成功并生成一个全局唯一的 XID；
</span></span><span class="line"><span class="cl">（2）XID 在微服务调用链路的上下文中传播；
</span></span><span class="line"><span class="cl">（3）RM 向 TC 注册分支事务，将其纳入 XID 对应全局事务的管辖；
</span></span><span class="line"><span class="cl">（4）TM 向 TC 发起针对 XID 的全局提交或回滚决议；
</span></span><span class="line"><span class="cl">（5）TC 调度 XID 下管辖的全部分支事务完成提交或回滚请求。
</span></span><span class="line"><span class="cl">不管是全局还是分支，只要是事务的注册就找TC
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="C:%5cUsers%5chp%5cDesktop%5c%e5%bc%80%e5%8f%91%e6%96%87%e6%a1%a3%5cSpringCloud%5cFigure%5cimage-20241214201522026.png"
	
	
	
	loading="lazy"
	
		alt="image-20241214201522026"
	
	
></p>
<h3 id="cmd指令-4">cmd指令
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cmd" data-lang="cmd"><span class="line"><span class="cl">运行
</span></span><span class="line"><span class="cl">seata-server.bat
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">打开
</span></span><span class="line"><span class="cl">http://localhost:7091
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">用户名、密码均为：seata
</span></span></code></pre></td></tr></table>
</div>
</div>
</section>


    <footer class="article-footer">
    

    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
</article>

    

    

     
    
        
    <div class="disqus-container">
    <div id="disqus_thread"></div>
<script>
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "hugo-theme-stack" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

<style>
    .disqus-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
    }
</style>

<script>
    window.addEventListener('onColorSchemeChange', (e) => {
        if (typeof DISQUS == 'object') {
            DISQUS.reset({
                reload: true
            });
        }
    })
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2020 - 
        
        2025 Example Person
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.30.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
